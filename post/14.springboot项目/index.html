<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>基于springboot框架的电商系统 - Daniel1n - Welcome to My Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Daniel1n" /><meta name="description" content="GitHub: https://github.com/daniel1n/tmall_springboot 一、开发流程 1.1 技术选型 前端：HTML、CSS、JavaScript、JSON、Jquery、Ajax、Bootstrap、Vue.js 后" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.69.2 with theme even" />


<link rel="canonical" href="https://daniel1n.github.io/post/14.springboot%E9%A1%B9%E7%9B%AE/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.8c3cbcb0324c2bb4875ceccba4007cbad4b4ac8377f33af9953c3e7684534a50.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="基于springboot框架的电商系统" />
<meta property="og:description" content="GitHub: https://github.com/daniel1n/tmall_springboot 一、开发流程 1.1 技术选型 前端：HTML、CSS、JavaScript、JSON、Jquery、Ajax、Bootstrap、Vue.js 后" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://daniel1n.github.io/post/14.springboot%E9%A1%B9%E7%9B%AE/" />
<meta property="article:published_time" content="2020-05-29T00:25:13+08:00" />
<meta property="article:modified_time" content="2020-05-29T00:25:13+08:00" />
<meta itemprop="name" content="基于springboot框架的电商系统">
<meta itemprop="description" content="GitHub: https://github.com/daniel1n/tmall_springboot 一、开发流程 1.1 技术选型 前端：HTML、CSS、JavaScript、JSON、Jquery、Ajax、Bootstrap、Vue.js 后">
<meta itemprop="datePublished" content="2020-05-29T00:25:13&#43;08:00" />
<meta itemprop="dateModified" content="2020-05-29T00:25:13&#43;08:00" />
<meta itemprop="wordCount" content="51469">



<meta itemprop="keywords" content="Spring Framework,SpringMVC,springboot,jpa," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="基于springboot框架的电商系统"/>
<meta name="twitter:description" content="GitHub: https://github.com/daniel1n/tmall_springboot 一、开发流程 1.1 技术选型 前端：HTML、CSS、JavaScript、JSON、Jquery、Ajax、Bootstrap、Vue.js 后"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Daniel1n</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Daniel1n</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">基于springboot框架的电商系统</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-05-29 </span>
        <div class="post-category">
            <a href="/categories/springboot/"> springboot </a>
            </div>
          <span class="more-meta"> 51469 words </span>
          <span class="more-meta"> 103 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#11-技术选型">1.1 技术选型</a></li>
    <li><a href="#12--具体流程">1.2  具体流程</a>
      <ul>
        <li><a href="#121-需求分析">1.2.1 需求分析</a></li>
        <li><a href="#122-表结构的设计">1.2.2 表结构的设计</a></li>
        <li><a href="#123-原型-后端">1.2.3 原型-后端</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#21-静态资源">2.1 静态资源</a></li>
    <li><a href="#22-创建项目">2.2 创建项目</a></li>
    <li><a href="#23-后台操作">2.3 后台操作</a>
      <ul>
        <li><a href="#231-项目配置">2.3.1 项目配置</a></li>
        <li><a href="#232-项目工具">2.3.2 项目工具</a></li>
        <li><a href="#233-分类管理的操作">2.3.3 分类管理的操作</a></li>
        <li><a href="#234-属性管理的操作">2.3.4 属性管理的操作</a></li>
        <li><a href="#235-产品管理的操作">2.3.5 产品管理的操作</a></li>
        <li><a href="#236-产品图片管理">2.3.6 产品图片管理</a></li>
        <li><a href="#237--产品属性管理">2.3.7  产品属性管理</a></li>
        <li><a href="#238-用户管理">2.3.8 用户管理</a></li>
        <li><a href="#239-订单管理">2.3.9 订单管理</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#31-前台管理-无需登录">3.1 前台管理-无需登录</a>
      <ul>
        <li><a href="#311-首页功能">3.1.1 首页功能</a></li>
        <li><a href="#312-注册功能">3.1.2 注册功能</a></li>
        <li><a href="#313--登录功能">3.1.3  登录功能</a></li>
        <li><a href="#314--退出登录">3.1.4  退出登录</a></li>
        <li><a href="#315-产品的详情页">3.1.5 产品的详情页</a></li>
        <li><a href="#316-分类的详情页">3.1.6 分类的详情页</a></li>
        <li><a href="#317--搜索页面">3.1.7  搜索页面</a></li>
      </ul>
    </li>
    <li><a href="#32-前台管理-需要登录">3.2 前台管理-需要登录</a>
      <ul>
        <li><a href="#311--立即购买">3.1.1  立即购买</a></li>
        <li><a href="#312--结算页面">3.1.2  结算页面</a></li>
        <li><a href="#313-加入购物车">3.1.3 加入购物车</a></li>
        <li><a href="#314--查看购物车页面">3.1.4  查看购物车页面</a></li>
        <li><a href="#315-拦截器">3.1.5 拦截器</a></li>
        <li><a href="#316-购物车页面操作">3.1.6 购物车页面操作</a></li>
        <li><a href="#317-订单的操作">3.1.7 订单的操作</a></li>
        <li><a href="#318-评论的功能">3.1.8 评论的功能</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<p>GitHub: <a href="https://github.com/daniel1n/tmall_springboot">https://github.com/daniel1n/tmall_springboot</a></p>
</blockquote>
<h1 id="一开发流程">一、开发流程</h1>
<h2 id="11-技术选型">1.1 技术选型</h2>
<blockquote>
<p>前端：HTML、CSS、JavaScript、JSON、Jquery、Ajax、Bootstrap、Vue.js</p>
<p>后端：Tomcat、Servlet、Jsp、Filter</p>
<p>框架：Spring、Spring MVC、Springboot</p>
<p>中间件：redis、nginx、elasticsearch、shiro</p>
<p>数据库：Mysql</p>
<p>开发工具：Interllij IDEA、Maven</p>
</blockquote>
<h2 id="12--具体流程">1.2  具体流程</h2>
<blockquote>
<p>1.需求分析</p>
<ul>
<li>需要确定做的功能模块，包括前台和后台</li>
</ul>
<p>2.表结构设计</p>
<ul>
<li>每个功能模块对应的表关系</li>
</ul>
<p>3.原型</p>
<ul>
<li>界面原型：前台原型和后台原型</li>
</ul>
<p>4.后台-分类管理</p>
<ul>
<li>功能模块之间的依赖关系，JSP包含关系，具体的功能包括：查询、分页、增加、删除、编辑、修改</li>
</ul>
<p>5.项目重构</p>
<ul>
<li>分页模块的重构、Mybatis的逆向工程</li>
</ul>
<p>6.后台-其他管理</p>
<ul>
<li>分类管理、产品管理、用户管理、订单管理</li>
</ul>
<p>7.前台-首页</p>
<p>8.前台无需登录</p>
<ul>
<li>无需登录状态下的功能模块：</li>
</ul>
<p>9.前台需要登录</p>
<ul>
<li>购物相关功能，购物流程环节与表关系</li>
</ul>
<p>10.总结</p>
<ul>
<li>项目的整体结构，实现了那些典型场景、运用了哪些设计模式</li>
</ul>
</blockquote>
<h3 id="121-需求分析">1.2.1 需求分析</h3>
<h4 id="需求分析-前台展示层"><strong>需求分析-前台展示层</strong></h4>
<blockquote>
<p>1.首页</p>
<ul>
<li>横向导航栏上提供4个分类连接</li>
<li>纵向导航栏上提供全部17个分类连接</li>
<li>鼠标移动到某一个纵向分类连接时，显示该分类下的推荐商品</li>
<li>按照每种分类显示5个商品的方式，显示所有17种分类的产品</li>
</ul>
<p>2.产品页</p>
<ul>
<li>显示分辨率为950*100的当前商品对应的分类图片</li>
<li>显示本商品的5个单独图片</li>
<li>商品的基本信息：标题、小标题、价格、销量、评价数量、库存</li>
<li>商品详情</li>
<li>评价信息</li>
<li>五张商品详细图片</li>
</ul>
<p>3.分类页</p>
<ul>
<li>搜索框及搜索框下的分类连接</li>
<li>显示分辨率为950*100的当前分类图片</li>
<li>显示本分类下的所有产品</li>
</ul>
<p>4.搜索结构页</p>
<ul>
<li>搜索框及搜索框下的分类连接</li>
<li>显示满足查询条件的商品</li>
</ul>
<p>5.购物车查看页</p>
<ul>
<li>购物车中的订单项，包含商品信息、单价、数量、金额、结算</li>
</ul>
<p>6.结算页面</p>
<ul>
<li>结算页面显示被选中的订单项，提交订单</li>
</ul>
<p>7.确认支付页</p>
<ul>
<li>支付方式的选择</li>
</ul>
<p>8.支付成功页</p>
<ul>
<li>付款成功时，显示本次付款金额、<strong>收货地址</strong>、<strong>物流信息查询</strong>连接、查看订单连接</li>
</ul>
<p>9.我的订单页</p>
<ul>
<li>显示所有订单，以及对应的订单项</li>
</ul>
<p>10.确认收货页</p>
<ul>
<li>显示订单内容</li>
<li>显示订单信息、收货人地址</li>
</ul>
<p>11.评价页</p>
<ul>
<li>
<p>显示要评价的商品信息，商品当前的总评价数</p>
</li>
<li>
<p>评价成功后，显示当前商品所有的评价信息</p>
</li>
</ul>
<p>12.页头信息</p>
<ul>
<li>
<p>未登录状态：请登录、免费注册、购物车为0</p>
</li>
<li>
<p>登录状态：用户名称、退出登录、购物车的数量显示</p>
</li>
</ul>
</blockquote>
<h4 id="需求分析-服务端交互层"><strong>需求分析-服务端交互层</strong></h4>
<blockquote>
<p>1.分类页排序</p>
<ul>
<li>
<p>按照综合、人气、新品、销量、价格排序</p>
</li>
<li>
<p>进行价格筛选、客户端的展示层，并没有跟服务端交互</p>
</li>
</ul>
<p>2.立即购买</p>
<ul>
<li>在产品页，未登录状态时，点击立即购买，弹出登录模态窗口</li>
<li>在产品页，已登录状态时，点击立即购买，提交数据到服务端、生成订单、跳转结算页面</li>
</ul>
<p>3.加入购物车</p>
<ul>
<li>在产品页，未登录状态时，点击加入购物车，弹出登录模态窗口</li>
<li>在产品页，在登录状态时，点击加入购物车，使用ajax异步提交数据到服务端，生成订单，并使当前“加入购物车“按钮，变得不可点击</li>
</ul>
<p>4.调整订单项</p>
<ul>
<li>在购物车页面，调整订单项数量，<strong>订单项的属性选择</strong></li>
</ul>
<p>5.删除订单项</p>
<ul>
<li>在购物车页面，删除订单项，首先弹出模态窗口确认是否要删除，如果要删除，则通过Ajax异步发送指令到服务端，并在当前页面删除该条订单项</li>
</ul>
<p>6.生成订单</p>
<ul>
<li>在结算页面，提交订单时候，根据结算页面的收货人信息，订单信息，生成订单数据</li>
</ul>
<p>7.订单页</p>
<ul>
<li>订单页上有三个按钮，付款、确认收货和评价，这些按钮都没有提交数据到服务端，而是提交到下一个页面的二次操作，才能提交数据到服务端</li>
</ul>
<p>8.确认付款</p>
<ul>
<li>点击确认支付，提交本信息到服务端，服务端修改订单中的支付日期</li>
</ul>
<p>9.确认收货</p>
<ul>
<li>确认收货页面，点击确认支付，提交数据到服务端，并修改订单中的确认收货日期</li>
</ul>
<p>10.提交评价信息</p>
<ul>
<li>提交评价信息到服务端</li>
</ul>
<p>11.登录</p>
<ul>
<li>输入正确账号密码，与服务端中的账号信息进行判断，正确即登录成功，跳转首页，失败提示错误信息</li>
</ul>
<p>12.注册</p>
<ul>
<li>新增账户的用户名与密码，与服务端中的账户信息进行判断，重复，显示用户名已被注册</li>
</ul>
<p>13.退出</p>
<ul>
<li>移除session，页面跳转到未登录状态</li>
</ul>
<p>14.搜索</p>
<ul>
<li>提交关键字到服务端，服务端查询数据库，进行模糊查询，返回匹配的产品</li>
</ul>
</blockquote>
<p><strong>需求分析-前端页面的总结：</strong></p>
<blockquote>
<p>首页</p>
<ul>
<li>在横向导航栏上提供4个分类连接</li>
<li>在纵向导航栏上提供全部17个分类连接</li>
<li>当鼠标移动到某一个纵向分类连接的时候，显示这个分类下的推荐商品</li>
<li>按照每种分类，显示5个商品的方式显示所有17种分类</li>
</ul>
<p>产品页</p>
<ul>
<li>显示分辨率为950x100的当前商品对应的分类图片</li>
<li>显示本商品的5个单独图片</li>
<li>商品的基本信息，如标题，小标题，价格，销量，评价数量，库存等</li>
<li>商品详情</li>
<li>评价信息</li>
<li>5张商品详细图片</li>
<li><strong>立即购买</strong></li>
<li><strong>加入购物车</strong></li>
</ul>
<p>分类页</p>
<ul>
<li>显示分辨率为950x100的当前分类图片</li>
<li>显示本分类下的所有产品</li>
<li><strong>分类页排序</strong></li>
</ul>
<p>搜索结果页</p>
<ul>
<li>显示满足查询条件的商品</li>
</ul>
<p>购物车查看页</p>
<ul>
<li>在购物车中显示订单项</li>
<li><strong>调整订单项数量</strong></li>
<li><em>删除订单项</em>*</li>
</ul>
<p>结算页</p>
<ul>
<li>在结算页面显示被选中的订单项</li>
<li><strong>生成订单</strong></li>
</ul>
<p>确认支付页</p>
<ul>
<li>确认支付页面显示本次订单的金额总数</li>
<li><strong>确认付款</strong></li>
</ul>
<p>支付成功页</p>
<ul>
<li>付款成功时，显示本次付款金额</li>
</ul>
<p>我的订单页</p>
<ul>
<li>显示所有订单，以及对应的订单项</li>
</ul>
<p>确认收货页</p>
<ul>
<li>显示订单项内容</li>
<li>显示订单信息，收货人地址等</li>
<li><strong>确认收货</strong></li>
</ul>
<p>评价页</p>
<ul>
<li>显示要评价的商品信息，商品当前的总评价数</li>
<li>评价成功后，显示当前商品所有的评价信息</li>
<li><strong>提交评价信息</strong></li>
</ul>
<p>页头信息展示</p>
<ul>
<li>未登录状态</li>
<li>已登录状态</li>
<li><strong>登录</strong></li>
<li><strong>注册</strong></li>
<li><strong>退出</strong></li>
</ul>
<p>所有页面</p>
<ul>
<li><strong>搜索</strong></li>
</ul>
</blockquote>
<h4 id="需求分析-后台展示层"><strong>需求分析-后台展示层</strong></h4>
<blockquote>
<p>1.分类管理</p>
<ol>
<li>分页查询</li>
<li>新增分类</li>
<li>编辑修改</li>
<li>删除</li>
</ol>
<p>2.属性管理</p>
<ol>
<li>产品属性</li>
<li>分页查询</li>
<li>新增属性</li>
<li>编辑修改</li>
<li>删除</li>
</ol>
<p>3.产品管理</p>
<ol>
<li>分页查询</li>
<li>新增产品</li>
<li>编辑修改</li>
<li>删除</li>
</ol>
<p>4.产品图片</p>
<ol>
<li>产品图片分类：单个产品图片（头像），产品的多个详细图片（信息）</li>
<li>产品管理：单个产品图片（像素400×400，使用图片列表中的第一个），详细图片（790×790）</li>
</ol>
<p>5.产品属性值设置</p>
<p>6.用户管理</p>
<ol>
<li>用户查询页面，不可更改</li>
<li>用户信息的修改，应由前端的用户自行修改</li>
<li>用户的增加，也是由前端注册增加</li>
</ol>
<p>7.订单管理</p>
<ol>
<li>订单分页查询</li>
<li>查看详情：订单有哪些订单项组成</li>
<li>发货</li>
</ol>
</blockquote>
<h3 id="122-表结构的设计">1.2.2 表结构的设计</h3>
<p>新建数据库：tmall_ssm_rebuild</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="c1">-- 新增数据库:tmall_ssm
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">tmall_ssm_rebuild</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf8</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>根据需求需要9张表</p>
<p><img src="https://stepimagewm.how2j.cn/6041.png" alt="image"></p>
<p>表的具体信息</p>
<table>
<thead>
<tr>
<th>表名</th>
<th>中文含义</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>Category</td>
<td>分类表</td>
<td>存放分类信息，如女装，平板电视，沙发等</td>
</tr>
<tr>
<td>Property</td>
<td>属性表</td>
<td>存放属性信息，如颜色，重量，品牌，厂商，型号等</td>
</tr>
<tr>
<td>Product</td>
<td>产品表</td>
<td>存放产品信息，如LED40EC平板电视机，海尔EC6005热水器</td>
</tr>
<tr>
<td>PropertyValue</td>
<td>属性值表</td>
<td>存放属性值信息，如重量是900g,颜色是粉红色</td>
</tr>
<tr>
<td>ProductImage</td>
<td>产品图片表</td>
<td>存放产品图片信息，如产品页显示的5个图片</td>
</tr>
<tr>
<td>Review</td>
<td>评论表</td>
<td>存放评论信息，如买回来的蜡烛很好用，么么哒</td>
</tr>
<tr>
<td>User</td>
<td>用户表</td>
<td>存放用户信息，如斩手狗，千手小粉红</td>
</tr>
<tr>
<td>OrderForm</td>
<td>订单表</td>
<td>存放订单信息，包括邮寄地址，电话号码等信息</td>
</tr>
<tr>
<td>OrderItem</td>
<td>订单项表</td>
<td>存放订单项信息，包括购买产品种类，数量等</td>
</tr>
</tbody>
</table>
<p>表的关系</p>
<table>
<thead>
<tr>
<th>一</th>
<th>多</th>
</tr>
</thead>
<tbody>
<tr>
<td>Category-分类</td>
<td>Product-产品</td>
</tr>
<tr>
<td>Category-分类</td>
<td>Property-属性</td>
</tr>
<tr>
<td>Property-属性</td>
<td>PropertyValue-属性值</td>
</tr>
<tr>
<td>Product-产品</td>
<td>PropertyValue-属性值</td>
</tr>
<tr>
<td>Product-产品</td>
<td>ProductImage-产品图片</td>
</tr>
<tr>
<td>Product-产品</td>
<td>Review-评价</td>
</tr>
<tr>
<td>User-用户</td>
<td>OrderForm-订单</td>
</tr>
<tr>
<td>Product-产品</td>
<td>OrderItem-订单项</td>
</tr>
<tr>
<td>User-用户</td>
<td>OrderItem-订单项</td>
</tr>
<tr>
<td>OrderForm-订单</td>
<td>OrderItem-订单项</td>
</tr>
<tr>
<td>User-用户</td>
<td>Review-评价</td>
</tr>
</tbody>
</table>
<p>创建表</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">DROP DATABASE IF EXISTS tmall_springboot;
CREATE DATABASE tmall_springboot DEFAULT CHARACTER SET utf8;
USE tmall_springboot;
 
CREATE TABLE user (
  id int(11) NOT NULL AUTO_INCREMENT,
  name varchar(255) DEFAULT NULL, 
  password varchar(255) DEFAULT NULL,
  salt varchar(255) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
 
CREATE TABLE category (
  id int(11) NOT NULL AUTO_INCREMENT,
  name varchar(255) DEFAULT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8;
 
CREATE TABLE property (
  id int(11) NOT NULL AUTO_INCREMENT,
  cid int(11) DEFAULT NULL,
  name varchar(255) DEFAULT NULL,
  PRIMARY KEY (id),
  CONSTRAINT fk_property_category FOREIGN KEY (cid) REFERENCES category (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
 
CREATE TABLE product (
  id int(11) NOT NULL AUTO_INCREMENT,
  name varchar(255) DEFAULT NULL,
  subTitle varchar(255) DEFAULT NULL,
  originalPrice float DEFAULT NULL,
  promotePrice float DEFAULT NULL,
  stock int(11) DEFAULT NULL,
  cid int(11) DEFAULT NULL,
  createDate datetime DEFAULT NULL,
  PRIMARY KEY (id),
  CONSTRAINT fk_product_category FOREIGN KEY (cid) REFERENCES category (id)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8;
 
CREATE TABLE propertyvalue (
  id int(11) NOT NULL AUTO_INCREMENT,
  pid int(11) DEFAULT NULL,
  ptid int(11) DEFAULT NULL,
  value varchar(255) DEFAULT NULL,
  PRIMARY KEY (id),
  CONSTRAINT fk_propertyvalue_property FOREIGN KEY (ptid) REFERENCES property (id),
  CONSTRAINT fk_propertyvalue_product FOREIGN KEY (pid) REFERENCES product (id)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8;
 
CREATE TABLE productimage (
  id int(11) NOT NULL AUTO_INCREMENT,
  pid int(11) DEFAULT NULL,
  type varchar(255) DEFAULT NULL,
  PRIMARY KEY (id),
  CONSTRAINT fk_productimage_product FOREIGN KEY (pid) REFERENCES product (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
 
CREATE TABLE review (
  id int(11) NOT NULL AUTO_INCREMENT,
  content varchar(4000) DEFAULT NULL,
  uid int(11) DEFAULT NULL,
  pid int(11) DEFAULT NULL,
  createDate datetime DEFAULT NULL,
  PRIMARY KEY (id),
  CONSTRAINT fk_review_product FOREIGN KEY (pid) REFERENCES product (id),
    CONSTRAINT fk_review_user FOREIGN KEY (uid) REFERENCES user (id)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8;
 
CREATE TABLE order_ (
  id int(11) NOT NULL AUTO_INCREMENT,
  orderCode varchar(255) DEFAULT NULL,
  address varchar(255) DEFAULT NULL,
  post varchar(255) DEFAULT NULL,
  receiver varchar(255) DEFAULT NULL,
  mobile varchar(255) DEFAULT NULL,
  userMessage varchar(255) DEFAULT NULL,
  createDate datetime DEFAULT NULL,
  payDate datetime DEFAULT NULL,
  deliveryDate datetime DEFAULT NULL,
  confirmDate datetime DEFAULT NULL,
  uid int(11) DEFAULT NULL,
  status varchar(255) DEFAULT NULL,
  PRIMARY KEY (id),
  CONSTRAINT fk_order_user FOREIGN KEY (uid) REFERENCES user (id)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8;
 
CREATE TABLE orderitem (
  id int(11) NOT NULL AUTO_INCREMENT,
  pid int(11) DEFAULT NULL,
  oid int(11) DEFAULT NULL,
  uid int(11) DEFAULT NULL,
  number int(11) DEFAULT NULL,
  PRIMARY KEY (id),
  CONSTRAINT fk_orderitem_user FOREIGN KEY (uid) REFERENCES user (id),
  CONSTRAINT fk_orderitem_product FOREIGN KEY (pid) REFERENCES product (id),
  CONSTRAINT fk_orderitem_order FOREIGN KEY (oid) REFERENCES order_ (id)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8;
</code></pre></td></tr></table>
</div>
</div><h3 id="123-原型-后端">1.2.3 原型-后端</h3>
<p>分类管理</p>
<p><img src="/media/image-20200523162550911.png" alt="image-20200523162550911"></p>
<p>属性管理</p>
<p><img src="/media/image-20200523162608101.png" alt="image-20200523162608101"></p>
<p>产品管理</p>
<p><img src="/media/image-20200523162617221.png" alt="image-20200523162617221"></p>
<p>产品图片管理</p>
<p><img src="/media/image-20200523162635768.png" alt="image-20200523162635768"></p>
<p>产品属性管理</p>
<p><img src="/media/image-20200523162721251.png" alt="image-20200523162721251"></p>
<p>用户管理</p>
<p><img src="/media/image-20200523162746340.png" alt="image-20200523162746340"></p>
<p>订单管理</p>
<p><img src="/media/image-20200523162808085.png" alt="image-20200523162808085"></p>
<h1 id="二-后台管理">二、 后台管理</h1>
<h2 id="21-静态资源">2.1 静态资源</h2>
<p>需要在resources/static目录下，导入图片资源img</p>
<p>需要在resources/static目录下，导入css资源</p>
<blockquote>
<ol>
<li>
<p>back</p>
<p>后台界面需要的样式</p>
</li>
<li>
<p>bootstrap</p>
<p>bootstrap的css样式文件</p>
</li>
<li>
<p>fore</p>
<p>前台界面需要的样式</p>
</li>
</ol>
</blockquote>
<p>需要在resources/static目录下，导入js资源</p>
<blockquote>
<p>/bootstrap：bootstrap用到的js文件</p>
<p>/jquery：jquery用到的js文件</p>
<p>/axios：ajax 库</p>
<p>/moment：日期格式化库</p>
<p>/vue ：vue.js 库</p>
</blockquote>
<p>需要在reources/templates目录下，存放各种html文件</p>
<h2 id="22-创建项目">2.2 创建项目</h2>
<p>点击Create New Project新建项目</p>
<blockquote>
<ol>
<li>左边选中Spring Initializr</li>
<li>勾选Custom: <a href="https://start.aliyun.com/">https://start.aliyun.com/</a></li>
<li>Next</li>
<li>选择spring web</li>
</ol>
</blockquote>
<p>项目参数</p>
<blockquote>
<p>GroupId: com.qqlin.tmall</p>
<p>ArtifactId: tmall_springboot</p>
<p>version：1.0-SNAPSHOT</p>
<p>springboot: 1.5.9.RELEASE</p>
</blockquote>
<p>导入maven依赖pom.xml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;project</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class="na">xmlns=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.qqlin.tmall<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>tmall_springboot<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;name&gt;</span>tmall_springboot<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;description&gt;</span>tmall_springboot<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.5.9.RELEASE<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!-- springboot web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- springboot tomcat 支持 --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- 热部署 --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- jpa--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- redis --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- springboot test --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- thymeleaf --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- elastic search --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-elasticsearch<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- 用了 elasticsearch 就要加这么一个，不然要com.sun.jna.Native 错误 --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.sun.jna<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jna<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.0.9<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- thymeleaf legacyhtml5 模式支持 --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>net.sourceforge.nekohtml<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>nekohtml<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.9.22<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- 测试支持 --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- tomcat的支持.--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.tomcat.embed<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>tomcat-embed-jasper<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>8.5.23<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- mysql--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.21<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- junit --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- commons-lang --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>commons-lang<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>commons-lang<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.6<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- shiro --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.shiro<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>shiro-spring<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.3.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- hsqldb --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.hsqldb<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>hsqldb<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>在java目录下新增源代码</p>
<blockquote>
<p>比较器：com.qqlin.comparator</p>
<p>配置器：com.qqlin.tmall.config</p>
<p>持久层：com.qqlin.tmall.dao</p>
<p>异常处理：com.qqlin.tmall.exception</p>
<p>拦截器：com.qqlin.tmall.interceptor</p>
<p>shiro相关：com.qqlin.tmall.realm</p>
<p>service层：com.qqlin.tmall.service</p>
<p>工具：com.qqlin.tmall.util</p>
<p>控制器：com.qqlin.tmall.web</p>
<p>启动类：Application</p>
</blockquote>
<p><strong>配置文件</strong></p>
<p>application.yml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">server</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">context-path</span><span class="p">:</span><span class="w"> </span>/tmall_springboot<span class="w">
</span><span class="w">  </span><span class="k">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">spring</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c">#database</span><span class="w">
</span><span class="w">  </span><span class="k">datasource</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">driver-class-name</span><span class="p">:</span><span class="w"> </span>com.mysql.jdbc.Driver<span class="w">
</span><span class="w">    </span><span class="k">url</span><span class="p">:</span><span class="w"> </span>jdbc<span class="p">:</span>mysql<span class="p">:</span>//<span class="m">127.0.0.1</span><span class="p">:</span><span class="m">3306</span>/tmall_springboot<span class="p">?</span>characterEncoding=UTF<span class="m">-8</span><span class="w">
</span><span class="w">    </span><span class="k">username</span><span class="p">:</span><span class="w"> </span>root<span class="w">
</span><span class="w">    </span><span class="k">password</span><span class="p">:</span><span class="w"> </span>admin<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c">#设置上传文件大小，默认只有1 m</span><span class="w">
</span><span class="w">  </span><span class="k">http</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">multipart</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">maxFileSize</span><span class="p">:</span><span class="w"> </span>100Mb<span class="w">
</span><span class="w">      </span><span class="k">maxRequestSize</span><span class="p">:</span><span class="w"> </span>100Mb<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c">#设置jpa</span><span class="w">
</span><span class="w">  </span><span class="k">jpa</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">hibernate</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">ddl-auto</span><span class="p">:</span><span class="w"> </span>none<span class="w">
</span><span class="w">      </span><span class="k">naming</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">physical-strategy</span><span class="p">:</span><span class="w"> </span>org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl<span class="w">
</span><span class="w">    </span><span class="c">#显示 hibernate运行的 sql 语句</span><span class="w">
</span><span class="w">    </span><span class="k">show-sql</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c">#设置thymeleaf</span><span class="w">
</span><span class="w">  </span><span class="k">thymeleaf</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">cache</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">    </span><span class="k">content-type</span><span class="p">:</span><span class="w"> </span>text/html<span class="w">
</span><span class="w">    </span><span class="k">encoding</span><span class="p">:</span><span class="w"> </span>UTF<span class="m">-8</span><span class="w">
</span><span class="w">    </span><span class="k">mode</span><span class="p">:</span><span class="w"> </span>LEGACYHTML5<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c">#设置redis</span><span class="w">
</span><span class="w">  </span><span class="k">redis</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c">#Redis数据库索引（默认为0）</span><span class="w">
</span><span class="w">    </span><span class="k">database</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="w">    </span><span class="c">#Redis服务器地址</span><span class="w">
</span><span class="w">    </span><span class="k">host</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="w">
</span><span class="w">    </span><span class="c">#Redis服务器连接端口</span><span class="w">
</span><span class="w">    </span><span class="k">port</span><span class="p">:</span><span class="w"> </span><span class="m">6379</span><span class="w">
</span><span class="w">    </span><span class="c">#Redis服务器连接密码（默认为空）</span><span class="w">
</span><span class="w">    </span><span class="k">password</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">pool</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="c">#连接池最大连接数（使用负值表示没有限制）</span><span class="w">
</span><span class="w">      </span><span class="k">max-active</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">      </span><span class="c">#连接池中的最大空闲连接</span><span class="w">
</span><span class="w">      </span><span class="k">max-idle</span><span class="p">:</span><span class="w"> </span><span class="m">8</span><span class="w">
</span><span class="w">      </span><span class="c">#连接池最大阻塞等待时间（使用负值表示没有限制）</span><span class="w">
</span><span class="w">      </span><span class="k">max-wait</span><span class="p">:</span><span class="w"> </span>-<span class="m">1</span><span class="w">
</span><span class="w">      </span><span class="c">#连接池中的最小空闲连接</span><span class="w">
</span><span class="w">      </span><span class="k">min-idle</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="w">    </span><span class="c">#连接超时时间（毫秒）</span><span class="w">
</span><span class="w">    </span><span class="k">timeout</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c">#设置ElasticSearch的port</span><span class="w">
</span><span class="w">  </span><span class="k">data</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">elasticsearch</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">cluster-nodes</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="p">:</span><span class="m">9300</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="23-后台操作">2.3 后台操作</h2>
<p>在项目com.qqlin.tmall目录下，新建dao目录，然后分别在dao目录下，新增entity实体类和repository仓库类</p>
<blockquote>
<p>entity实体类，对应的是数据库中创建的表，字段内容和实体类中的变量一一对应。</p>
<p>repository仓库类，对应的是dao层对数据库的操作方法。</p>
</blockquote>
<p>在项目com.qqlin.tmall目录下，新建web目录，提供后台操作的控制器</p>
<p>在项目com.qqlin.tmall目录下，新建config目录，提供项目的配置</p>
<p>在项目com.qqlin.tmall目录下，新建exception目录，提供项目的异常显示情况</p>
<p>在项目com.qqlin.tmall目录下，新建util目录，提供项目实现的工具类</p>
<h3 id="231-项目配置">2.3.1 项目配置</h3>
<p>请求跨域配置，用于允许所有的请求都跨域。
因为是二次请求，第一次是获取 html 页面， 第二次通过 html 页面上的 js 代码异步获取数据，一旦部署到服务器就容易面临跨域请求问题，所以允许所有访问都跨域，就不会出现通过 ajax 获取数据获取不到的问题了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.CorsRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 所有请求都允许跨域
</span><span class="cm"> *
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CorsConfiguration</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addCorsMappings</span><span class="o">(</span><span class="n">CorsRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//所有请求都允许跨域
</span><span class="c1"></span>        <span class="n">registry</span><span class="o">.</span><span class="na">addMapping</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">allowedOrigins</span><span class="o">(</span><span class="s">&#34;*&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">allowedMethods</span><span class="o">(</span><span class="s">&#34;*&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">allowedHeaders</span><span class="o">(</span><span class="s">&#34;*&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>拦截器配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.interceptor.LoginInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.interceptor.OrderInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.InterceptorRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 拦截器设置
</span><span class="cm"> *
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebMvcConfigurer</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">LoginInterceptor</span> <span class="nf">getLoginInterceptor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">LoginInterceptor</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">OrderInterceptor</span> <span class="nf">getOtherInterceptor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">OrderInterceptor</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="n">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">getLoginInterceptor</span><span class="o">())</span>
                <span class="o">.</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">getOtherInterceptor</span><span class="o">())</span>
                <span class="o">.</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Shiro的配置，其中的 bean 都是常规配置，需要关注的有两个：</p>
<blockquote>
<ol>
<li>getJPARealm() 指定了 Realm 使用 JPARealm。</li>
<li>hashedCredentialsMatcher() 指定了 加密算法使用 md5,并且混进行2次加密。</li>
</ol>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.realm.JpaRealm</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.authc.credential.HashedCredentialsMatcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.mgt.SecurityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.spring.LifecycleBeanPostProcessor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.spring.web.ShiroFilterFactoryBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.web.mgt.DefaultWebSecurityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * Shiro的配置
</span><span class="cm"> *
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShiroConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">LifecycleBeanPostProcessor</span> <span class="nf">getLifecycleBeanPostProcessor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">LifecycleBeanPostProcessor</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">ShiroFilterFactoryBean</span> <span class="nf">shirFilter</span><span class="o">(</span><span class="n">SecurityManager</span> <span class="n">securityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ShiroFilterFactoryBean</span> <span class="n">shiroFilterFactoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShiroFilterFactoryBean</span><span class="o">();</span>
        <span class="n">shiroFilterFactoryBean</span><span class="o">.</span><span class="na">setSecurityManager</span><span class="o">(</span><span class="n">securityManager</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">shiroFilterFactoryBean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">SecurityManager</span> <span class="nf">securityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">DefaultWebSecurityManager</span> <span class="n">securityManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultWebSecurityManager</span><span class="o">();</span>
        <span class="n">securityManager</span><span class="o">.</span><span class="na">setRealm</span><span class="o">(</span><span class="n">getJPARealm</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">securityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">JpaRealm</span> <span class="nf">getJPARealm</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">JpaRealm</span> <span class="n">myShiroRealm</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JpaRealm</span><span class="o">();</span>
        <span class="n">myShiroRealm</span><span class="o">.</span><span class="na">setCredentialsMatcher</span><span class="o">(</span><span class="n">hashedCredentialsMatcher</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">myShiroRealm</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">HashedCredentialsMatcher</span> <span class="nf">hashedCredentialsMatcher</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">HashedCredentialsMatcher</span> <span class="n">hashedCredentialsMatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashedCredentialsMatcher</span><span class="o">();</span>
        <span class="n">hashedCredentialsMatcher</span><span class="o">.</span><span class="na">setHashAlgorithmName</span><span class="o">(</span><span class="s">&#34;md5&#34;</span><span class="o">);</span>
        <span class="n">hashedCredentialsMatcher</span><span class="o">.</span><span class="na">setHashIterations</span><span class="o">(</span><span class="n">2</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">hashedCredentialsMatcher</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 开启shiro aop注解支持.
</span><span class="cm">     * 使用代理方式;所以需要开启代码支持;
</span><span class="cm">     *
</span><span class="cm">     * @param securityManager
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">AuthorizationAttributeSourceAdvisor</span> <span class="nf">authorizationAttributeSourceAdvisor</span><span class="o">(</span><span class="n">SecurityManager</span> <span class="n">securityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">AuthorizationAttributeSourceAdvisor</span> <span class="n">authorizationAttributeSourceAdvisor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AuthorizationAttributeSourceAdvisor</span><span class="o">();</span>
        <span class="n">authorizationAttributeSourceAdvisor</span><span class="o">.</span><span class="na">setSecurityManager</span><span class="o">(</span><span class="n">securityManager</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">authorizationAttributeSourceAdvisor</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>供通过 JPA 进行验证的 Realm</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.realm</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.UserService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.authc.AuthenticationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.authc.AuthenticationInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.authc.AuthenticationToken</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.authc.SimpleAuthenticationInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.authz.AuthorizationInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.authz.SimpleAuthorizationInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.realm.AuthorizingRealm</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.subject.PrincipalCollection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.util.ByteSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 提供通过 JPA 进行验证的 Realm
</span><span class="cm"> *
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaRealm</span> <span class="kd">extends</span> <span class="n">AuthorizingRealm</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">AuthorizationInfo</span> <span class="nf">doGetAuthorizationInfo</span><span class="o">(</span><span class="n">PrincipalCollection</span> <span class="n">principalCollection</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SimpleAuthorizationInfo</span> <span class="n">simpleAuthorizationInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleAuthorizationInfo</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">simpleAuthorizationInfo</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">AuthenticationInfo</span> <span class="nf">doGetAuthenticationInfo</span><span class="o">(</span><span class="n">AuthenticationToken</span> <span class="n">authenticationToken</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">AuthenticationException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">userName</span> <span class="o">=</span> <span class="n">authenticationToken</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="n">userName</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">passWordInDB</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getPassword</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">salt</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getSalt</span><span class="o">();</span>
        <span class="n">SimpleAuthenticationInfo</span> <span class="n">authenticationInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleAuthenticationInfo</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span> <span class="n">passWordInDB</span><span class="o">,</span>
                <span class="n">ByteSource</span><span class="o">.</span><span class="na">Util</span><span class="o">.</span><span class="na">bytes</span><span class="o">(</span><span class="n">salt</span><span class="o">),</span> <span class="n">getName</span><span class="o">());</span>

        <span class="k">return</span> <span class="n">authenticationInfo</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>redis缓存配置RedisConfig</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonAutoDetect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.PropertyAccessor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.CacheManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CachingConfigurerSupport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.cache.RedisCacheManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.core.RedisTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.serializer.StringRedisSerializer</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * Redis 缓存配置类
</span><span class="cm"> *
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-2
</span><span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisConfig</span> <span class="kd">extends</span> <span class="n">CachingConfigurerSupport</span> <span class="o">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">CacheManager</span> <span class="nf">cacheManager</span><span class="o">(</span><span class="n">RedisTemplate</span><span class="o">&lt;?,</span> <span class="o">?&gt;</span> <span class="n">redisTemplate</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">StringRedisSerializer</span> <span class="n">stringRedisSerializer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringRedisSerializer</span><span class="o">();</span>
    <span class="kd">final</span> <span class="n">Jackson2JsonRedisSerializer</span> <span class="n">jackson2JsonRedisSerializer</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">Jackson2JsonRedisSerializer</span><span class="o">(</span><span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">ObjectMapper</span> <span class="n">objectMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectMapper</span><span class="o">();</span>

    <span class="n">objectMapper</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">PropertyAccessor</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">JsonAutoDetect</span><span class="o">.</span><span class="na">Visibility</span><span class="o">.</span><span class="na">PUBLIC_ONLY</span><span class="o">);</span>
    <span class="n">objectMapper</span><span class="o">.</span><span class="na">enableDefaultTyping</span><span class="o">(</span><span class="n">ObjectMapper</span><span class="o">.</span><span class="na">DefaultTyping</span><span class="o">.</span><span class="na">NON_FINAL</span><span class="o">);</span>
    <span class="n">jackson2JsonRedisSerializer</span><span class="o">.</span><span class="na">setObjectMapper</span><span class="o">(</span><span class="n">objectMapper</span><span class="o">);</span>
    <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setKeySerializer</span><span class="o">(</span><span class="n">stringRedisSerializer</span><span class="o">);</span>
    <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setHashKeySerializer</span><span class="o">(</span><span class="n">stringRedisSerializer</span><span class="o">);</span>

    <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setValueSerializer</span><span class="o">(</span><span class="n">jackson2JsonRedisSerializer</span><span class="o">);</span>
    <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setHashValueSerializer</span><span class="o">(</span><span class="n">jackson2JsonRedisSerializer</span><span class="o">);</span>

    <span class="kd">final</span> <span class="n">RedisCacheManager</span> <span class="n">redisCacheManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RedisCacheManager</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">redisCacheManager</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="232-项目工具">2.3.2 项目工具</h3>
<p>图片文件上传工具ImageUtil</p>
<blockquote>
<ol>
<li>
<p>change2jpg
确保图片文件的二进制格式是jpg。
仅仅通过ImageIO.write(img, &ldquo;jpg&rdquo;, file);不足以保证转换出来的jpg文件显示正常。这段转换代码，可以确保转换后jpg的图片显示正常，而不会出现暗红色( 有一定几率出现)。</p>
</li>
<li>
<p>后两种resizeImage用于改变图片大小，在上传产品图片的时候会用到。</p>
</li>
</ol>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.imageio.ImageIO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.image.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImageUtil</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">BufferedImage</span> <span class="nf">change2jpg</span><span class="o">(</span><span class="n">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Image</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="o">.</span><span class="na">getDefaultToolkit</span><span class="o">().</span><span class="na">createImage</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
            <span class="n">PixelGrabber</span> <span class="n">pg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PixelGrabber</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="o">-</span><span class="n">1</span><span class="o">,</span> <span class="o">-</span><span class="n">1</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
            <span class="n">pg</span><span class="o">.</span><span class="na">grabPixels</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">height</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="na">getHeight</span><span class="o">();</span>
            <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">RGB_MASKS</span> <span class="o">=</span> <span class="o">{</span><span class="n">0xFF0000</span><span class="o">,</span> <span class="n">0xFF00</span><span class="o">,</span> <span class="n">0xFF</span><span class="o">};</span>
            <span class="kd">final</span> <span class="n">ColorModel</span> <span class="n">RGB_OPAQUE</span> <span class="o">=</span>
                    <span class="k">new</span> <span class="n">DirectColorModel</span><span class="o">(</span><span class="n">32</span><span class="o">,</span> <span class="n">RGB_MASKS</span><span class="o">[</span><span class="n">0</span><span class="o">],</span> <span class="n">RGB_MASKS</span><span class="o">[</span><span class="n">1</span><span class="o">],</span> <span class="n">RGB_MASKS</span><span class="o">[</span><span class="n">2</span><span class="o">]);</span>
            <span class="n">DataBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataBufferInt</span><span class="o">((</span><span class="kt">int</span><span class="o">[])</span> <span class="n">pg</span><span class="o">.</span><span class="na">getPixels</span><span class="o">(),</span> <span class="n">pg</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">*</span> <span class="n">pg</span><span class="o">.</span><span class="na">getHeight</span><span class="o">());</span>
            <span class="n">WritableRaster</span> <span class="n">raster</span> <span class="o">=</span>
                    <span class="n">Raster</span><span class="o">.</span><span class="na">createPackedRaster</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="n">RGB_MASKS</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">BufferedImage</span><span class="o">(</span><span class="n">RGB_OPAQUE</span><span class="o">,</span> <span class="n">raster</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">resizeImage</span><span class="o">(</span><span class="n">File</span> <span class="n">srcFile</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">,</span> <span class="n">File</span> <span class="n">destFile</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">destFile</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">destFile</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">mkdirs</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">Image</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ImageIO</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">srcFile</span><span class="o">);</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">resizeImage</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">);</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="n">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">((</span><span class="n">RenderedImage</span><span class="o">)</span> <span class="n">i</span><span class="o">,</span> <span class="s">&#34;jpg&#34;</span><span class="o">,</span> <span class="n">destFile</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Image</span> <span class="nf">resizeImage</span><span class="o">(</span><span class="n">Image</span> <span class="n">srcImage</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>

            <span class="n">BufferedImage</span> <span class="n">buffImg</span><span class="o">;</span>
            <span class="n">buffImg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedImage</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">,</span> <span class="n">BufferedImage</span><span class="o">.</span><span class="na">TYPE_INT_RGB</span><span class="o">);</span>
            <span class="n">buffImg</span>
                    <span class="o">.</span><span class="na">getGraphics</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">drawImage</span><span class="o">(</span><span class="n">srcImage</span><span class="o">.</span><span class="na">getScaledInstance</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">,</span> <span class="n">Image</span><span class="o">.</span><span class="na">SCALE_SMOOTH</span><span class="o">),</span> <span class="n">0</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

            <span class="k">return</span> <span class="n">buffImg</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>分页显示工具Page4Navigator .java</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * JPA 默认提供了一个分页类：org.springframework.data.domain.Page
</span><span class="cm"> * 这个分页类已经能够满足各种分页需要了，所以大部分时候用它就足够了。
</span><span class="cm"> * 但是为了中间页码数能居中显示，我们还需要Page4Navigator。
</span><span class="cm"> * 首先对 Page 类进行了封装，然后在构造方法里提供了一个 navigatePages 参数。
</span><span class="cm"> * 这个参数如果传7，就表示如图所示的效果，前面3个，后面3个。
</span><span class="cm"> * 在构造方法里，还调用了 calcnavigatepageNums，
</span><span class="cm"> * 就是用来计算这个数值，并返回到一个int 数组变量 navigatePageNums
</span><span class="cm"> * 方便前端遍历展示。
</span><span class="cm"> *
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-29
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Page4Navigator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * jpa 传递出来的分页对象， Page4Navigator 类就是对它进行封装以达到扩展的效果
</span><span class="cm">     */</span>
    <span class="n">Page</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">pageFromJPA</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 分页的时候 ,如果总页数比较多，那么显示出来的分页超链一个有几个。
</span><span class="cm">     * 比如如果分页出来的超链是这样的： [8,9,10,11,12], 那么 navigatePages 就是5
</span><span class="cm">     */</span>
    <span class="kt">int</span> <span class="n">navigatePages</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 总页面数
</span><span class="cm">     */</span>
    <span class="kt">int</span> <span class="n">totalPages</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 第几页（基0）
</span><span class="cm">     */</span>
    <span class="kt">int</span> <span class="n">number</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 总共有多少条数据
</span><span class="cm">     */</span>
    <span class="kt">long</span> <span class="n">totalElements</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 一页最多有多少条数据
</span><span class="cm">     */</span>
    <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 当前页有多少条数据 (与 size，不同的是，最后一页可能不满 size 个)
</span><span class="cm">     */</span>
    <span class="kt">int</span> <span class="n">numberOfElements</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 数据集合
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">content</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 是否有数据
</span><span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="n">isHasContent</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 是否是首页
</span><span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="n">first</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 是否是末页
</span><span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="n">last</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 是否有下一页
</span><span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="n">isHasNext</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 是否有上一页
</span><span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="n">isHasPrevious</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 分页的时候 ,如果总页数比较多，那么显示出来的分页超链一个有几个。
</span><span class="cm">     * 比如如果分页出来的超链是这样的： [8,9,10,11,12]，
</span><span class="cm">     * 那么 navigatepageNums 就是这个数组：[8,9,10,11,12]，这样便于前端展示
</span><span class="cm">     */</span>
    <span class="kt">int</span><span class="o">[]</span> <span class="n">navigatepageNums</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Page4Navigator</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//这个空的分页是为了 Redis 从 json格式转换为 Page4Navigator 对象而专门提供的
</span><span class="c1"></span>    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">Page4Navigator</span><span class="o">(</span><span class="n">Page</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">pageFromJPA</span><span class="o">,</span> <span class="kt">int</span> <span class="n">navigatePages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">pageFromJPA</span> <span class="o">=</span> <span class="n">pageFromJPA</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">navigatePages</span> <span class="o">=</span> <span class="n">navigatePages</span><span class="o">;</span>

        <span class="n">totalPages</span> <span class="o">=</span> <span class="n">pageFromJPA</span><span class="o">.</span><span class="na">getTotalPages</span><span class="o">();</span>

        <span class="n">number</span> <span class="o">=</span> <span class="n">pageFromJPA</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>

        <span class="n">totalElements</span> <span class="o">=</span> <span class="n">pageFromJPA</span><span class="o">.</span><span class="na">getTotalElements</span><span class="o">();</span>

        <span class="n">size</span> <span class="o">=</span> <span class="n">pageFromJPA</span><span class="o">.</span><span class="na">getSize</span><span class="o">();</span>

        <span class="n">numberOfElements</span> <span class="o">=</span> <span class="n">pageFromJPA</span><span class="o">.</span><span class="na">getNumberOfElements</span><span class="o">();</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">pageFromJPA</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span>

        <span class="n">isHasContent</span> <span class="o">=</span> <span class="n">pageFromJPA</span><span class="o">.</span><span class="na">hasContent</span><span class="o">();</span>

        <span class="n">first</span> <span class="o">=</span> <span class="n">pageFromJPA</span><span class="o">.</span><span class="na">isFirst</span><span class="o">();</span>

        <span class="n">last</span> <span class="o">=</span> <span class="n">pageFromJPA</span><span class="o">.</span><span class="na">isLast</span><span class="o">();</span>

        <span class="n">isHasNext</span> <span class="o">=</span> <span class="n">pageFromJPA</span><span class="o">.</span><span class="na">hasNext</span><span class="o">();</span>

        <span class="n">isHasPrevious</span> <span class="o">=</span> <span class="n">pageFromJPA</span><span class="o">.</span><span class="na">hasPrevious</span><span class="o">();</span>

        <span class="n">calcNavigatepageNums</span><span class="o">();</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">calcNavigatepageNums</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">navigatepageNums</span><span class="o">[];</span>
        <span class="kt">int</span> <span class="n">totalPages</span> <span class="o">=</span> <span class="n">getTotalPages</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="n">getNumber</span><span class="o">();</span>
        <span class="c1">//当总页数小于或等于导航页码数时
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">totalPages</span> <span class="o">&lt;=</span> <span class="n">navigatePages</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">navigatepageNums</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">totalPages</span><span class="o">];</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">totalPages</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">navigatepageNums</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="c1">//当总页数大于导航页码数时
</span><span class="c1"></span>            <span class="n">navigatepageNums</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">navigatePages</span><span class="o">];</span>
            <span class="kt">int</span> <span class="n">startNum</span> <span class="o">=</span> <span class="n">num</span> <span class="o">-</span> <span class="n">navigatePages</span> <span class="o">/</span> <span class="n">2</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">endNum</span> <span class="o">=</span> <span class="n">num</span> <span class="o">+</span> <span class="n">navigatePages</span> <span class="o">/</span> <span class="n">2</span><span class="o">;</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">startNum</span> <span class="o">&lt;</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">startNum</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
                <span class="c1">//(最前navigatePages页
</span><span class="c1"></span>                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">navigatePages</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">navigatepageNums</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">startNum</span><span class="o">++;</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">endNum</span> <span class="o">&gt;</span> <span class="n">totalPages</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">endNum</span> <span class="o">=</span> <span class="n">totalPages</span><span class="o">;</span>
                <span class="c1">//最后navigatePages页
</span><span class="c1"></span>                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">navigatePages</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
                    <span class="n">navigatepageNums</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">endNum</span><span class="o">--;</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">//所有中间页
</span><span class="c1"></span>                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">navigatePages</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">navigatepageNums</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">startNum</span><span class="o">++;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">navigatepageNums</span> <span class="o">=</span> <span class="n">navigatepageNums</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNavigatePages</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">navigatePages</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNavigatePages</span><span class="o">(</span><span class="kt">int</span> <span class="n">navigatePages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">navigatePages</span> <span class="o">=</span> <span class="n">navigatePages</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getTotalPages</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">totalPages</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTotalPages</span><span class="o">(</span><span class="kt">int</span> <span class="n">totalPages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">totalPages</span> <span class="o">=</span> <span class="n">totalPages</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNumber</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">number</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNumber</span><span class="o">(</span><span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getTotalElements</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">totalElements</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTotalElements</span><span class="o">(</span><span class="kt">long</span> <span class="n">totalElements</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">totalElements</span> <span class="o">=</span> <span class="n">totalElements</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSize</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSize</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="n">size</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNumberOfElements</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">numberOfElements</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNumberOfElements</span><span class="o">(</span><span class="kt">int</span> <span class="n">numberOfElements</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">numberOfElements</span> <span class="o">=</span> <span class="n">numberOfElements</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isHasContent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">isHasContent</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHasContent</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">isHasContent</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">isHasContent</span> <span class="o">=</span> <span class="n">isHasContent</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFirst</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">first</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirst</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">first</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">first</span> <span class="o">=</span> <span class="n">first</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isLast</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">last</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLast</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">last</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">last</span> <span class="o">=</span> <span class="n">last</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isHasNext</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">isHasNext</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHasNext</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">isHasNext</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">isHasNext</span> <span class="o">=</span> <span class="n">isHasNext</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isHasPrevious</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">isHasPrevious</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHasPrevious</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">isHasPrevious</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">isHasPrevious</span> <span class="o">=</span> <span class="n">isHasPrevious</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span><span class="o">[]</span> <span class="nf">getNavigatepageNums</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">navigatepageNums</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNavigatepageNums</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">navigatepageNums</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">navigatepageNums</span> <span class="o">=</span> <span class="n">navigatepageNums</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><p>端口启动判断类PortUtil</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.swing.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 用于判断某个端口是否启动。
</span><span class="cm"> *
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-2
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PortUtil</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">testPort</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="n">port</span><span class="o">);</span>
            <span class="n">serverSocket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">BindException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">checkPort</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">,</span> <span class="n">String</span> <span class="n">server</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">shutdown</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">testPort</span><span class="o">(</span><span class="n">port</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">shutdown</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;在端口 %d 未检测到 %s 启动%n&#34;</span><span class="o">,</span> <span class="n">port</span><span class="o">,</span> <span class="n">server</span><span class="o">);</span>
                <span class="n">JOptionPane</span><span class="o">.</span><span class="na">showMessageDialog</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
                <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;在端口 %d 未检查得到 %s 启动%n,是否继续?&#34;</span><span class="o">,</span> <span class="n">port</span><span class="o">,</span> <span class="n">server</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">JOptionPane</span><span class="o">.</span><span class="na">OK_OPTION</span> <span class="o">!=</span> <span class="n">JOptionPane</span><span class="o">.</span><span class="na">showConfirmDialog</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">message</span><span class="o">))</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Result工具类</p>
<blockquote>
<p>统一的 REST响应对象。 这个对象里包含是否成功，错误信息，以及数据。
Result 对象是一种常见的 RESTFUL 风格返回的 json 格式，里面可以有错误代码，错误信息和数据。 这样就比起以前那样，仅仅返回数据附加了更多的信息，方便前端人员识别和显示给用户可识别信息。 在前端注册，登陆等地方有更广泛的运用。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.util</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Result</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">SUCCESS_CODE</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">FAIL_CODE</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>

    <span class="kt">int</span> <span class="n">code</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">message</span><span class="o">;</span>
    <span class="n">Object</span> <span class="n">data</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">Result</span><span class="o">(</span><span class="kt">int</span> <span class="n">code</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">Object</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">success</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Result</span><span class="o">(</span><span class="n">SUCCESS_CODE</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">success</span><span class="o">(</span><span class="n">Object</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Result</span><span class="o">(</span><span class="n">SUCCESS_CODE</span><span class="o">,</span> <span class="s">&#34;&#34;</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">fail</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Result</span><span class="o">(</span><span class="n">FAIL_CODE</span><span class="o">,</span> <span class="n">message</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">code</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCode</span><span class="o">(</span><span class="kt">int</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getData</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setData</span><span class="o">(</span><span class="n">Object</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>


<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>SpringContextUtils 这个工具类</p>
<blockquote>
<p>项目中的部分Bean没有被声明为@Bean，无法被springboot管理，需要借助此工具类，进行实例的获取</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContextAware</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 因为 springboot 的缓存机制是通过切面编程 aop来实现的。
</span><span class="cm"> * 从fill方法里直接调用 listByCategory 方法，
</span><span class="cm"> * aop 是拦截不到的，也就不会走缓存了。
</span><span class="cm"> * 所以要通过这种 绕一绕 的方式故意诱发 aop,
</span><span class="cm"> * 这样才会像我们期望的那样走redis缓存。
</span><span class="cm"> *
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-2
</span><span class="cm"> */</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringContextUtil</span> <span class="kd">implements</span> <span class="n">ApplicationContextAware</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">SpringContextUtil</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">getBean</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setApplicationContext</span><span class="o">(</span><span class="n">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SpringContextUtil</span><span class="o">.</span><span class="na">applicationContext</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="233-分类管理的操作">2.3.3 分类管理的操作</h3>
<h4 id="entity实体类">entity实体类</h4>
<p>在 entity实体类下，新增category类：</p>
<ul>
<li>com.qqlin.tmall.dao.entity.Category.java</li>
</ul>
<blockquote>
<p>首先需要标注为实体类：@Entity</p>
<p>标注数据库中对应的表明：@Table(name = &ldquo;category&rdquo;)</p>
<p>忽略配置：@JsonIgnoreProperties({ &ldquo;handler&rdquo;,&ldquo;hibernateLazyInitializer&rdquo; })</p>
<p>因为是做前后端分离，而前后端数据交互用的是 json 格式。 那么 Category 对象就会被转换为 json 数据。 而本项目使用 jpa  来做实体类的持久化，jpa 默认会使用 hibernate, 在 jpa 工作过程中，就会创造代理类来继承 Category ，并添加  handler 和  hibernateLazyInitializer 这两个无须 json 化的属性，所以这里需要用   JsonIgnoreProperties 把这两个属性忽略掉。</p>
<p>标注主键：@Id</p>
<p>标注主键为自增长：@GeneratedValue(strategy = GenerationType.IDENTITY)</p>
<p>数据库中主键的名称：@Column(name = &ldquo;id&rdquo;)</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonIgnoreProperties</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;category&#34;</span><span class="o">)</span>
<span class="nd">@JsonIgnoreProperties</span><span class="o">({</span><span class="s">&#34;handler&#34;</span><span class="o">,</span> <span class="s">&#34;hibernateLazyInitializer&#34;</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Category</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;id&#34;</span><span class="o">)</span>
    <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@Transient</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span><span class="o">;</span>
    <span class="nd">@Transient</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span> <span class="n">productsByRow</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">getProducts</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">products</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProducts</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">products</span> <span class="o">=</span> <span class="n">products</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span> <span class="nf">getProductsByRow</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productsByRow</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProductsByRow</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span> <span class="n">productsByRow</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">productsByRow</span> <span class="o">=</span> <span class="n">productsByRow</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;Category [id=&#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;, name=&#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="repository仓库类">repository仓库类</h4>
<p>在 repository仓库类下，新增categoryDAO类：</p>
<ul>
<li>com.qqlin.tmall.dao.repository.categoryDAO.java</li>
</ul>
<p>继承了JpaRepository&lt;Category, Integer&gt;，就提供了CRUD和分页 的各种常见功能。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CategoryDAO</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="service层">Service层</h4>
<p>然后，到了Service层，创建CategoryService接口类：</p>
<ul>
<li>com.qqlin.tmall.service.CategoryService.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qingq
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CategoryService</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 查询分类Category中的所有值
</span><span class="cm">     *
</span><span class="cm">     * @return 返回一个包含各种Category的list
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">();</span>

    <span class="cm">/**
</span><span class="cm">     * 对分类Category进行分页查询
</span><span class="cm">     *
</span><span class="cm">     * @param start         从第几页开始
</span><span class="cm">     * @param size          当页显示几条数据
</span><span class="cm">     * @param navigatePages 表示导航栏中显示的个数
</span><span class="cm">     * @return 返回一个根据既定约束，显示的list
</span><span class="cm">     */</span>
    <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">,</span> <span class="kt">int</span> <span class="n">navigatePages</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 增加分类Category
</span><span class="cm">     *
</span><span class="cm">     * @param bean 需要增加的Category
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Category</span> <span class="n">bean</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 根据id删除分类
</span><span class="cm">     *
</span><span class="cm">     * @param id 需要删除的id
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 根据id获取到该分类
</span><span class="cm">     *
</span><span class="cm">     * @param id 需要获取的分类id
</span><span class="cm">     * @return  返回一个分类Category
</span><span class="cm">     */</span>
    <span class="n">Category</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 将传入的Category,进行更新
</span><span class="cm">     *
</span><span class="cm">     * @param bean 需要更新的Category
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Category</span> <span class="n">bean</span><span class="o">);</span>


    <span class="cm">/**
</span><span class="cm">     * 为什么要删除呢？
</span><span class="cm">     * 因为在对分类做序列还转换为 json 的时候，会遍历里面的 products,
</span><span class="cm">     * 然后遍历出来的产品上，又会有分类，接着就开始子子孙孙无穷溃矣地遍历了
</span><span class="cm">     * 删除Product对象上的 分类
</span><span class="cm">     *
</span><span class="cm">     * @param category  需要删除的分类Category
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">removeCategoryFromProduct</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 删除Product对象上的 分类
</span><span class="cm">     *
</span><span class="cm">     * @param categories    需要删除的分类Category的list
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">removeCategoryFromProduct</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">);</span>

<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><p>以及它的实现类impl.CategoryServiceImpl：</p>
<ul>
<li>com.qqlin.tmall.service.impl.CategoryServiceImpl</li>
</ul>
<blockquote>
<p>首先需要的标注为Service：@Service</p>
<p>标注redis的缓存配置：@CacheConfig(cacheNames = &ldquo;categories&rdquo;)</p>
<p>需要注入的bean：@Autowired</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.repository.CategoryDAO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheEvict</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.Cacheable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.PageRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Sort</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="nd">@CacheConfig</span><span class="o">(</span><span class="n">cacheNames</span> <span class="o">=</span> <span class="s">&#34;categories&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CategoryServiceImpl</span> <span class="kd">implements</span> <span class="n">CategoryService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CategoryDAO</span> <span class="n">categoryDAO</span><span class="o">;</span>


    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;categories-page-&#39; + #p0 + &#39;-&#39; + #p1&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Page4Navigator</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">,</span> <span class="kt">int</span> <span class="n">navigatePages</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Sort</span> <span class="n">sort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sort</span><span class="o">(</span><span class="n">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">sort</span><span class="o">);</span>
        <span class="n">Page</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">pageFromJpa</span> <span class="o">=</span> <span class="n">categoryDAO</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="n">Page4Navigator</span><span class="o">&lt;&gt;(</span><span class="n">pageFromJpa</span><span class="o">,</span> <span class="n">navigatePages</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;categories-all&#39;&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Sort</span> <span class="n">sort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sort</span><span class="o">(</span><span class="n">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">categoryDAO</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">sort</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Category</span> <span class="n">bean</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">categoryDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">categoryDAO</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;categiries-one-&#39; + #p0&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Category</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">categoryDAO</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Category</span> <span class="n">bean</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">categoryDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeCategoryFromProduct</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Category</span> <span class="n">category</span> <span class="o">:</span> <span class="n">categories</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">removeCategoryFromProduct</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeCategoryFromProduct</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getProducts</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">products</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">product</span> <span class="o">:</span> <span class="n">products</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">product</span><span class="o">.</span><span class="na">setCategory</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span> <span class="n">productsByRow</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getProductsByRow</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">productsByRow</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span> <span class="o">:</span> <span class="n">productsByRow</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">product</span> <span class="o">:</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">product</span><span class="o">.</span><span class="na">setCategory</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="web控制层">web控制层</h4>
<p>最后到了web控制层，在com.qqlin.tmall.web目录下新增admin目录，分别新增AdminPageController.java和CategoryController.java</p>
<ul>
<li>AdminPageController(后台管理页面跳转专用控制器)</li>
</ul>
<blockquote>
<p>因为是做前后端分离，所以数据是通过 RESTFUL接口来取的，而在业务上，除了 RESTFUL 服务要提供，还要提供页面跳转服务，所以所有的后台页面跳转都放在 AdminPageController 这个控制器里。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.web.admin</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdminPageController</span> <span class="o">{</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/admin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">admin</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;redirect:admin_category_list&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/admin_category_list&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">listCategory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;admin/listCategory&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/admin_category_edit&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">editCategory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;admin/editCategory&#34;</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/admin_order_list&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">listOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;admin/listOrder&#34;</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/admin_product_list&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">listProduct</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;admin/listProduct&#34;</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/admin_product_edit&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">editProduct</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;admin/editProduct&#34;</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/admin_productImage_list&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">listProductImage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;admin/listProductImage&#34;</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/admin_property_list&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">listProperty</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;admin/listProperty&#34;</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/admin_property_edit&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">editProperty</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;admin/editProperty&#34;</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/admin_propertyValue_edit&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">editPropertyValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;admin/editPropertyValue&#34;</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/admin_user_list&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">listUser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;admin/listUser&#34;</span><span class="o">;</span>

    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>CategoryController(提供 RESTFUL 服务器控制器)</li>
</ul>
<blockquote>
<p>标注为控制器：@RestController（相当于@ResponseBody ＋ @Controller合在一起的作用），返回json数据不需要在方法前面加@ResponseBody注解了，但使用@RestController这个注解，就不能返回jsp,html页面，视图解析器无法解析jsp,html页面。</p>
<p>注入CategoryService</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Autowired</span>
<span class="kd">private</span> <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>@GetMapping(&quot;/categories&rdquo;)：分类查询</p>
<p>@PostMapping(&quot;/categories&rdquo;)：增加分类</p>
<p>@DeleteMapping(&quot;/categories/{id}&quot;)：删除分类</p>
<p>@GetMapping(&quot;/categories/{id}&quot;)：获得分类</p>
<p>@PutMapping(&quot;/categories/{id}&quot;)：修改分类</p>
<p>saveOrUpdateImageFile：提供图片文件的方法</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.web.admin</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.ImageUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.imageio.ImageIO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.image.BufferedImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CategoryController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/categories&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;start&#34;</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&#34;0&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> 
                                         <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;size&#34;</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&#34;5&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="n">start</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">5</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/categories&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">add</span><span class="o">(</span><span class="n">Category</span> <span class="n">bean</span><span class="o">,</span> <span class="n">MultipartFile</span> <span class="n">image</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">categoryService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="n">saveOrUpdateImageFile</span><span class="o">(</span><span class="n">bean</span><span class="o">,</span> <span class="n">image</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveOrUpdateImageFile</span><span class="o">(</span><span class="n">Category</span> <span class="n">bean</span><span class="o">,</span> <span class="n">MultipartFile</span> <span class="n">image</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">File</span> <span class="n">imageFolder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/category&#34;</span><span class="o">));</span>
        <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder</span><span class="o">,</span> <span class="n">bean</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;.jpg&#34;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">file</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">mkdirs</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">image</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
        <span class="n">BufferedImage</span> <span class="n">img</span> <span class="o">=</span> <span class="n">ImageUtil</span><span class="o">.</span><span class="na">change2jpg</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
        <span class="k">assert</span> <span class="n">img</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">img</span><span class="o">,</span> <span class="s">&#34;jpg&#34;</span><span class="o">,</span> <span class="n">file</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">&#34;/categories/{id}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">categoryService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">File</span> <span class="n">imageFolder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/category&#34;</span><span class="o">));</span>
        <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder</span><span class="o">,</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;.jpg&#34;</span><span class="o">);</span>
        <span class="n">file</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/categories/{id}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Category</span> <span class="nf">get</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@PutMapping</span><span class="o">(</span><span class="s">&#34;/categories/{id}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">update</span><span class="o">(</span><span class="n">Category</span> <span class="n">bean</span><span class="o">,</span> <span class="n">MultipartFile</span> <span class="n">image</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">);</span>
        <span class="n">bean</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">categoryService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">image</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">saveOrUpdateImageFile</span><span class="o">(</span><span class="n">bean</span><span class="o">,</span> <span class="n">image</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="视图templates">视图templates</h4>
<p>视图的模板引擎是thymeleaf</p>
<p>分类有两个视图listCategory.html和editCategory.html，以及include/admin的4个嵌套视图</p>
<ul>
<li>listCategory.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/admin/adminHeader::html(&#39;分类管理&#39;)&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminNavigator::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">uri</span><span class="o">:</span><span class="s1">&#39;categories&#39;</span><span class="p">,</span>
            <span class="nx">beans</span><span class="o">:</span> <span class="p">[],</span>
            <span class="nx">bean</span><span class="o">:</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
            <span class="nx">pagination</span><span class="o">:</span><span class="p">{},</span>
            <span class="nx">file</span><span class="o">:</span> <span class="kc">null</span>
        <span class="p">};</span>

        <span class="c1">//ViewModel
</span><span class="c1"></span>        <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
            <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                <span class="k">this</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">list</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span> <span class="s2">&#34;?start=&#34;</span><span class="o">+</span><span class="nx">start</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">pagination</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">beans</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">content</span>	<span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s2">&#34;分类名称&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">file</span><span class="p">,</span> <span class="s2">&#34;分类图片&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>

                    <span class="c1">//axios.js 上传文件要用 formData 这种方式
</span><span class="c1"></span>                    <span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
                    <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">file</span><span class="p">);</span>
                    <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="nx">formData</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">bean</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">hp</span><span class="o">:</span> <span class="s1">&#39;0&#39;</span><span class="p">};</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#categoryPic&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">file</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">deleteBean</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">checkDeleteLink</span><span class="p">())</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="nx">id</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                        <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">!=</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
                            <span class="nx">alert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">else</span><span class="p">{</span>
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">getFile</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">file</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="p">},</span>
                <span class="nx">jump</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">){</span>
                    <span class="nx">jump</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="nx">vue</span><span class="p">);</span> <span class="c1">//定义在adminHeader.html 中
</span><span class="c1"></span>                <span class="p">},</span>
                <span class="nx">jumpByNumber</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">){</span>
                    <span class="nx">jumpByNumber</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span><span class="nx">vue</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;label label-info&#34;</span> <span class="p">&gt;</span>分类管理<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;listDataTableDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;table table-striped table-bordered table-hover  table-condensed&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;success&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>图片<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>分类名称<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>属性管理<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>产品管理<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>编辑<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>删除<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;bean in beans &#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{bean.id}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;40px&#34;</span>  <span class="na">:src</span><span class="o">=</span><span class="s">&#34;&#39;img/category/&#39;+bean.id+&#39;.jpg&#39;&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    {{bean.name}}
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_property_list?cid=&#39; + bean.id &#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-th-list&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_product_list?cid=&#39; + bean.id &#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-shopping-cart&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_category_edit?id=&#39; + bean.id &#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-edit&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span>  <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;deleteBean(bean.id)&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;   glyphicon glyphicon-trash&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminPage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-warning addDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>新增分类<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addTable&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>分类名称<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;add&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.name&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>分类图片<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;categoryPic&#34;</span> <span class="na">accept</span><span class="o">=</span><span class="s">&#34;image/*&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;image&#34;</span> <span class="err">@</span><span class="na">change</span><span class="o">=</span><span class="s">&#34;getFile($event)&#34;</span> <span class="p">/&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitTR&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span>  <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;add&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-success&#34;</span><span class="p">&gt;</span>提交<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminFooter::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>editCategory.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/admin/adminHeader::html(&#39;编辑分类&#39;)&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminNavigator::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;categories&#39;</span><span class="p">,</span>
            <span class="nx">listURL</span><span class="o">:</span><span class="s1">&#39;admin_category_list&#39;</span><span class="p">,</span>
            <span class="nx">bean</span><span class="o">:</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">hp</span><span class="o">:</span> <span class="s1">&#39;0&#39;</span><span class="p">},</span>
            <span class="nx">file</span><span class="o">:</span><span class="s1">&#39;&#39;</span>
        <span class="p">};</span>

        <span class="c1">//ViewModel
</span><span class="c1"></span>        <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
            <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">();</span>
            <span class="p">},</span>
            <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">get</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
                    <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="nx">id</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">bean</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                    <span class="p">})</span>
                <span class="p">},</span>
                <span class="nx">update</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s2">&#34;分类名称&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

                    <span class="c1">//axios.js 上传文件要用 formData 这种方式
</span><span class="c1"></span>                    <span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
                    <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">file</span><span class="p">);</span>
                    <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="nx">formData</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                        <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="nx">vue</span><span class="p">.</span><span class="nx">listURL</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">getFile</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">file</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">ol</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;breadcrumb&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_category_list&#34;</span><span class="p">&gt;</span>所有分类<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>编辑分类<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-warning editDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>编辑分类<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;editTable&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>分类名称<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;update&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.name&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>分类图片<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;categoryPic&#34;</span> <span class="na">accept</span><span class="o">=</span><span class="s">&#34;image/*&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;image&#34;</span> <span class="err">@</span><span class="na">change</span><span class="o">=</span><span class="s">&#34;getFile($event)&#34;</span> <span class="p">/&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitTR&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;hidden&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;id&#34;</span>   <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.id&#34;</span> <span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-success&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;update&#34;</span><span class="p">&gt;</span>提 交<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminFooter::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>adminFooter.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.w3.org/1999/xhtml&#34;</span><span class="p">&gt;</span>
   
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>adminHeader.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html(title)&#34;</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.w3.org/1999/XSL/Transform&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;js/jquery/2.0.0/jquery.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;css/bootstrap/3.3.6/bootstrap.min.css&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;js/bootstrap/3.3.6/bootstrap.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;js/vue/2.5.16/vue.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;js/axios/0.17.1/axios.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;js/moment/2.22.2/moment.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span> <span class="c">&lt;!-- vue.js 格式化日期用的 --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;css/back/style.css&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="c1">//判断是否为空
</span><span class="c1"></span>        <span class="kd">function</span> <span class="nx">checkEmpty</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="nx">value</span> <span class="o">||</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="nx">text</span> <span class="o">+</span> <span class="s2">&#34;不能为空&#34;</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//获取地址栏参数的函数
</span><span class="c1"></span>        <span class="kd">function</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="nx">para</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">search</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">;</span> <span class="c1">//页面URL的查询部分字符串
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">arrPara</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span> <span class="c1">//参数数组。数组单项为包含参数名和参数值的字符串，如“para=value”
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">arrVal</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span> <span class="c1">//参数值数组。用于存储查找到的参数值
</span><span class="c1"></span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">search</span> <span class="o">!=</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="nx">search</span> <span class="o">=</span> <span class="nx">search</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">//去除开头的“?”
</span><span class="c1"></span>                <span class="nx">arrPara</span> <span class="o">=</span> <span class="nx">search</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34;&amp;&#34;</span><span class="p">);</span>

                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">arrPara</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">paraPre</span> <span class="o">=</span> <span class="nx">para</span> <span class="o">+</span> <span class="s2">&#34;=&#34;</span><span class="p">;</span> <span class="c1">//参数前缀。即参数名+“=”，如“para=”
</span><span class="c1"></span>                    <span class="k">if</span> <span class="p">(</span><span class="nx">arrPara</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">paraPre</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">paraPre</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">arrPara</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">arrVal</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">decodeURI</span><span class="p">(</span><span class="nx">arrPara</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">substr</span><span class="p">(</span><span class="nx">paraPre</span><span class="p">.</span><span class="nx">length</span><span class="p">));</span> <span class="c1">//顺带URI解码避免出现乱码
</span><span class="c1"></span>                        <span class="nx">index</span><span class="o">++</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">arrVal</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">arrVal</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arrVal</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">arrVal</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//判断是否数字 (小数和整数)
</span><span class="c1"></span>        <span class="kd">function</span> <span class="nx">checkNumber</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="nx">text</span> <span class="o">+</span> <span class="s2">&#34;不能为空&#34;</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="nx">text</span> <span class="o">+</span> <span class="s2">&#34;必须是数字&#34;</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//判断是否整数
</span><span class="c1"></span>        <span class="kd">function</span> <span class="nx">checkInt</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="nx">text</span> <span class="o">+</span> <span class="s2">&#34;不能为空&#34;</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="nx">text</span> <span class="o">+</span> <span class="s2">&#34;必须是整数&#34;</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//确实是否要删除
</span><span class="c1"></span>        <span class="kd">function</span> <span class="nx">checkDeleteLink</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">confirmDelete</span> <span class="o">=</span> <span class="nx">confirm</span><span class="p">(</span><span class="s2">&#34;确认要删除&#34;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">confirmDelete</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//跳转函数
</span><span class="c1"></span>        <span class="kd">function</span> <span class="nx">jump</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">vue</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;first&#39;</span> <span class="o">==</span> <span class="nx">page</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">vue</span><span class="p">.</span><span class="nx">pagination</span><span class="p">.</span><span class="nx">first</span><span class="p">)</span>
                <span class="nx">vue</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;pre&#39;</span> <span class="o">==</span> <span class="nx">page</span> <span class="o">&amp;&amp;</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">pagination</span><span class="p">.</span><span class="nx">hasPrevious</span><span class="p">)</span>
                <span class="nx">vue</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="nx">vue</span><span class="p">.</span><span class="nx">pagination</span><span class="p">.</span><span class="nx">number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;next&#39;</span> <span class="o">==</span> <span class="nx">page</span> <span class="o">&amp;&amp;</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">pagination</span><span class="p">.</span><span class="nx">hasNext</span><span class="p">)</span>
                <span class="nx">vue</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="nx">vue</span><span class="p">.</span><span class="nx">pagination</span><span class="p">.</span><span class="nx">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;last&#39;</span> <span class="o">==</span> <span class="nx">page</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">vue</span><span class="p">.</span><span class="nx">pagination</span><span class="p">.</span><span class="nx">last</span><span class="p">)</span>
                <span class="nx">vue</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="nx">vue</span><span class="p">.</span><span class="nx">pagination</span><span class="p">.</span><span class="nx">totalPages</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">//跳转函数
</span><span class="c1"></span>        <span class="kd">function</span> <span class="nx">jumpByNumber</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">vue</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">start</span> <span class="o">!=</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">pagination</span><span class="p">.</span><span class="nx">number</span><span class="p">)</span>
                <span class="nx">vue</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="nx">start</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;text/html; charset=utf-8&#34;</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;Content-Type&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${title}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>adminNavigator.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navitagorDiv&#34;</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.w3.org/1999/xhtml&#34;</span><span class="p">&gt;</span>
	<span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar navbar-default navbar-fixed-top navbar-inverse&#34;</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">img</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-left:10px;margin-right:0px&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-left&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/tmallbuy.png&#34;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;45px&#34;</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-brand&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>天猫后台<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
		
		<span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-brand&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_category_list&#34;</span><span class="p">&gt;</span>分类管理<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-brand&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_user_list&#34;</span><span class="p">&gt;</span>用户管理<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-brand&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_order_list&#34;</span><span class="p">&gt;</span>订单管理<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	<span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>adminPage.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pageDiv&#34;</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.w3.org/1999/xhtml&#34;</span><span class="p">&gt;</span>
	<span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
	  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pagination&#34;</span><span class="p">&gt;</span>
	    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{ disabled: pagination.first }&#34;</span><span class="p">&gt;</span>
	      <span class="p">&lt;</span><span class="nt">a</span>  <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;jump(&#39;first&#39;)&#34;</span><span class="p">&gt;</span>«<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
	    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{ disabled: !pagination.hasPrevious }&#34;</span><span class="p">&gt;</span>
	      <span class="p">&lt;</span><span class="nt">a</span>  <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;jump(&#39;pre&#39;)&#34;</span><span class="p">&gt;</span>‹<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>		    

		<span class="p">&lt;</span><span class="nt">li</span>  <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;i in pagination.navigatepageNums&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;jumpByNumber(i-1)&#34;</span> <span class="p">&gt;</span>
				{{i}}
			<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
		<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>

	    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{ disabled: !pagination.hasNext }&#34;</span><span class="p">&gt;</span>
	      <span class="p">&lt;</span><span class="nt">a</span>  <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;jump(&#39;next&#39;)&#34;</span><span class="p">&gt;</span>›<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
	    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{ disabled: pagination.last }&#34;</span><span class="p">&gt;</span>
	      <span class="p">&lt;</span><span class="nt">a</span>  <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;jump(&#39;last&#39;)&#34;</span><span class="p">&gt;</span>»<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>		    
	  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
	<span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>    
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="234-属性管理的操作">2.3.4 属性管理的操作</h3>
<h4 id="entity实体类-1">entity实体类</h4>
<p>在 entity实体类下，新增Property类：</p>
<ul>
<li>com.qqlin.tmall.dao.entity.Property.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonIgnoreProperties</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;property&#34;</span><span class="o">)</span>
<span class="nd">@JsonIgnoreProperties</span><span class="o">({</span><span class="s">&#34;handler&#34;</span><span class="o">,</span> <span class="s">&#34;hibernateLazyInitializer&#34;</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Property</span> <span class="o">{</span>
    
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;id&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;name&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;cid&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Category</span> <span class="n">category</span><span class="o">;</span>


    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Category</span> <span class="nf">getCategory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">category</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">category</span> <span class="o">=</span> <span class="n">category</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;Property [id=&#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;, name=&#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#34;, category=&#34;</span> <span class="o">+</span> <span class="n">category</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">;</span>
    <span class="o">}</span>


<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="repository仓库类-1">repository仓库类</h4>
<p>在 repository仓库类下，新增PropertyDAO类：</p>
<ul>
<li>com.qqlin.tmall.dao.repository.propertyDAO.java</li>
</ul>
<p>继承了JpaRepository&lt;Property, Integer&gt;，就提供了CRUD和分页 的各种常见功能，再重写需要的方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Property</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PropertyDAO</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * 根据传入的Category和Pageable，查询相应的page
</span><span class="cm">     *
</span><span class="cm">     * @param category 分类
</span><span class="cm">     * @param pageable 分页
</span><span class="cm">     * @return 分页的对象Page
</span><span class="cm">     */</span>
    <span class="n">Page</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="nf">findByCategory</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 根据传入的Category，查询分类下的属性值
</span><span class="cm">     *
</span><span class="cm">     * @param category 分类
</span><span class="cm">     * @return 属性值list
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="nf">findByCategory</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="service层-1">Service层</h4>
<p>然后，到了Service层，创建PropertyService接口类：</p>
<ul>
<li>com.qqlin.tmall.service.PropertyService.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Property</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PropertyService</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 增加属性
</span><span class="cm">     *
</span><span class="cm">     * @param bean 增加的实体Property
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Property</span> <span class="n">bean</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 删除属性
</span><span class="cm">     *
</span><span class="cm">     * @param id 属性对应的id
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 获取属性
</span><span class="cm">     *
</span><span class="cm">     * @param id 属性的id
</span><span class="cm">     * @return 返回Property
</span><span class="cm">     */</span>
    <span class="n">Property</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 更新属性
</span><span class="cm">     *
</span><span class="cm">     * @param bean 需要更新的实体Property
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Property</span> <span class="n">bean</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 查询所有的属性值，进行分页
</span><span class="cm">     *
</span><span class="cm">     * @param cid           分类的id
</span><span class="cm">     * @param start         分页的起始页
</span><span class="cm">     * @param size          单页显示的条数
</span><span class="cm">     * @param navigatePages 分页导航栏显示的分页个数
</span><span class="cm">     * @return 返回已分页的属性列表
</span><span class="cm">     */</span>
    <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">,</span> <span class="kt">int</span> <span class="n">navigatePages</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 查询分类对应的属性值
</span><span class="cm">     *
</span><span class="cm">     * @param category 需要查询的分类
</span><span class="cm">     * @return 返回属性列表
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="nf">listByCategory</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以及它的实现类impl.PropertyServiceImpl：</p>
<ul>
<li>com.qqlin.tmall.service.impl.PropertyServiceImpl.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Property</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.repository.PropertyDAO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.PropertyService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheEvict</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.Cacheable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.PageRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Sort</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="nd">@CacheConfig</span><span class="o">(</span><span class="n">cacheNames</span> <span class="o">=</span> <span class="s">&#34;properties&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropertyServiceImpl</span> <span class="kd">implements</span> <span class="n">PropertyService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">PropertyDAO</span> <span class="n">propertyDAO</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Property</span> <span class="n">bean</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyDAO</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;properties-one-&#39;+ #p0&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Property</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">propertyDAO</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Property</span> <span class="n">bean</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;properties-cid-&#39;+#p0+&#39;-page-&#39;+#p1 + &#39;-&#39; + #p2 &#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">,</span> <span class="kt">int</span> <span class="n">navigatePages</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">category</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>

        <span class="n">Sort</span> <span class="n">sort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sort</span><span class="o">(</span><span class="n">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">sort</span><span class="o">);</span>

        <span class="n">Page</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="n">pageFromJPA</span> <span class="o">=</span> <span class="n">propertyDAO</span><span class="o">.</span><span class="na">findByCategory</span><span class="o">(</span><span class="n">category</span><span class="o">,</span> <span class="n">pageable</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Page4Navigator</span><span class="o">&lt;&gt;(</span><span class="n">pageFromJPA</span><span class="o">,</span> <span class="n">navigatePages</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;properties-cid-&#39;+ #p0.id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="nf">listByCategory</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">propertyDAO</span><span class="o">.</span><span class="na">findByCategory</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="web控制层-1">web控制层</h4>
<p>最后到了web控制层，在com.qqlin.tmall.web目录下新增admin目录，新增PropertyController.java</p>
<ul>
<li>com.qqlin.tmall.web.admin.PropertyController</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.web.admin</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Property</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.PropertyService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropertyController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">PropertyService</span> <span class="n">propertyService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/categories/{cid}/properties&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;cid&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">cid</span><span class="o">,</span>
                                         <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;start&#34;</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&#34;0&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span>
                                         <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;size&#34;</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&#34;5&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="n">start</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">propertyService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">cid</span><span class="o">,</span> <span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">5</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/properties/{id}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Property</span> <span class="nf">get</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">propertyService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/properties&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">add</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">Property</span> <span class="n">bean</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">propertyService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">&#34;/properties/{id}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">propertyService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PutMapping</span><span class="o">(</span><span class="s">&#34;/properties&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">update</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">Property</span> <span class="n">bean</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">propertyService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="视图templates-1">视图templates</h4>
<p>视图的模板引擎是thymeleaf</p>
<p>分类有两个视图listProperty.html和editProperty.html，以及include/admin的4个嵌套视图</p>
<ul>
<li>listProperty.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/admin/adminHeader::html(&#39;属性管理&#39;)&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminNavigator::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">cid</span> <span class="o">=</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="s2">&#34;cid&#34;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">uri</span><span class="o">:</span><span class="s1">&#39;properties&#39;</span><span class="p">,</span>
            <span class="nx">beans</span><span class="o">:</span> <span class="p">[],</span>
            <span class="nx">bean</span><span class="o">:</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">name</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nx">category</span><span class="o">:</span><span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">0</span><span class="p">}},</span>
            <span class="nx">pagination</span><span class="o">:</span><span class="p">{},</span>
            <span class="nx">category</span><span class="o">:</span><span class="s1">&#39;&#39;</span>
        <span class="p">};</span>

        <span class="c1">//ViewModel
</span><span class="c1"></span>        <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
            <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                <span class="k">this</span><span class="p">.</span><span class="nx">getCategory</span><span class="p">(</span><span class="nx">cid</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">getCategory</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">cid</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;categories/&#34;</span><span class="o">+</span><span class="nx">cid</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">category</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                    <span class="p">})</span>
                <span class="p">},</span>
                <span class="nx">list</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="s2">&#34;categories/&#34;</span><span class="o">+</span><span class="nx">cid</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;?start=&#34;</span><span class="o">+</span><span class="nx">start</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">pagination</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">beans</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">content</span>	<span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s2">&#34;属性名称&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">category</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">cid</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">bean</span> <span class="o">=</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">name</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nx">category</span><span class="o">:</span><span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">0</span><span class="p">}};</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">deleteBean</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">checkDeleteLink</span><span class="p">())</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="nx">id</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                        <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">!=</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
                            <span class="nx">alert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
                        <span class="k">else</span>
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">jump</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">){</span>
                    <span class="nx">jump</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="nx">vue</span><span class="p">);</span> <span class="c1">//定义在adminHeader.html 中
</span><span class="c1"></span>                <span class="p">},</span>
                <span class="nx">jumpByNumber</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">){</span>
                    <span class="nx">jumpByNumber</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span><span class="nx">vue</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="p">});</span>
    <span class="p">});</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ol</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;breadcrumb&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_category_list&#34;</span><span class="p">&gt;</span>所有分类<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_property_list?cid=&#39;+category.id&#34;</span><span class="p">&gt;</span>{{category.name}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>属性管理<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;listDataTableDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;table table-striped table-bordered table-hover  table-condensed&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;success&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>属性名称<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>编辑<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>删除<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;bean in beans &#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{bean.id}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    {{bean.name}}
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_property_edit?id=&#39; + bean.id &#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-edit&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span>  <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;deleteBean(bean.id)&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;   glyphicon glyphicon-trash&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminPage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-warning addDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>新增属性<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addTable&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>属性名称<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;add&#34;</span>  <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.name&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitTR&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span>  <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;add&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-success&#34;</span><span class="p">&gt;</span>提交<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminFooter::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>editProperty.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/admin/adminHeader::html(&#39;编辑属性&#39;)&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminNavigator::html&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
            <span class="nx">listURL</span><span class="o">:</span> <span class="s1">&#39;admin_property_list&#39;</span><span class="p">,</span>
            <span class="nx">bean</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">category</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
        <span class="p">};</span>

        <span class="c1">//ViewModel
</span><span class="c1"></span>        <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
            <span class="nx">mounted</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">();</span>
            <span class="p">},</span>
            <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">bean</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">category</span> <span class="o">=</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">category</span><span class="p">;</span>
                    <span class="p">})</span>
                <span class="p">},</span>
                <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s2">&#34;属性名称&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">bean</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">listURL</span> <span class="o">+</span> <span class="s2">&#34;?cid=&#34;</span> <span class="o">+</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">category</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">ol</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;breadcrumb&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_category_list&#34;</span><span class="p">&gt;</span>所有分类<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_property_list?cid=&#39;+category.id&#34;</span><span class="p">&gt;</span>{{category.name}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>属性管理<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>


    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-warning editDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>编辑属性<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;editTable&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>属性名称<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;update&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.name&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitTR&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;id&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;hidden&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.id&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;update&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-success&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>提 交<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminFooter::html&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="235-产品管理的操作">2.3.5 产品管理的操作</h3>
<h4 id="entity实体类-2">entity实体类</h4>
<p>在 entity实体类下，新增Product类：</p>
<ul>
<li>com.qqlin.tmall.dao.entity.Property.java</li>
</ul>
<blockquote>
<p>注解@Document：</p>
<p>@Document(indexName = &ldquo;tmall_springboot&rdquo;, type = &ldquo;product&rdquo;)</p>
<p>@Document就表明了要连接到 ElasticSearch 的哪个索引和哪个 type 上</p>
<p>索引相当于就是数据库，type 相当于就是表</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonIgnoreProperties</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.elasticsearch.annotations.Document</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>


<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;product&#34;</span><span class="o">)</span>
<span class="nd">@JsonIgnoreProperties</span><span class="o">({</span><span class="s">&#34;handler&#34;</span><span class="o">,</span> <span class="s">&#34;hibernateLazyInitializer&#34;</span><span class="o">})</span>
<span class="nd">@Document</span><span class="o">(</span><span class="n">indexName</span> <span class="o">=</span> <span class="s">&#34;tmall_springboot&#34;</span><span class="o">,</span> <span class="n">type</span> <span class="o">=</span> <span class="s">&#34;product&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;id&#34;</span><span class="o">)</span>
    <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;cid&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Category</span> <span class="n">category</span><span class="o">;</span>

    <span class="c1">//如果既没有指明 关联到哪个Column,又没有明确要用@Transient忽略，那么就会自动关联到表对应的同名字段
</span><span class="c1"></span>    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">subTitle</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">originalPrice</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">promotePrice</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">stock</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createDate</span><span class="o">;</span>

    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="n">ProductImage</span> <span class="n">firstProductImage</span><span class="o">;</span>
    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span><span class="o">;</span>
    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span><span class="o">;</span>
    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">reviewCount</span><span class="o">;</span>
    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">saleCount</span><span class="o">;</span>


    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Category</span> <span class="nf">getCategory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">category</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">category</span> <span class="o">=</span> <span class="n">category</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getSubTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">subTitle</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSubTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">subTitle</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">subTitle</span> <span class="o">=</span> <span class="n">subTitle</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">getOriginalPrice</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">originalPrice</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOriginalPrice</span><span class="o">(</span><span class="kt">float</span> <span class="n">originalPrice</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">originalPrice</span> <span class="o">=</span> <span class="n">originalPrice</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">getPromotePrice</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">promotePrice</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPromotePrice</span><span class="o">(</span><span class="kt">float</span> <span class="n">promotePrice</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">promotePrice</span> <span class="o">=</span> <span class="n">promotePrice</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getStock</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">stock</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStock</span><span class="o">(</span><span class="kt">int</span> <span class="n">stock</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreateDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreateDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">createDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">createDate</span> <span class="o">=</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ProductImage</span> <span class="nf">getFirstProductImage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">firstProductImage</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">ProductImage</span> <span class="n">firstProductImage</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">firstProductImage</span> <span class="o">=</span> <span class="n">firstProductImage</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="nf">getProductSingleImages</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productSingleImages</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProductSingleImages</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">productSingleImages</span> <span class="o">=</span> <span class="n">productSingleImages</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="nf">getProductDetailImages</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productDetailImages</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProductDetailImages</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">productDetailImages</span> <span class="o">=</span> <span class="n">productDetailImages</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getReviewCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">reviewCount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setReviewCount</span><span class="o">(</span><span class="kt">int</span> <span class="n">reviewCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">reviewCount</span> <span class="o">=</span> <span class="n">reviewCount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSaleCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">saleCount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSaleCount</span><span class="o">(</span><span class="kt">int</span> <span class="n">saleCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">saleCount</span> <span class="o">=</span> <span class="n">saleCount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;Product [id=&#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;, category=&#34;</span> <span class="o">+</span> <span class="n">category</span> <span class="o">+</span> <span class="s">&#34;, name=&#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#34;, subTitle=&#34;</span> <span class="o">+</span> <span class="n">subTitle</span>
                <span class="o">+</span> <span class="s">&#34;, originalPrice=&#34;</span> <span class="o">+</span> <span class="n">originalPrice</span> <span class="o">+</span> <span class="s">&#34;, promotePrice=&#34;</span> <span class="o">+</span> <span class="n">promotePrice</span> <span class="o">+</span> <span class="s">&#34;, stock=&#34;</span> <span class="o">+</span> <span class="n">stock</span>
                <span class="o">+</span> <span class="s">&#34;, createDate=&#34;</span> <span class="o">+</span> <span class="n">createDate</span> <span class="o">+</span> <span class="s">&#34;, firstProductImage=&#34;</span> <span class="o">+</span> <span class="n">firstProductImage</span> <span class="o">+</span> <span class="s">&#34;, reviewCount=&#34;</span>
                <span class="o">+</span> <span class="n">reviewCount</span> <span class="o">+</span> <span class="s">&#34;, saleCount=&#34;</span> <span class="o">+</span> <span class="n">saleCount</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="repository仓库类-2">repository仓库类</h4>
<p>在 repository仓库类下，新增ProductDAO类：</p>
<ul>
<li>com.qqlin.tmall.dao.repository.ProductDAO.java</li>
</ul>
<p>继承了JpaRepository&lt;Product, Integer&gt;，就提供了CRUD和分页 的各种常见功能，再重写需要的方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductDAO</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 查询分类下的产品，对应的Page
</span><span class="cm">     *
</span><span class="cm">     * @param category 分类
</span><span class="cm">     * @param pageable 分页
</span><span class="cm">     * @return 分页对象
</span><span class="cm">     */</span>
    <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">findByCategory</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 查询分类下的所有产品
</span><span class="cm">     *
</span><span class="cm">     * @param category 分类
</span><span class="cm">     * @return 返回一个所有产品的列表
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">findByCategoryOrderById</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 使用keyword从数据库，进行模糊查询，进而实现产品的搜索功能
</span><span class="cm">     * 现在已经被ElasticSearch替代，已不使用
</span><span class="cm">     * @param keyword 关键字
</span><span class="cm">     * @param pageable  分页
</span><span class="cm">     * @return 返回查询到的产品列表
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">findByNameLike</span><span class="o">(</span><span class="n">String</span> <span class="n">keyword</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="service层-2">Service层</h4>
<p>然后，到了Service层，创建ProductService接口类：</p>
<ul>
<li>com.qqlin.tmall.service.ProductService.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qingq
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductService</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 增加产品
</span><span class="cm">     *
</span><span class="cm">     * @param bean 需要增加的产品实体类
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Product</span> <span class="n">bean</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 删除产品
</span><span class="cm">     *
</span><span class="cm">     * @param id 需要删除的产品id
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 获取产品
</span><span class="cm">     *
</span><span class="cm">     * @param id 产品的id
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="n">Product</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 更新产品
</span><span class="cm">     *
</span><span class="cm">     * @param bean 需要更新的实体Product
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Product</span> <span class="n">bean</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 查询分类下的所有产品，并进行分页
</span><span class="cm">     *
</span><span class="cm">     * @param cid           分类id
</span><span class="cm">     * @param start         开始的页码
</span><span class="cm">     * @param size          当页显示的条数
</span><span class="cm">     * @param navigatePages 导航栏显示的页码数量
</span><span class="cm">     * @return 返回所有该分类下的所有产品
</span><span class="cm">     */</span>
    <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">,</span> <span class="kt">int</span> <span class="n">navigatePages</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 为分类填充产品集合
</span><span class="cm">     *
</span><span class="cm">     * @param category 分类
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 为多个分类填充产品集合
</span><span class="cm">     *
</span><span class="cm">     * @param categories 多个分类
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 为多个分类填充推荐产品集合
</span><span class="cm">     *
</span><span class="cm">     * @param categories 多个分类
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">fillByRow</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 查询某个分类下的所有产品
</span><span class="cm">     *
</span><span class="cm">     * @param category 分类
</span><span class="cm">     * @return 返回查询到产品列表
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">listByCategory</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 为产品设置销量和评价数量的方法
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 为多个产品设置销量和评价数量的方法
</span><span class="cm">     *
</span><span class="cm">     * @param products 多个产品
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 以前查询是模糊查询，是直接到数据库的
</span><span class="cm">     * 现在是通过 ProductESDAO 到 ElasticSearch 中进行查询了
</span><span class="cm">     *
</span><span class="cm">     * @param keyword 查询提供的关键字
</span><span class="cm">     * @param start   分页显示的初始页码
</span><span class="cm">     * @param size    当页显示的条数
</span><span class="cm">     * @return 返回查询到产品
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">search</span><span class="o">(</span><span class="n">String</span> <span class="n">keyword</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 初始化数据到ElasticSearch.
</span><span class="cm">     * 因为数据刚开始都在数据库中，不在ElasticSearch中，
</span><span class="cm">     * 所以刚开始查询，先看看ElasticSearch有没有数据，
</span><span class="cm">     * 如果没有，就把数据从数据库同步到ElasticSearch中。
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">initDatabase2ES</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以及它的实现类impl.ProductServiceImpl：</p>
<ul>
<li>com.qqlin.tmall.service.impl.ProductServiceImpl.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.elasticsearch.ProductESDAO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.repository.ProductDAO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.SpringContextUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.elasticsearch.index.query.QueryBuilders</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.elasticsearch.index.query.functionscore.FunctionScoreQueryBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.elasticsearch.index.query.functionscore.ScoreFunctionBuilders</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheEvict</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.Cacheable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.PageRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Sort</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.elasticsearch.core.query.NativeSearchQueryBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.elasticsearch.core.query.SearchQuery</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="nd">@CacheConfig</span><span class="o">(</span><span class="n">cacheNames</span> <span class="o">=</span> <span class="s">&#34;products&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductServiceImpl</span> <span class="kd">implements</span> <span class="n">ProductService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductDAO</span> <span class="n">productDAO</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductESDAO</span> <span class="n">productESDAO</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Product</span> <span class="n">bean</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="n">productESDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productDAO</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">productESDAO</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;products-one-&#39;+ #p0&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productDAO</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Product</span> <span class="n">bean</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="n">productESDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;products-cid-&#39;+#p0+&#39;-page-&#39;+#p1 + &#39;-&#39; + #p2 &#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">,</span> <span class="kt">int</span> <span class="n">navigatePages</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">category</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">Sort</span> <span class="n">sort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sort</span><span class="o">(</span><span class="n">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">sort</span><span class="o">);</span>
        <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">pageFromJPA</span> <span class="o">=</span> <span class="n">productDAO</span><span class="o">.</span><span class="na">findByCategory</span><span class="o">(</span><span class="n">category</span><span class="o">,</span> <span class="n">pageable</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Page4Navigator</span><span class="o">&lt;&gt;(</span><span class="n">pageFromJPA</span><span class="o">,</span> <span class="n">navigatePages</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Category</span> <span class="n">category</span> <span class="o">:</span> <span class="n">categories</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">fill</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
<span class="c1">//        List&lt;Product&gt; products = listByCategory(category);
</span><span class="c1"></span>        <span class="n">ProductService</span> <span class="n">productService</span> <span class="o">=</span> <span class="n">SpringContextUtil</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">ProductService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">listByCategory</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
        <span class="n">productImageService</span><span class="o">.</span><span class="na">setFirstProductImages</span><span class="o">(</span><span class="n">products</span><span class="o">);</span>
        <span class="n">category</span><span class="o">.</span><span class="na">setProducts</span><span class="o">(</span><span class="n">products</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fillByRow</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">productNumberEachRow</span> <span class="o">=</span> <span class="n">8</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Category</span> <span class="n">category</span> <span class="o">:</span> <span class="n">categories</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getProducts</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span> <span class="n">productsByRow</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">products</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">productNumberEachRow</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">productNumberEachRow</span><span class="o">;</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="n">products</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">?</span> <span class="n">products</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">:</span> <span class="n">size</span><span class="o">;</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">productsOfEachRow</span> <span class="o">=</span> <span class="n">products</span><span class="o">.</span><span class="na">subList</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
                <span class="n">productsByRow</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">productsOfEachRow</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">category</span><span class="o">.</span><span class="na">setProductsByRow</span><span class="o">(</span><span class="n">productsByRow</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;products-cid-&#39;+ #p0.id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">listByCategory</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productDAO</span><span class="o">.</span><span class="na">findByCategoryOrderById</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">saleCount</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">getSaleCount</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="n">product</span><span class="o">.</span><span class="na">setSaleCount</span><span class="o">(</span><span class="n">saleCount</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">reviewCount</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">getCount</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="n">product</span><span class="o">.</span><span class="na">setReviewCount</span><span class="o">(</span><span class="n">reviewCount</span><span class="o">);</span>

    <span class="o">}</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">product</span> <span class="o">:</span> <span class="n">products</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
	
    <span class="c1">// 这是之前的模糊查询，已被ElasticSearch代替
</span><span class="c1"></span>    <span class="cm">/*@Override
</span><span class="cm">    public List&lt;Product&gt; search(String keyword, int start, int size) {
</span><span class="cm">        Sort sort = new Sort(Sort.Direction.DESC, &#34;id&#34;);
</span><span class="cm">        Pageable pageable = new PageRequest(start, size, sort);
</span><span class="cm">        List&lt;Product&gt; products = productDAO.findByNameLike(&#34;%&#34; + keyword + &#34;%&#34;, pageable);
</span><span class="cm">        return products;
</span><span class="cm">    }*/</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initDatabase2ES</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">5</span><span class="o">);</span>
        <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">productESDAO</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getContent</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span> <span class="n">productDAO</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
            <span class="n">productESDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">products</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">search</span><span class="o">(</span><span class="n">String</span> <span class="n">keyword</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">initDatabase2ES</span><span class="o">();</span>
        <span class="n">FunctionScoreQueryBuilder</span> <span class="n">functionScoreQueryBuilder</span> <span class="o">=</span> <span class="n">QueryBuilders</span><span class="o">.</span><span class="na">functionScoreQuery</span><span class="o">()</span>
                <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">QueryBuilders</span><span class="o">.</span><span class="na">matchPhrasePrefixQuery</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="n">keyword</span><span class="o">),</span>
                        <span class="n">ScoreFunctionBuilders</span><span class="o">.</span><span class="na">weightFactorFunction</span><span class="o">(</span><span class="n">100</span><span class="o">))</span>
                <span class="o">.</span><span class="na">scoreMode</span><span class="o">(</span><span class="s">&#34;sum&#34;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setMinScore</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>
        <span class="n">Sort</span> <span class="n">sort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sort</span><span class="o">(</span><span class="n">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">sort</span><span class="o">);</span>
        <span class="n">SearchQuery</span> <span class="n">searchQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withPageable</span><span class="o">(</span><span class="n">pageable</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withQuery</span><span class="o">(</span><span class="n">functionScoreQueryBuilder</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

        <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">productESDAO</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">searchQuery</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">page</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="web控制层-2">web控制层</h4>
<p>最后到了web控制层，在com.qqlin.tmall.web目录下新增admin目录，新增ProductController.java</p>
<ul>
<li>com.qqlin.tmall.web.admin.ProductController</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.web.admin</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductImageService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/categories/{cid}/products&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;cid&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">cid</span><span class="o">,</span>
                                        <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;start&#34;</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&#34;0&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span>
                                        <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;size&#34;</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&#34;5&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="n">start</span><span class="o">;</span>
        <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">cid</span><span class="o">,</span> <span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">5</span><span class="o">);</span>
        <span class="n">productImageService</span><span class="o">.</span><span class="na">setFirstProductImages</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>

        <span class="k">return</span> <span class="n">page</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/products/{id}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">get</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/products&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">add</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">Product</span> <span class="n">bean</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">bean</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">&#34;/products/{id}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PutMapping</span><span class="o">(</span><span class="s">&#34;/products&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">update</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">Product</span> <span class="n">bean</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="视图templates-2">视图templates</h4>
<p>视图的模板引擎是thymeleaf</p>
<p>分类有两个视图listProduct.html和editProduct.html，以及include/admin的4个嵌套视图</p>
<ul>
<li>listProduct.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/admin/adminHeader::html(&#39;产品管理&#39;)&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminNavigator::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">cid</span> <span class="o">=</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="s2">&#34;cid&#34;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">uri</span><span class="o">:</span><span class="s1">&#39;products&#39;</span><span class="p">,</span>
            <span class="nx">beans</span><span class="o">:</span> <span class="p">[],</span>
            <span class="nx">bean</span><span class="o">:</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">name</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;subTitle&#39;</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;originalPrice&#39;</span><span class="o">:</span><span class="mf">99.98</span><span class="p">,</span><span class="s1">&#39;promotePrice&#39;</span><span class="o">:</span><span class="mf">19.98</span><span class="p">,</span><span class="s1">&#39;stock&#39;</span><span class="o">:</span><span class="mi">99</span><span class="p">,</span><span class="nx">category</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="o">:</span><span class="mi">0</span><span class="p">}},</span>
            <span class="nx">pagination</span><span class="o">:</span><span class="p">{},</span>
            <span class="nx">category</span><span class="o">:</span><span class="s1">&#39;&#39;</span>
        <span class="p">};</span>

        <span class="c1">//ViewModel
</span><span class="c1"></span>        <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
            <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                <span class="k">this</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">getCategory</span><span class="p">(</span><span class="nx">cid</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">getCategory</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">cid</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;categories/&#34;</span><span class="o">+</span><span class="nx">cid</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">category</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                    <span class="p">})</span>
                <span class="p">},</span>
                <span class="nx">list</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="s2">&#34;categories/&#34;</span><span class="o">+</span><span class="nx">cid</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;?start=&#34;</span><span class="o">+</span><span class="nx">start</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">pagination</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">beans</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">content</span>	<span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s2">&#34;产品名称&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">subTitle</span><span class="p">,</span> <span class="s2">&#34;小标题&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">checkNumber</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">originalPrice</span><span class="p">,</span> <span class="s2">&#34;原价格&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">checkNumber</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">promotePrice</span><span class="p">,</span> <span class="s2">&#34;优惠价格&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">checkInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">stock</span><span class="p">,</span> <span class="s2">&#34;库存&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">category</span><span class="p">.</span><span class="nx">id</span><span class="o">=</span><span class="nx">cid</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">bean</span> <span class="o">=</span>  <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">name</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;subTitle&#39;</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;originalPrice&#39;</span><span class="o">:</span><span class="mf">99.98</span><span class="p">,</span><span class="s1">&#39;promotePrice&#39;</span><span class="o">:</span><span class="mf">19.98</span><span class="p">,</span><span class="s1">&#39;stock&#39;</span><span class="o">:</span><span class="mi">99</span><span class="p">,</span><span class="nx">category</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="o">:</span><span class="mi">0</span><span class="p">}};</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">deleteBean</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">checkDeleteLink</span><span class="p">())</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="nx">id</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                        <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">!=</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
                            <span class="nx">alert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
                        <span class="k">else</span>
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">jump</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">){</span>
                    <span class="nx">jump</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="nx">vue</span><span class="p">);</span> <span class="c1">//定义在adminHeader.html 中
</span><span class="c1"></span>                <span class="p">},</span>
                <span class="nx">jumpByNumber</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">){</span>
                    <span class="nx">jumpByNumber</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span><span class="nx">vue</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="p">});</span>
    <span class="p">});</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ol</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;breadcrumb&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_category_list&#34;</span><span class="p">&gt;</span>所有分类<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_product_list?cid=&#39;+category.id&#34;</span><span class="p">&gt;</span>{{category.name}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>产品管理<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;listDataTableDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;table table-striped table-bordered table-hover table-condensed&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;success&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>图片<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>产品名称<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>产品小标题<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;53px&#34;</span><span class="p">&gt;</span>原价格<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;80px&#34;</span><span class="p">&gt;</span>优惠价格<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;80px&#34;</span><span class="p">&gt;</span>库存数量<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;80px&#34;</span><span class="p">&gt;</span>图片管理<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;80px&#34;</span><span class="p">&gt;</span>设置属性<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>编辑<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>删除<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;bean in beans &#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{bean.id}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;null != bean.firstProductImage&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;40px&#34;</span> <span class="na">:src</span><span class="o">=</span><span class="s">&#34;&#39;img/productSingle/&#39;+bean.firstProductImage.id+&#39;.jpg&#39;&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{bean.name}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{bean.subTitle}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{bean.originalPrice}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{bean.promotePrice}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{bean.stock}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_productImage_list?pid=&#39; + bean.id &#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-picture&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_propertyValue_edit?pid=&#39; + bean.id &#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-th-list&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_product_edit?id=&#39; + bean.id &#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-edit&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span>  <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;deleteBean(bean.id)&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;   glyphicon glyphicon-trash&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminPage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-warning addDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>新增产品<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addTable&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>产品名称<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;add&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.name&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>产品小标题<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;add&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.subTitle&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
                                <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>原价格<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;add&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.originalPrice&#34;</span>  <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
                                <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>优惠价格<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;add&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.promotePrice&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
                                <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>库存<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;add&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.stock&#34;</span>  <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
                                <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>



                <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitTR&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span>  <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;add&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-success&#34;</span><span class="p">&gt;</span>提交<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminFooter::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>editProduct.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/admin/adminHeader::html(&#39;编辑产品&#39;)&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminNavigator::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span>
            <span class="nx">listURL</span><span class="o">:</span><span class="s1">&#39;admin_product_list&#39;</span><span class="p">,</span>
            <span class="nx">bean</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">category</span><span class="o">:</span><span class="s1">&#39;&#39;</span>
        <span class="p">};</span>

        <span class="c1">//ViewModel
</span><span class="c1"></span>        <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
            <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">();</span>
            <span class="p">},</span>
            <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">get</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
                    <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="nx">id</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">bean</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">category</span> <span class="o">=</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">category</span><span class="p">;</span>
                    <span class="p">})</span>
                <span class="p">},</span>
                <span class="nx">update</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s2">&#34;产品名称&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">subTitle</span><span class="p">,</span> <span class="s2">&#34;小标题&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">checkNumber</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">originalPrice</span><span class="p">,</span> <span class="s2">&#34;原价格&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">checkNumber</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">promotePrice</span><span class="p">,</span> <span class="s2">&#34;优惠价格&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">checkInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bean</span><span class="p">.</span><span class="nx">stock</span><span class="p">,</span> <span class="s2">&#34;库存&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="nx">vue</span><span class="p">.</span><span class="nx">bean</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                        <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="nx">vue</span><span class="p">.</span><span class="nx">listURL</span><span class="o">+</span><span class="s2">&#34;?cid=&#34;</span><span class="o">+</span><span class="nx">vue</span><span class="p">.</span><span class="nx">category</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">ol</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;breadcrumb&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_category_list&#34;</span><span class="p">&gt;</span>所有分类<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_product_list?cid=&#39;+category.id&#34;</span><span class="p">&gt;</span>{{category.name}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>产品管理<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>



    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-warning editDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>编辑产品<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;editTable&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>产品名称<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;update&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.name&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>产品小标题<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;update&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.subTitle&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
                                <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>原价格<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;update&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.originalPrice&#34;</span>  <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
                                <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>优惠价格<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;update&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.promotePrice&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
                                <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>库存<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="err">@</span><span class="na">keyup</span><span class="err">.</span><span class="na">enter</span><span class="o">=</span><span class="s">&#34;update&#34;</span> <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.stock&#34;</span>  <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
                                <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitTR&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;hidden&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;id&#34;</span>   <span class="na">v-model</span><span class="err">.</span><span class="na">trim</span><span class="o">=</span><span class="s">&#34;bean.id&#34;</span> <span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-success&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;update&#34;</span><span class="p">&gt;</span>提 交<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminFooter::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="236-产品图片管理">2.3.6 产品图片管理</h3>
<h4 id="entity实体类-3">entity实体类</h4>
<p>在 entity实体类下，新增ProductImage类：</p>
<ul>
<li>com.qqlin.tmall.dao.entity.ProductImage</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonBackReference</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonIgnoreProperties</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;productImage&#34;</span><span class="o">)</span>
<span class="nd">@JsonIgnoreProperties</span><span class="o">({</span><span class="s">&#34;handler&#34;</span><span class="o">,</span> <span class="s">&#34;hibernateLazyInitializer&#34;</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductImage</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;id&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;pid&#34;</span><span class="o">)</span>
    <span class="nd">@JsonBackReference</span>
    <span class="kd">private</span> <span class="n">Product</span> <span class="n">product</span><span class="o">;</span>


    <span class="kd">private</span> <span class="n">String</span> <span class="n">type</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">type</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setType</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProduct</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">product</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProduct</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">product</span> <span class="o">=</span> <span class="n">product</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="repository仓库类-3">repository仓库类</h4>
<p>在 repository仓库类下，新增ProductImageDAO类：</p>
<ul>
<li>com.qqlin.tmall.dao.repository.ProductImageDAO.java</li>
</ul>
<p>继承了JpaRepository&lt;ProductImage, Integer&gt;，就提供了CRUD和分页 的各种常见功能，再重写需要的方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.ProductImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductImageDAO</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 根据产品以及产品图片对应的类型，获得产品图片
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     * @param type 产品图片的类型
</span><span class="cm">     * @return 返回所查询的图片集合
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="nf">findByProductAndTypeOrderByIdDesc</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">,</span> <span class="n">String</span> <span class="n">type</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="service层-3">Service层</h4>
<p>然后，到了Service层，创建ProductImageService接口类：</p>
<ul>
<li>com.qqlin.tmall.service.ProductImageService.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.ProductImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductImageService</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">TYPE_SINGLE</span> <span class="o">=</span> <span class="s">&#34;single&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">TYPE_DETAIL</span> <span class="o">=</span> <span class="s">&#34;detail&#34;</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 增加图片
</span><span class="cm">     *
</span><span class="cm">     * @param bean 图片实体
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">ProductImage</span> <span class="n">bean</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 删除图片
</span><span class="cm">     *
</span><span class="cm">     * @param id 图片的id
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 获得图片
</span><span class="cm">     *
</span><span class="cm">     * @param id 图片的id
</span><span class="cm">     * @return 返回图片实体
</span><span class="cm">     */</span>
    <span class="n">ProductImage</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 查询singeImage图片
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     * @return 返回所有查询的singeImage集合
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="nf">listSingleProductImages</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 查询detailImage图片
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     * @return 返回所有查询的detailImages
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="nf">listDetailProductImages</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 为产品设置显示图片
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 为多个产品设置多个图片
</span><span class="cm">     *
</span><span class="cm">     * @param products 多个产品
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">setFirstProductImages</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 为购物车中的产品设图片
</span><span class="cm">     *
</span><span class="cm">     * @param orderItems 购物车
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">setFirstProductImagesOnOrderItems</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以及它的实现类impl.ProductImageServiceImpl：</p>
<ul>
<li>com.qqlin.tmall.service.impl.ProductImageServiceImpl.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.ProductImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.repository.ProductImageDAO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductImageService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.SpringContextUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheEvict</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.Cacheable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="nd">@CacheConfig</span><span class="o">(</span><span class="n">cacheNames</span> <span class="o">=</span> <span class="s">&#34;productImages&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductImageServiceImpl</span> <span class="kd">implements</span> <span class="n">ProductImageService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductImageDAO</span> <span class="n">productImageDAO</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">ProductImage</span> <span class="n">bean</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productImageDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productImageDAO</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;productImages-one-&#39;+ #p0&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ProductImage</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productImageDAO</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;productImages-single-pid-&#39;+ #p0.id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="nf">listSingleProductImages</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productImageDAO</span><span class="o">.</span><span class="na">findByProductAndTypeOrderByIdDesc</span><span class="o">(</span><span class="n">product</span><span class="o">,</span> <span class="n">TYPE_SINGLE</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;productImages-detail-pid-&#39;+ #p0.id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="nf">listDetailProductImages</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productImageDAO</span><span class="o">.</span><span class="na">findByProductAndTypeOrderByIdDesc</span><span class="o">(</span><span class="n">product</span><span class="o">,</span> <span class="n">TYPE_DETAIL</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
<span class="c1">//        List&lt;ProductImage&gt; singleImages = listSingleProductImages(product);
</span><span class="c1"></span>        <span class="n">ProductImageService</span> <span class="n">productImageService</span> <span class="o">=</span> <span class="n">SpringContextUtil</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">ProductImageService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">singleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">listSingleProductImages</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">singleImages</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">product</span><span class="o">.</span><span class="na">setFirstProductImage</span><span class="o">(</span><span class="n">singleImages</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">product</span><span class="o">.</span><span class="na">setFirstProductImage</span><span class="o">(</span><span class="k">new</span> <span class="n">ProductImage</span><span class="o">());</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImages</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">product</span> <span class="o">:</span> <span class="n">products</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImagesOnOrderItems</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">orderItem</span> <span class="o">:</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">orderItem</span><span class="o">.</span><span class="na">getProduct</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="web控制层-3">web控制层</h4>
<p>最后到了web控制层，在com.qqlin.tmall.web目录下新增admin目录，新增ProductImageController.java</p>
<ul>
<li>com.qqlin.tmall.web.admin.ProductImageController</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.web.admin</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.ProductImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductImageService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.ImageUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.imageio.ImageIO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.image.BufferedImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductImageController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/products/{pid}/productImages&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;type&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">type</span><span class="o">,</span> <span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;pid&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">ProductImageService</span><span class="o">.</span><span class="na">TYPE_SINGLE</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">type</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">singles</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">listSingleProductImages</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">singles</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ProductImageService</span><span class="o">.</span><span class="na">TYPE_DETAIL</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">type</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">details</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">listDetailProductImages</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">details</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/productImages&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">add</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;pid&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span>
                      <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;type&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">type</span><span class="o">,</span> <span class="n">MultipartFile</span> <span class="n">image</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">ProductImage</span> <span class="n">bean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProductImage</span><span class="o">();</span>
        <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">bean</span><span class="o">.</span><span class="na">setProduct</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="n">bean</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>

        <span class="n">productImageService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">folder</span> <span class="o">=</span> <span class="s">&#34;img/&#34;</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ProductImageService</span><span class="o">.</span><span class="na">TYPE_SINGLE</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">bean</span><span class="o">.</span><span class="na">getType</span><span class="o">()))</span> <span class="o">{</span>
            <span class="n">folder</span> <span class="o">+=</span> <span class="s">&#34;productSingle&#34;</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">folder</span> <span class="o">+=</span> <span class="s">&#34;productDetail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">File</span> <span class="n">imageFolder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="n">folder</span><span class="o">));</span>
        <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder</span><span class="o">,</span> <span class="n">bean</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;.jpg&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">file</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">mkdirs</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">image</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
            <span class="n">BufferedImage</span> <span class="n">img</span> <span class="o">=</span> <span class="n">ImageUtil</span><span class="o">.</span><span class="na">change2jpg</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
            <span class="n">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">img</span><span class="o">,</span> <span class="s">&#34;jpg&#34;</span><span class="o">,</span> <span class="n">file</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">ProductImageService</span><span class="o">.</span><span class="na">TYPE_SINGLE</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">bean</span><span class="o">.</span><span class="na">getType</span><span class="o">()))</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">imageFolder_small</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/productSingle_small&#34;</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">imageFolder_middle</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/productSingle_middle&#34;</span><span class="o">);</span>
            <span class="n">File</span> <span class="n">f_small</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder_small</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
            <span class="n">File</span> <span class="n">f_middle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder_middle</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
            <span class="n">f_small</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">mkdirs</span><span class="o">();</span>
            <span class="n">f_middle</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">mkdirs</span><span class="o">();</span>
            <span class="n">ImageUtil</span><span class="o">.</span><span class="na">resizeImage</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">56</span><span class="o">,</span> <span class="n">56</span><span class="o">,</span> <span class="n">f_small</span><span class="o">);</span>
            <span class="n">ImageUtil</span><span class="o">.</span><span class="na">resizeImage</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">217</span><span class="o">,</span> <span class="n">190</span><span class="o">,</span> <span class="n">f_middle</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">&#34;/productImages/{id}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">ProductImage</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">productImageService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">folder</span> <span class="o">=</span> <span class="s">&#34;img/&#34;</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ProductImageService</span><span class="o">.</span><span class="na">TYPE_SINGLE</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">bean</span><span class="o">.</span><span class="na">getType</span><span class="o">()))</span> <span class="o">{</span>
            <span class="n">folder</span> <span class="o">+=</span> <span class="s">&#34;productSingle&#34;</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">folder</span> <span class="o">+=</span> <span class="s">&#34;productDetail&#34;</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">File</span> <span class="n">imageFolder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="n">folder</span><span class="o">));</span>
        <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder</span><span class="o">,</span> <span class="n">bean</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;.jpg&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">file</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ProductImageService</span><span class="o">.</span><span class="na">TYPE_SINGLE</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">bean</span><span class="o">.</span><span class="na">getType</span><span class="o">()))</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">imageFolder_small</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/productSingle_small&#34;</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">imageFolder_middle</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/productSingle_middle&#34;</span><span class="o">);</span>
            <span class="n">File</span> <span class="n">f_small</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder_small</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
            <span class="n">File</span> <span class="n">f_middle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder_middle</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
            <span class="n">f_small</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
            <span class="n">f_middle</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="视图templates-3">视图templates</h4>
<p>视图的模板引擎是thymeleaf</p>
<p>分类有一个视图listProductImage.html，以及include/admin的4个嵌套视图</p>
<ul>
<li>listProductImage.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/admin/adminHeader::html(&#39;产品管理&#39;)&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminNavigator::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">pid</span> <span class="o">=</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="s2">&#34;pid&#34;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">uri</span><span class="o">:</span><span class="s1">&#39;productImages&#39;</span><span class="p">,</span>
            <span class="nx">singleProductImages</span><span class="o">:</span> <span class="p">[],</span>
            <span class="nx">detailProductImages</span><span class="o">:</span> <span class="p">[],</span>
            <span class="nx">product</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">category</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">singleFile</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">detailFile</span><span class="o">:</span><span class="s1">&#39;&#39;</span>
        <span class="p">};</span>

        <span class="c1">//ViewModel
</span><span class="c1"></span>        <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
            <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                <span class="k">this</span><span class="p">.</span><span class="nx">listSingles</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">listDetails</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">pid</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">getProduct</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">pid</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;products/&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">product</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">category</span> <span class="o">=</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">category</span><span class="p">;</span>
                    <span class="p">})</span>
                <span class="p">},</span>
                <span class="nx">listSingles</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="s2">&#34;products/&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;?type=single&#34;</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">singleProductImages</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">listDetails</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="s2">&#34;products/&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;?type=detail&#34;</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">detailProductImages</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">addSingle</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">singleFile</span><span class="p">,</span> <span class="s2">&#34;单个产品图片&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;?type=single&amp;pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
                    <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">singleFile</span><span class="p">);</span>

                    <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="nx">formData</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">listSingles</span><span class="p">();</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#singlePic&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">singleFile</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">addDetail</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">detailFile</span><span class="p">,</span> <span class="s2">&#34;详情产品图片&#34;</span><span class="p">))</span>
                        <span class="k">return</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;?type=detail&amp;pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="p">;</span>

                    <span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
                    <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">detailFile</span><span class="p">);</span>

                    <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="nx">formData</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">listDetails</span><span class="p">();</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#detailPic&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">detailFile</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">deleteBean</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">checkDeleteLink</span><span class="p">())</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="nx">id</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">listSingles</span><span class="p">();</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">listDetails</span><span class="p">();</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">getSingleFile</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">singleFile</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="p">},</span>
                <span class="nx">getDetailFile</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">detailFile</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="p">},</span>
            <span class="p">}</span>

        <span class="p">});</span>
    <span class="p">});</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ol</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;breadcrumb&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_category_list&#34;</span><span class="p">&gt;</span>所有分类<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_product_list?cid=&#39;+category.id&#34;</span><span class="p">&gt;</span>{{category.name}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>{{product.name}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>产品图片管理<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addPictureTable&#34;</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addPictureTableTD&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-warning addPictureDiv&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>新增产品<span class="p">&lt;</span><span class="nt">b</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;text-primary&#34;</span><span class="p">&gt;</span> 单个 <span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>图片<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addTable&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>请选择本地图片 尺寸400X400 为佳<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;singlePic&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="err">@</span><span class="na">change</span><span class="o">=</span><span class="s">&#34;getSingleFile($event)&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;image&#34;</span> <span class="p">/&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitTR&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;addSingle&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-success&#34;</span><span class="p">&gt;</span>提 交<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;table table-striped table-bordered table-hover  table-condensed&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;success&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>产品单个图片缩略图<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>删除<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;pi in singleProductImages&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{pi.id}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;点击查看原图&#34;</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;img/productSingle/&#39;+pi.id+&#39;.jpg&#39;&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;50px&#34;</span> <span class="na">:src</span><span class="o">=</span><span class="s">&#34;&#39;img/productSingle/&#39;+pi.id+&#39;.jpg&#39;&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;deleteBean(pi.id)&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-trash&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>

                        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addPictureTableTD&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-warning addPictureDiv&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>新增产品<span class="p">&lt;</span><span class="nt">b</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;text-primary&#34;</span><span class="p">&gt;</span> 详情 <span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>图片<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addTable&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>请选择本地图片 宽度790  为佳<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;detailPic&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="err">@</span><span class="na">change</span><span class="o">=</span><span class="s">&#34;getDetailFile($event)&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;image&#34;</span> <span class="p">/&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitTR&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;addDetail&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-success&#34;</span><span class="p">&gt;</span>提 交<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;table table-striped table-bordered table-hover  table-condensed&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;success&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>产品详情图片缩略图<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>删除<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;pi in detailProductImages&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{pi.id}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;点击查看原图&#34;</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;img/productDetail/&#39;+pi.id+&#39;.jpg&#39;&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;50px&#34;</span> <span class="na">:src</span><span class="o">=</span><span class="s">&#34;&#39;img/productDetail/&#39;+pi.id+&#39;.jpg&#39;&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;deleteBean(pi.id)&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-trash&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>

                        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>



<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminFooter::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="237--产品属性管理">2.3.7  产品属性管理</h3>
<h4 id="entity实体类-4">entity实体类</h4>
<p>在 entity实体类下，新增PropertyValue类：</p>
<ul>
<li>com.qqlin.tmall.dao.entity.PropertyValue.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonIgnoreProperties</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;propertyvalue&#34;</span><span class="o">)</span>
<span class="nd">@JsonIgnoreProperties</span><span class="o">({</span><span class="s">&#34;handler&#34;</span><span class="o">,</span> <span class="s">&#34;hibernateLazyInitializer&#34;</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropertyValue</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;id&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;pid&#34;</span><span class="o">)</span>

    <span class="kd">private</span> <span class="n">Product</span> <span class="n">product</span><span class="o">;</span>
    <span class="nd">@ManyToOne</span>

    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;ptid&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Property</span> <span class="n">property</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProduct</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">product</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProduct</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">product</span> <span class="o">=</span> <span class="n">product</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Property</span> <span class="nf">getProperty</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">property</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">Property</span> <span class="n">property</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">property</span> <span class="o">=</span> <span class="n">property</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;PropertyValue [id=&#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;, product=&#34;</span> <span class="o">+</span> <span class="n">product</span> <span class="o">+</span> <span class="s">&#34;, property=&#34;</span> <span class="o">+</span> <span class="n">property</span> <span class="o">+</span> <span class="s">&#34;, value=&#34;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">;</span>
    <span class="o">}</span>


<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="repository仓库类-4">repository仓库类</h4>
<p>在 repository仓库类下，新增PropertyValueDAO类：</p>
<ul>
<li>com.qqlin.tmall.dao.repository.PropertyValueDAO.java</li>
</ul>
<p>继承了JpaRepository&lt;PropertyValue, Integer&gt;，就提供了CRUD和分页 的各种常见功能，再重写需要的方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.repository</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Property</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.PropertyValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PropertyValueDAO</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 查询产品对应的属性值，并按id的倒序排列
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     * @return 属性集合
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="nf">findByProductOrderByIdDesc</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 根据产品和属性，获取产品属性值
</span><span class="cm">     * @param property 属性
</span><span class="cm">     * @param product   产品
</span><span class="cm">     * @return  属性值
</span><span class="cm">     */</span>
    <span class="n">PropertyValue</span> <span class="nf">getByPropertyAndProduct</span><span class="o">(</span><span class="n">Property</span> <span class="n">property</span><span class="o">,</span> <span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="service层-4">Service层</h4>
<p>然后，到了Service层，创建PropertyValueService接口类：</p>
<ul>
<li>com.qqlin.tmall.service.PropertyValueService.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Property</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.PropertyValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PropertyValueService</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 更新属性值
</span><span class="cm">     *
</span><span class="cm">     * @param bean 属性值的实体类
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">PropertyValue</span> <span class="n">bean</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 初始化产品的属性
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 和根据产品和属性获取PropertyValue对象
</span><span class="cm">     *
</span><span class="cm">     * @param product  产品
</span><span class="cm">     * @param property 属性
</span><span class="cm">     * @return 产品的属性值
</span><span class="cm">     */</span>
    <span class="n">PropertyValue</span> <span class="nf">getByPropertyAndProduct</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">,</span> <span class="n">Property</span> <span class="n">property</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 查询产品的所有属性值
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     * @return 产品的属性值集合
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以及它的实现类impl.PropertyValueServiceImpl：</p>
<ul>
<li>com.qqlin.tmall.service.impl.PropertyValueServiceImpl.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Property</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.PropertyValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.repository.PropertyValueDAO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.PropertyService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.PropertyValueService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.SpringContextUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheEvict</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.Cacheable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="nd">@CacheConfig</span><span class="o">(</span><span class="n">cacheNames</span> <span class="o">=</span> <span class="s">&#34;propertyValues&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropertyValueServiceImpl</span> <span class="kd">implements</span> <span class="n">PropertyValueService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">PropertyValueDAO</span> <span class="n">propertyValueDAO</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">PropertyService</span> <span class="n">propertyService</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">PropertyValue</span> <span class="n">bean</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyValueDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span> <span class="o">=</span> <span class="n">SpringContextUtil</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">PropertyValueService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">propertyService</span><span class="o">.</span><span class="na">listByCategory</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getCategory</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Property</span> <span class="n">property</span> <span class="o">:</span> <span class="n">properties</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">PropertyValue</span> <span class="n">propertyValue</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">getByPropertyAndProduct</span><span class="o">(</span><span class="n">product</span><span class="o">,</span> <span class="n">property</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">propertyValue</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">propertyValue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PropertyValue</span><span class="o">();</span>
                <span class="n">propertyValue</span><span class="o">.</span><span class="na">setProduct</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
                <span class="n">propertyValue</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">property</span><span class="o">);</span>
                <span class="n">propertyValueDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">propertyValue</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;propertyValues-one-pid-&#39;+#p0.id+ &#39;-ptid-&#39; + #p1.id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">PropertyValue</span> <span class="nf">getByPropertyAndProduct</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">,</span> <span class="n">Property</span> <span class="n">property</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">propertyValueDAO</span><span class="o">.</span><span class="na">getByPropertyAndProduct</span><span class="o">(</span><span class="n">property</span><span class="o">,</span> <span class="n">product</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;propertyValues-pid-&#39;+ #p0.id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">propertyValueDAO</span><span class="o">.</span><span class="na">findByProductOrderByIdDesc</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="web控制层-4">web控制层</h4>
<p>最后到了web控制层，在com.qqlin.tmall.web目录下新增admin目录，新增PropertyValueController.java</p>
<ul>
<li>com.qqlin.tmall.web.admin.PropertyValueController</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.web.admin</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.PropertyValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.PropertyValueService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropertyValueController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/products/{pid}/propertyValues&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;pid&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">propertyValueService</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@PutMapping</span><span class="o">(</span><span class="s">&#34;/propertyValues&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">update</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">PropertyValue</span> <span class="n">bean</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">propertyValueService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="视图templates-4">视图templates</h4>
<p>视图的模板引擎是thymeleaf</p>
<p>分类有一个视图editPropertyValue.html，以及include/admin的4个嵌套视图</p>
<ul>
<li>editPropertyValue.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/admin/adminHeader::html(&#39;产品管理&#39;)&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminNavigator::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">pid</span> <span class="o">=</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="s2">&#34;pid&#34;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">uri</span><span class="o">:</span><span class="s1">&#39;propertyValues&#39;</span><span class="p">,</span>
            <span class="nx">beans</span><span class="o">:</span> <span class="p">[],</span>
            <span class="nx">product</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">category</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="p">};</span>

        <span class="c1">//ViewModel
</span><span class="c1"></span>        <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
            <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                <span class="k">this</span><span class="p">.</span><span class="nx">getProduct</span><span class="p">(</span><span class="nx">pid</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">list</span><span class="p">();</span>
            <span class="p">},</span>
            <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">list</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;products/&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">beans</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">getProduct</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">pid</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;products/&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">product</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">category</span> <span class="o">=</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">category</span><span class="p">;</span>
                    <span class="p">})</span>
                <span class="p">},</span>
                <span class="nx">update</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">bean</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">bean</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#pvid&#34;</span><span class="o">+</span><span class="nx">bean</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;border&#34;</span><span class="p">,</span><span class="s2">&#34;2px solid yellow&#34;</span><span class="p">);</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="nx">bean</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">bean</span><span class="p">.</span><span class="nx">id</span><span class="o">==</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#pvid&#34;</span><span class="o">+</span><span class="nx">bean</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;border&#34;</span><span class="p">,</span><span class="s2">&#34;2px solid green&#34;</span><span class="p">);</span>
                        <span class="k">else</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#pvid&#34;</span><span class="o">+</span><span class="nx">bean</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;border&#34;</span><span class="p">,</span><span class="s2">&#34;2px solid red&#34;</span><span class="p">);</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="p">});</span>
    <span class="p">});</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ol</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;breadcrumb&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_category_list&#34;</span><span class="p">&gt;</span>所有分类<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;admin_product_list?cid=&#39;+category.id&#34;</span><span class="p">&gt;</span>{{category.name}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>{{product.name}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>产品图片管理<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;editPVDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;bean in beans&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;eachPV&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pvName&#34;</span> <span class="p">&gt;</span>{{bean.property.name}}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pvValue&#34;</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pvValue&#34;</span> <span class="na">:id</span><span class="o">=</span><span class="s">&#34;&#39;pvid&#39;+bean.id&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;bean.value&#34;</span> <span class="err">@</span><span class="na">keyup</span><span class="o">=</span><span class="s">&#34;update(bean)&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>



<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminFooter::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="238-用户管理">2.3.8 用户管理</h3>
<h4 id="entity实体类-5">entity实体类</h4>
<p>在 entity实体类下，新增User类：</p>
<ul>
<li>com.qqlin.tmall.dao.entity.User.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonIgnoreProperties</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;user&#34;</span><span class="o">)</span>
<span class="nd">@JsonIgnoreProperties</span><span class="o">({</span><span class="s">&#34;handler&#34;</span><span class="o">,</span> <span class="s">&#34;hibernateLazyInitializer&#34;</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;id&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 盐
</span><span class="cm">     * 用于用户密码的加密
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">salt</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 别名
</span><span class="cm">     * 用于评论功能中的匿名
</span><span class="cm">     */</span>
    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">anonymousName</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getSalt</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">salt</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSalt</span><span class="o">(</span><span class="n">String</span> <span class="n">salt</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">salt</span> <span class="o">=</span> <span class="n">salt</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAnonymousName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">anonymousName</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">anonymousName</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">anonymousName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">anonymousName</span> <span class="o">=</span> <span class="s">&#34;*&#34;</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="n">2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">anonymousName</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34;*&#34;</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="kt">char</span><span class="o">[]</span> <span class="n">cs</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cs</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">cs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="sc">&#39;*&#39;</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">anonymousName</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">anonymousName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAnonymousName</span><span class="o">(</span><span class="n">String</span> <span class="n">anonymousName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">anonymousName</span> <span class="o">=</span> <span class="n">anonymousName</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="repository仓库类-5">repository仓库类</h4>
<p>在 repository仓库类下，新增UserDAO类：</p>
<ul>
<li>com.qqlin.tmall.dao.repository.UserDAO.java</li>
</ul>
<p>继承了JpaRepository&lt;User, Integer&gt;，就提供了CRUD和分页 的各种常见功能，再重写需要的方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserDAO</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 根据用户名，查询用户
</span><span class="cm">     * @param name 用户名
</span><span class="cm">     * @return 用户信息
</span><span class="cm">     */</span>
    <span class="n">User</span> <span class="nf">findByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 根据用户名和用户密码，获得用户
</span><span class="cm">     * @param name 用户名
</span><span class="cm">     * @param password 用户密码
</span><span class="cm">     * @return 用户
</span><span class="cm">     */</span>
    <span class="n">User</span> <span class="nf">getByNameAndPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="service层-5">Service层</h4>
<p>然后，到了Service层，创建UserService接口类：</p>
<ul>
<li>com.qqlin.tmall.service.UserService.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserService</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 判断用户名是否存在
</span><span class="cm">     * 用户账户注册，或者账户登录
</span><span class="cm">     *
</span><span class="cm">     * @param name 用户名
</span><span class="cm">     * @return 返回布尔值
</span><span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="nf">isExist</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 根据用户名获得用户信息
</span><span class="cm">     *
</span><span class="cm">     * @param name 用户名
</span><span class="cm">     * @return 返回一个用户
</span><span class="cm">     */</span>
    <span class="n">User</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 根据用户名和密码获得用户信息
</span><span class="cm">     *
</span><span class="cm">     * @param name     用户名
</span><span class="cm">     * @param password 用户密码
</span><span class="cm">     * @return 返回一个用户
</span><span class="cm">     */</span>
    <span class="n">User</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 获取全部用户，并分页显示
</span><span class="cm">     * @param start 起始页
</span><span class="cm">     * @param size 当页显示的条数
</span><span class="cm">     * @param navigatePages 导航栏显示的页码数
</span><span class="cm">     * @return 返回一个用户集合
</span><span class="cm">     */</span>
    <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">,</span> <span class="kt">int</span> <span class="n">navigatePages</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 新增用户
</span><span class="cm">     * @param user 需要增加的用户
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>以及它的实现类impl.UserServiceImpl：</p>
<ul>
<li>com.qqlin.tmall.service.impl.UserServiceImpl.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.repository.UserDAO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.UserService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheEvict</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.Cacheable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.PageRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Sort</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="nd">@CacheConfig</span><span class="o">(</span><span class="n">cacheNames</span> <span class="o">=</span> <span class="s">&#34;users&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceImpl</span> <span class="kd">implements</span> <span class="n">UserService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">UserDAO</span> <span class="n">userDAO</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isExist</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">getByName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span> <span class="o">!=</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;users-one-name-&#39;+ #p0&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userDAO</span><span class="o">.</span><span class="na">findByName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;users-one-name-&#39;+ #p0 +&#39;-password-&#39;+ #p1&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userDAO</span><span class="o">.</span><span class="na">getByNameAndPassword</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;users-page-&#39;+#p0+ &#39;-&#39; + #p1&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">,</span> <span class="kt">int</span> <span class="n">navigatePages</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Sort</span> <span class="n">sort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sort</span><span class="o">(</span><span class="n">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">sort</span><span class="o">);</span>
        <span class="n">Page</span> <span class="n">pageFromJPA</span> <span class="o">=</span> <span class="n">userDAO</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Page4Navigator</span><span class="o">&lt;&gt;(</span><span class="n">pageFromJPA</span><span class="o">,</span> <span class="n">navigatePages</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="web控制层-5">web控制层</h4>
<p>最后到了web控制层，在com.qqlin.tmall.web目录下新增admin目录，新增UserController.java</p>
<ul>
<li>com.qqlin.tmall.web.admin.UserController</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.web.admin</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.UserService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/users&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;start&#34;</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&#34;0&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span>
                                     <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;size&#34;</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&#34;5&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="n">start</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">5</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="视图templates-5">视图templates</h4>
<p>视图的模板引擎是thymeleaf</p>
<p>分类有一个个视图listUser.html，以及include/admin的4个嵌套视图</p>
<ul>
<li>listUser.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/admin/adminHeader::html(&#39;用户管理&#39;)&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminNavigator::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

        <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">uri</span><span class="o">:</span><span class="s1">&#39;users&#39;</span><span class="p">,</span>
            <span class="nx">beans</span><span class="o">:</span> <span class="p">[],</span>
            <span class="nx">pagination</span><span class="o">:</span><span class="p">{}</span>
        <span class="p">};</span>

        <span class="c1">//ViewModel
</span><span class="c1"></span>        <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
            <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                <span class="k">this</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">list</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span> <span class="s2">&#34;?start=&#34;</span><span class="o">+</span><span class="nx">start</span><span class="p">;</span>
                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">pagination</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                        <span class="nx">vue</span><span class="p">.</span><span class="nx">beans</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">content</span>	<span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">jump</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">){</span>
                    <span class="nx">jump</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="nx">vue</span><span class="p">);</span> <span class="c1">//定义在adminHeader.html 中
</span><span class="c1"></span>                <span class="p">},</span>
                <span class="nx">jumpByNumber</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">){</span>
                    <span class="nx">jumpByNumber</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span><span class="nx">vue</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;label label-info&#34;</span> <span class="p">&gt;</span>用户管理<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;listDataTableDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;table table-striped table-bordered table-hover  table-condensed&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;success&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>用户名称<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;bean in beans &#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{bean.id}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    {{bean.name}}
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminPage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>


<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminFooter::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="239-订单管理">2.3.9 订单管理</h3>
<h4 id="entity实体类-6">entity实体类</h4>
<p>在 entity实体类下，新增Order类：</p>
<ul>
<li>com.qqlin.tmall.dao.entity.Order.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonIgnoreProperties</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderService</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;order_&#34;</span><span class="o">)</span>
<span class="nd">@JsonIgnoreProperties</span><span class="o">({</span><span class="s">&#34;handler&#34;</span><span class="o">,</span> <span class="s">&#34;hibernateLazyInitializer&#34;</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Order</span> <span class="o">{</span>
    
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;id&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;uid&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">orderCode</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">address</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">post</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">receiver</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">mobile</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">userMessage</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">payDate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">deliveryDate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">confirmDate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">status</span><span class="o">;</span>

    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span><span class="o">;</span>
    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">total</span><span class="o">;</span>
    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">totalNumber</span><span class="o">;</span>
    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">statusDesc</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStatusDesc</span><span class="o">(</span><span class="n">String</span> <span class="n">statusDesc</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">statusDesc</span> <span class="o">=</span> <span class="n">statusDesc</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getStatusDesc</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">statusDesc</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">statusDesc</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">String</span> <span class="n">desc</span> <span class="o">=</span> <span class="s">&#34;未知&#34;</span><span class="o">;</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">status</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">waitPay</span><span class="o">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s">&#34;待付&#34;</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">waitDelivery</span><span class="o">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s">&#34;待发&#34;</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">waitConfirm</span><span class="o">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s">&#34;待收&#34;</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">waitReview</span><span class="o">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s">&#34;等评&#34;</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">finish</span><span class="o">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s">&#34;完成&#34;</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">delete</span><span class="o">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s">&#34;刪除&#34;</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s">&#34;未知&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">statusDesc</span> <span class="o">=</span> <span class="n">desc</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">statusDesc</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAddress</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">address</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAddress</span><span class="o">(</span><span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPost</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">post</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPost</span><span class="o">(</span><span class="n">String</span> <span class="n">post</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">post</span> <span class="o">=</span> <span class="n">post</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMobile</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mobile</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMobile</span><span class="o">(</span><span class="n">String</span> <span class="n">mobile</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">mobile</span> <span class="o">=</span> <span class="n">mobile</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUserMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userMessage</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">userMessage</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userMessage</span> <span class="o">=</span> <span class="n">userMessage</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreateDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreateDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">createDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">createDate</span> <span class="o">=</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getPayDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">payDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPayDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">payDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">payDate</span> <span class="o">=</span> <span class="n">payDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getDeliveryDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">deliveryDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDeliveryDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">deliveryDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">deliveryDate</span> <span class="o">=</span> <span class="n">deliveryDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getConfirmDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">confirmDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setConfirmDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">confirmDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">confirmDate</span> <span class="o">=</span> <span class="n">confirmDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getReceiver</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">receiver</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setReceiver</span><span class="o">(</span><span class="n">String</span> <span class="n">receiver</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">receiver</span> <span class="o">=</span> <span class="n">receiver</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getOrderCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderCode</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrderCode</span><span class="o">(</span><span class="n">String</span> <span class="n">orderCode</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">orderCode</span> <span class="o">=</span> <span class="n">orderCode</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">getOrderItems</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderItems</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrderItems</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">orderItems</span> <span class="o">=</span> <span class="n">orderItems</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">getTotal</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">total</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTotal</span><span class="o">(</span><span class="kt">float</span> <span class="n">total</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">total</span> <span class="o">=</span> <span class="n">total</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getStatus</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">status</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStatus</span><span class="o">(</span><span class="n">String</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">status</span> <span class="o">=</span> <span class="n">status</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getTotalNumber</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">totalNumber</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTotalNumber</span><span class="o">(</span><span class="kt">int</span> <span class="n">totalNumber</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">totalNumber</span> <span class="o">=</span> <span class="n">totalNumber</span><span class="o">;</span>
    <span class="o">}</span>
    
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在 entity实体类下，新增OrderItem类：</p>
<ul>
<li>com.qqlin.tmall.dao.entity.OrderItem.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonIgnoreProperties</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;orderItem&#34;</span><span class="o">)</span>
<span class="nd">@JsonIgnoreProperties</span><span class="o">({</span><span class="s">&#34;handler&#34;</span><span class="o">,</span> <span class="s">&#34;hibernateLazyInitializer&#34;</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderItem</span> <span class="o">{</span>
    
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;id&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;pid&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Product</span> <span class="n">product</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;oid&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Order</span> <span class="n">order</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;uid&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNumber</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">number</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNumber</span><span class="o">(</span><span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProduct</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">product</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProduct</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">product</span> <span class="o">=</span> <span class="n">product</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Order</span> <span class="nf">getOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">order</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrder</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">order</span> <span class="o">=</span> <span class="n">order</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="repository仓库类-6">repository仓库类</h4>
<p>在 repository仓库类下，新增OrderDAO类：</p>
<ul>
<li>com.qqlin.tmall.dao.repository.OrderDAO.java</li>
</ul>
<p>继承了JpaRepository<!-- raw HTML omitted -->，就提供了CRUD和分页 的各种常见功能，再重写需要的方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qingq
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderDAO</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * 根据用户和订单状态，查询订单
</span><span class="cm">     *
</span><span class="cm">     * @param user   用户
</span><span class="cm">     * @param status 订单状态
</span><span class="cm">     * @return 返回订单集合
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="nf">findByUserAndStatusNotOrderByIdDesc</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span> <span class="n">String</span> <span class="n">status</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在 repository仓库类下，新增OrderItemDAO类：</p>
<ul>
<li>com.qqlin.tmall.dao.repository.OrderItemDAO.java</li>
</ul>
<p>继承了JpaRepository<!-- raw HTML omitted -->，就提供了CRUD和分页 的各种常见功能，再重写需要的方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderItemDAO</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 根据订单查找订单项，并按照倒序排序
</span><span class="cm">     *
</span><span class="cm">     * @param order 订单
</span><span class="cm">     * @return 返回订单项的集合
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">findByOrderOrderByIdDesc</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 根据产品查找订单项
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     * @return 订单项的集合
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">findByProduct</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 根据用户查找订单项，且用户的订单为空
</span><span class="cm">     *
</span><span class="cm">     * @param user 用户
</span><span class="cm">     * @return 返回订单项列表
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">findByUserAndOrderIsNull</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="service层-6">Service层</h4>
<p>然后，到了Service层，创建OrderService接口类和OrderItemService：</p>
<ul>
<li>com.qqlin.tmall.service.OrderService.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderService</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">WAIT_PAY</span> <span class="o">=</span> <span class="s">&#34;waitPay&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">WAIT_DELIVERY</span> <span class="o">=</span> <span class="s">&#34;waitDelivery&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">WAIT_CONFIRM</span> <span class="o">=</span> <span class="s">&#34;waitConfirm&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">WAIT_REVIEW</span> <span class="o">=</span> <span class="s">&#34;waitReview&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">FINISH</span> <span class="o">=</span> <span class="s">&#34;finish&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">DELETE</span> <span class="o">=</span> <span class="s">&#34;delete&#34;</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 查询订单，并分页
</span><span class="cm">     *
</span><span class="cm">     * @param start         起始页
</span><span class="cm">     * @param size          当页显示的条数
</span><span class="cm">     * @param navigatePages 分页
</span><span class="cm">     * @return 返回订单的集合
</span><span class="cm">     */</span>
    <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">,</span> <span class="kt">int</span> <span class="n">navigatePages</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 从订单项中删除订单
</span><span class="cm">     *
</span><span class="cm">     * @param orders 多个订单
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">removeOrderFromOrderItem</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 从订单项中删除订单
</span><span class="cm">     *
</span><span class="cm">     * @param order 订单
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">removeOrderFromOrderItem</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 根据订单项，查询订单
</span><span class="cm">     *
</span><span class="cm">     * @param oid 订单项的id
</span><span class="cm">     * @return 返回订单
</span><span class="cm">     */</span>
    <span class="n">Order</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 更新订单
</span><span class="cm">     *
</span><span class="cm">     * @param bean 订单实体类
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Order</span> <span class="n">bean</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 根据订单和订单项，计算出该订单的支付金额，显示在订单列表中
</span><span class="cm">     *
</span><span class="cm">     * @param order      订单
</span><span class="cm">     * @param orderItems 订单项
</span><span class="cm">     * @return 总的支付金额
</span><span class="cm">     */</span>
    <span class="kt">float</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 订单新增
</span><span class="cm">     *
</span><span class="cm">     * @param order 订单实体类
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 将没被删除的订单，填充订单项
</span><span class="cm">     *
</span><span class="cm">     * @param user 用户
</span><span class="cm">     * @return 返回已填充订单项的订单
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="nf">listByUserWithoutDelete</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 订单删除：只是把订单状态，标注为delete
</span><span class="cm">     * 查询出所有没被删除的订单
</span><span class="cm">     *
</span><span class="cm">     * @param user 用户
</span><span class="cm">     * @return 返回所有没删除的订单
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="nf">listByUserAndNotDeleted</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 用于计算订单总金额
</span><span class="cm">     *
</span><span class="cm">     * @param order 订单
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">calculation</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>com.qqlin.tmall.service.impl.OrderServiceImpl</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.repository.OrderDAO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.SpringContextUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheEvict</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.Cacheable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.PageRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Sort</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Propagation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="nd">@CacheConfig</span><span class="o">(</span><span class="n">cacheNames</span> <span class="o">=</span> <span class="s">&#34;orders&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderServiceImpl</span> <span class="kd">implements</span> <span class="n">OrderService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">OrderDAO</span> <span class="n">orderDAO</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;orders-page-&#39;+#p0+ &#39;-&#39; + #p1&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Page4Navigator</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">,</span> <span class="kt">int</span> <span class="n">navigatePages</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Sort</span> <span class="n">sort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sort</span><span class="o">(</span><span class="n">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">sort</span><span class="o">);</span>
        <span class="n">Page</span> <span class="n">pageFromJPA</span> <span class="o">=</span> <span class="n">orderDAO</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Page4Navigator</span><span class="o">&lt;&gt;(</span><span class="n">pageFromJPA</span><span class="o">,</span> <span class="n">navigatePages</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeOrderFromOrderItem</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Order</span> <span class="n">order</span> <span class="o">:</span> <span class="n">orders</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">removeOrderFromOrderItem</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeOrderFromOrderItem</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getOrderItems</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">orderItem</span> <span class="o">:</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">orderItem</span><span class="o">.</span><span class="na">setOrder</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;orders-one-&#39;+ #p0&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Order</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderDAO</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Order</span> <span class="n">bean</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">propagation</span> <span class="o">=</span> <span class="n">Propagation</span><span class="o">.</span><span class="na">REQUIRED</span><span class="o">,</span> <span class="n">rollbackForClassName</span> <span class="o">=</span> <span class="s">&#34;Exception&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="n">add</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>

        <span class="cm">/**
</span><span class="cm">         * 故意抛出异常代码用来模拟当增加订单后出现异常，
</span><span class="cm">         * 观察事务管理是否预期发生。
</span><span class="cm">         * （需要把false修改为true才能观察到）
</span><span class="cm">         */</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">false</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setOrder</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()</span> <span class="o">*</span> <span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">total</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;orders-uid-&#39;+ #p0.id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="nf">listByUserAndNotDeleted</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderDAO</span><span class="o">.</span><span class="na">findByUserAndStatusNotOrderByIdDesc</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">DELETE</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="nf">listByUserWithoutDelete</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OrderService</span> <span class="n">orderService</span> <span class="o">=</span> <span class="n">SpringContextUtil</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">listByUserAndNotDeleted</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">orders</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">orders</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculation</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getOrderItems</span><span class="o">();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">orderItem</span> <span class="o">:</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">orderItem</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()</span> <span class="o">*</span> <span class="n">orderItem</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setTotal</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>com.qqlin.tmall.service.OrderItemService.java</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qingq
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderItemService</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 订单填充内容
</span><span class="cm">     *
</span><span class="cm">     * @param order 订单
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 为多个订单填充内容
</span><span class="cm">     *
</span><span class="cm">     * @param orders 多个订单
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 更新订单中的订单项
</span><span class="cm">     *
</span><span class="cm">     * @param orderItem 订单项
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">orderItem</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 新增订单项
</span><span class="cm">     *
</span><span class="cm">     * @param orderItem 订单项
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">orderItem</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 获取订单项
</span><span class="cm">     *
</span><span class="cm">     * @param id 订单项的id
</span><span class="cm">     * @return 返回一个订单
</span><span class="cm">     */</span>
    <span class="n">OrderItem</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 删除订单
</span><span class="cm">     *
</span><span class="cm">     * @param id 订单的id
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 获取产品的销售数量
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     * @return 返回销售数量
</span><span class="cm">     */</span>
    <span class="kt">int</span> <span class="nf">getSaleCount</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 购物车功能
</span><span class="cm">     * 根据产品，查找所有的订单项
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     * @return 所有订单项
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">listByProduct</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 订单功能
</span><span class="cm">     * 根据订单查找订单项
</span><span class="cm">     *
</span><span class="cm">     * @param order 订单
</span><span class="cm">     * @return 所有的订单项
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">listByOrder</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 查找用户的订单项
</span><span class="cm">     *
</span><span class="cm">     * @param user 用户
</span><span class="cm">     * @return 所有的订单项
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">listByUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>com.qqlin.tmall.service.impl.OrderItemServiceImpl</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.repository.OrderItemDAO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductImageService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.SpringContextUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheEvict</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.Cacheable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="nd">@CacheConfig</span><span class="o">(</span><span class="n">cacheNames</span> <span class="o">=</span> <span class="s">&#34;orderItems&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderItemServiceImpl</span> <span class="kd">implements</span> <span class="n">OrderItemService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">OrderItemDAO</span> <span class="n">orderItemDAO</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Order</span> <span class="n">order</span> <span class="o">:</span> <span class="n">orders</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">fill</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">orderItem</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderItemDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">orderItem</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
<span class="c1">//        List&lt;OrderItem&gt; orderItems = listByOrder(order);
</span><span class="c1"></span>        <span class="n">OrderItemService</span> <span class="n">orderItemService</span> <span class="o">=</span> <span class="n">SpringContextUtil</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">OrderItemService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByOrder</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">totalNumber</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()</span> <span class="o">*</span> <span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">();</span>
            <span class="n">totalNumber</span> <span class="o">+=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">productImageService</span><span class="o">.</span><span class="na">setFirstProductImage</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setTotal</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setOrderItems</span><span class="o">(</span><span class="n">orderItems</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setTotalNumber</span><span class="o">(</span><span class="n">totalNumber</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setOrderItems</span><span class="o">(</span><span class="n">orderItems</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">orderItem</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderItemDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">orderItem</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;orderItems-one-&#39;+ #p0&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">OrderItem</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderItemDAO</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderItemDAO</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSaleCount</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">listByProduct</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getOrder</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getOrder</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="kc">null</span> <span class="o">!=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getOrder</span><span class="o">().</span><span class="na">getPayDate</span><span class="o">())</span> <span class="o">{</span>
                    <span class="n">result</span> <span class="o">+=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;orderItems-pid-&#39;+ #p0.id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">listByProduct</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderItemDAO</span><span class="o">.</span><span class="na">findByProduct</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;orderItems-oid-&#39;+ #p0.id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">listByOrder</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderItemDAO</span><span class="o">.</span><span class="na">findByOrderOrderByIdDesc</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;orderItems-uid-&#39;+ #p0.id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">listByUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderItemDAO</span><span class="o">.</span><span class="na">findByUserAndOrderIsNull</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="web控制层-6">web控制层</h4>
<p>最后到了web控制层，在com.qqlin.tmall.web目录下新增admin目录，新增OrderController.java</p>
<ul>
<li>com.qqlin.tmall.web.admin.OrderController</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.web.admin</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page4Navigator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Result</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderController</span> <span class="o">{</span>
    
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/orders&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;start&#34;</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&#34;0&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;size&#34;</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&#34;5&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="n">start</span><span class="o">;</span>
        <span class="n">Page4Navigator</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">5</span><span class="o">);</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">removeOrderFromOrderItem</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">page</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PutMapping</span><span class="o">(</span><span class="s">&#34;deliveryOrder/{oid}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">deliveryOrder</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setDeliveryDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">WAIT_CONFIRM</span><span class="o">);</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="视图templates-6">视图templates</h4>
<p>视图的模板引擎是thymeleaf</p>
<p>分类有一个个视图listOrder.html，以及include/admin的4个嵌套视图</p>
<ul>
<li>listOrder.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span> <span class="n">th</span><span class="o">:</span><span class="n">include</span><span class="o">=</span><span class="s">&#34;include/admin/adminHeader::html(&#39;订单管理&#39;)&#34;</span> <span class="o">&gt;&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">div</span> <span class="n">th</span><span class="o">:</span><span class="n">replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminNavigator::html&#34;</span> <span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="nf">$</span><span class="o">(</span><span class="n">function</span><span class="o">(){</span>

        <span class="n">var</span> <span class="n">data4Vue</span> <span class="o">=</span> <span class="o">{</span>
            <span class="n">uri</span><span class="o">:</span><span class="err">&#39;</span><span class="n">orders</span><span class="err">&#39;</span><span class="o">,</span>
            <span class="n">beans</span><span class="o">:</span> <span class="o">[],</span>
            <span class="n">pagination</span><span class="o">:{}</span>
        <span class="o">};</span>

        <span class="c1">//ViewModel
</span><span class="c1"></span>        <span class="n">var</span> <span class="n">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Vue</span><span class="o">({</span>
            <span class="n">el</span><span class="o">:</span> <span class="err">&#39;#</span><span class="n">workingArea</span><span class="err">&#39;</span><span class="o">,</span>
            <span class="n">data</span><span class="o">:</span> <span class="n">data4Vue</span><span class="o">,</span>
            <span class="n">mounted</span><span class="o">:</span><span class="n">function</span><span class="o">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                <span class="k">this</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
            <span class="o">},</span>
            <span class="n">methods</span><span class="o">:</span> <span class="o">{</span>
                <span class="n">list</span><span class="o">:</span><span class="n">function</span><span class="o">(</span><span class="n">start</span><span class="o">){</span>
                    <span class="n">var</span> <span class="n">url</span> <span class="o">=</span>  <span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">+</span> <span class="s">&#34;?start=&#34;</span><span class="o">+</span><span class="n">start</span><span class="o">;</span>
                    <span class="n">axios</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">url</span><span class="o">).</span><span class="na">then</span><span class="o">(</span><span class="n">function</span><span class="o">(</span><span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">vue</span><span class="o">.</span><span class="na">pagination</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">;</span>
                        <span class="n">vue</span><span class="o">.</span><span class="na">beans</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">content</span><span class="o">;</span>
                    <span class="o">});</span>
                <span class="o">},</span>
                <span class="n">showOrderItems</span><span class="o">:</span> <span class="n">function</span><span class="o">(</span><span class="n">order</span><span class="o">){</span>
                    <span class="n">var</span> <span class="n">id</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
                    <span class="n">$</span><span class="o">(</span><span class="s">&#34;#orderItemsTR&#34;</span><span class="o">+</span><span class="n">id</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="o">},</span>
                <span class="n">jump</span><span class="o">:</span> <span class="n">function</span><span class="o">(</span><span class="n">page</span><span class="o">){</span>
                    <span class="n">jump</span><span class="o">(</span><span class="n">page</span><span class="o">,</span><span class="n">vue</span><span class="o">);</span> <span class="c1">//定义在adminHeader.html 中
</span><span class="c1"></span>                <span class="o">},</span>
                <span class="n">jumpByNumber</span><span class="o">:</span> <span class="n">function</span><span class="o">(</span><span class="n">start</span><span class="o">){</span>
                    <span class="n">jumpByNumber</span><span class="o">(</span><span class="n">start</span><span class="o">,</span><span class="n">vue</span><span class="o">);</span>
                <span class="o">},</span>
                <span class="n">deliveryOrder</span><span class="o">:</span><span class="n">function</span><span class="o">(</span><span class="n">order</span><span class="o">,</span><span class="n">e</span><span class="o">){</span>
                    <span class="n">var</span> <span class="n">url</span> <span class="o">=</span>  <span class="s">&#34;deliveryOrder/&#34;</span><span class="o">+</span><span class="n">order</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
                    <span class="n">axios</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">url</span><span class="o">).</span><span class="na">then</span><span class="o">(</span><span class="n">function</span><span class="o">(</span><span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">$</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">target</span><span class="o">).</span><span class="na">hide</span><span class="o">();</span>
                    <span class="o">});</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">Vue</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="err">&#39;</span><span class="n">formatDateFilter</span><span class="err">&#39;</span><span class="o">,</span> <span class="n">function</span> <span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">formatString</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">value</span><span class="o">)</span>
                <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
            <span class="n">formatString</span> <span class="o">=</span> <span class="n">formatString</span> <span class="o">||</span> <span class="err">&#39;</span><span class="n">YYYY</span><span class="o">-</span><span class="n">MM</span><span class="o">-</span><span class="n">DD</span> <span class="n">HH</span><span class="o">:</span><span class="n">mm</span><span class="o">:</span><span class="n">ss</span><span class="err">&#39;</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">moment</span><span class="o">(</span><span class="n">value</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="n">formatString</span><span class="o">);</span>
        <span class="o">});</span>
    <span class="o">});</span>

<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">div</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span> <span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">h1</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;label label-info&#34;</span> <span class="o">&gt;</span><span class="n">订单管理</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;listDataTableDiv&#34;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;table table-striped table-bordered table-hover  table-condensed&#34;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">thead</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">tr</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;success&#34;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">状态</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">金额</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span> <span class="n">width</span><span class="o">=</span><span class="s">&#34;100px&#34;</span><span class="o">&gt;</span><span class="n">商品数量</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span> <span class="n">width</span><span class="o">=</span><span class="s">&#34;100px&#34;</span><span class="o">&gt;</span><span class="n">买家名称</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">创建时间</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">支付时间</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">发货时间</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">确认收货时间</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span> <span class="n">width</span><span class="o">=</span><span class="s">&#34;120px&#34;</span><span class="o">&gt;</span><span class="n">操作</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">thead</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">tbody</span><span class="o">&gt;</span>
            <span class="o">&lt;!--</span> <span class="n">在业务上需要一个订单数据产生两行</span> <span class="n">tr</span><span class="o">,</span> <span class="n">此时就不能在</span> <span class="n">tr上进行</span> <span class="n">v</span><span class="o">-</span><span class="k">for</span><span class="o">,</span> <span class="n">而需要用</span> <span class="n">template</span> <span class="n">标签</span> <span class="o">--&gt;</span>
            <span class="o">&lt;</span><span class="n">template</span> <span class="n">v</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s">&#34;bean in beans &#34;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">tr</span> <span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
                        <span class="o">{{</span><span class="n">bean</span><span class="o">.</span><span class="na">statusDesc</span><span class="o">}}</span>
                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
                        <span class="o">{{</span><span class="n">bean</span><span class="o">.</span><span class="na">total</span><span class="o">}}</span>
                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
                        <span class="o">{{</span><span class="n">bean</span><span class="o">.</span><span class="na">totalNumber</span><span class="o">}}</span>
                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
                        <span class="o">{{</span><span class="n">bean</span><span class="o">.</span><span class="na">user</span><span class="o">.</span><span class="na">name</span><span class="o">}}</span>
                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
                        <span class="o">{{</span><span class="n">bean</span><span class="o">.</span><span class="na">createDate</span> <span class="o">|</span> <span class="n">formatDateFilter</span><span class="o">}}</span>
                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
                        <span class="o">{{</span><span class="n">bean</span><span class="o">.</span><span class="na">payDate</span> <span class="o">|</span> <span class="n">formatDateFilter</span><span class="o">}}</span>
                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
                        <span class="o">{{</span><span class="n">bean</span><span class="o">.</span><span class="na">deliveryDate</span> <span class="o">|</span> <span class="n">formatDateFilter</span><span class="o">}}</span>
                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
                        <span class="o">{{</span><span class="n">bean</span><span class="o">.</span><span class="na">confirmDate</span> <span class="o">|</span> <span class="n">formatDateFilter</span><span class="o">}}</span>
                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="n">button</span> <span class="nd">@click</span><span class="o">=</span><span class="s">&#34;showOrderItems(bean)&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;orderPageCheckOrderItems btn btn-primary btn-xs&#34;</span><span class="o">&gt;</span><span class="n">查看详情</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>

                        <span class="o">&lt;</span><span class="n">button</span> <span class="n">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s">&#34;bean.status==&#39;waitDelivery&#39;&#34;</span> <span class="nd">@click</span><span class="o">=</span><span class="s">&#34;deliveryOrder(bean,$event)&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;btn btn-primary btn-xs&#34;</span><span class="o">&gt;</span><span class="n">发货</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">tr</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;orderPageOrderItemTR&#34;</span>  <span class="o">:</span><span class="n">id</span><span class="o">=</span><span class="s">&#34;&#39;orderItemsTR&#39;+bean.id&#34;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="s">&#34;10&#34;</span> <span class="n">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="o">&gt;</span>

                        <span class="o">&lt;</span><span class="n">div</span>  <span class="n">class</span><span class="o">=</span><span class="s">&#34;orderPageOrderItem&#34;</span><span class="o">&gt;</span>
                            <span class="o">&lt;</span><span class="n">table</span> <span class="n">width</span><span class="o">=</span><span class="s">&#34;800px&#34;</span> <span class="n">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;orderPageOrderItemTable&#34;</span><span class="o">&gt;</span>
                                <span class="o">&lt;</span><span class="n">tr</span> <span class="n">v</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s">&#34;orderItem in bean.orderItems&#34;</span><span class="o">&gt;</span>
                                    <span class="o">&lt;</span><span class="n">td</span> <span class="n">align</span><span class="o">=</span><span class="s">&#34;left&#34;</span><span class="o">&gt;</span>
                                        <span class="o">&lt;</span><span class="n">img</span> <span class="n">width</span><span class="o">=</span><span class="s">&#34;40px&#34;</span> <span class="n">height</span><span class="o">=</span><span class="s">&#34;40px&#34;</span> <span class="o">:</span><span class="n">src</span><span class="o">=</span><span class="s">&#34;&#39;img/productSingle/&#39;+orderItem.product.firstProductImage.id+&#39;.jpg&#39;&#34;</span><span class="o">&gt;</span>
                                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>

                                    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
                                        <span class="o">&lt;</span><span class="n">a</span> <span class="o">:</span><span class="n">href</span><span class="o">=</span><span class="s">&#34;&#39;product?product.id=&#39;+orderItem.product.id&#34;</span><span class="o">&gt;</span>
                                            <span class="o">&lt;</span><span class="n">span</span><span class="o">&gt;{{</span><span class="n">orderItem</span><span class="o">.</span><span class="na">product</span><span class="o">.</span><span class="na">name</span><span class="o">}}&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                                        <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                                    <span class="o">&lt;</span><span class="n">td</span> <span class="n">align</span><span class="o">=</span><span class="s">&#34;right&#34;</span><span class="o">&gt;</span>

                                        <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;text-muted&#34;</span><span class="o">&gt;{{</span><span class="n">orderItem</span><span class="o">.</span><span class="na">number</span><span class="o">}}</span><span class="n">个</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                                    <span class="o">&lt;</span><span class="n">td</span> <span class="n">align</span><span class="o">=</span><span class="s">&#34;right&#34;</span><span class="o">&gt;</span>

                                        <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;text-muted&#34;</span><span class="o">&gt;</span><span class="n">单价</span><span class="err">：￥</span><span class="o">{{</span><span class="n">orderItem</span><span class="o">.</span><span class="na">product</span><span class="o">.</span><span class="na">promotePrice</span><span class="o">}}&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>

                                <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
                            <span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
                        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
                    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">template</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">tbody</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">div</span> <span class="n">th</span><span class="o">:</span><span class="n">replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminPage::html&#34;</span> <span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>


<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">div</span> <span class="n">th</span><span class="o">:</span><span class="n">replace</span><span class="o">=</span><span class="s">&#34;include/admin/adminFooter::html&#34;</span> <span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="三前台管理">三、前台管理</h1>
<h2 id="31-前台管理-无需登录">3.1 前台管理-无需登录</h2>
<h3 id="311-首页功能">3.1.1 首页功能</h3>
<h4 id="web控制层-7">web控制层</h4>
<p>新增 ForePageController ，用于控制前台管理的页面跳转</p>
<ul>
<li>com.qqlin.tmall.web.fore.ForePageController</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.web.fore</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.shiro.SecurityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.subject.Subject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForePageController</span> <span class="o">{</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;redirect:home&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/home&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/register&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/alipay&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">alipay</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/alipay&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/bought&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">bought</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/bought&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/buy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/cart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/cart&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/category&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/confirmPay&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">confirmPay</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/confirmPay&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/login&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/orderConfirmed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">orderConfirmed</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/orderConfirmed&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/payed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">payed</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/payed&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/product&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/registerSuccess&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">registerSuccess</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/registerSuccess&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/review&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">review</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/review&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/search&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">searchResult</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/search&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 退出需要，通过subject.logout退出
</span><span class="cm">     *
</span><span class="cm">     * @param session
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//        session.removeAttribute(&#34;user&#34;);
</span><span class="c1"></span>
        <span class="kd">final</span> <span class="n">Subject</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">SecurityUtils</span><span class="o">.</span><span class="na">getSubject</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">subject</span><span class="o">.</span><span class="na">isAuthenticated</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">subject</span><span class="o">.</span><span class="na">logout</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:home&#34;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>com.qqlin.tmall.web.fore.ForeRestController.home()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.web.fore</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Result</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.math.RandomUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.SecurityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.authc.AuthenticationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.authc.UsernamePasswordToken</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.crypto.SecureRandomNumberGenerator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.crypto.hash.SimpleHash</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.subject.Subject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qingq
</span><span class="cm"> */</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeRestController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * 提供主页显示
</span><span class="cm">     * 将分类信息填充到分类中
</span><span class="cm">     *
</span><span class="cm">     * @return 已填充的分类
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">home</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">categories</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">categories</span><span class="o">);</span>
        <span class="n">categoryService</span><span class="o">.</span><span class="na">removeCategoryFromProduct</span><span class="o">(</span><span class="n">categories</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">categories</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="视图templates-7">视图templates</h4>
<p>根据前台页面的特点，我们把home.html设计成如代码所示。</p>
<ol>
<li>header.html
引入标准标签库，js,css，自定义javascript函数等</li>
<li>top.html
置顶导航</li>
<li>search.html
搜索栏</li>
<li>homePage.html
首页业务页面</li>
<li>footer.html
页脚</li>
</ol>
<ul>
<li>home.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/fore/header::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/top::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/search::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/home/homePage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/footer::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>header.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;js/jquery/2.0.0/jquery.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;css/bootstrap/3.3.6/bootstrap.min.css&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;js/bootstrap/3.3.6/bootstrap.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;js/vue/2.5.16/vue.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;js/axios/0.17.1/axios.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;js/moment/2.22.2/moment.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;css/fore/style.css&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>


        <span class="kd">function</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="nx">para</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">search</span><span class="o">=</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">;</span> <span class="c1">//页面URL的查询部分字符串
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">arrPara</span><span class="o">=</span><span class="k">new</span> <span class="nb">Array</span><span class="p">();</span> <span class="c1">//参数数组。数组单项为包含参数名和参数值的字符串，如“para=value”
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">arrVal</span><span class="o">=</span><span class="k">new</span> <span class="nb">Array</span><span class="p">();</span> <span class="c1">//参数值数组。用于存储查找到的参数值
</span><span class="c1"></span>
            <span class="k">if</span><span class="p">(</span><span class="nx">search</span><span class="o">!=</span><span class="s2">&#34;&#34;</span><span class="p">){</span>
                <span class="kd">var</span> <span class="nx">index</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
                <span class="nx">search</span><span class="o">=</span><span class="nx">search</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">//去除开头的“?”
</span><span class="c1"></span>                <span class="nx">arrPara</span><span class="o">=</span><span class="nx">search</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34;&amp;&#34;</span><span class="p">);</span>

                <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">arrPara</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">paraPre</span><span class="o">=</span><span class="nx">para</span><span class="o">+</span><span class="s2">&#34;=&#34;</span><span class="p">;</span> <span class="c1">//参数前缀。即参数名+“=”，如“para=”
</span><span class="c1"></span>                    <span class="k">if</span><span class="p">(</span><span class="nx">arrPara</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">paraPre</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="o">&amp;&amp;</span> <span class="nx">paraPre</span><span class="p">.</span><span class="nx">length</span><span class="o">&lt;</span><span class="nx">arrPara</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">length</span><span class="p">){</span>
                        <span class="nx">arrVal</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span><span class="o">=</span><span class="nb">decodeURI</span><span class="p">(</span><span class="nx">arrPara</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">substr</span><span class="p">(</span><span class="nx">paraPre</span><span class="p">.</span><span class="nx">length</span><span class="p">));</span> <span class="c1">//顺带URI解码避免出现乱码
</span><span class="c1"></span>                        <span class="nx">index</span><span class="o">++</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="nx">arrVal</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
                <span class="k">return</span> <span class="nx">arrVal</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">arrVal</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="nx">arrVal</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">formatMoney</span><span class="p">(</span><span class="nx">num</span><span class="p">){</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="nx">num</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\$|\,/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">num</span><span class="p">))</span>
                <span class="nx">num</span> <span class="o">=</span> <span class="s2">&#34;0&#34;</span><span class="p">;</span>
            <span class="nx">sign</span> <span class="o">=</span> <span class="p">(</span><span class="nx">num</span> <span class="o">==</span> <span class="p">(</span><span class="nx">num</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">num</span><span class="p">)));</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">num</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mf">0.50000000001</span><span class="p">);</span>
            <span class="nx">cents</span> <span class="o">=</span> <span class="nx">num</span><span class="o">%</span><span class="mi">100</span><span class="p">;</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">num</span><span class="o">/</span><span class="mi">100</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">cents</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">)</span>
                <span class="nx">cents</span> <span class="o">=</span> <span class="s2">&#34;0&#34;</span> <span class="o">+</span> <span class="nx">cents</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">num</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nx">i</span><span class="p">))</span><span class="o">/</span><span class="mi">3</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
                <span class="nx">num</span> <span class="o">=</span> <span class="nx">num</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">num</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="nx">i</span><span class="o">+</span><span class="mi">3</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span>
                    <span class="nx">num</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">num</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="nx">i</span><span class="o">+</span><span class="mi">3</span><span class="p">));</span>
            <span class="k">return</span> <span class="p">(((</span><span class="nx">sign</span><span class="p">)</span><span class="o">?</span><span class="s1">&#39;&#39;</span><span class="o">:</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">num</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">cents</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">checkEmpty</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#&#34;</span><span class="o">+</span><span class="nx">id</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#&#34;</span><span class="o">+</span><span class="nx">id</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">focus</span><span class="p">();</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">linkDefaultActions</span><span class="p">(){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.leaveMessageTextareaSpan&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.leaveMessageImg&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.leaveMessageTextareaSpan&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.orderItemSumDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;height&#34;</span><span class="p">,</span><span class="s2">&#34;100px&#34;</span><span class="p">);</span>
            <span class="p">});</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div#footer a[href$=#nowhere]&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;模仿天猫的连接，并没有跳转到实际的页面&#34;</span><span class="p">);</span>
            <span class="p">});</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;a.wangwanglink&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;模仿旺旺的图标，并不会打开旺旺&#34;</span><span class="p">);</span>
            <span class="p">});</span>

            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;a.notImplementLink&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;这个功能没做，蛤蛤~&#34;</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="nx">Vue</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&#34;subStringFilter&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span><span class="nx">end</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="nx">Vue</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&#34;formatMoneyFilter&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
            <span class="k">return</span> <span class="nx">formatMoney</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="nx">Vue</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;formatDateFilter&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">formatString</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="kc">null</span><span class="o">==</span><span class="nx">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
            <span class="nx">formatString</span> <span class="o">=</span> <span class="nx">formatString</span> <span class="o">||</span> <span class="s1">&#39;YYYY-MM-DD HH:mm:ss&#39;</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">value</span><span class="p">).</span><span class="nx">format</span><span class="p">(</span><span class="nx">formatString</span><span class="p">);</span>
        <span class="p">});</span>

    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;Content-Type&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;text/html; charset=utf-8&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>top.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;top&#34;</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;${application.contextPath}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;color:#C40000;margin:0px&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34; glyphicon glyphicon-home redColor&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        天猫首页
    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>喵，欢迎来天猫<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&#34;${null!=session.user}&#34;</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;login&#34;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${session.user.name}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forelogout&#34;</span> <span class="p">&gt;</span>退出<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>


    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&#34;${null==session.user}&#34;</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;login&#34;</span><span class="p">&gt;</span>请登录<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;register&#34;</span><span class="p">&gt;</span>免费注册<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>


    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;bought&#34;</span><span class="p">&gt;</span>我的订单<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;cart&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">span</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;color:#C40000;margin:0px&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34; glyphicon glyphicon-shopping-cart redColor&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
			购物车<span class="p">&lt;</span><span class="nt">strong</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${session.cartTotalItemNumber}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>件<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>search.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;${application.contextPath}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;logo&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/logo.gif&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;logo&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;search&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;get&#34;</span> <span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;keyword&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;时尚男鞋  太阳镜 &#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span>  <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchButton&#34;</span><span class="p">&gt;</span>搜索<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchBelow&#34;</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&#34;c,status: ${application.categories_below_search}&#34;</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&#34;${status.index&gt;=5 &amp;&amp; status.index&lt;=8}&#34;</span><span class="p">&gt;</span>
					<span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;@{&#39;category?cid=&#39;+${c.id}}&#34;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${c.name}&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
					<span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&#34;${status.index!=8}&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	            <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>

            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>footer.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;footer&#34;</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;footer&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;display: block;&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;footer_ensure&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;footer_ensure&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/ensure.png&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;horizontal_line&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;footer_desc&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;footer_desc&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumn&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumnTitle&#34;</span><span class="p">&gt;</span>购物指南<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>免费注册<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>开通支付宝<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>支付宝充值<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumn&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumnTitle&#34;</span><span class="p">&gt;</span>天猫保障<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>发票保障<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>售后规则<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>缺货赔付<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumn&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumnTitle&#34;</span><span class="p">&gt;</span>支付方式<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>快捷支付<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>信用卡<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>蚂蚁花呗<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>货到付款<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumn&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumnTitle&#34;</span><span class="p">&gt;</span>商家服务<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>商家入驻<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>商家中心<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>天猫智库<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>天猫规则<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>物流服务<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>喵言喵语<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>运营服务<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumn&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumnTitle&#34;</span><span class="p">&gt;</span>手机天猫<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/ma.png&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;</span>
 
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;copyright&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;copyright&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;coptyrightMiddle&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;cateye&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cateye&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/cateye.png&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;white_link&#34;</span> <span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;padding-left:0px&#34;</span> <span class="p">&gt;</span>关于天猫<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span> 帮助中心<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>开放平台<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  诚聘英才<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>联系我们<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>网站合作<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>法律声明<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>知识产权<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  廉正举报    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;white_link&#34;</span> <span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span>  <span class="na">style</span><span class="o">=</span><span class="s">&#34;padding-left:0px&#34;</span> <span class="p">&gt;</span> 阿里巴巴集团<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span> 淘宝网<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>天猫 <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  聚划算<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>全球速卖通<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>阿里巴巴国际交易市场<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>1688<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>阿里妈妈<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  阿里旅行 去啊 <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  阿里云计算   <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  阿里通信    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  YunOS   <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  阿里旅行 去啊 <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>   万网 <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  高德  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span> 优视   <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  友盟  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  虾米  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  天天动听    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  来往  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  钉钉  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  支付宝         <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;license&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>增值电信业务经营许可证： 浙B2-20110446<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>网络文化经营许可证：浙网文[2015]0295-065号<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>互联网医疗保健信息服务 审核同意书 浙卫网审【2014】6号 <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>互联网药品信息服务资质证书编号：浙-（经营性）-2012-0005<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;copyRightYear&#34;</span><span class="p">&gt;</span>© 2003-2016 TMALL.COM 版权所有<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/copyRight1.jpg&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/copyRight2.jpg&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>homePage.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;</span><span class="n">div</span> <span class="n">th</span><span class="o">:</span><span class="n">fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
        <span class="n">function</span> <span class="nf">showProductsAsideCategorys</span><span class="o">(</span><span class="n">cid</span><span class="o">){</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.eachCategory[cid=&#34;</span><span class="o">+</span><span class="n">cid</span><span class="o">+</span><span class="s">&#34;]&#34;</span><span class="o">).</span><span class="na">css</span><span class="o">(</span><span class="s">&#34;background-color&#34;</span><span class="o">,</span><span class="s">&#34;white&#34;</span><span class="o">);</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.eachCategory[cid=&#34;</span><span class="o">+</span><span class="n">cid</span><span class="o">+</span><span class="s">&#34;] a&#34;</span><span class="o">).</span><span class="na">css</span><span class="o">(</span><span class="s">&#34;color&#34;</span><span class="o">,</span><span class="s">&#34;#87CEFA&#34;</span><span class="o">);</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.productsAsideCategorys[cid=&#34;</span><span class="o">+</span><span class="n">cid</span><span class="o">+</span><span class="s">&#34;]&#34;</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="n">function</span> <span class="nf">hideProductsAsideCategorys</span><span class="o">(</span><span class="n">cid</span><span class="o">){</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.eachCategory[cid=&#34;</span><span class="o">+</span><span class="n">cid</span><span class="o">+</span><span class="s">&#34;]&#34;</span><span class="o">).</span><span class="na">css</span><span class="o">(</span><span class="s">&#34;background-color&#34;</span><span class="o">,</span><span class="s">&#34;#e2e2e3&#34;</span><span class="o">);</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.eachCategory[cid=&#34;</span><span class="o">+</span><span class="n">cid</span><span class="o">+</span><span class="s">&#34;] a&#34;</span><span class="o">).</span><span class="na">css</span><span class="o">(</span><span class="s">&#34;color&#34;</span><span class="o">,</span><span class="s">&#34;#000&#34;</span><span class="o">);</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.productsAsideCategorys[cid=&#34;</span><span class="o">+</span><span class="n">cid</span><span class="o">+</span><span class="s">&#34;]&#34;</span><span class="o">).</span><span class="na">hide</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="n">function</span> <span class="nf">homePageRegisterListeners</span><span class="o">(){</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.eachCategory&#34;</span><span class="o">).</span><span class="na">mouseenter</span><span class="o">(</span><span class="n">function</span><span class="o">(){</span>
                <span class="n">var</span> <span class="n">cid</span> <span class="o">=</span> <span class="n">$</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">attr</span><span class="o">(</span><span class="s">&#34;cid&#34;</span><span class="o">);</span>
                <span class="n">showProductsAsideCategorys</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
            <span class="o">});</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.eachCategory&#34;</span><span class="o">).</span><span class="na">mouseleave</span><span class="o">(</span><span class="n">function</span><span class="o">(){</span>
                <span class="n">var</span> <span class="n">cid</span> <span class="o">=</span> <span class="n">$</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">attr</span><span class="o">(</span><span class="s">&#34;cid&#34;</span><span class="o">);</span>
                <span class="n">hideProductsAsideCategorys</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
            <span class="o">});</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.productsAsideCategorys&#34;</span><span class="o">).</span><span class="na">mouseenter</span><span class="o">(</span><span class="n">function</span><span class="o">(){</span>
                <span class="n">var</span> <span class="n">cid</span> <span class="o">=</span> <span class="n">$</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">attr</span><span class="o">(</span><span class="s">&#34;cid&#34;</span><span class="o">);</span>
                <span class="n">showProductsAsideCategorys</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
            <span class="o">});</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.productsAsideCategorys&#34;</span><span class="o">).</span><span class="na">mouseleave</span><span class="o">(</span><span class="n">function</span><span class="o">(){</span>
                <span class="n">var</span> <span class="n">cid</span> <span class="o">=</span> <span class="n">$</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">attr</span><span class="o">(</span><span class="s">&#34;cid&#34;</span><span class="o">);</span>
                <span class="n">hideProductsAsideCategorys</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
            <span class="o">});</span>

            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.rightMenu span&#34;</span><span class="o">).</span><span class="na">mouseenter</span><span class="o">(</span><span class="n">function</span><span class="o">(){</span>
                <span class="n">var</span> <span class="n">left</span> <span class="o">=</span> <span class="n">$</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">position</span><span class="o">().</span><span class="na">left</span><span class="o">;</span>
                <span class="n">var</span> <span class="n">top</span> <span class="o">=</span> <span class="n">$</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">position</span><span class="o">().</span><span class="na">top</span><span class="o">;</span>
                <span class="n">var</span> <span class="n">width</span> <span class="o">=</span> <span class="n">$</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">css</span><span class="o">(</span><span class="s">&#34;width&#34;</span><span class="o">);</span>
                <span class="n">var</span> <span class="n">destLeft</span> <span class="o">=</span> <span class="n">parseInt</span><span class="o">(</span><span class="n">left</span><span class="o">)</span> <span class="o">+</span> <span class="n">parseInt</span><span class="o">(</span><span class="n">width</span><span class="o">)/</span><span class="n">2</span><span class="o">;</span>
                <span class="n">$</span><span class="o">(</span><span class="s">&#34;img#catear&#34;</span><span class="o">).</span><span class="na">css</span><span class="o">(</span><span class="s">&#34;left&#34;</span><span class="o">,</span><span class="n">destLeft</span><span class="o">);</span>
                <span class="n">$</span><span class="o">(</span><span class="s">&#34;img#catear&#34;</span><span class="o">).</span><span class="na">css</span><span class="o">(</span><span class="s">&#34;top&#34;</span><span class="o">,</span><span class="n">top</span><span class="o">-</span><span class="n">20</span><span class="o">);</span>
                <span class="n">$</span><span class="o">(</span><span class="s">&#34;img#catear&#34;</span><span class="o">).</span><span class="na">fadeIn</span><span class="o">(</span><span class="n">500</span><span class="o">);</span>

            <span class="o">});</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.rightMenu span&#34;</span><span class="o">).</span><span class="na">mouseleave</span><span class="o">(</span><span class="n">function</span><span class="o">(){</span>
                <span class="n">$</span><span class="o">(</span><span class="s">&#34;img#catear&#34;</span><span class="o">).</span><span class="na">hide</span><span class="o">();</span>
            <span class="o">});</span>

            <span class="n">var</span> <span class="n">left</span> <span class="o">=</span> <span class="n">$</span><span class="o">(</span><span class="s">&#34;div#carousel-of-product&#34;</span><span class="o">).</span><span class="na">offset</span><span class="o">().</span><span class="na">left</span><span class="o">;</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.categoryMenu&#34;</span><span class="o">).</span><span class="na">css</span><span class="o">(</span><span class="s">&#34;left&#34;</span><span class="o">,</span><span class="n">left</span><span class="o">-</span><span class="n">20</span><span class="o">);</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.categoryWithCarousel div.head&#34;</span><span class="o">).</span><span class="na">css</span><span class="o">(</span><span class="s">&#34;margin-left&#34;</span><span class="o">,</span><span class="n">left</span><span class="o">);</span>
            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.productsAsideCategorys&#34;</span><span class="o">).</span><span class="na">css</span><span class="o">(</span><span class="s">&#34;left&#34;</span><span class="o">,</span><span class="n">left</span><span class="o">-</span><span class="n">20</span><span class="o">);</span>

            <span class="n">$</span><span class="o">(</span><span class="s">&#34;div.productsAsideCategorys div.row a&#34;</span><span class="o">).</span><span class="na">each</span><span class="o">(</span><span class="n">function</span><span class="o">(){</span>
                <span class="n">var</span> <span class="n">v</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">round</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span><span class="n">6</span><span class="o">);</span>
                <span class="k">if</span><span class="o">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span>
                    <span class="n">$</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">css</span><span class="o">(</span><span class="s">&#34;color&#34;</span><span class="o">,</span><span class="s">&#34;#87CEFA&#34;</span><span class="o">);</span>
            <span class="o">});</span>
        <span class="o">}</span>

        <span class="n">$</span><span class="o">(</span><span class="n">function</span><span class="o">(){</span>

            <span class="n">var</span> <span class="n">data4Vue</span> <span class="o">=</span> <span class="o">{</span>
                <span class="n">uri</span><span class="o">:</span><span class="err">&#39;</span><span class="n">forehome</span><span class="err">&#39;</span><span class="o">,</span>
                <span class="n">categories</span><span class="o">:</span> <span class="o">[]</span>
            <span class="o">};</span>
            <span class="c1">//ViewModel
</span><span class="c1"></span>            <span class="n">var</span> <span class="n">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Vue</span><span class="o">({</span>
                <span class="n">el</span><span class="o">:</span> <span class="err">&#39;#</span><span class="n">workingArea</span><span class="err">&#39;</span><span class="o">,</span>
                <span class="n">data</span><span class="o">:</span> <span class="n">data4Vue</span><span class="o">,</span>
                <span class="n">mounted</span><span class="o">:</span><span class="n">function</span><span class="o">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                    <span class="n">linkDefaultActions</span><span class="o">();</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">load</span><span class="o">();</span>
                <span class="o">},</span>
                <span class="n">methods</span><span class="o">:</span> <span class="o">{</span>
                    <span class="n">load</span><span class="o">:</span><span class="n">function</span><span class="o">(){</span>
                        <span class="n">var</span> <span class="n">url</span> <span class="o">=</span>  <span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">;</span>
                        <span class="n">axios</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">url</span><span class="o">).</span><span class="na">then</span><span class="o">(</span><span class="n">function</span><span class="o">(</span><span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">vue</span><span class="o">.</span><span class="na">categories</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">;</span>
                            <span class="n">vue</span><span class="o">.</span><span class="na">$nextTick</span><span class="o">(</span><span class="n">function</span><span class="o">(){</span>
                                <span class="c1">//要等渲染结束之后，才来进行监听，否则他们都没有被创建出来，监听也没有意义呀
</span><span class="c1"></span>                                <span class="n">homePageRegisterListeners</span><span class="o">();</span>
                            <span class="o">})</span>
                        <span class="o">});</span>
                    <span class="o">}</span>
                <span class="o">},</span>
                <span class="n">filters</span><span class="o">:{</span>
                    <span class="n">subTitleFilter</span><span class="o">:</span><span class="n">function</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(!</span><span class="n">value</span><span class="o">)</span> <span class="k">return</span> <span class="err">&#39;&#39;</span><span class="o">;</span> <span class="c1">//如果为空，则返回空字符串
</span><span class="c1"></span>                        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&#34; &#34;</span><span class="o">)[</span><span class="n">0</span><span class="o">];</span> <span class="c1">//根据空格拆分，并且只获取数组第一个值
</span><span class="c1"></span>                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">});</span>


        <span class="o">});</span>

    <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>


    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">模仿天猫官网</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;homepageDiv&#34;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">th</span><span class="o">:</span><span class="n">replace</span><span class="o">=</span><span class="s">&#34;include/fore/home/categoryAndcarousel::html&#34;</span> <span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">th</span><span class="o">:</span><span class="n">replace</span><span class="o">=</span><span class="s">&#34;include/fore/home/homepageCategoryProducts::html&#34;</span> <span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="312-注册功能">3.1.2 注册功能</h3>
<h4 id="web控制层-8">web控制层</h4>
<ul>
<li>com.qqlin.tmall.web.fore.ForeRestController.register()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 注册用户功能
</span><span class="cm">     * 添加了Shiro的加密支持
</span><span class="cm">     *
</span><span class="cm">     * @param user
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">register</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getPassword</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">exist</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="cm">/**
</span><span class="cm">         * Shiro加密支持
</span><span class="cm">         */</span>
        <span class="n">String</span> <span class="n">salt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandomNumberGenerator</span><span class="o">().</span><span class="na">nextBytes</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">times</span> <span class="o">=</span> <span class="n">2</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">algorithmName</span> <span class="o">=</span> <span class="s">&#34;md5&#34;</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">encodedPassword</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleHash</span><span class="o">(</span><span class="n">algorithmName</span><span class="o">,</span> <span class="n">password</span><span class="o">,</span> <span class="n">salt</span><span class="o">,</span> <span class="n">times</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>

        <span class="n">user</span><span class="o">.</span><span class="na">setSalt</span><span class="o">(</span><span class="n">salt</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">encodedPassword</span><span class="o">);</span>
<span class="c1">//        user.setPassword(password);
</span><span class="c1"></span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="视图templates-8">视图templates</h4>
<ul>
<li>register.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/fore/header::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/top::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/simpleSearch::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/registerPage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/footer::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>simpleSearch.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;${application.contextPath}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;simpleLogo&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;simpleLogo&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/simpleLogo.png&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;search&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;get&#34;</span> <span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;simpleSearchDiv pull-right&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;平衡车 原汁机&#34;</span>  <span class="na">name</span><span class="o">=</span><span class="s">&#34;keyword&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchButton&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>搜天猫<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchBelow&#34;</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&#34;c,status: ${application.categories_below_search}&#34;</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&#34;${status.index&gt;=7 &amp;&amp; status.index&lt;=10}&#34;</span><span class="p">&gt;</span>
					<span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;@{&#39;category?cid=&#39;+${c.id}}&#34;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${c.name}&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
					<span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&#34;${status.index!=10}&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	            <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>registerPage.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">uri</span><span class="o">:</span><span class="s1">&#39;foreregister&#39;</span><span class="p">,</span>
                <span class="nx">result</span><span class="o">:</span> <span class="p">[],</span>
                <span class="nx">user</span><span class="o">:</span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">repeatpassword</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span>
            <span class="p">};</span>
            <span class="c1">//ViewModel
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
                <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
                <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
                    <span class="nx">linkDefaultActions</span><span class="p">();</span>
                <span class="p">},</span>
                <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">register</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
                        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
                        <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;请输入用户名&#34;</span><span class="p">);</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.registerErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>
                            <span class="k">return</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;请输入密码&#34;</span><span class="p">);</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.registerErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>
                            <span class="k">return</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">repeatpassword</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;请输入重复密码&#34;</span><span class="p">);</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.registerErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>
                            <span class="k">return</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span> <span class="o">!=</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">repeatpassword</span><span class="p">){</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;重复密码不一致&#34;</span><span class="p">);</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.registerErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>
                            <span class="k">return</span><span class="p">;</span>
                        <span class="p">}</span>

                        <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
                                <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">&#34;registerSuccess&#34;</span><span class="p">;</span>
                            <span class="p">}</span>
                            <span class="k">else</span><span class="p">{</span>
                                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.registerErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">});</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">})</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerErrorMessageDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;alert alert-danger&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;alert&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;close&#34;</span> <span class="na">data-dismiss</span><span class="o">=</span><span class="s">&#34;alert&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Close&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;errorMessage&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>


        <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTable&#34;</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTip registerTableLeftTD&#34;</span><span class="p">&gt;</span>设置会员名<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableLeftTD&#34;</span><span class="p">&gt;</span>登陆名<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableRightTD&#34;</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;user.name&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;会员名一旦设置成功，无法修改&#34;</span> <span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTip registerTableLeftTD&#34;</span><span class="p">&gt;</span>设置登陆密码<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableRightTD&#34;</span><span class="p">&gt;</span>登陆时验证，保护账号信息<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableLeftTD&#34;</span><span class="p">&gt;</span>登陆密码<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableRightTD&#34;</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;user.password&#34;</span>  <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span>  <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;设置你的登陆密码&#34;</span> <span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableLeftTD&#34;</span><span class="p">&gt;</span>密码确认<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableRightTD&#34;</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;user.repeatpassword&#34;</span>   <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span>  <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;请再次输入你的密码&#34;</span> <span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerButtonTD&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;register&#34;</span><span class="p">&gt;&lt;</span><span class="nt">button</span><span class="p">&gt;</span>提   交<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>registerSuccess.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/fore/header::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/top::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>   
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/simpleSearch::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/registerSuccessPage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>   
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/footer::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>registerSuccessPage.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerSuccessDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/registerSuccess.png&#34;</span><span class="p">&gt;</span>
        恭喜注册成功
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="313--登录功能">3.1.3  登录功能</h3>
<h4 id="web控制层-9">web控制层</h4>
<ul>
<li>com.qqlin.tmall.web.fore.ForeRestController.login()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm">     * 登录模块
</span><span class="cm">     * 登录时，也需要Shiro的方式来进行校验
</span><span class="cm">     *
</span><span class="cm">     * @param userParam 用户
</span><span class="cm">     * @param session   会话
</span><span class="cm">     * @return 返回登录的结果
</span><span class="cm">     */</span>
    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">User</span> <span class="n">userParam</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">userParam</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>

        <span class="cm">/*
</span><span class="cm">        User user = userService.get(name, userParam.getPassword());
</span><span class="cm">        if (null == user) {
</span><span class="cm">            String message = &#34;账号密码错误&#34;;
</span><span class="cm">            return Result.fail(message);
</span><span class="cm">        } else {
</span><span class="cm">            session.setAttribute(&#34;user&#34;, user);
</span><span class="cm">            return Result.success();
</span><span class="cm">        }
</span><span class="cm">         */</span>

        <span class="n">Subject</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">SecurityUtils</span><span class="o">.</span><span class="na">getSubject</span><span class="o">();</span>
        <span class="n">UsernamePasswordToken</span> <span class="n">token</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UsernamePasswordToken</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">userParam</span><span class="o">.</span><span class="na">getPassword</span><span class="o">());</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">subject</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
            <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">AuthenticationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="视图templates-9">视图templates</h4>
<ul>
<li>login.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/fore/header::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/loginPage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/footer::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>loginPage.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;forelogin&#39;</span><span class="p">,</span>
                <span class="nx">result</span><span class="o">:</span> <span class="p">[],</span>
                <span class="nx">user</span><span class="o">:</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
            <span class="p">};</span>
            <span class="c1">//ViewModel
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
                <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
                <span class="nx">mounted</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="nx">linkDefaultActions</span><span class="p">();</span>
                <span class="p">},</span>
                <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">login</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;请输入用户名&#34;</span><span class="p">);</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span> <span class="s2">&#34;visible&#34;</span><span class="p">);</span>
                            <span class="k">return</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;请输入密码&#34;</span><span class="p">);</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span> <span class="s2">&#34;visible&#34;</span><span class="p">);</span>
                            <span class="k">return</span><span class="p">;</span>
                        <span class="p">}</span>

                        <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s2">&#34;home&#34;</span><span class="p">;</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span> <span class="s2">&#34;visible&#34;</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">});</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">162</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginSmallDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;left&#34;</span><span class="p">,</span> <span class="nx">left</span><span class="p">);</span>
        <span class="p">})</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>


    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;loginDiv&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;position: relative&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;simpleLogo&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&#34;${application.contextPath}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/simpleLogo.png&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;loginBackgroundImg&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginBackgroundImg&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/loginBackground.png&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;loginSmallDiv&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginSmallDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginErrorMessageDiv&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;alert alert-danger&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;close&#34;</span> <span class="na">data-dismiss</span><span class="o">=</span><span class="s">&#34;alert&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Close&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;errorMessage&#34;</span><span class="p">&gt;</span>22<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;login_acount_text&#34;</span><span class="p">&gt;</span>账户登录<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInput &#34;</span><span class="p">&gt;</span>
					<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInputIcon &#34;</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34; glyphicon glyphicon-user&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
					<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;user.name&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;手机/会员名/邮箱&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInput &#34;</span><span class="p">&gt;</span>
					<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInputIcon &#34;</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34; glyphicon glyphicon-lock&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
					<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;user.password&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;密码&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;text-danger&#34;</span><span class="p">&gt;</span>不要输入真实的天猫账号密码<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;notImplementLink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>忘记登录密码<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;register&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span><span class="p">&gt;</span>免费注册<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-top:20px&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-block redButton&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;login&#34;</span><span class="p">&gt;</span>登录<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="314--退出登录">3.1.4  退出登录</h3>
<ul>
<li>com.qqlin.tmall.web.fore.ForePageController.logout()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 退出登录
</span><span class="cm">     * 需要，通过subject.logout退出
</span><span class="cm">     *
</span><span class="cm">     * @param session
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// session.removeAttribute(&#34;user&#34;);
</span><span class="c1"></span>
        <span class="kd">final</span> <span class="n">Subject</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">SecurityUtils</span><span class="o">.</span><span class="na">getSubject</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">subject</span><span class="o">.</span><span class="na">isAuthenticated</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">subject</span><span class="o">.</span><span class="na">logout</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="315-产品的详情页">3.1.5 产品的详情页</h3>
<h4 id="entity实体类-7">entity实体类</h4>
<p>新增实体类Review，用于评论内容操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonIgnoreProperties</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;review&#34;</span><span class="o">)</span>
<span class="nd">@JsonIgnoreProperties</span><span class="o">({</span><span class="s">&#34;handler&#34;</span><span class="o">,</span> <span class="s">&#34;hibernateLazyInitializer&#34;</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Review</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;id&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;uid&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;pid&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Product</span> <span class="n">product</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createDate</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreateDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreateDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">createDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">createDate</span> <span class="o">=</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProduct</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">product</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProduct</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">product</span> <span class="o">=</span> <span class="n">product</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="repository仓库类-7">repository仓库类</h4>
<p>repository仓库，用于dao层的数据操作</p>
<ul>
<li>com.qqlin.tmall.dao.repository.ReviewDAO</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Review</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ReviewDAO</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 查找产品的评论，并以倒序排序
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     * @return 返回所有的评论
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="nf">findByProductOrderByIdDesc</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 查询产品的数量
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     * @return 返回产品的数量
</span><span class="cm">     */</span>
    <span class="kt">int</span> <span class="nf">countByProduct</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="service层-7">service层</h4>
<ul>
<li>com.qqlin.tmall.service.ReviewService</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Review</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ReviewService</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 新增评论
</span><span class="cm">     *
</span><span class="cm">     * @param review 评论的实体类
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Review</span> <span class="n">review</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 查询产品的所有评论
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     * @return 产品的所有评论
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 获得产品的数量
</span><span class="cm">     *
</span><span class="cm">     * @param product 产品
</span><span class="cm">     * @return 返回产品的数量
</span><span class="cm">     */</span>
    <span class="kt">int</span> <span class="nf">getCount</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>com.qqlin.tmall.service.impl.ReviewServiceImpl</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Review</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.repository.ReviewDAO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ReviewService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.CacheEvict</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cache.annotation.Cacheable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="nd">@CacheConfig</span><span class="o">(</span><span class="n">cacheNames</span> <span class="o">=</span> <span class="s">&#34;reviews&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReviewServiceImpl</span> <span class="kd">implements</span> <span class="n">ReviewService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ReviewDAO</span> <span class="n">reviewDAO</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">allEntries</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Review</span> <span class="n">review</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">reviewDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">review</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;reviews-pid-&#39;+ #p0.id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">reviewDAO</span><span class="o">.</span><span class="na">findByProductOrderByIdDesc</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;reviews-count-pid-&#39;+ #p0.id&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">reviewDAO</span><span class="o">.</span><span class="na">countByProduct</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="web控制层-10">web控制层</h4>
<ul>
<li>com.qqlin.tmall.web.fore.ForeRestController.product()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 产品显示的详情页面
</span><span class="cm">     *
</span><span class="cm">     * @param pid 产品的id
</span><span class="cm">     * @return 填充产品信息，并返回result.success
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/foreproduct/{pid}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">product</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;pid&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">listSingleProductImages</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">listDetailProductImages</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="n">product</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">product</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">propertyValues</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="n">productImageService</span><span class="o">.</span><span class="na">setFirstProductImage</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;product&#34;</span><span class="o">,</span> <span class="n">product</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;propertyValues&#34;</span><span class="o">,</span> <span class="n">propertyValues</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>视图templates</p>
<ul>
<li>product.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/fore/header::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/top::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/search::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/product/productPage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/modal4login::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/footer::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>productPage.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">pid</span> <span class="o">=</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="s2">&#34;pid&#34;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">uri</span><span class="o">:</span><span class="s1">&#39;foreproduct&#39;</span><span class="p">,</span>
                <span class="nx">p</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="nx">category</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
                <span class="nx">firstProductImage</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
                <span class="nx">pvs</span><span class="o">:</span><span class="p">[],</span>
                <span class="nx">reviews</span><span class="o">:</span><span class="p">[],</span>
                <span class="nx">showDetail</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
                <span class="nx">showReview</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
                <span class="nx">user</span><span class="o">:</span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span>
            <span class="p">};</span>
            <span class="c1">//ViewModel
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
                <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
                <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                    <span class="nx">linkDefaultActions</span><span class="p">();</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>
                <span class="p">},</span>
                <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">load</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
                        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="p">;</span>
                        <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">p</span><span class="o">=</span><span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">product</span><span class="p">;</span>
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">pvs</span><span class="o">=</span><span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">pvs</span><span class="p">;</span>
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">reviews</span><span class="o">=</span><span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">reviews</span><span class="p">;</span>

                            <span class="nx">vue</span><span class="p">.</span><span class="nx">category</span> <span class="o">=</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">category</span><span class="p">;</span>
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">firstProductImage</span> <span class="o">=</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">firstProductImage</span><span class="p">;</span>
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                                <span class="nx">imgAndInfoPageRegisterListeners</span><span class="p">(</span><span class="nx">vue</span><span class="p">);</span>
                            <span class="p">})</span>
                        <span class="p">});</span>

                    <span class="p">},</span>
                    <span class="nx">toggle2Detail</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">showDetail</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">showReview</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span>
                    <span class="p">},</span>
                    <span class="nx">toggle2Review</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">showDetail</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">showReview</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>


        <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>模仿天猫官网 -- {{p.name}}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categoryPictureInProductPageDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;category!=null&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categoryPictureInProductPage&#34;</span> <span class="na">:src</span><span class="o">=</span><span class="s">&#34;&#39;img/category/&#39;+category.id+&#39;.jpg&#39;&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productPageDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/product/imgAndInfo::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/product/productReview::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/product/productDetail::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>imgAndInfo.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span> 

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span> 
<span class="kd">function</span> <span class="nx">imgAndInfoPageRegisterListeners</span><span class="p">(</span><span class="nx">vue</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">stock</span> <span class="o">=</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">stock</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">keyup</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="nx">num</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">num</span><span class="p">))</span>
            <span class="nx">num</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&gt;</span><span class="nx">stock</span><span class="p">)</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="nx">stock</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.increaseNumber&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="nx">num</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&gt;</span><span class="nx">stock</span><span class="p">)</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="nx">stock</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.decreaseNumber&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="o">--</span><span class="nx">num</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>
            <span class="nx">num</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartButton&#34;</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&#34;disabled&#34;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartLink&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;forecheckLogin&#34;</span><span class="p">;</span>
        <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">code</span><span class="p">){</span>
                <span class="kd">var</span> <span class="nx">pid</span> <span class="o">=</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
                <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="s2">&#34;foreaddCart?pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;&amp;num=&#34;</span><span class="o">+</span><span class="nx">num</span><span class="p">;</span>
	            <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
		        	<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
	                <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">){</span>
	                    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartButton&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;已加入购物车&#34;</span><span class="p">);</span>
	                    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartButton&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;disabled&#34;</span><span class="p">,</span><span class="s2">&#34;disabled&#34;</span><span class="p">);</span>
	                    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartButton&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;lightgray&#34;</span><span class="p">)</span>
	                    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartButton&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;border-color&#34;</span><span class="p">,</span><span class="s2">&#34;lightgray&#34;</span><span class="p">)</span>
	                    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartButton&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;color&#34;</span><span class="p">,</span><span class="s2">&#34;black&#34;</span><span class="p">)</span>
	                <span class="p">}</span>
				<span class="p">});</span>	
            <span class="p">}</span>
            <span class="k">else</span><span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#loginModal&#34;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">);</span>                     
            <span class="p">}</span>        	
        <span class="p">});</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.buyLink&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;forecheckLogin&#34;</span><span class="p">;</span>
        <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        	<span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">code</span><span class="p">){</span>
                 <span class="kd">var</span> <span class="nx">pid</span> <span class="o">=</span> <span class="nx">vue</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
                 <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
	             <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="s2">&#34;forebuyone?pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;&amp;num=&#34;</span><span class="o">+</span><span class="nx">num</span><span class="p">;</span>
	             <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
	             	<span class="kd">var</span> <span class="nx">oiid</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
	             	<span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">&#34;buy?oiid=&#34;</span><span class="o">+</span><span class="nx">oiid</span><span class="p">;</span>	
	             <span class="p">});</span>	            		
			<span class="p">}</span>
        	<span class="k">else</span><span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#loginModal&#34;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">);</span>                     
        	<span class="p">}</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.loginSubmitButton&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="s2">&#34;forelogin&#34;</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="nx">vue</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;请输入用户名&#34;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="nx">vue</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;请输入密码&#34;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>                    
        
        <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="nx">vue</span><span class="p">.</span><span class="nx">user</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        	<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
        	<span class="k">if</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
        		<span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">&#34;product?pid=&#34;</span><span class="o">+</span><span class="nx">vue</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
        	<span class="p">}</span>
        	<span class="k">else</span><span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>	                    		
        	<span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.smallImage&#34;</span><span class="p">).</span><span class="nx">mouseenter</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">bigImageURL</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;bigImageURL&#34;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.bigImg&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="nx">bigImageURL</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.bigImg&#34;</span><span class="p">).</span><span class="nx">load</span><span class="p">(</span>
        <span class="kd">function</span><span class="p">(){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.smallImage&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                <span class="kd">var</span> <span class="nx">bigImageURL</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;bigImageURL&#34;</span><span class="p">);</span>
                <span class="nx">img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
                <span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">bigImageURL</span><span class="p">;</span>
                 
                <span class="nx">img</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.img4load&#34;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">img</span><span class="p">));</span>
                <span class="p">};</span>
            <span class="p">});</span>     
        <span class="p">}</span>
    <span class="p">);</span>
<span class="p">}</span>
 
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
	 
	<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;imgAndInfo&#34;</span><span class="p">&gt;</span>
	 
	    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;imgInimgAndInfo&#34;</span><span class="p">&gt;</span>
	        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;firstProductImage!=null&#34;</span> <span class="na">:src</span><span class="o">=</span><span class="s">&#34;&#39;img/productSingle/&#39;+firstProductImage.id+&#39;.jpg&#39;&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;bigImg&#34;</span><span class="p">&gt;</span>
	        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;smallImageDiv&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">img</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;pi in p.productSingleImages&#34;</span> <span class="na">:src</span><span class="o">=</span><span class="s">&#34;&#39;img/productSingle_small/&#39;+pi.id+&#39;.jpg&#39;&#34;</span> <span class="na">:bigImageURL</span><span class="o">=</span><span class="s">&#34;&#39;img/productSingle/&#39;+pi.id+&#39;.jpg&#39;&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;smallImage&#34;</span><span class="p">&gt;</span>
	        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;img4load hidden&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	
	
	    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;infoInimgAndInfo&#34;</span><span class="p">&gt;</span>
	         
	        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productTitle&#34;</span><span class="p">&gt;</span>
	            {{p.name}}
	        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productSubTitle&#34;</span><span class="p">&gt;</span>
	            {{p.subTitle}}
	        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	
	
	
	        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productPrice&#34;</span><span class="p">&gt;</span>
	            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;juhuasuan&#34;</span><span class="p">&gt;</span>
	                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;juhuasuanBig&#34;</span> <span class="p">&gt;</span>聚划算<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>此商品即将参加聚划算，<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;juhuasuanTime&#34;</span><span class="p">&gt;</span>1天19小时<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>后开始，<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	
	
	
	            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productPriceDiv&#34;</span><span class="p">&gt;</span>
	                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;gouwujuanDiv&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;16px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/gouwujuan.png&#34;</span><span class="p">&gt;</span>
	                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span> 全天猫实物商品通用<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                 
	                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;originalDiv&#34;</span><span class="p">&gt;</span>
	                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;originalPriceDesc&#34;</span><span class="p">&gt;</span>价格<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;originalPriceYuan&#34;</span><span class="p">&gt;</span>¥<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;originalPrice&#34;</span><span class="p">&gt;</span>
	                    	{{p.originalPrice|formatMoneyFilter}}
	                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	
	                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;promotionDiv&#34;</span><span class="p">&gt;</span>
	                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;promotionPriceDesc&#34;</span><span class="p">&gt;</span>促销价 <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;promotionPriceYuan&#34;</span><span class="p">&gt;</span>¥<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;promotionPrice&#34;</span><span class="p">&gt;</span>
							{{p.promotePrice|formatMoneyFilter}}
	                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	
	        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productSaleAndReviewNumber&#34;</span><span class="p">&gt;</span>
	            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>销量 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;redColor boldWord&#34;</span><span class="p">&gt;</span> {{ p.saleCount }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>   
	            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>累计评价 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;redColor boldWord&#34;</span><span class="p">&gt;</span> {{ p.reviewCount }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>    
	        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productNumber&#34;</span><span class="p">&gt;</span>
	            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>数量<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
	                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productNumberSettingSpan&#34;</span><span class="p">&gt;</span>
	                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productNumberSetting&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;1&#34;</span><span class="p">&gt;</span>
	                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;arrow&#34;</span><span class="p">&gt;</span>
	                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;increaseNumber&#34;</span><span class="p">&gt;</span>
	                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;updown&#34;</span><span class="p">&gt;</span>
	                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/increase.png&#34;</span><span class="p">&gt;</span>
	                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	                     
	                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;updownMiddle&#34;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;decreaseNumber&#34;</span><span class="p">&gt;</span>
	                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;updown&#34;</span><span class="p">&gt;</span>
	                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/decrease.png&#34;</span><span class="p">&gt;</span>
	                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	                     
	                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	                     
	            件<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>库存{{p.stock}}件<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;serviceCommitment&#34;</span><span class="p">&gt;</span>
	            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;serviceCommitmentDesc&#34;</span><span class="p">&gt;</span>服务承诺<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;serviceCommitmentLink&#34;</span><span class="p">&gt;</span>
	                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>正品保证<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>极速退款<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>赠运费险<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>七天无理由退换<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	            <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>    
	         
	        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;buyDiv&#34;</span><span class="p">&gt;</span>
	            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;buyLink&#34;</span> <span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;buyButton&#34;</span> <span class="p">&gt;</span>立即购买<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addCartLink&#34;</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addCartButton&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-shopping-cart&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>加入购物车<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
	        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	     
	    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	     
	<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>productDetail.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span> 
	<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDetailDiv&#34;</span> <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;showDetail&#34;</span> <span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDetailTopPart&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDetailTopPartSelectedLink selected&#34;</span><span class="p">&gt;</span>商品详情<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDetailTopReviewLink&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;toggle2Review&#34;</span><span class="p">&gt;</span>累计评价 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDetailTopReviewLinkNumber&#34;</span><span class="p">&gt;</span>{{p.reviewCount}}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
		<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

		<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productParamterPart&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productParamter&#34;</span><span class="p">&gt;</span>产品参数：<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productParamterList&#34;</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">span</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;pv in pvs&#34;</span> <span class="p">&gt;</span>{{pv.property.name}}: {{pv.value | subStringFilter(0,10)}} <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
			<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
		<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
		
		<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDetailImagesPart&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">img</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;pi in p.productDetailImages&#34;</span> <span class="na">:src</span><span class="o">=</span><span class="s">&#34;&#39;img/productDetail/&#39;+pi.id+&#39;.jpg&#39;&#34;</span><span class="p">&gt;</span>
		<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>


</code></pre></td></tr></table>
</div>
</div><ul>
<li>productReview.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span> 
	<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewDiv&#34;</span> <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;showReview&#34;</span> <span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewTopPart&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">a</span>  <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewTopPartSelectedLink&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;toggle2Detail&#34;</span><span class="p">&gt;</span>商品详情<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">a</span>  <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;selected&#34;</span><span class="p">&gt;</span>累计评价 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewTopReviewLinkNumber&#34;</span><span class="p">&gt;</span>{{p.reviewCount}}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
		<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
		
		<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewContentPart&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewItem&#34;</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;r in reviews&#34;</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewItemDesc&#34;</span><span class="p">&gt;</span>
					<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewItemContent&#34;</span><span class="p">&gt;</span>
						{{r.content }}
					<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
					<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewItemDate&#34;</span><span class="p">&gt;</span>
						{{r.createDate|formatDateFilter(&#39;YYYY-MM-DD&#39;)}}
					<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
				<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewItemUserInfo&#34;</span><span class="p">&gt;</span>
					{{r.user.anonymousName}}<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;userInfoGrayPart&#34;</span><span class="p">&gt;</span>（匿名）<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
				<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
			
				<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>			
			<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
		<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>modal4login.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal &#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;loginModal&#34;</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">&#34;-1&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;dialog&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-dialog loginDivInProductPageModalDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-content&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginDivInProductPage&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginErrorMessageDiv&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;alert alert-danger&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;close&#34;</span> <span class="na">data-dismiss</span><span class="o">=</span><span class="s">&#34;alert&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Close&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;errorMessage&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;login_acount_text&#34;</span><span class="p">&gt;</span>账户登录<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInput &#34;</span><span class="p">&gt;</span>
							<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInputIcon &#34;</span><span class="p">&gt;</span>
								<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34; glyphicon glyphicon-user&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
							<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;user.name&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;手机/会员名/邮箱&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInput &#34;</span><span class="p">&gt;</span>
							<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInputIcon &#34;</span><span class="p">&gt;</span>
								<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34; glyphicon glyphicon-lock&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
							<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;user.password&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;密码&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;text-danger&#34;</span><span class="p">&gt;</span>不要输入真实的天猫账号密码<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;notImplementLink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>忘记登录密码<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;register&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span><span class="p">&gt;</span>免费注册<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-top:20px&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-block redButton loginSubmitButton&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>登录<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="316-模态登录">3.1.6 模态登录</h4>
<p>在未登录状态，点击购买或者加入购物车就会弹出这个模态对话框</p>
<h4 id="web控制器">web控制器</h4>
<ul>
<li>com.qqlin.tmall.web.fore.ForeRestController.checkLogin()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 在产品页面点击立即购买或者加入购物车的时候，
</span><span class="cm">     * 需要判断是否登录，同样改为Shiro 方式
</span><span class="cm">     *
</span><span class="cm">     * @param session 会话
</span><span class="cm">     * @return 返回result.success或者result.fail
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/forecheckLogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">checkLogin</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
<span class="c1">//        User user = (User) session.getAttribute(&#34;user&#34;);
</span><span class="c1">//        if (null != user) {
</span><span class="c1"></span>        <span class="n">Subject</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">SecurityUtils</span><span class="o">.</span><span class="na">getSubject</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">subject</span><span class="o">.</span><span class="na">isAuthenticated</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="s">&#34;未登录&#34;</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="316-分类的详情页">3.1.6 分类的详情页</h3>
<h4 id="比较器">比较器</h4>
<p>需要5个比较器，用于分类详情页的页面排序</p>
<p>分类这个页面有排序功能，所以在讲解ForeRESTController之前，先准备5个Comparator比较器</p>
<ol>
<li>ProductAllComparator 综合比较器
把 销量x评价 高的放前面</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.comparator</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-21
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductAllComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Product</span> <span class="n">o1</span><span class="o">,</span> <span class="n">Product</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">o2</span><span class="o">.</span><span class="na">getSaleCount</span><span class="o">()</span> <span class="o">*</span> <span class="n">o2</span><span class="o">.</span><span class="na">getReviewCount</span><span class="o">()</span> <span class="o">-</span> <span class="n">o1</span><span class="o">.</span><span class="na">getSaleCount</span><span class="o">()</span> <span class="o">*</span> <span class="n">o2</span><span class="o">.</span><span class="na">getReviewCount</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>ProductReviewComparator 人气比较器
把 评价数量多的放前面</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.comparator</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-21
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductReviewComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Product</span> <span class="n">o1</span><span class="o">,</span> <span class="n">Product</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">o2</span><span class="o">.</span><span class="na">getReviewCount</span><span class="o">()</span> <span class="o">-</span> <span class="n">o1</span><span class="o">.</span><span class="na">getReviewCount</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>ProductDateComparator 新品比较器
把 创建日期晚的放前面</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.comparator</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-21
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductDateComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Product</span> <span class="n">o1</span><span class="o">,</span> <span class="n">Product</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">o2</span><span class="o">.</span><span class="na">getCreateDate</span><span class="o">().</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o1</span><span class="o">.</span><span class="na">getCreateDate</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>ProductSaleCountComparator 销量比较器
把 销量高的放前面</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.comparator</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-21
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductSaleCountComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Product</span> <span class="n">o1</span><span class="o">,</span> <span class="n">Product</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">o2</span><span class="o">.</span><span class="na">getSaleCount</span><span class="o">()</span> <span class="o">-</span> <span class="n">o1</span><span class="o">.</span><span class="na">getSaleCount</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>ProductPriceComparator 价格比较器
把 价格低的放前面</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.comparator</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-21
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductPriceComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Product</span> <span class="n">o1</span><span class="o">,</span> <span class="n">Product</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">o1</span><span class="o">.</span><span class="na">getPromotePrice</span><span class="o">()</span> <span class="o">-</span> <span class="n">o2</span><span class="o">.</span><span class="na">getPromotePrice</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="web控制层-11">web控制层</h4>
<ul>
<li>com.qqlin.tmall.web.fore.ForeRestController.category()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 分类的详情显示页
</span><span class="cm">     *
</span><span class="cm">     * @param cid  分类的id
</span><span class="cm">     * @param sort 排序
</span><span class="cm">     * @return 返回填充了产品，并排序的分类
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/forecategory/{cid}&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">category</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;cid&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">cid</span><span class="o">,</span> <span class="n">String</span> <span class="n">sort</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">category</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">category</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
        <span class="n">categoryService</span><span class="o">.</span><span class="na">removeCategoryFromProduct</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">sort</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">switch</span> <span class="o">(</span><span class="n">sort</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">category</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span> <span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">category</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span> <span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>

                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">category</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span> <span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>

                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">category</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span> <span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>

                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">category</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span> <span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">default</span><span class="o">:</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">category</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="视图templates-10">视图templates</h4>
<ul>
<li>category.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
	<span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/fore/header::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
	<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/top::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>	
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/search::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>	
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/category/categoryPage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>	
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/footer::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>	
		<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>categoryPage.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span> 
	<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
		<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
			<span class="kd">var</span> <span class="nx">cid</span> <span class="o">=</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="s2">&#34;cid&#34;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">sort</span> <span class="o">=</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="s2">&#34;sort&#34;</span><span class="p">);</span>
	        <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
	        		<span class="nx">uri</span><span class="o">:</span><span class="s1">&#39;forecategory&#39;</span><span class="p">,</span>
	        		<span class="nx">c</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
	        		<span class="nx">sort</span><span class="o">:</span><span class="s1">&#39;&#39;</span>
	        <span class="p">};</span>
	        <span class="c1">//ViewModel
</span><span class="c1"></span>	        <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
	            <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
	            <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
	            <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>	            	<span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>
	            <span class="p">},</span>        
	            <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>     	
	            	<span class="nx">load</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
	            		<span class="k">this</span><span class="p">.</span><span class="nx">sort</span> <span class="o">=</span> <span class="nx">sort</span><span class="p">;</span>
	                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="nx">cid</span><span class="o">+</span><span class="s2">&#34;?sort=&#34;</span><span class="o">+</span><span class="nx">sort</span><span class="p">;</span>
	                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
	                    	<span class="nx">vue</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
	                        <span class="nx">vue</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
	        	            	<span class="nx">linkDefaultActions</span><span class="p">();</span>
	                        <span class="p">})</span>
	                    <span class="p">});</span>
	                    
	            	<span class="p">}</span>
	            <span class="p">}</span>
	        <span class="p">});</span>       			
			
		<span class="p">})</span>
	<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
	
	<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>模仿天猫官网-{{c.name}}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>	
	<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;category&#34;</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categoryPageDiv&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">img</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;c.id!=null&#34;</span> <span class="na">:src</span><span class="o">=</span><span class="s">&#34;&#39;img/category/&#39;+c.id+&#39;.jpg&#39;&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/category/sortBar::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>	
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/category/productsByCategory::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>	
		<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>productsBycategory.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span> 
	<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categoryProducts&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;p in c.products&#34;</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;productUnit&#34;</span> <span class="na">:price</span><span class="o">=</span><span class="s">&#34;p.promotePrice&#34;</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productUnitFrame&#34;</span><span class="p">&gt;</span>
					<span class="p">&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;product?pid=&#39;+p.id&#34;</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productImage&#34;</span> <span class="na">:src</span><span class="o">=</span><span class="s">&#34;&#39;img/productSingle_middle/&#39;+p.firstProductImage.id+&#39;.jpg&#39;&#34;</span><span class="p">&gt;</span>
					<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
					<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productPrice&#34;</span><span class="p">&gt;</span>{{p.promotePrice|formatMoneyFilter}} <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
					
					<span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productLink&#34;</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;product?pid=&#39;+p.id&#34;</span><span class="p">&gt;</span>
						 {{p.name|subStringFilter(0,50)}}
					<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
					
					<span class="p">&lt;</span><span class="nt">a</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;tmallLink&#34;</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;product?pid=&#39;+p.id&#34;</span><span class="p">&gt;</span>天猫专卖<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
		
					<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;show1 productInfo&#34;</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;monthDeal &#34;</span><span class="p">&gt;</span>月成交 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDealNumber&#34;</span><span class="p">&gt;</span>{{p.saleCount}}笔<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReview&#34;</span><span class="p">&gt;</span>评价<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewNumber&#34;</span><span class="p">&gt;</span>{{p.reviewCount}}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;wangwang&#34;</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;wangwanglink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>
							<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/wangwang.png&#34;</span><span class="p">&gt;</span>
						<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
						
						<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
					<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
				<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
			<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
	<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>sortBar.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span> 
	<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
		<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;input.sortBarPrice&#34;</span><span class="p">).</span><span class="nx">keyup</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				<span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
					<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productUnit&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
					<span class="k">return</span><span class="p">;</span>
				<span class="p">}</span>
					
				<span class="nx">num</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
				<span class="k">if</span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">num</span><span class="p">))</span>
					<span class="nx">num</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>
					<span class="nx">num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>		
				
				
				<span class="kd">var</span> <span class="nx">begin</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;input.beginPrice&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">end</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;input.endPrice&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">begin</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">end</span><span class="p">)){</span>
					<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productUnit&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
					<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productUnit&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
						<span class="kd">var</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;price&#34;</span><span class="p">);</span>
						<span class="nx">price</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">price</span><span class="p">);</span>
						
						<span class="k">if</span><span class="p">(</span><span class="nx">price</span><span class="o">&lt;=</span><span class="nx">end</span> <span class="o">&amp;&amp;</span> <span class="nx">price</span><span class="o">&gt;=</span><span class="nx">begin</span><span class="p">)</span>
							<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
					<span class="p">});</span>
				<span class="p">}</span>
				
			<span class="p">});</span>
		<span class="p">});</span>
	<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>	
	<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categorySortBar&#34;</span><span class="p">&gt;</span>
	
	
		<span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categorySortBarTable categorySortTable&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">td</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{&#39;grayColumn&#39;:(sort==null||sort==&#39;all&#39;)}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;?cid=&#39;+c.id+&#39;&amp;sort=all&#39;&#34;</span><span class="p">&gt;</span>综合<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-arrow-down&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">td</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{&#39;grayColumn&#39;:(sort==null||sort==&#39;review&#39;)}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;?cid=&#39;+c.id+&#39;&amp;sort=review&#39;&#34;</span><span class="p">&gt;</span>人气<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-arrow-down&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">td</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{&#39;grayColumn&#39;:(sort==null||sort==&#39;date&#39;)}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;?cid=&#39;+c.id+&#39;&amp;sort=date&#39;&#34;</span><span class="p">&gt;</span>新品<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-arrow-down&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">td</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{&#39;grayColumn&#39;:(sort==null||sort==&#39;saleCount&#39;)}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;?cid=&#39;+c.id+&#39;&amp;sort=saleCount&#39;&#34;</span><span class="p">&gt;</span>销量<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-arrow-down&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">td</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{&#39;grayColumn&#39;:(sort==null||sort==&#39;price&#39;)}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;?cid=&#39;+c.id+&#39;&amp;sort=price&#39;&#34;</span><span class="p">&gt;</span>价格<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-resize-vertical&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
			<span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
		<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
		
		
		
		<span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categorySortBarTable&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;sortBarPrice beginPrice&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;请输入&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;grayColumn priceMiddleColumn&#34;</span><span class="p">&gt;</span>-<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;sortBarPrice endPrice&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;请输入&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
			<span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
		<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
	
	<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="317--搜索页面">3.1.7  搜索页面</h3>
<p>实体类product，添加了一行注解 <code>@Document(indexName = &quot;tmall_springboot&quot;, type= &quot;product&quot;)</code></p>
<p>然后在dao，新增elasticsearch，用于存放elasticsearch的仓库类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.dao.elasticsearch</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.elasticsearch.repository.ElasticsearchRepository</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 用于链接 ElasticSearch 的DAO
</span><span class="cm"> *
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-2
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductElasticSearchDAO</span> <span class="kd">extends</span> <span class="n">ElasticsearchRepository</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>再然后到了service，ProductSeviceImpl</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">	<span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initDatabase2ES</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">5</span><span class="o">);</span>
        <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">productElasticSearchDAO</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getContent</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span> <span class="n">productDAO</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
            <span class="n">productElasticSearchDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">products</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">search</span><span class="o">(</span><span class="n">String</span> <span class="n">keyword</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">initDatabase2ES</span><span class="o">();</span>
        <span class="n">FunctionScoreQueryBuilder</span> <span class="n">functionScoreQueryBuilder</span> <span class="o">=</span> <span class="n">QueryBuilders</span><span class="o">.</span><span class="na">functionScoreQuery</span><span class="o">()</span>
                <span class="c1">// 关键字查询
</span><span class="c1"></span>                <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">QueryBuilders</span><span class="o">.</span><span class="na">matchPhrasePrefixQuery</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="n">keyword</span><span class="o">),</span>
                        <span class="n">ScoreFunctionBuilders</span><span class="o">.</span><span class="na">weightFactorFunction</span><span class="o">(</span><span class="n">100</span><span class="o">))</span>
                <span class="c1">// 设置权重分 求和模式
</span><span class="c1"></span>                <span class="o">.</span><span class="na">scoreMode</span><span class="o">(</span><span class="s">&#34;sum&#34;</span><span class="o">)</span>
                <span class="c1">// 设置权重分最低分
</span><span class="c1"></span>                <span class="o">.</span><span class="na">setMinScore</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>
        <span class="c1">// 设置分页
</span><span class="c1"></span>        <span class="n">Sort</span> <span class="n">sort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sort</span><span class="o">(</span><span class="n">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">sort</span><span class="o">);</span>
        <span class="n">SearchQuery</span> <span class="n">searchQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withPageable</span><span class="o">(</span><span class="n">pageable</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withQuery</span><span class="o">(</span><span class="n">functionScoreQueryBuilder</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

        <span class="n">Page</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">productElasticSearchDAO</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">searchQuery</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">page</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>视图templates</p>
<ul>
<li>search.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/fore/header::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/top::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>   
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/simpleSearch::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/searchPage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/footer::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>searchPage.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">keyword</span> <span class="o">=</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="s2">&#34;keyword&#34;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="nx">uri</span><span class="o">:</span><span class="s1">&#39;foresearch&#39;</span><span class="p">,</span>
                    <span class="nx">products</span><span class="o">:</span><span class="p">[]</span>
            <span class="p">};</span>
            <span class="c1">//ViewModel
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
                <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
                <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                    <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>
                <span class="p">},</span>       
                <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">load</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
                        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;?keyword=&#34;</span><span class="o">+</span><span class="nx">keyword</span><span class="p">;</span>
                        <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">products</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                                <span class="nx">linkDefaultActions</span><span class="p">();</span>
                            <span class="p">})</span>
                        <span class="p">});</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>                
        <span class="p">})</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;searchResult&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchResultDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/productsBySearch::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="32-前台管理-需要登录">3.2 前台管理-需要登录</h2>
<h3 id="311--立即购买">3.1.1  立即购买</h3>
<p>通过在产品页点击立即购买步骤访问的地址 /forebuyone 导致ForeRESTController.buyone()方法被调用，然后调用 buyoneAndAddCart 方法。</p>
<ol>
<li>获取参数pid</li>
<li>获取参数num</li>
<li>根据pid获取产品对象p</li>
<li>从session中获取用户对象user</li>
</ol>
<p>接下来就是新增订单项OrderItem， 新增订单项要考虑两个情况
a. 如果已经存在这个产品对应的OrderItem，并且还没有生成订单，即还在购物车中。 那么就应该在对应的OrderItem基础上，调整数量
a.1 基于用户对象user，查询没有生成订单的订单项集合
a.2 遍历这个集合
a.3 如果产品是一样的话，就进行数量追加
a.4 获取这个订单项的 id</p>
<p>b. 如果不存在对应的OrderItem,那么就新增一个订单项OrderItem
b.1 生成新的订单项
b.2 设置数量，用户和产品
b.3 插入到数据库
b.4 获取这个订单项的 id</p>
<p>5.返回当前订单项id
6. 在页面上，拿到这个订单项id，就跳转到 location.href=&quot;buy?oiid=&quot;+oiid;
buy 是结算页面，现在还没有做，在下一个知识点就会做了。</p>
<p>因为增加到购物车的逻辑和这个是一样的，所以都重构到 buyoneAndAddCart 方法里了，方便后续增加购物车行为。</p>
<ul>
<li>com.qqlin.tmall.web.fore.ForeRestController.buyOne()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 立即购买
</span><span class="cm">     *
</span><span class="cm">     * @param pid 产品id
</span><span class="cm">     * @param num 购买的数量
</span><span class="cm">     * @param session 会话
</span><span class="cm">     * @return 返回已购买或者添加到购物车
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">buyOne</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">buyOneAndAddCart</span><span class="o">(</span><span class="n">pid</span><span class="o">,</span> <span class="n">num</span><span class="o">,</span> <span class="n">session</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">buyOneAndAddCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">orderItemId</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>

        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">orderItem</span> <span class="o">:</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">orderItem</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="n">product</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">orderItem</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">orderItem</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()</span> <span class="o">+</span> <span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">orderItem</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">orderItemId</span> <span class="o">=</span> <span class="n">orderItem</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">found</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">OrderItem</span> <span class="n">orderItem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">orderItem</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
            <span class="n">orderItem</span><span class="o">.</span><span class="na">setProduct</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
            <span class="n">orderItem</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">orderItem</span><span class="o">);</span>
            <span class="n">orderItemId</span> <span class="o">=</span> <span class="n">orderItem</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">orderItemId</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="312--结算页面">3.1.2  结算页面</h3>
<p>视图templates</p>
<ul>
<li>buy.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/fore/header::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/top::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>   
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/search::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/cart/buyPage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/footer::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>buyPage.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">oiid</span> <span class="o">=</span> <span class="nx">getUrlParms</span><span class="p">(</span><span class="s2">&#34;oiid&#34;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="nx">uri</span><span class="o">:</span><span class="s1">&#39;forebuy&#39;</span><span class="p">,</span>
                    <span class="nx">total</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="nx">orderItems</span><span class="o">:</span><span class="p">[],</span>
                    <span class="nx">order</span><span class="o">:</span><span class="p">{</span><span class="nx">address</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nx">post</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nx">receiver</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nx">mobile</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nx">userMessage</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span>
            <span class="p">};</span>
            <span class="c1">//ViewModel
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
                <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
                <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>                    <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>
                <span class="p">},</span>       
                <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>     
                    <span class="nx">load</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
                        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="o">+</span><span class="s2">&#34;/?oiid=&#34;</span><span class="o">+</span><span class="nx">oiid</span><span class="p">;</span>
                        <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">total</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span>
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">orderItems</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">orderItems</span><span class="p">;</span>
                             
                            <span class="nx">vue</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                                <span class="nx">linkDefaultActions</span><span class="p">();</span>
                            <span class="p">})</span>
                        <span class="p">});</span>
                    <span class="p">},</span>
                    <span class="nx">submitOrder</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
                        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="s2">&#34;forecreateOrder&#34;</span><span class="p">;</span>
                        <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">order</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                            <span class="kd">var</span> <span class="nx">oid</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">oid</span><span class="p">;</span>
                            <span class="kd">var</span> <span class="nx">total</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span>
                            <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">&#34;alipay?oid=&#34;</span><span class="o">+</span><span class="nx">oid</span><span class="o">+</span><span class="s2">&#34;&amp;total=&#34;</span><span class="o">+</span><span class="nx">total</span><span class="p">;</span>
                        <span class="p">});</span>                    
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>                
             
        <span class="p">})</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;buyPageDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;buyFlow&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-left&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/simpleLogo.png&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/buyflow.png&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;address&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addressTip&#34;</span><span class="p">&gt;</span>输入收货地址<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
             
                <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addressTable&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;firstColumn&#34;</span><span class="p">&gt;</span>详细地址<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;redStar&#34;</span><span class="p">&gt;</span>*<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                         
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;address&#34;</span> <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;order.address&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;建议您如实填写详细收货地址，例如接到名称，门牌好吗，楼层和房间号等信息&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>邮政编码<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="na">name</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;order.post&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;如果您不清楚邮递区号，请填写000000&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>收货人姓名<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;redStar&#34;</span><span class="p">&gt;</span>*<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="na">name</span><span class="o">=</span><span class="s">&#34;receiver&#34;</span>  <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;order.receiver&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;长度不超过25个字符&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>手机号码 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;redStar&#34;</span><span class="p">&gt;</span>*<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;mobile&#34;</span>  <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;order.mobile&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;请输入11位手机号码&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productList&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productListTip&#34;</span><span class="p">&gt;</span>确认订单信息<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
             
            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productListTable&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">th</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productListTableFirstColumn&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;tmallbuy&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/tmallbuy.png&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;marketLink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>店铺：天猫店铺<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;wangwanglink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;wangwangGif&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>单价<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>数量<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>小计<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>配送方式<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;rowborder&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span>  <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tbody</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productListTableTbody&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemTR&#34;</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;oi,index in orderItems&#34;</span> <span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemFirstTD&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemImg&#34;</span>  <span class="na">:src</span><span class="o">=</span><span class="s">&#34;&#39;img/productSingle_middle/&#39;+oi.product.firstProductImage.id+&#39;.jpg&#39;&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemProductInfo&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span>  <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;product?pid=&#39;+oi.product.id&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemProductLink&#34;</span><span class="p">&gt;</span>
                                    {{oi.product.name}}
                                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/creditcard.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;支持信用卡支付&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/7day.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;消费者保障服务,承诺7天退货&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/promise.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;消费者保障服务,承诺如实描述&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemProductPrice&#34;</span><span class="p">&gt;</span>
                                    {{oi.product.promotePrice | formatMoneyFilter}}
                                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemProductNumber&#34;</span><span class="p">&gt;</span>{{oi.number}}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemUnitSum&#34;</span><span class="p">&gt;</span>
                                    {{oi.product.promotePrice*oi.number | formatMoneyFilter}}
                                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">rowspan</span><span class="o">=</span><span class="s">&#34;5&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemLastTD&#34;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;index==0&#34;</span> <span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemDeliveryLabel&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;radio&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="na">checked</span><span class="o">=</span><span class="s">&#34;checked&#34;</span><span class="p">&gt;</span>
                                    普通配送
                                <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">select</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemDeliverySelect&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">option</span><span class="p">&gt;</span>快递 免邮费<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemSumDiv&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-left&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;leaveMessageText&#34;</span><span class="p">&gt;</span>给卖家留言:<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;leaveMessageImg&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/leaveMessage.png&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;leaveMessageTextareaSpan&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;userMessage&#34;</span> <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;order.userMessage&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;leaveMessageTextarea&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>还可以输入200个字符<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span><span class="p">&gt;</span>店铺合计(含运费): ￥
                    {{total|formatMoneyFilter}}
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
         
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemTotalSumDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>实付款：<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemTotalSumSpan&#34;</span><span class="p">&gt;</span>{{total|formatMoneyFilter}}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitOrderDiv&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitOrderButton&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;submitOrder&#34;</span><span class="p">&gt;</span>提交订单<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>com.qqlin.tmall.web.fore.ForeRestController.buy()</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 结算页面
</span><span class="cm">     *
</span><span class="cm">     * @param oiid    订单项的id
</span><span class="cm">     * @param session 会话
</span><span class="cm">     * @return 返回result.success
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">buy</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">orderItem</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">orderItem</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()</span> <span class="o">*</span> <span class="n">orderItem</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">orderItems</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">orderItem</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">productImageService</span><span class="o">.</span><span class="na">setFirstProductImagesOnOrderItems</span><span class="o">(</span><span class="n">orderItems</span><span class="o">);</span>

        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">orderItems</span><span class="o">);</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;orderItems&#34;</span><span class="o">,</span> <span class="n">orderItems</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="313-加入购物车">3.1.3 加入购物车</h3>
<ul>
<li>com.qqlin.tmall.web.fore.ForeRestController#addCart</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm">     * 加入购物车
</span><span class="cm">     *
</span><span class="cm">     * @param pid     产品的id
</span><span class="cm">     * @param num     产品的数量
</span><span class="cm">     * @param session 会话
</span><span class="cm">     * @return 返回添加成功
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">buyOneAndAddCart</span><span class="o">(</span><span class="n">pid</span><span class="o">,</span> <span class="n">num</span><span class="o">,</span> <span class="n">session</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="314--查看购物车页面">3.1.4  查看购物车页面</h3>
<p>视图templates</p>
<ul>
<li>cart.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span> <span class="na">th:include</span><span class="o">=</span><span class="s">&#34;include/fore/header::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/top::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>   
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/simpleSearch::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/cart/cartPage::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span> 
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/modal4deleteConfirm::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&#34;include/fore/footer::html&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>cartPage.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span><span class="p">&gt;</span> 
	<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
		<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
	        <span class="kd">var</span> <span class="nx">data4Vue</span> <span class="o">=</span> <span class="p">{</span>
	        		<span class="nx">uri</span><span class="o">:</span><span class="s1">&#39;forecart&#39;</span><span class="p">,</span>
	        		<span class="nx">orderItems</span><span class="o">:</span><span class="p">[]</span>
	        <span class="p">};</span>
	        <span class="c1">//ViewModel
</span><span class="c1"></span>	        <span class="kd">var</span> <span class="nx">vue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
	            <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#workingArea&#39;</span><span class="p">,</span>
	            <span class="nx">data</span><span class="o">:</span> <span class="nx">data4Vue</span><span class="p">,</span>
	            <span class="nx">mounted</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span> <span class="c1">//mounted　表示这个 Vue 对象加载成功了
</span><span class="c1"></span>	            	<span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>
	            <span class="p">},</span>        
	            <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>     	
	            	<span class="nx">load</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
	                    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span>  <span class="k">this</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
	                    <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
	                    	<span class="nx">vue</span><span class="p">.</span><span class="nx">orderItems</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
	                        <span class="nx">vue</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
	        	            	<span class="nx">linkDefaultActions</span><span class="p">();</span>
	        	            	<span class="nx">cartPageRegisterListeners</span><span class="p">();</span>
	                        <span class="p">})</span>
	                    <span class="p">});</span>
	            	<span class="p">}</span>
	            <span class="p">}</span>
	        <span class="p">});</span>       			
			
		<span class="p">})</span>	
	
	
		<span class="kd">var</span> <span class="nx">deleteOrderItem</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">deleteOrderItemid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="kd">function</span> <span class="nx">cartPageRegisterListeners</span><span class="p">(){</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;a.deleteOrderItem&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				<span class="nx">deleteOrderItem</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
				<span class="kd">var</span> <span class="nx">oiid</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;oiid&#34;</span><span class="p">)</span>
				<span class="nx">deleteOrderItemid</span> <span class="o">=</span> <span class="nx">oiid</span><span class="p">;</span>
				<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#deleteConfirmModal&#34;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">);</span>	   
			<span class="p">});</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.deleteConfirmButton&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				<span class="nx">deleteOrderItem</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
				<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#deleteConfirmModal&#34;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s1">&#39;hide&#39;</span><span class="p">);</span>
			<span class="p">});</span>
			
			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#deleteConfirmModal&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;hidden.bs.modal&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">deleteOrderItem</span><span class="p">){</span>
					
					<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;foredeleteOrderItem?oiid=&#34;</span><span class="o">+</span><span class="nx">deleteOrderItemid</span><span class="p">;</span>
		            <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
						<span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">code</span><span class="p">){</span>
							<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;tr.cartProductItemTR[oiid=&#34;</span><span class="o">+</span><span class="nx">deleteOrderItemid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
						<span class="p">}</span>
						<span class="k">else</span><span class="p">{</span>
							<span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">&#34;login&#34;</span><span class="p">;</span>
						<span class="p">}</span>
		            <span class="p">});</span>
				<span class="p">}</span>
			<span class="p">})</span>	
			
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.cartProductItemIfSelected&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				<span class="kd">var</span> <span class="nx">selectit</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">)</span>
				<span class="k">if</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="o">==</span><span class="nx">selectit</span><span class="p">){</span>
					<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">);</span>
					<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">,</span><span class="s2">&#34;false&#34;</span><span class="p">)</span>
					<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s2">&#34;tr.cartProductItemTR&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#fff&#34;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">else</span><span class="p">{</span>
					<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartSelected.png&#34;</span><span class="p">);</span>
					<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">,</span><span class="s2">&#34;selectit&#34;</span><span class="p">)</span>
					<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s2">&#34;tr.cartProductItemTR&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#FFF8E1&#34;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="nx">syncSelect</span><span class="p">();</span>
				<span class="nx">syncCreateOrderButton</span><span class="p">();</span>
				<span class="nx">calcCartSumPriceAndNumber</span><span class="p">();</span>
			<span class="p">});</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				<span class="kd">var</span> <span class="nx">selectit</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">)</span>
				<span class="k">if</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="o">==</span><span class="nx">selectit</span><span class="p">){</span>
					<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">);</span>
					<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">,</span><span class="s2">&#34;false&#34;</span><span class="p">)</span>
					<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemIfSelected&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
						<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">);</span>
						<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">,</span><span class="s2">&#34;false&#34;</span><span class="p">);</span>
						<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s2">&#34;tr.cartProductItemTR&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#fff&#34;</span><span class="p">);</span>
					<span class="p">});</span>			
				<span class="p">}</span>
				<span class="k">else</span><span class="p">{</span>
					<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartSelected.png&#34;</span><span class="p">);</span>
					<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">,</span><span class="s2">&#34;selectit&#34;</span><span class="p">)</span>
					<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemIfSelected&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
						<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartSelected.png&#34;</span><span class="p">);</span>
						<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">,</span><span class="s2">&#34;selectit&#34;</span><span class="p">);</span>
						<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s2">&#34;tr.cartProductItemTR&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#FFF8E1&#34;</span><span class="p">);</span>
					<span class="p">});</span>				
				<span class="p">}</span>
				<span class="nx">syncCreateOrderButton</span><span class="p">();</span>
				<span class="nx">calcCartSumPriceAndNumber</span><span class="p">();</span>
				
		
			<span class="p">});</span>
			
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.orderItemNumberSetting&#34;</span><span class="p">).</span><span class="nx">keyup</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				<span class="kd">var</span> <span class="nx">pid</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;pid&#34;</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">stock</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.orderItemStock[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">price</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.orderItemPromotePrice[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
				
				<span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.orderItemNumberSetting[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
				<span class="nx">num</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
				<span class="k">if</span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">num</span><span class="p">))</span>
					<span class="nx">num</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>
					<span class="nx">num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&gt;</span><span class="nx">stock</span><span class="p">)</span>
					<span class="nx">num</span> <span class="o">=</span> <span class="nx">stock</span><span class="p">;</span>
				
				<span class="nx">syncPrice</span><span class="p">(</span><span class="nx">pid</span><span class="p">,</span><span class="nx">num</span><span class="p">,</span><span class="nx">price</span><span class="p">);</span>
			<span class="p">});</span>
		
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.numberPlus&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				
				<span class="kd">var</span> <span class="nx">pid</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;pid&#34;</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">stock</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.orderItemStock[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">price</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.orderItemPromotePrice[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.orderItemNumberSetting[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
		
				<span class="nx">num</span><span class="o">++</span><span class="p">;</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&gt;</span><span class="nx">stock</span><span class="p">)</span>
					<span class="nx">num</span> <span class="o">=</span> <span class="nx">stock</span><span class="p">;</span>
				<span class="nx">syncPrice</span><span class="p">(</span><span class="nx">pid</span><span class="p">,</span><span class="nx">num</span><span class="p">,</span><span class="nx">price</span><span class="p">);</span>
			<span class="p">});</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.numberMinus&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				<span class="kd">var</span> <span class="nx">pid</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;pid&#34;</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">stock</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.orderItemStock[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">price</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.orderItemPromotePrice[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
				
				<span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.orderItemNumberSetting[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
				<span class="o">--</span><span class="nx">num</span><span class="p">;</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>
					<span class="nx">num</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
				<span class="nx">syncPrice</span><span class="p">(</span><span class="nx">pid</span><span class="p">,</span><span class="nx">num</span><span class="p">,</span><span class="nx">price</span><span class="p">);</span>
			<span class="p">});</span>	
			
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.createOrderButton&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				<span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
				<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemIfSelected&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
					<span class="k">if</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="o">==</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">)){</span>
						<span class="kd">var</span> <span class="nx">oiid</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;oiid&#34;</span><span class="p">);</span>
						<span class="nx">params</span> <span class="o">+=</span> <span class="s2">&#34;&amp;oiid=&#34;</span><span class="o">+</span><span class="nx">oiid</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">});</span>
				<span class="nx">params</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
				<span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">&#34;buy?&#34;</span><span class="o">+</span><span class="nx">params</span><span class="p">;</span>
			<span class="p">});</span>
		<span class="p">}</span>
	
		<span class="kd">function</span> <span class="nx">syncCreateOrderButton</span><span class="p">(){</span>
			<span class="kd">var</span> <span class="nx">selectAny</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemIfSelected&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				<span class="k">if</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="o">==</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">)){</span>
					<span class="nx">selectAny</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">});</span>
			
			<span class="k">if</span><span class="p">(</span><span class="nx">selectAny</span><span class="p">){</span>
				<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.createOrderButton&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#C40000&#34;</span><span class="p">);</span>
				<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.createOrderButton&#34;</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&#34;disabled&#34;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span><span class="p">{</span>
				<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.createOrderButton&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#AAAAAA&#34;</span><span class="p">);</span>
				<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.createOrderButton&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;disabled&#34;</span><span class="p">,</span><span class="s2">&#34;disabled&#34;</span><span class="p">);</span>		
			<span class="p">}</span>
				
		<span class="p">}</span>
		<span class="kd">function</span> <span class="nx">syncSelect</span><span class="p">(){</span>
			<span class="kd">var</span> <span class="nx">selectAll</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemIfSelected&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				<span class="k">if</span><span class="p">(</span><span class="s2">&#34;false&#34;</span><span class="o">==</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">)){</span>
					<span class="nx">selectAll</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">});</span>
			
			<span class="k">if</span><span class="p">(</span><span class="nx">selectAll</span><span class="p">)</span>
				<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartSelected.png&#34;</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">);</span>
			
			
			
		<span class="p">}</span>
		<span class="kd">function</span> <span class="nx">calcCartSumPriceAndNumber</span><span class="p">(){</span>
			<span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">totalNumber</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.cartProductItemIfSelected[selectit=&#39;selectit&#39;]&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
				<span class="kd">var</span> <span class="nx">oiid</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;oiid&#34;</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">price</span> <span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemSmallSumPrice[oiid=&#34;</span><span class="o">+</span><span class="nx">oiid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
				<span class="nx">price</span> <span class="o">=</span> <span class="nx">price</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,/g</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">);</span>
				<span class="nx">price</span> <span class="o">=</span> <span class="nx">price</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/￥/g</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">);</span>
				<span class="nx">sum</span> <span class="o">+=</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">price</span><span class="p">);</span>	
				
				<span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.orderItemNumberSetting[oiid=&#34;</span><span class="o">+</span><span class="nx">oiid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
				<span class="nx">totalNumber</span> <span class="o">+=</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>	
				
			<span class="p">});</span>
			
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.cartSumPrice&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;￥&#34;</span><span class="o">+</span><span class="nx">formatMoney</span><span class="p">(</span><span class="nx">sum</span><span class="p">));</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.cartTitlePrice&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;￥&#34;</span><span class="o">+</span><span class="nx">formatMoney</span><span class="p">(</span><span class="nx">sum</span><span class="p">));</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.cartSumNumber&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">totalNumber</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="kd">function</span> <span class="nx">syncPrice</span><span class="p">(</span><span class="nx">pid</span><span class="p">,</span><span class="nx">num</span><span class="p">,</span><span class="nx">price</span><span class="p">){</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.orderItemNumberSetting[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">cartProductItemSmallSumPrice</span> <span class="o">=</span> <span class="nx">formatMoney</span><span class="p">(</span><span class="nx">num</span><span class="o">*</span><span class="nx">price</span><span class="p">);</span> 
			<span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemSmallSumPrice[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;￥&#34;</span><span class="o">+</span><span class="nx">cartProductItemSmallSumPrice</span><span class="p">);</span>
			<span class="nx">calcCartSumPriceAndNumber</span><span class="p">();</span>
			
			<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;forechangeOrderItem?pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;&amp;num=&#34;</span><span class="o">+</span><span class="nx">num</span><span class="p">;</span>
            <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
				<span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">!=</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">code</span><span class="p">){</span>
					<span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">&#34;login&#34;</span><span class="p">;</span>
				<span class="p">}</span>            	
            <span class="p">});</span>
		<span class="p">}</span>
	<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>	
	
	<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>购物车<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
	<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartDiv&#34;</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartTitle pull-right&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>已选商品  (不含运费)<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartTitlePrice&#34;</span><span class="p">&gt;</span>￥0.00<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;createOrderButton&#34;</span> <span class="na">disabled</span><span class="o">=</span><span class="s">&#34;disabled&#34;</span><span class="p">&gt;</span>结 算<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
		<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
		
		
		<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductList&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductTable&#34;</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
					<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">th</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;selectAndImage&#34;</span><span class="p">&gt;</span>
								<span class="p">&lt;</span><span class="nt">img</span> <span class="na">selectit</span><span class="o">=</span><span class="s">&#34;false&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;selectAllItem&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">&gt;</span>				
						全选
						
						<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>商品信息<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>单价<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>数量<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">th</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;120px&#34;</span><span class="p">&gt;</span>金额<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">th</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;operation&#34;</span><span class="p">&gt;</span>操作<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
					<span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
				<span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
						<span class="p">&lt;</span><span class="nt">tr</span> <span class="na">:oiid</span><span class="o">=</span><span class="s">&#34;oi.id&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductItemTR&#34;</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;oi in orderItems&#34;</span><span class="p">&gt;</span>
							<span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
								<span class="p">&lt;</span><span class="nt">img</span> <span class="na">selectit</span><span class="o">=</span><span class="s">&#34;false&#34;</span> <span class="na">:oiid</span><span class="o">=</span><span class="s">&#34;oi.id&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductItemIfSelected&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">&gt;</span>
								<span class="p">&lt;</span><span class="nt">a</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;display:none&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/cartSelected.png&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
								<span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductImg&#34;</span>  <span class="na">:src</span><span class="o">=</span><span class="s">&#34;&#39;img/productSingle_middle/&#39;+oi.product.firstProductImage.id+&#39;.jpg&#39;&#34;</span><span class="p">&gt;</span>
							<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
							<span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
								<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductLinkOutDiv&#34;</span><span class="p">&gt;</span>
									<span class="p">&lt;</span><span class="nt">a</span> <span class="na">:href</span><span class="o">=</span><span class="s">&#34;&#39;product?pid=&#39;+oi.product.id&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductLink&#34;</span><span class="p">&gt;</span>{{oi.product.name}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
									<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductLinkInnerDiv&#34;</span><span class="p">&gt;</span>
										<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/creditcard.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;支持信用卡支付&#34;</span><span class="p">&gt;</span>
										<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/7day.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;消费者保障服务,承诺7天退货&#34;</span><span class="p">&gt;</span>
										<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/promise.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;消费者保障服务,承诺如实描述&#34;</span><span class="p">&gt;</span>
									<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
								<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
								
							<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
							<span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
								<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductItemOringalPrice&#34;</span><span class="p">&gt;</span>￥{{oi.product.originalPrice|formatMoneyFilter}}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
								<span class="p">&lt;</span><span class="nt">span</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductItemPromotionPrice&#34;</span><span class="p">&gt;</span>￥{{oi.product.promotePrice|formatMoneyFilter}}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
								
							<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
							<span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
							
								<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductChangeNumberDiv&#34;</span><span class="p">&gt;</span>
									<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;hidden orderItemStock &#34;</span> <span class="na">:pid</span><span class="o">=</span><span class="s">&#34;oi.product.id&#34;</span><span class="p">&gt;</span>{{oi.product.stock}}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
									<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;hidden orderItemPromotePrice &#34;</span> <span class="na">:pid</span><span class="o">=</span><span class="s">&#34;oi.product.id&#34;</span><span class="p">&gt;</span>{{oi.product.promotePrice}}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
									<span class="p">&lt;</span><span class="nt">a</span>  <span class="na">:pid</span><span class="o">=</span><span class="s">&#34;oi.product.id&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;numberMinus&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>-<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
									<span class="p">&lt;</span><span class="nt">input</span> <span class="na">:pid</span><span class="o">=</span><span class="s">&#34;oi.product.id&#34;</span> <span class="na">:oiid</span><span class="o">=</span><span class="s">&#34;oi.id&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemNumberSetting&#34;</span> <span class="na">autocomplete</span><span class="o">=</span><span class="s">&#34;off&#34;</span> <span class="na">:value</span><span class="o">=</span><span class="s">&#34;oi.number&#34;</span><span class="p">&gt;</span>
									<span class="p">&lt;</span><span class="nt">a</span>  <span class="na">:stock</span><span class="o">=</span><span class="s">&#34;oi.product.stock&#34;</span> <span class="na">:pid</span><span class="o">=</span><span class="s">&#34;oi.product.id&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;numberPlus&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>+<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
								<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>					
							
							 <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
							<span class="p">&lt;</span><span class="nt">td</span> <span class="p">&gt;</span>
								<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductItemSmallSumPrice&#34;</span> <span class="na">:oiid</span><span class="o">=</span><span class="s">&#34;oi.id&#34;</span> <span class="na">:pid</span><span class="o">=</span><span class="s">&#34;oi.product.id&#34;</span> <span class="p">&gt;</span>
									￥ {{oi.product.promotePrice*oi.number|formatMoneyFilter}} 
								<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
							
							<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
							<span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
								<span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;deleteOrderItem&#34;</span> <span class="na">:oiid</span><span class="o">=</span><span class="s">&#34;oi.id&#34;</span>  <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>删除<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
							<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
						<span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
				<span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
			
			<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
		<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
		
		<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartFoot&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">img</span> <span class="na">selectit</span><span class="o">=</span><span class="s">&#34;false&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;selectAllItem&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>全选<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
	<span class="c">&lt;!-- 		&lt;a href=&#34;#&#34;&gt;删除&lt;/a&gt; --&gt;</span>
			
			<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>已选商品 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartSumNumber&#34;</span> <span class="p">&gt;</span>0<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> 件<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
				
				<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>合计 (不含运费): <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> 
				<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartSumPrice&#34;</span> <span class="p">&gt;</span>￥0.00<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
				<span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;createOrderButton&#34;</span> <span class="na">disabled</span><span class="o">=</span><span class="s">&#34;disabled&#34;</span> <span class="p">&gt;</span>结  算<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
			<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
			
		<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
		
	<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>modal4deleteConfirm.html</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&#34;html&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;deleteConfirmModal&#34;</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">&#34;-1&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;dialog&#34;</span> <span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-dialog deleteConfirmModalDiv&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-content&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-header&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">data-dismiss</span><span class="o">=</span><span class="s">&#34;modal&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;close&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span>×<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;sr-only&#34;</span><span class="p">&gt;</span>Close<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">h4</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-title&#34;</span><span class="p">&gt;</span>确认删除？<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-footer&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">data-dismiss</span><span class="o">=</span><span class="s">&#34;modal&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-default&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span><span class="p">&gt;</span>关闭<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-primary deleteConfirmButton&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span><span class="p">&gt;</span>确认<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>com.qqlin.tmall.web.fore.ForeRestController#cart</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 购物车页面
</span><span class="cm">     *
</span><span class="cm">     * @param session 会话
</span><span class="cm">     * @return 返回
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;forecart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">cart</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">productImageService</span><span class="o">.</span><span class="na">setFirstProductImagesOnOrderItems</span><span class="o">(</span><span class="n">orderItems</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">orderItems</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="315-拦截器">3.1.5 拦截器</h3>
<h4 id="interceptor拦截器">interceptor拦截器</h4>
<ul>
<li>com.qqlin.tmall.interceptor.LoginInterceptor</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.interceptor</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.lang.StringUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.SecurityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.shiro.subject.Subject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.HandlerInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 拦截器判断是否登录，改用了Shiro方式
</span><span class="cm"> *
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginInterceptor</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">httpServletRequest</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">contextPath</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getContextPath</span><span class="o">();</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">requiredAuthPages</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span>
                <span class="s">&#34;buy&#34;</span><span class="o">,</span>
                <span class="s">&#34;alipay&#34;</span><span class="o">,</span>
                <span class="s">&#34;payed&#34;</span><span class="o">,</span>
                <span class="s">&#34;cart&#34;</span><span class="o">,</span>
                <span class="s">&#34;bought&#34;</span><span class="o">,</span>
                <span class="s">&#34;confirmPay&#34;</span><span class="o">,</span>
                <span class="s">&#34;orderConfirmed&#34;</span><span class="o">,</span>

                <span class="s">&#34;forebuyone&#34;</span><span class="o">,</span>
                <span class="s">&#34;forebuy&#34;</span><span class="o">,</span>
                <span class="s">&#34;foreaddCart&#34;</span><span class="o">,</span>
                <span class="s">&#34;forecart&#34;</span><span class="o">,</span>
                <span class="s">&#34;forechangeOrderItem&#34;</span><span class="o">,</span>
                <span class="s">&#34;foredeleteOrderItem&#34;</span><span class="o">,</span>
                <span class="s">&#34;forecreateOrder&#34;</span><span class="o">,</span>
                <span class="s">&#34;forepayed&#34;</span><span class="o">,</span>
                <span class="s">&#34;forebought&#34;</span><span class="o">,</span>
                <span class="s">&#34;foreconfirmPay&#34;</span><span class="o">,</span>
                <span class="s">&#34;foreorderConfirmed&#34;</span><span class="o">,</span>
                <span class="s">&#34;foredeleteOrder&#34;</span><span class="o">,</span>
                <span class="s">&#34;forereview&#34;</span><span class="o">,</span>
                <span class="s">&#34;foredoreview&#34;</span>
        <span class="o">};</span>

        <span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">httpServletRequest</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="n">contextPath</span> <span class="o">+</span> <span class="s">&#34;/&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">page</span> <span class="o">=</span> <span class="n">uri</span><span class="o">;</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">beginWith</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="n">requiredAuthPages</span><span class="o">))</span> <span class="o">{</span>
            <span class="cm">/**
</span><span class="cm">             * 修改为subject
</span><span class="cm">             */</span>
<span class="c1">//            User user = (User) session.getAttribute(&#34;user&#34;);
</span><span class="c1"></span>            <span class="n">Subject</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">SecurityUtils</span><span class="o">.</span><span class="na">getSubject</span><span class="o">();</span>

            <span class="k">if</span> <span class="o">(!</span><span class="n">subject</span><span class="o">.</span><span class="na">isAuthenticated</span><span class="o">())</span> <span class="o">{</span>
<span class="c1">//            if (user == null) {
</span><span class="c1"></span>                <span class="n">httpServletResponse</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&#34;login&#34;</span><span class="o">);</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">beginWith</span><span class="o">(</span><span class="n">String</span> <span class="n">page</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">requiredAuthPages</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">requiredAuthPage</span> <span class="o">:</span> <span class="n">requiredAuthPages</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="n">requiredAuthPage</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o</span><span class="o">,</span> <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>com.qqlin.tmall.interceptor.OrderInterceptor</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.interceptor</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.dao.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.HandlerInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 搜索栏下的分类信息
</span><span class="cm"> * 购物车数量显示
</span><span class="cm"> *
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderInterceptor</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o</span><span class="o">,</span> <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">httpServletRequest</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">cartTotalItemNumber</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">orderItem</span> <span class="o">:</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">cartTotalItemNumber</span> <span class="o">+=</span> <span class="n">orderItem</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">contextPath</span> <span class="o">=</span> <span class="n">httpServletRequest</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getContextPath</span><span class="o">();</span>

        <span class="n">httpServletRequest</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;categories_below_search&#34;</span><span class="o">,</span> <span class="n">categories</span><span class="o">);</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;cartTotalItemNumber&#34;</span><span class="o">,</span> <span class="n">cartTotalItemNumber</span><span class="o">);</span>
        <span class="n">httpServletRequest</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;contextPath&#34;</span><span class="o">,</span> <span class="n">contextPath</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="webmvcconfigurer配置器">WebMvcConfigurer配置器</h4>
<ul>
<li>com.qqlin.tmall.config.WebMvcConfigurer</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.interceptor.LoginInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.interceptor.OrderInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.InterceptorRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 拦截器设置
</span><span class="cm"> *
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @since 2020-6-1
</span><span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebMvcConfigurer</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">LoginInterceptor</span> <span class="nf">getLoginInterceptor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">LoginInterceptor</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">OrderInterceptor</span> <span class="nf">getOtherInterceptor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">OrderInterceptor</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="n">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">getLoginInterceptor</span><span class="o">())</span>
                <span class="o">.</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">getOtherInterceptor</span><span class="o">())</span>
                <span class="o">.</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="316-购物车页面操作">3.1.6 购物车页面操作</h3>
<ul>
<li>com.qqlin.tmall.web.fore.ForeRestController#changeOrderItem</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 调整购物车中的订单数量
</span><span class="cm">     *
</span><span class="cm">     * @param session 会话
</span><span class="cm">     * @param pid     产品id
</span><span class="cm">     * @param num     产品数量
</span><span class="cm">     * @return 返回result.success
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;forechangeOrderItem&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">changeOrderItem</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="s">&#34;未登录&#34;</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 删除购物车的订单项
</span><span class="cm">     *
</span><span class="cm">     * @param session 会话
</span><span class="cm">     * @param oiid    订单项的id
</span><span class="cm">     * @return 返回删除成功
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrderItem&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">deleteOrderItem</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="s">&#34;未登录&#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">oiid</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="317-订单的操作">3.1.7 订单的操作</h3>
<ul>
<li>com.qqlin.tmall.web.fore.ForeRestController#createOrder</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 生成订单
</span><span class="cm">     *
</span><span class="cm">     * @param order   订单
</span><span class="cm">     * @param session 会话
</span><span class="cm">     * @return 订单生成成功
</span><span class="cm">     */</span>
    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;forecreateOrder&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">createOrder</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">Order</span> <span class="n">order</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="s">&#34;未登录&#34;</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">String</span> <span class="n">orderCode</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyyMMddHHmmssSSS&#34;</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">())</span> <span class="o">+</span> <span class="n">RandomUtils</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setOrderCode</span><span class="o">(</span><span class="n">orderCode</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">WAIT_PAY</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">);</span>

        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">order</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;oid&#34;</span><span class="o">,</span> <span class="n">order</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 支付页面
</span><span class="cm">     *
</span><span class="cm">     * @param oid 订单项的id
</span><span class="cm">     * @return 返回已支付的订单
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;forepayed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">payed</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">WAIT_DELIVERY</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setPayDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">order</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>3.1.8 我的订单页</p>
<ul>
<li>com.qqlin.tmall.web.fore.ForeRestController#confirmPay</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 确认收货的页面
</span><span class="cm">     *
</span><span class="cm">     * @param oid 订单的id
</span><span class="cm">     * @return 返回订单对象
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;foreconfirmPay&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">confirmPay</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">calculation</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">removeOrderFromOrderItem</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">order</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 确认收货后的页面
</span><span class="cm">     *
</span><span class="cm">     * @param oid 订单的id
</span><span class="cm">     * @return 返回操作成功
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;foreorderConfirmed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">orderConfirmed</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">WAIT_REVIEW</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setConfirmDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 删除订单
</span><span class="cm">     *
</span><span class="cm">     * @param oid 订单的id
</span><span class="cm">     * @return 操作成功
</span><span class="cm">     */</span>
    <span class="nd">@PutMapping</span><span class="o">(</span><span class="s">&#34;/foredeleteOrder&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">deleteOrder</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">DELETE</span><span class="o">);</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="318-评论的功能">3.1.8 评论的功能</h3>
<ul>
<li>com.qqlin.tmall.web.fore.ForeRestController#review</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="cm">/**
</span><span class="cm">     * 填写评论
</span><span class="cm">     * @param oid 订单的id
</span><span class="cm">     * @return 填写成功
</span><span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;forereview&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">review</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">removeOrderFromOrderItem</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getOrderItems</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">).</span><span class="na">getProduct</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">product</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">order</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 订单提交
</span><span class="cm">     * @param session 会话
</span><span class="cm">     * @param oid 订单id
</span><span class="cm">     * @param pid 产品id
</span><span class="cm">     * @param content 评论正文
</span><span class="cm">     * @return 返回提交成功
</span><span class="cm">     */</span>
    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;foredoreview&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">doreview</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">oid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">FINISH</span><span class="o">);</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>

        <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>

        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">Review</span> <span class="n">review</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Review</span><span class="o">();</span>
        <span class="n">review</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
        <span class="n">review</span><span class="o">.</span><span class="na">setProduct</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
        <span class="n">review</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">review</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">reviewService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">review</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="na">success</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="四在linux中的简单部署">四、在Linux中的简单部署</h1>
<p>使用maven将项目打包为jar包，先clear，然后package，生成tmall_springboot.jar</p>
<p>然后在Linux安装redis，并启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback"># 安装到/usr/local/redis/目录中
# 然后打开 /redis-5.0.4/utils/install_server.sh
# 一直按确认

➜  utils ./install_server.sh
Welcome to the redis service installer
This script will help you easily set up a running redis server

Please select the redis port for this instance: [6379]
Selecting default: 6379
Please select the redis config file name [/etc/redis/6379.conf]
Selected default - /etc/redis/6379.conf
Please select the redis log file name [/var/log/redis_6379.log]
Selected default - /var/log/redis_6379.log
Please select the data directory for this instance [/var/lib/redis/6379]
Selected default - /var/lib/redis/6379
Please select the redis executable path [/usr/local/bin/redis-server]
Selected config:
Port           : 6379
Config file    : /etc/redis/6379.conf
Log file       : /var/log/redis_6379.log
Data dir       : /var/lib/redis/6379
Executable     : /usr/local/bin/redis-server
Cli Executable : /usr/local/bin/redis-cli
Is this ok? Then press ENTER to go on or Ctrl-C to abort.
Copied /tmp/6379.conf =&gt; /etc/init.d/redis_6379
Installing service...
Successfully added to chkconfig!
Successfully added to runlevels 345!
/var/run/redis_6379.pid exists, process is already running or crashed
Installation successful!

</code></pre></td></tr></table>
</div>
</div><p>在Linux中安装elasticsearch，并启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback"># 安装到 /opt/elasticsearch/目录中，生成elasticsearch-2.4.2
# 由于 Elasticsearch不能以 root⽤户启动，因此需要添加⾮ root⽤户：
groupadd es
useradd es -g es
chown -R es:es ./elasticsearch-2.4.2

# 关闭防⽕墙
systemctl stop firewalld
systemctl disable firewalld

# 切换⽤户
su es

# 启动服务
cd bin
./elasticsearch // 若要后台启动，则加-d参数

# 浏览器访问：http://ip:9200/ 查看启动效果
</code></pre></td></tr></table>
</div>
</div><p>部署jar包</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">nohup java -jar tmall_springboot.jar &gt;/dev/null 2&gt;&amp;1 &amp;

# 查看端口，查看是否正常运行
netstat -lnp|grep java

➜  ~ netstat -lnp|grep java
tcp6       0      0 :::8080                 :::*                    LISTEN      4847/java
tcp6       0      0 127.0.0.1:9200          :::*                    LISTEN      4624/java
tcp6       0      0 ::1:9200                :::*                    LISTEN      4624/java
tcp6       0      0 127.0.0.1:9300          :::*                    LISTEN      4624/java
tcp6       0      0 ::1:9300                :::*                    LISTEN      4624/java

# 8080和9200/9300 端口都在运行中
</code></pre></td></tr></table>
</div>
</div><p>最后在主机的浏览器打开 <code>http://192.168.43.227:8080/tmall_springboot/home</code>，其中<code>192.168.43.227</code>是虚拟机中的ip</p>
<p>部署完成</p>
<p><img src="/media/image-20200610164726408.png" alt="image-20200610164726408"></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/spring-framework/">Spring Framework</a>
          <a href="/tags/springmvc/">SpringMVC</a>
          <a href="/tags/springboot/">springboot</a>
          <a href="/tags/jpa/">jpa</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/15.hibernate%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%BA%94%E8%AF%A5%E4%BD%BF%E7%94%A8int%E8%BF%98%E6%98%AFinteger/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Hibernate实体类属性应该使用int还是Integer</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/13.ssm%E6%A1%86%E6%9E%B6/">
            <span class="next-text nav-default">基于SSM框架的电商系统</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:492332435@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/daniel1n" class="iconfont icon-github" title="github"></a>
  <a href="https://daniel1n.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2020 - 
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Daniel1n</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>








</body>
</html>
