<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>基于SSM框架的电商系统 - Daniel1n - Welcome to My Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Daniel1n" /><meta name="description" content="SSM框架整合的基础：Spring，SpringMVC，Mybatis 一、开发流程 1.1 技术选型 前端：HTML、CSS、JavaScript、J" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.69.2 with theme even" />


<link rel="canonical" href="https://daniel1n.github.io/post/13.ssm%E6%A1%86%E6%9E%B6/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.8c3cbcb0324c2bb4875ceccba4007cbad4b4ac8377f33af9953c3e7684534a50.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="基于SSM框架的电商系统" />
<meta property="og:description" content="SSM框架整合的基础：Spring，SpringMVC，Mybatis 一、开发流程 1.1 技术选型 前端：HTML、CSS、JavaScript、J" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://daniel1n.github.io/post/13.ssm%E6%A1%86%E6%9E%B6/" />
<meta property="article:published_time" content="2020-05-23T09:41:40+08:00" />
<meta property="article:modified_time" content="2020-05-23T09:41:40+08:00" />
<meta itemprop="name" content="基于SSM框架的电商系统">
<meta itemprop="description" content="SSM框架整合的基础：Spring，SpringMVC，Mybatis 一、开发流程 1.1 技术选型 前端：HTML、CSS、JavaScript、J">
<meta itemprop="datePublished" content="2020-05-23T09:41:40&#43;08:00" />
<meta itemprop="dateModified" content="2020-05-23T09:41:40&#43;08:00" />
<meta itemprop="wordCount" content="60294">



<meta itemprop="keywords" content="Spring Framework,SpringMVC,Mybatis," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="基于SSM框架的电商系统"/>
<meta name="twitter:description" content="SSM框架整合的基础：Spring，SpringMVC，Mybatis 一、开发流程 1.1 技术选型 前端：HTML、CSS、JavaScript、J"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Daniel1n</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Daniel1n</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">基于SSM框架的电商系统</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-05-23 </span>
        <div class="post-category">
            <a href="/categories/ssm/"> SSM </a>
            </div>
          <span class="more-meta"> 60294 words </span>
          <span class="more-meta"> 121 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#11-技术选型">1.1 技术选型</a></li>
    <li><a href="#12--具体流程">1.2  具体流程</a>
      <ul>
        <li><a href="#121-需求分析">1.2.1 需求分析</a></li>
        <li><a href="#122-表结构的设计">1.2.2 表结构的设计</a></li>
        <li><a href="#123-原型-后端">1.2.3 原型-后端</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#21-静态资源">2.1 静态资源</a></li>
    <li><a href="#22-后端代码"><strong>2.2 后端代码</strong></a>
      <ul>
        <li><a href="#创建项目">创建项目</a></li>
        <li><a href="#配置文件"><strong>配置文件</strong></a></li>
        <li><a href="#mybatis的逆向工程"><strong>Mybatis的逆向工程</strong></a></li>
      </ul>
    </li>
    <li><a href="#23-编写源代码">2.3 编写源代码</a>
      <ul>
        <li><a href="#231-逆向工程生成的代码">2.3.1 逆向工程生成的代码</a></li>
        <li><a href="#232-分页查询">2.3.2 分页查询</a></li>
        <li><a href="#233-图片上传">2.3.3 图片上传</a></li>
        <li><a href="#234-分类管理">2.3.4 分类管理</a></li>
        <li><a href="#235-属性管理">2.3.5 属性管理</a></li>
        <li><a href="#236-产品管理">2.3.6 产品管理</a></li>
        <li><a href="#237-产品图片管理">2.3.7 产品图片管理</a></li>
        <li><a href="#238-产品属性值设置">2.3.8 产品属性值设置</a></li>
        <li><a href="#239-用户管理">2.3.9 用户管理</a></li>
        <li><a href="#2310-订单管理">2.3.10 订单管理</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#31-首页-分类管理">3.1 首页-分类管理</a>
      <ul>
        <li><a href="#category实体类">Category实体类</a></li>
        <li><a href="#productservice-1">ProductService</a></li>
        <li><a href="#productserviceimpl-1">ProductServiceImpl</a></li>
        <li><a href="#forecontrollerhome">ForeController.home()</a></li>
        <li><a href="#视图homejsp">视图home.jsp</a></li>
        <li><a href="#视图homepagejsp">视图homePage.jsp</a></li>
      </ul>
    </li>
    <li><a href="#32-前台-无需登录">3.2 前台-无需登录</a>
      <ul>
        <li><a href="#321-注册">3.2.1 注册</a></li>
        <li><a href="#322-登录">3.2.2 登录</a></li>
        <li><a href="#323-退出">3.2.3 退出</a></li>
        <li><a href="#324-产品页">3.2.4 产品页</a></li>
        <li><a href="#325-模态登录">3.2.5 模态登录</a></li>
        <li><a href="#326-分类页">3.2.6 分类页</a></li>
        <li><a href="#327-搜索">3.2.7 搜索</a></li>
      </ul>
    </li>
    <li><a href="#32-前台-需要登录">3.2 前台-需要登录</a>
      <ul>
        <li><a href="#321-购物流程">3.2.1 购物流程</a></li>
        <li><a href="#322-购物流程与表关系">3.2.2 购物流程与表关系</a></li>
        <li><a href="#323-立即购买">3.2.3 立即购买</a></li>
        <li><a href="#324-结算页面">3.2.4 结算页面</a></li>
        <li><a href="#325-加入购物车">3.2.5 加入购物车</a></li>
        <li><a href="#326-查看购物车">3.2.6 查看购物车</a></li>
        <li><a href="#327-登录拦截器">3.2.7 登录拦截器</a></li>
        <li><a href="#328-其他拦截器">3.2.8 其他拦截器</a></li>
        <li><a href="#329-购物车页面">3.2.9 购物车页面</a></li>
        <li><a href="#3210-订单状态">3.2.10 订单状态</a></li>
        <li><a href="#3211-生成订单">3.2.11 生成订单</a></li>
        <li><a href="#3212-我的订单页">3.2.12 我的订单页</a></li>
        <li><a href="#3213-我的订单页面操作">3.2.13 我的订单页面操作</a></li>
        <li><a href="#3214-评价">3.2.14 评价</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#41-项目结构">4.1 项目结构</a></li>
    <li><a href="#42-运用的场景">4.2 运用的场景</a></li>
    <li><a href="#43-设计模式">4.3 设计模式</a></li>
    <li><a href="#44-需要改进">4.4 需要改进</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<p>SSM框架整合的基础：Spring，SpringMVC，Mybatis</p>
</blockquote>
<h1 id="一开发流程">一、开发流程</h1>
<h2 id="11-技术选型">1.1 技术选型</h2>
<blockquote>
<p>前端：HTML、CSS、JavaScript、JSON、Jquery、Ajax、Bootstrap</p>
<p>后端：Tomcat、Servlet、Jsp、Filter</p>
<p>框架：Spring、Spring MVC、Mybatis</p>
<p>数据库：Mysql</p>
<p>开发工具：Interllij IDEA、Maven</p>
</blockquote>
<h2 id="12--具体流程">1.2  具体流程</h2>
<blockquote>
<p>1.需求分析</p>
<ul>
<li>需要确定做的功能模块，包括前台和后台</li>
</ul>
<p>2.表结构设计</p>
<ul>
<li>每个功能模块对应的表关系</li>
</ul>
<p>3.原型</p>
<ul>
<li>界面原型：前台原型和后台原型</li>
</ul>
<p>4.后台-分类管理</p>
<ul>
<li>功能模块之间的依赖关系，JSP包含关系，具体的功能包括：查询、分页、增加、删除、编辑、修改</li>
</ul>
<p>5.项目重构</p>
<ul>
<li>分页模块的重构、Mybatis的逆向工程</li>
</ul>
<p>6.后台-其他管理</p>
<ul>
<li>分类管理、产品管理、用户管理、订单管理</li>
</ul>
<p>7.前台-首页</p>
<p>8.前台无需登录</p>
<ul>
<li>无需登录状态下的功能模块：</li>
</ul>
<p>9.前台需要登录</p>
<ul>
<li>购物相关功能，购物流程环节与表关系</li>
</ul>
<p>10.总结</p>
<ul>
<li>项目的整体结构，实现了那些典型场景、运用了哪些设计模式</li>
</ul>
</blockquote>
<h3 id="121-需求分析">1.2.1 需求分析</h3>
<h4 id="需求分析-前台展示层"><strong>需求分析-前台展示层</strong></h4>
<blockquote>
<p>1.首页</p>
<ul>
<li>横向导航栏上提供4个分类连接</li>
<li>纵向导航栏上提供全部17个分类连接</li>
<li>鼠标移动到某一个纵向分类连接时，显示该分类下的推荐商品</li>
<li>按照每种分类显示5个商品的方式，显示所有17种分类的产品</li>
</ul>
<p>2.产品页</p>
<ul>
<li>显示分辨率为950*100的当前商品对应的分类图片</li>
<li>显示本商品的5个单独图片</li>
<li>商品的基本信息：标题、小标题、价格、销量、评价数量、库存</li>
<li>商品详情</li>
<li>评价信息</li>
<li>五张商品详细图片</li>
</ul>
<p>3.分类页</p>
<ul>
<li>搜索框及搜索框下的分类连接</li>
<li>显示分辨率为950*100的当前分类图片</li>
<li>显示本分类下的所有产品</li>
</ul>
<p>4.搜索结构页</p>
<ul>
<li>搜索框及搜索框下的分类连接</li>
<li>显示满足查询条件的商品</li>
</ul>
<p>5.购物车查看页</p>
<ul>
<li>购物车中的订单项，包含商品信息、单价、数量、金额、结算</li>
</ul>
<p>6.结算页面</p>
<ul>
<li>结算页面显示被选中的订单项，提交订单</li>
</ul>
<p>7.确认支付页</p>
<ul>
<li>支付方式的选择</li>
</ul>
<p>8.支付成功页</p>
<ul>
<li>付款成功时，显示本次付款金额、<strong>收货地址</strong>、<strong>物流信息查询</strong>连接、查看订单连接</li>
</ul>
<p>9.我的订单页</p>
<ul>
<li>显示所有订单，以及对应的订单项</li>
</ul>
<p>10.确认收货页</p>
<ul>
<li>显示订单内容</li>
<li>显示订单信息、收货人地址</li>
</ul>
<p>11.评价页</p>
<ul>
<li>
<p>显示要评价的商品信息，商品当前的总评价数</p>
</li>
<li>
<p>评价成功后，显示当前商品所有的评价信息</p>
</li>
</ul>
<p>12.页头信息</p>
<ul>
<li>
<p>未登录状态：请登录、免费注册、购物车为0</p>
</li>
<li>
<p>登录状态：用户名称、退出登录、购物车的数量显示</p>
</li>
</ul>
</blockquote>
<h4 id="需求分析-服务端交互层"><strong>需求分析-服务端交互层</strong></h4>
<blockquote>
<p>1.分类页排序</p>
<ul>
<li>
<p>按照综合、人气、新品、销量、价格排序</p>
</li>
<li>
<p>进行价格筛选、客户端的展示层，并没有跟服务端交互</p>
</li>
</ul>
<p>2.立即购买</p>
<ul>
<li>在产品页，未登录状态时，点击立即购买，弹出登录模态窗口</li>
<li>在产品页，已登录状态时，点击立即购买，提交数据到服务端、生成订单、跳转结算页面</li>
</ul>
<p>3.加入购物车</p>
<ul>
<li>在产品页，未登录状态时，点击加入购物车，弹出登录模态窗口</li>
<li>在产品页，在登录状态时，点击加入购物车，使用ajax异步提交数据到服务端，生成订单，并使当前“加入购物车“按钮，变得不可点击</li>
</ul>
<p>4.调整订单项</p>
<ul>
<li>在购物车页面，调整订单项数量，<strong>订单项的属性选择</strong></li>
</ul>
<p>5.删除订单项</p>
<ul>
<li>在购物车页面，删除订单项，首先弹出模态窗口确认是否要删除，如果要删除，则通过Ajax异步发送指令到服务端，并在当前页面删除该条订单项</li>
</ul>
<p>6.生成订单</p>
<ul>
<li>在结算页面，提交订单时候，根据结算页面的收货人信息，订单信息，生成订单数据</li>
</ul>
<p>7.订单页</p>
<ul>
<li>订单页上有三个按钮，付款、确认收货和评价，这些按钮都没有提交数据到服务端，而是提交到下一个页面的二次操作，才能提交数据到服务端</li>
</ul>
<p>8.确认付款</p>
<ul>
<li>点击确认支付，提交本信息到服务端，服务端修改订单中的支付日期</li>
</ul>
<p>9.确认收货</p>
<ul>
<li>确认收货页面，点击确认支付，提交数据到服务端，并修改订单中的确认收货日期</li>
</ul>
<p>10.提交评价信息</p>
<ul>
<li>提交评价信息到服务端</li>
</ul>
<p>11.登录</p>
<ul>
<li>输入正确账号密码，与服务端中的账号信息进行判断，正确即登录成功，跳转首页，失败提示错误信息</li>
</ul>
<p>12.注册</p>
<ul>
<li>新增账户的用户名与密码，与服务端中的账户信息进行判断，重复，显示用户名已被注册</li>
</ul>
<p>13.退出</p>
<ul>
<li>移除session，页面跳转到未登录状态</li>
</ul>
<p>14.搜索</p>
<ul>
<li>提交关键字到服务端，服务端查询数据库，进行模糊查询，返回匹配的产品</li>
</ul>
</blockquote>
<p><strong>需求分析-前端页面的总结：</strong></p>
<blockquote>
<p>首页</p>
<ul>
<li>在横向导航栏上提供4个分类连接</li>
<li>在纵向导航栏上提供全部17个分类连接</li>
<li>当鼠标移动到某一个纵向分类连接的时候，显示这个分类下的推荐商品</li>
<li>按照每种分类，显示5个商品的方式显示所有17种分类</li>
</ul>
<p>产品页</p>
<ul>
<li>显示分辨率为950x100的当前商品对应的分类图片</li>
<li>显示本商品的5个单独图片</li>
<li>商品的基本信息，如标题，小标题，价格，销量，评价数量，库存等</li>
<li>商品详情</li>
<li>评价信息</li>
<li>5张商品详细图片</li>
<li><strong>立即购买</strong></li>
<li><strong>加入购物车</strong></li>
</ul>
<p>分类页</p>
<ul>
<li>显示分辨率为950x100的当前分类图片</li>
<li>显示本分类下的所有产品</li>
<li><strong>分类页排序</strong></li>
</ul>
<p>搜索结果页</p>
<ul>
<li>显示满足查询条件的商品</li>
</ul>
<p>购物车查看页</p>
<ul>
<li>在购物车中显示订单项</li>
<li><strong>调整订单项数量</strong></li>
<li><em>删除订单项</em>*</li>
</ul>
<p>结算页</p>
<ul>
<li>在结算页面显示被选中的订单项</li>
<li><strong>生成订单</strong></li>
</ul>
<p>确认支付页</p>
<ul>
<li>确认支付页面显示本次订单的金额总数</li>
<li><strong>确认付款</strong></li>
</ul>
<p>支付成功页</p>
<ul>
<li>付款成功时，显示本次付款金额</li>
</ul>
<p>我的订单页</p>
<ul>
<li>显示所有订单，以及对应的订单项</li>
</ul>
<p>确认收货页</p>
<ul>
<li>显示订单项内容</li>
<li>显示订单信息，收货人地址等</li>
<li><strong>确认收货</strong></li>
</ul>
<p>评价页</p>
<ul>
<li>显示要评价的商品信息，商品当前的总评价数</li>
<li>评价成功后，显示当前商品所有的评价信息</li>
<li><strong>提交评价信息</strong></li>
</ul>
<p>页头信息展示</p>
<ul>
<li>未登录状态</li>
<li>已登录状态</li>
<li><strong>登录</strong></li>
<li><strong>注册</strong></li>
<li><strong>退出</strong></li>
</ul>
<p>所有页面</p>
<ul>
<li><strong>搜索</strong></li>
</ul>
</blockquote>
<h4 id="需求分析-后台展示层"><strong>需求分析-后台展示层</strong></h4>
<blockquote>
<p>1.分类管理</p>
<ol>
<li>分页查询</li>
<li>新增分类</li>
<li>编辑修改</li>
<li>删除</li>
</ol>
<p>2.属性管理</p>
<ol>
<li>产品属性</li>
<li>分页查询</li>
<li>新增属性</li>
<li>编辑修改</li>
<li>删除</li>
</ol>
<p>3.产品管理</p>
<ol>
<li>分页查询</li>
<li>新增产品</li>
<li>编辑修改</li>
<li>删除</li>
</ol>
<p>4.产品图片</p>
<ol>
<li>产品图片分类：单个产品图片（头像），产品的多个详细图片（信息）</li>
<li>产品管理：单个产品图片（像素400×400，使用图片列表中的第一个），详细图片（790×790）</li>
</ol>
<p>5.产品属性值设置</p>
<p>6.用户管理</p>
<ol>
<li>用户查询页面，不可更改</li>
<li>用户信息的修改，应由前端的用户自行修改</li>
<li>用户的增加，也是由前端注册增加</li>
</ol>
<p>7.订单管理</p>
<ol>
<li>订单分页查询</li>
<li>查看详情：订单有哪些订单项组成</li>
<li>发货</li>
</ol>
</blockquote>
<h3 id="122-表结构的设计">1.2.2 表结构的设计</h3>
<p>新建数据库：tmall_ssm_rebuild</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="c1">-- 新增数据库:tmall_ssm
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">tmall_ssm_rebuild</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf8</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>根据需求需要9张表</p>
<p><img src="https://stepimagewm.how2j.cn/6041.png" alt="image"></p>
<p>表的具体信息</p>
<table>
<thead>
<tr>
<th>表名</th>
<th>中文含义</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>Category</td>
<td>分类表</td>
<td>存放分类信息，如女装，平板电视，沙发等</td>
</tr>
<tr>
<td>Property</td>
<td>属性表</td>
<td>存放属性信息，如颜色，重量，品牌，厂商，型号等</td>
</tr>
<tr>
<td>Product</td>
<td>产品表</td>
<td>存放产品信息，如LED40EC平板电视机，海尔EC6005热水器</td>
</tr>
<tr>
<td>PropertyValue</td>
<td>属性值表</td>
<td>存放属性值信息，如重量是900g,颜色是粉红色</td>
</tr>
<tr>
<td>ProductImage</td>
<td>产品图片表</td>
<td>存放产品图片信息，如产品页显示的5个图片</td>
</tr>
<tr>
<td>Review</td>
<td>评论表</td>
<td>存放评论信息，如买回来的蜡烛很好用，么么哒</td>
</tr>
<tr>
<td>User</td>
<td>用户表</td>
<td>存放用户信息，如斩手狗，千手小粉红</td>
</tr>
<tr>
<td>OrderForm</td>
<td>订单表</td>
<td>存放订单信息，包括邮寄地址，电话号码等信息</td>
</tr>
<tr>
<td>OrderItem</td>
<td>订单项表</td>
<td>存放订单项信息，包括购买产品种类，数量等</td>
</tr>
</tbody>
</table>
<p>表的关系</p>
<table>
<thead>
<tr>
<th>一</th>
<th>多</th>
</tr>
</thead>
<tbody>
<tr>
<td>Category-分类</td>
<td>Product-产品</td>
</tr>
<tr>
<td>Category-分类</td>
<td>Property-属性</td>
</tr>
<tr>
<td>Property-属性</td>
<td>PropertyValue-属性值</td>
</tr>
<tr>
<td>Product-产品</td>
<td>PropertyValue-属性值</td>
</tr>
<tr>
<td>Product-产品</td>
<td>ProductImage-产品图片</td>
</tr>
<tr>
<td>Product-产品</td>
<td>Review-评价</td>
</tr>
<tr>
<td>User-用户</td>
<td>OrderForm-订单</td>
</tr>
<tr>
<td>Product-产品</td>
<td>OrderItem-订单项</td>
</tr>
<tr>
<td>User-用户</td>
<td>OrderItem-订单项</td>
</tr>
<tr>
<td>OrderForm-订单</td>
<td>OrderItem-订单项</td>
</tr>
<tr>
<td>User-用户</td>
<td>Review-评价</td>
</tr>
</tbody>
</table>
<p>创建表</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="c1">-- 新增数据库:tmall_ssm_rebuild
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">tmall_ssm</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf8</span><span class="p">;</span>

<span class="n">USE</span> <span class="n">tmall_ssm_rebuild</span><span class="p">;</span>
<span class="c1">-- 先建立被外键指向的表，比如user和categor
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">user</span><span class="p">(</span>
	<span class="n">id</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">password</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">category</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 从这个表开始，有外键约束
</span><span class="c1">-- 属性表
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">property</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">categoryId</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">fk_property_category</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">categoryId</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">category</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>


<span class="cm">/*
</span><span class="cm">产品表
</span><span class="cm">name: 产品名称
</span><span class="cm">subTitle: 小标题
</span><span class="cm">originalPrice: 原始价格
</span><span class="cm">promotePrice: 优惠价格
</span><span class="cm">stock: 库存
</span><span class="cm">createDate: 创建日期
</span><span class="cm">categoryId: 指向分类表的id字段 
</span><span class="cm">*/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">product</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">subTitle</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">originalPrice</span> <span class="nb">FLOAT</span><span class="p">,</span>
    <span class="n">promotePrice</span> <span class="nb">FLOAT</span><span class="p">,</span>
    <span class="n">stock</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">categoryId</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">createDate</span> <span class="n">DATETIME</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">fk_product_category</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">categoryId</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">category</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 属性值表
</span><span class="c1">-- 外键propertyId,指向属性表的id
</span><span class="c1">-- 外键productId,指向产品表的id
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">propertyValue</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">productId</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">propertyId</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">value</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">fk_propertyValue_property</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">propertyId</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">property</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">fk_propertyValue_product</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">productId</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">product</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 产品图片表
</span><span class="c1">-- type表示类型，产品图片分为单个图片和详情图片
</span><span class="c1">-- 外键productId，指向产品表的id字段
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">productImage</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">productId</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="k">type</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">fk_productImage_product</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">productId</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">product</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 评价表
</span><span class="c1">-- 外键productId，指向产品表的id
</span><span class="c1">-- 外键userId, 指向用户表的id
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">review</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">content</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">4000</span><span class="p">),</span>
    <span class="n">userId</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">productId</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">createDate</span> <span class="n">DATETIME</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">fk_review_product</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">productId</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">product</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">fk_review_user</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">userId</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="k">user</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>



<span class="cm">/*
</span><span class="cm">订单表
</span><span class="cm">orderCode： 订单号
</span><span class="cm">address:收货地址
</span><span class="cm">post: 邮编
</span><span class="cm">receiver: 收货人信息
</span><span class="cm">mobile: 手机号码
</span><span class="cm">userMessage: 用户备注信息
</span><span class="cm">createDate: 订单创建日期
</span><span class="cm">payDate: 支付日期
</span><span class="cm">deliveryDate: 发货日期
</span><span class="cm">confirmDate：确认收货日期
</span><span class="cm">status: 订单状态
</span><span class="cm">外键userId，指向用户表id字段 
</span><span class="cm">*/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orderForm</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">orderCode</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">address</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">post</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">receiver</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">mobile</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">userMessage</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">createDate</span> <span class="n">DATETIME</span><span class="p">,</span>
    <span class="n">payDate</span> <span class="n">DATETIME</span><span class="p">,</span>
    <span class="n">deliveryDate</span> <span class="n">DATETIME</span><span class="p">,</span>
    <span class="n">confirmDate</span> <span class="n">DATETIME</span><span class="p">,</span>
    <span class="n">userId</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">status</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">fk_orderForm_user</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">userId</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="k">user</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 订单项表
</span><span class="c1">-- 外键productId,指向产品表的id
</span><span class="c1">-- 外键orderId,指向订单表的id
</span><span class="c1">-- 外键userId,指向用户表id
</span><span class="c1">-- number字段表示购物数量
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orderItem</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">productId</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">orderId</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">userId</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="nb">number</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">fk_orderItem_user</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">userId</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="k">user</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">fk_orderItem_product</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">productId</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">product</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">fk_ouderItem_order</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">orderId</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">product</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意:</p>
<p>在创建表结构的时候，有外键约束，导致当存在从表数据的时候，主表数据无法被删除。</p>
<p>为什么会这样呢？ 假设即使有从表数据，主表也允许被删除，那么那些从表数据就变成脏数据了。</p>
<p>对于这个问题通常有两种解决办法：</p>
<ol>
<li>使用级联删除。即删除主表的时候，从表自动删除。 这样做在技术上最简单，但是在业务上最危险，不推荐。</li>
<li>删除有从表数据的主表时，提醒用户依然有从表数据，建议用户一条一条删除从表数据，再删除主表数据。 这样技术上无改动，业务上最安全。 建议采纳此种方案。 附：主从表概念——以分类和产品而言，他们是一对多关系，分类就是主表，产品就是从表。</li>
</ol>
</blockquote>
<h3 id="123-原型-后端">1.2.3 原型-后端</h3>
<p>分类管理</p>
<p><img src="/media/image-20200523162550911.png" alt="image-20200523162550911"></p>
<p>属性管理</p>
<p><img src="/media/image-20200523162608101.png" alt="image-20200523162608101"></p>
<p>产品管理</p>
<p><img src="/media/image-20200523162617221.png" alt="image-20200523162617221"></p>
<p>产品图片管理</p>
<p><img src="/media/image-20200523162635768.png" alt="image-20200523162635768"></p>
<p>产品属性管理</p>
<p><img src="/media/image-20200523162721251.png" alt="image-20200523162721251"></p>
<p>用户管理</p>
<p><img src="/media/image-20200523162746340.png" alt="image-20200523162746340"></p>
<p>订单管理</p>
<p><img src="/media/image-20200523162808085.png" alt="image-20200523162808085"></p>
<h1 id="二-后台管理">二、 后台管理</h1>
<h2 id="21-静态资源">2.1 静态资源</h2>
<p>需要在webapp目录下，导入图片资源img</p>
<p>需要在webapp目录下，导入css资源</p>
<blockquote>
<ol>
<li>
<p>back</p>
<p>后台界面需要的样式</p>
</li>
<li>
<p>bootstrap</p>
<p>bootstrap的css样式文件</p>
</li>
<li>
<p>fore</p>
<p>前台界面需要的样式</p>
</li>
</ol>
</blockquote>
<p>需要在webapp目录下，导入js资源</p>
<blockquote>
<p>/bootstrap:  bootstrap用到的js文件</p>
<p>/jquery：  jquery用到的js文件</p>
</blockquote>
<p>需要在webapp目录下，新增admin目录，存放index.jsp，用于客户端跳转的后端界面</p>
<p>需要在webapp目录的WEB-INF目录下，新增jsp目录，用于前后台的页面跳转</p>
<h2 id="22-后端代码"><strong>2.2 后端代码</strong></h2>
<h3 id="创建项目">创建项目</h3>
<p>点击Create New Project新建项目</p>
<blockquote>
<ol>
<li>左边选中Maven</li>
<li>勾选Create from archetype</li>
<li>选中 org.apache.maven.archetypes:maven-archetype-webapp</li>
<li>Next</li>
</ol>
</blockquote>
<p>项目参数</p>
<blockquote>
<p>GroupId: com.qqlin.tmall</p>
<p>ArtifactId: tmall_ssm</p>
<p>version：1.0-SNAPSHOT</p>
</blockquote>
<p>导入maven依赖pom.xml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>

<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>com.qqlin.tmall<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>tmall_ssm<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;name&gt;</span>ssm__ Maven Webapp<span class="nt">&lt;/name&gt;</span>
    <span class="c">&lt;!-- FIXME change it to the project&#39;s website --&gt;</span>
    <span class="nt">&lt;url&gt;</span>http://www.example.com<span class="nt">&lt;/url&gt;</span>

    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;spring.version&gt;</span>5.2.6.RELEASE<span class="nt">&lt;/spring.version&gt;</span>
        <span class="nt">&lt;pagehelper.version&gt;</span>5.1.2-beta<span class="nt">&lt;/pagehelper.version&gt;</span>
        <span class="nt">&lt;mysql.version&gt;</span>5.1.6<span class="nt">&lt;/mysql.version&gt;</span>
        <span class="nt">&lt;mybatis.spring.version&gt;</span>1.2.3<span class="nt">&lt;/mybatis.spring.version&gt;</span>
        <span class="nt">&lt;mybatis.version&gt;</span>3.1.1<span class="nt">&lt;/mybatis.version&gt;</span>
        <span class="nt">&lt;junit.version&gt;</span>4.12<span class="nt">&lt;/junit.version&gt;</span>
        <span class="nt">&lt;jstl.version&gt;</span>1.2<span class="nt">&lt;/jstl.version&gt;</span>
        <span class="nt">&lt;jsqlparser.version&gt;</span>1.0<span class="nt">&lt;/jsqlparser.version&gt;</span>
        <span class="nt">&lt;jackson.version&gt;</span>1.2.7<span class="nt">&lt;/jackson.version&gt;</span>
        <span class="nt">&lt;servlet-api.version&gt;</span>4.0.1<span class="nt">&lt;/servlet-api.version&gt;</span>
        <span class="nt">&lt;druid.version&gt;</span>1.0.18<span class="nt">&lt;/druid.version&gt;</span>
        <span class="nt">&lt;log4j.version&gt;</span>1.2.16<span class="nt">&lt;/log4j.version&gt;</span>
        <span class="nt">&lt;commons-logging.version&gt;</span>1.2<span class="nt">&lt;/commons-logging.version&gt;</span>
        <span class="nt">&lt;commons-fileupload.version&gt;</span>1.2.1<span class="nt">&lt;/commons-fileupload.version&gt;</span>
        <span class="nt">&lt;commons-io.version&gt;</span>1.3.2<span class="nt">&lt;/commons-io.version&gt;</span>
        <span class="nt">&lt;commons-lang.version&gt;</span>2.6<span class="nt">&lt;/commons-lang.version&gt;</span>
        <span class="nt">&lt;aopalliance.version&gt;</span>1.0<span class="nt">&lt;/aopalliance.version&gt;</span>
        <span class="nt">&lt;mybatis-generator.version&gt;</span>1.3.5<span class="nt">&lt;/mybatis-generator.version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${junit.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mybatis<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${mybatis.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mybatis-spring<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${mybatis.spring.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${mysql.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>druid<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${druid.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-beans<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-jdbc<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-aspects<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- JSP相关 --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>jstl<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jstl<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${jstl.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>javax.servlet-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${servlet-api.version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- pageHelper --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.github.pagehelper<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>pagehelper<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${pagehelper.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!--jsqlparser--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.github.jsqlparser<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jsqlparser<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${jsqlparser.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>log4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>log4j<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${log4j.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>commons-logging<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>commons-logging<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${commons-logging.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>commons-fileupload<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>commons-fileupload<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${commons-fileupload.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>commons-io<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>commons-io<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${commons-io.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>commons-lang<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>commons-lang<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${commons-lang.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>aopalliance<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>aopalliance<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${aopalliance.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.mybatis.generator<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mybatis-generator-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${mybatis-generator.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;build&gt;</span>

        <span class="nt">&lt;finalName&gt;</span>${project.artifactId}<span class="nt">&lt;/finalName&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="c">&lt;!-- 资源文件拷贝插件 --&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-resources-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.7<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;encoding&gt;</span>UTF-8<span class="nt">&lt;/encoding&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="c">&lt;!-- java编译插件 --&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>3.2<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
                    <span class="nt">&lt;encoding&gt;</span>UTF-8<span class="nt">&lt;/encoding&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
        <span class="nt">&lt;pluginManagement&gt;</span>
            <span class="nt">&lt;plugins&gt;</span>
                <span class="c">&lt;!-- 配置Tomcat插件 --&gt;</span>
                <span class="nt">&lt;plugin&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>org.apache.tomcat.maven<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>tomcat7-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                    <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;/plugins&gt;</span>
        <span class="nt">&lt;/pluginManagement&gt;</span>

        <span class="nt">&lt;resources&gt;</span>
            <span class="nt">&lt;resource&gt;</span>
                <span class="nt">&lt;directory&gt;</span>src/main/resources<span class="nt">&lt;/directory&gt;</span>
                <span class="nt">&lt;includes&gt;</span>
                    <span class="nt">&lt;include&gt;</span>**/*.properties<span class="nt">&lt;/include&gt;</span>
                    <span class="nt">&lt;include&gt;</span>**/*.xml<span class="nt">&lt;/include&gt;</span>
                    <span class="nt">&lt;include&gt;</span>**/*.tld<span class="nt">&lt;/include&gt;</span>
                <span class="nt">&lt;/includes&gt;</span>
                <span class="nt">&lt;filtering&gt;</span>false<span class="nt">&lt;/filtering&gt;</span>
            <span class="nt">&lt;/resource&gt;</span>
            <span class="nt">&lt;resource&gt;</span>
                <span class="nt">&lt;directory&gt;</span>src/main/java<span class="nt">&lt;/directory&gt;</span>
                <span class="nt">&lt;includes&gt;</span>
                    <span class="nt">&lt;include&gt;</span>**/*.properties<span class="nt">&lt;/include&gt;</span>
                    <span class="nt">&lt;include&gt;</span>**/*.xml<span class="nt">&lt;/include&gt;</span>
                <span class="nt">&lt;/includes&gt;</span>
                <span class="nt">&lt;filtering&gt;</span>false<span class="nt">&lt;/filtering&gt;</span>
            <span class="nt">&lt;/resource&gt;</span>
        <span class="nt">&lt;/resources&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>在java目录下新增源代码</p>
<blockquote>
<p>控制器：com.qqlin.tmall.controller</p>
<p>拦截器：com.qqlin.tmall.interceptor</p>
<p>持久层：com.qqlin.tmall.mapper</p>
<p>模型：com.qqlin.tmall.pojo</p>
<p>service层：com.qqlin.tmall.service</p>
<p>工具：com.qqlin.tmall.util</p>
<p>比较器：com.qqlin.comparator</p>
</blockquote>
<h3 id="配置文件"><strong>配置文件</strong></h3>
<p>在resources目录下新增mapper目录，存放xml文件</p>
<p>在resources目录下新增log4j.properties,查看mybatis运行的情况，执行了什么SQL语句，以及sql语句的返回情况等信息。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback"># Global logging configuration
log4j.rootLogger=ERROR, stdout
# MyBatis logging configuration...
log4j.logger.com.qqlin.tmall=TRACE
# Console output...
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n
</code></pre></td></tr></table>
</div>
</div><p>在resources目录下新增jdbc.properties，配置访问数据的基本信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">#数据库配置文件
jdbc.driver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/tmall_ssm
jdbc.username=root
jdbc.password=admin
</code></pre></td></tr></table>
</div>
</div><p>在resources目录下新建applicationContext.xml</p>
<blockquote>
<ol>
<li>启动对注解的识别</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;context:annotation-config</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.qqlin.tmall.service&#34;</span> <span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>指定对<a href="https://how2j.cn/k/tmall_ssm/tmall_ssm-1516/1516.html#step6439">jdbc.properties</a>的引用</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&#34;classpath:jdbc.properties&#34;</span><span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>配置数据源</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;com.alibaba.druid.pool.DruidDataSource&#34;</span> <span class="na">init-method=</span><span class="s">&#34;init&#34;</span> <span class="na">destroy-method=</span><span class="s">&#34;close&#34;</span><span class="nt">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>配置Mybatis的SessionFactory，其中声明了别名，并且使用前面配置的数据源，扫描<a href="https://how2j.cn/k/tmall_ssm/tmall_ssm-1516/1516.html#step6435">CategoryMapper.xml</a>配置文件</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;sqlSession&#34;</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.spring.SqlSessionFactoryBean&#34;</span><span class="nt">&gt;</span> 
</code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>扫描Mapper类： <a href="https://how2j.cn/k/tmall_ssm/tmall_ssm-1516/1516.html#step6434">CategoryMapper</a></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;sqlSession&#34;</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.spring.SqlSessionFactoryBean&#34;</span><span class="nt">&gt;</span>
</code></pre></td></tr></table>
</div>
</div></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       <span class="na">xmlns:tx=</span><span class="s">&#34;http://www.springframework.org/schema/tx&#34;</span>
       <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;
</span><span class="s">     http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
</span><span class="s">     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
</span><span class="s">     http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;context:annotation-config/&gt;</span>
    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.qqlin.tmall.service&#34;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- 导入数据库配置文件 --&gt;</span>
    <span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&#34;classpath:jdbc.properties&#34;</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!-- 配置数据库连接池 --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;com.alibaba.druid.pool.DruidDataSource&#34;</span> <span class="na">init-method=</span><span class="s">&#34;init&#34;</span> <span class="na">destroy-method=</span><span class="s">&#34;close&#34;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- 基本属性 url、user、password --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;url&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.url}&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;username&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.username}&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.password}&#34;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- 配置初始化大小、最小、最大 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;initialSize&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;minIdle&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxActive&#34;</span> <span class="na">value=</span><span class="s">&#34;20&#34;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- 配置获取连接等待超时的时间 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxWait&#34;</span> <span class="na">value=</span><span class="s">&#34;60000&#34;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;timeBetweenEvictionRunsMillis&#34;</span> <span class="na">value=</span><span class="s">&#34;60000&#34;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- 配置一个连接在池中最小生存的时间，单位是毫秒 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;minEvictableIdleTimeMillis&#34;</span> <span class="na">value=</span><span class="s">&#34;300000&#34;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;validationQuery&#34;</span> <span class="na">value=</span><span class="s">&#34;SELECT 1&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;testWhileIdle&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;testOnBorrow&#34;</span> <span class="na">value=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;testOnReturn&#34;</span> <span class="na">value=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- 打开PSCache，并且指定每个连接上PSCache的大小 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;poolPreparedStatements&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxPoolPreparedStatementPerConnectionSize&#34;</span>
                  <span class="na">value=</span><span class="s">&#34;20&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!--Mybatis的SessionFactory配置--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;sqlSession&#34;</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.spring.SqlSessionFactoryBean&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;typeAliasesPackage&#34;</span> <span class="na">value=</span><span class="s">&#34;com.qqlin.tmall.pojo&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;mapperLocations&#34;</span> <span class="na">value=</span><span class="s">&#34;classpath:mapper/*.xml&#34;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;plugins&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;array&gt;</span>
                <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.github.pagehelper.PageInterceptor&#34;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;properties&#34;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;value&gt;</span>
                        <span class="nt">&lt;/value&gt;</span>
                    <span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;/bean&gt;</span>
            <span class="nt">&lt;/array&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!--Mybatis的Mapper文件识别--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.spring.mapper.MapperScannerConfigurer&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;basePackage&#34;</span> <span class="na">value=</span><span class="s">&#34;com.qqlin.tmall.mapper&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!--事务管理--&gt;</span>
    <span class="nt">&lt;tx:annotation-driven</span> <span class="na">transaction-manager=</span><span class="s">&#34;transactionManager&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;transactionManager&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>在resources目录下新建springMVC.xml</p>
<blockquote>
<ol>
<li>开启注解的识别</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">    <span class="nt">&lt;context:annotation-config/&gt;</span>
    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.qqlin.tmall.controller&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;context:include-filter</span> <span class="na">type=</span><span class="s">&#34;annotation&#34;</span>
                                <span class="na">expression=</span><span class="s">&#34;org.springframework.stereotype.Controller&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/context:component-scan&gt;</span>
    <span class="nt">&lt;mvc:annotation-driven</span> <span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>开通静态资源的访问，否则访问图片，css,js等文件可能出错</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;mvc:default-servlet-handler</span> <span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>
<p>视图定位</p>
<p>视图定位到/WEB-INF/JSP/*.jsp</p>
</li>
<li>
<p>对上传文件的解析</p>
</li>
</ol>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
       <span class="na">xmlns:mvc=</span><span class="s">&#34;http://www.springframework.org/schema/mvc&#34;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
</span><span class="s">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
</span><span class="s">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd&#34;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!--启动注解识别--&gt;</span>
    <span class="nt">&lt;context:annotation-config/&gt;</span>

    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.qqlin.tmall.controller&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;context:include-filter</span> <span class="na">type=</span><span class="s">&#34;annotation&#34;</span>
                                <span class="na">expression=</span><span class="s">&#34;org.springframework.stereotype.Controller&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/context:component-scan&gt;</span>

    <span class="nt">&lt;mvc:annotation-driven/&gt;</span>

    <span class="c">&lt;!--开通静态资源的访问--&gt;</span>
    <span class="nt">&lt;mvc:default-servlet-handler/&gt;</span>

    <span class="c">&lt;!-- 视图定位 --&gt;</span>
    <span class="nt">&lt;bean</span>
            <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;viewClass&#34;</span>
                  <span class="na">value=</span><span class="s">&#34;org.springframework.web.servlet.view.JstlView&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/jsp/&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- 对上传文件的解析--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;multipartResolver&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.multipart.commons.CommonsMultipartResolver&#34;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- 添加拦截器--&gt;</span>
    <span class="nt">&lt;mvc:interceptors&gt;</span>
        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&#34;/fore*&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.qqlin.tmall.interceptor.LoginInterceptor&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&#34;/fore*&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.qqlin.tmall.interceptor.OtherInterceptor&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
    <span class="nt">&lt;/mvc:interceptors&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>修改webapp目录下的web.xml文件</p>
<blockquote>
<ol>
<li>指定spring的配置文件为classpath下的applicationContext.xml</li>
<li>设置中文过滤器</li>
<li>指定spring mvc配置文件为classpath下的springMVC.xml</li>
</ol>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span class="na">xmlns=</span><span class="s">&#34;http://java.sun.com/xml/ns/javaee&#34;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&#34;</span>
         <span class="na">version=</span><span class="s">&#34;2.5&#34;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- spring的配置文件--&gt;</span>
    <span class="nt">&lt;context-param&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>classpath:applicationContext.xml<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/context-param&gt;</span>
    <span class="nt">&lt;listener&gt;</span>
        <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>

    <span class="c">&lt;!--中文过滤器--&gt;</span>
    <span class="nt">&lt;filter&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>utf-8<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;filter-mapping&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/filter-mapping&gt;</span>

    <span class="c">&lt;!-- spring mvc核心：分发servlet --&gt;</span>
    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>mvc-dispatcher<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="c">&lt;!-- spring mvc的配置文件 --&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>classpath:springMVC.xml<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
        <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>
    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>mvc-dispatcher<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>

<span class="nt">&lt;/web-app&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="mybatis的逆向工程"><strong>Mybatis的逆向工程</strong></h3>
<blockquote>
<p>目前分类管理中Mybatis中相关类都是自己手动编写的，包括：Category.java, CategoryMapper.java和CategoryMapper.xml。</p>
<p>尤其是CategoryMapper.xml里面主要是SQL语句，可以预见在接下来的开发任务中，随着业务逻辑的越来越复杂，SQL语句也会越来越复杂，进而导致开发速度降低，出错率增加，维护成本上升等问题。</p>
<p>为了解决手动编写SQL语句效率低这个问题，我们对Mybatis部分的代码，使用逆向工程进行重构。</p>
<p>所谓的逆向工程，就是在已经存在的数据库表结构基础上，通过工具，自动生成Category.java, CategoryMapper.java和CategoryMapper.xml。</p>
<p>逆向工程使用了 MybatisGenerator这个工具</p>
</blockquote>
<p>MybatisGenerator插件是Mybatis官方提供的，这个插件存在一个固有的Bug，即当第一次生成了CategoryMapper.xml之后，再次运行会导致CategoryMapper.xml生成重复内容，而影响正常的运行。
为了解决这个问题，需要自己写一个小插件类OverIsMergeablePlugin</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.mybatis.generator.api.GeneratedXmlFile</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.generator.api.IntrospectedTable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.generator.api.PluginAdapter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.Field</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-20
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OverIsMergeablePlugin</span> <span class="kd">extends</span> <span class="n">PluginAdapter</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">validate</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">warnings</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">sqlMapGenerated</span><span class="o">(</span><span class="n">GeneratedXmlFile</span> <span class="n">sqlMap</span><span class="o">,</span> <span class="n">IntrospectedTable</span> <span class="n">introspectedTable</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Field</span> <span class="n">field</span> <span class="o">=</span> <span class="n">sqlMap</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;isMergeable&#34;</span><span class="o">);</span>
            <span class="n">field</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">field</span><span class="o">.</span><span class="na">setBoolean</span><span class="o">(</span><span class="n">sqlMap</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchFieldException</span> <span class="o">|</span> <span class="n">IllegalAccessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在resources下创建generatorConfig.xml文件，其目的就是为了正确使用本插件而提供必要的配置信息</li>
</ul>
<blockquote>
<ol>
<li>使用<a href="https://how2j.cn/k/tmall_ssm/tmall_ssm-1547/1547.html#step6503">OverIsMergeablePlugin</a>插件</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;plugin</span> <span class="na">type=</span><span class="s">&#34;com.qqlin.tmall.util.OverIsMergeablePlugin&#34;</span> <span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>在生成的代码中，不提供注释。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;commentGenerator&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>指定链接数据库的账号和密码，既然是逆向工程</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;jdbcConnection</span> <span class="na">driverClass=</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span> <span class="na">connectionURL=</span><span class="s">&#34;jdbc:mysql://localhost/tmall_ssm&#34;</span> <span class="na">userId=</span><span class="s">&#34;root&#34;</span> <span class="na">password=</span><span class="s">&#34;admin&#34;</span><span class="nt">&gt;</span> 
</code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>
<p>指定生成的pojo,mapper, xml文件的存放位置</p>
</li>
<li>
<p>生成对应表及类名</p>
</li>
</ol>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="cp">&lt;!DOCTYPE generatorConfiguration
</span><span class="cp">        PUBLIC &#34;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&#34;
</span><span class="cp">        &#34;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&#34;&gt;</span>
<span class="nt">&lt;generatorConfiguration&gt;</span>

    <span class="nt">&lt;context</span> <span class="na">id=</span><span class="s">&#34;DB2Tables&#34;</span> <span class="na">targetRuntime=</span><span class="s">&#34;MyBatis3&#34;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!--避免生成重复代码的插件--&gt;</span>
        <span class="nt">&lt;plugin</span> <span class="na">type=</span><span class="s">&#34;com.qqlin.tmall.util.OverIsMergeablePlugin&#34;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!--是否在代码中显示注释--&gt;</span>
        <span class="nt">&lt;commentGenerator&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suppressDate&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suppressAllComments&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/commentGenerator&gt;</span>

        <span class="c">&lt;!--数据库链接地址账号密码--&gt;</span>
        <span class="nt">&lt;jdbcConnection</span> <span class="na">driverClass=</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span> <span class="na">connectionURL=</span><span class="s">&#34;jdbc:mysql://localhost/tmall_ssm&#34;</span>
                        <span class="na">userId=</span><span class="s">&#34;root&#34;</span> <span class="na">password=</span><span class="s">&#34;admin&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/jdbcConnection&gt;</span>
        <span class="c">&lt;!--此属性用于指定MyBatis Generator是否应将DECIMAL和NUMERIC字段强制使用java.math.BigDecimal，而不是在可能的情况下替换整数类型。--&gt;</span>
        <span class="nt">&lt;javaTypeResolver&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;forceBigDecimals&#34;</span> <span class="na">value=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/javaTypeResolver&gt;</span>
        <span class="c">&lt;!--生成pojo类存放位置--&gt;</span>
        <span class="nt">&lt;javaModelGenerator</span> <span class="na">targetPackage=</span><span class="s">&#34;com.qqlin.tmall.pojo&#34;</span> <span class="na">targetProject=</span><span class="s">&#34;src/main/java&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;enableSubPackages&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;trimStrings&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/javaModelGenerator&gt;</span>
        <span class="c">&lt;!--生成xml映射文件存放位置--&gt;</span>
        <span class="nt">&lt;sqlMapGenerator</span> <span class="na">targetPackage=</span><span class="s">&#34;mapper&#34;</span> <span class="na">targetProject=</span><span class="s">&#34;src/main/resources&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;enableSubPackages&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/sqlMapGenerator&gt;</span>
        <span class="c">&lt;!--生成mapper类存放位置--&gt;</span>
        <span class="nt">&lt;javaClientGenerator</span> <span class="na">type=</span><span class="s">&#34;XMLMAPPER&#34;</span> <span class="na">targetPackage=</span><span class="s">&#34;com.qqlin.tmall.mapper&#34;</span> <span class="na">targetProject=</span><span class="s">&#34;src/main/java&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;enableSubPackages&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/javaClientGenerator&gt;</span>

        <span class="c">&lt;!--生成对应表及类名--&gt;</span>

        <span class="nt">&lt;table</span> <span class="na">tableName=</span><span class="s">&#34;category&#34;</span> <span class="na">domainObjectName=</span><span class="s">&#34;Category&#34;</span> <span class="na">enableCountByExample=</span><span class="s">&#34;false&#34;</span>
               <span class="na">enableUpdateByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableDeleteByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableSelectByExample=</span><span class="s">&#34;true&#34;</span>
               <span class="na">selectByExampleQueryId=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;my.isgen.usekeys&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;useActualColumnNames&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;generatedKey</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span> <span class="na">sqlStatement=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;/table&gt;</span>

        <span class="nt">&lt;table</span> <span class="na">tableName=</span><span class="s">&#34;property&#34;</span> <span class="na">domainObjectName=</span><span class="s">&#34;Property&#34;</span> <span class="na">enableCountByExample=</span><span class="s">&#34;false&#34;</span>
               <span class="na">enableUpdateByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableDeleteByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableSelectByExample=</span><span class="s">&#34;true&#34;</span>
               <span class="na">selectByExampleQueryId=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;my.isgen.usekeys&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;useActualColumnNames&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;generatedKey</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span> <span class="na">sqlStatement=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

        <span class="nt">&lt;table</span> <span class="na">tableName=</span><span class="s">&#34;product&#34;</span> <span class="na">domainObjectName=</span><span class="s">&#34;Product&#34;</span> <span class="na">enableCountByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableUpdateByExample=</span><span class="s">&#34;false&#34;</span>
               <span class="na">enableDeleteByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableSelectByExample=</span><span class="s">&#34;true&#34;</span> <span class="na">selectByExampleQueryId=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;my.isgen.usekeys&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;useActualColumnNames&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;generatedKey</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span> <span class="na">sqlStatement=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

        <span class="nt">&lt;table</span> <span class="na">tableName=</span><span class="s">&#34;productImage&#34;</span> <span class="na">domainObjectName=</span><span class="s">&#34;ProductImage&#34;</span> <span class="na">enableCountByExample=</span><span class="s">&#34;false&#34;</span>
               <span class="na">enableUpdateByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableDeleteByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableSelectByExample=</span><span class="s">&#34;true&#34;</span>
               <span class="na">selectByExampleQueryId=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;my.isgen.usekeys&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;useActualColumnNames&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;generatedKey</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span> <span class="na">sqlStatement=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

        <span class="nt">&lt;table</span> <span class="na">tableName=</span><span class="s">&#34;order_&#34;</span> <span class="na">domainObjectName=</span><span class="s">&#34;Order&#34;</span> <span class="na">enableCountByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableUpdateByExample=</span><span class="s">&#34;false&#34;</span>
               <span class="na">enableDeleteByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableSelectByExample=</span><span class="s">&#34;true&#34;</span> <span class="na">selectByExampleQueryId=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;my.isgen.usekeys&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;useActualColumnNames&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;generatedKey</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span> <span class="na">sqlStatement=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

        <span class="nt">&lt;table</span> <span class="na">tableName=</span><span class="s">&#34;propertyValue&#34;</span> <span class="na">domainObjectName=</span><span class="s">&#34;PropertyValue&#34;</span> <span class="na">enableCountByExample=</span><span class="s">&#34;false&#34;</span>
               <span class="na">enableUpdateByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableDeleteByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableSelectByExample=</span><span class="s">&#34;true&#34;</span>
               <span class="na">selectByExampleQueryId=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;my.isgen.usekeys&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;useActualColumnNames&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;generatedKey</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span> <span class="na">sqlStatement=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

        <span class="nt">&lt;table</span> <span class="na">tableName=</span><span class="s">&#34;review&#34;</span> <span class="na">domainObjectName=</span><span class="s">&#34;Review&#34;</span> <span class="na">enableCountByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableUpdateByExample=</span><span class="s">&#34;false&#34;</span>
               <span class="na">enableDeleteByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableSelectByExample=</span><span class="s">&#34;true&#34;</span> <span class="na">selectByExampleQueryId=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;my.isgen.usekeys&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;useActualColumnNames&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;generatedKey</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span> <span class="na">sqlStatement=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

        <span class="nt">&lt;table</span> <span class="na">tableName=</span><span class="s">&#34;user&#34;</span> <span class="na">domainObjectName=</span><span class="s">&#34;User&#34;</span> <span class="na">enableCountByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableUpdateByExample=</span><span class="s">&#34;false&#34;</span>
               <span class="na">enableDeleteByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableSelectByExample=</span><span class="s">&#34;true&#34;</span> <span class="na">selectByExampleQueryId=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;my.isgen.usekeys&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;useActualColumnNames&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;generatedKey</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span> <span class="na">sqlStatement=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

        <span class="nt">&lt;table</span> <span class="na">tableName=</span><span class="s">&#34;orderItem&#34;</span> <span class="na">domainObjectName=</span><span class="s">&#34;OrderItem&#34;</span> <span class="na">enableCountByExample=</span><span class="s">&#34;false&#34;</span>
               <span class="na">enableUpdateByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableDeleteByExample=</span><span class="s">&#34;false&#34;</span> <span class="na">enableSelectByExample=</span><span class="s">&#34;true&#34;</span>
               <span class="na">selectByExampleQueryId=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;my.isgen.usekeys&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;useActualColumnNames&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;generatedKey</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span> <span class="na">sqlStatement=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/table&gt;</span>

    <span class="nt">&lt;/context&gt;</span>
<span class="nt">&lt;/generatorConfiguration&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>新增工具类MybatisGenerator</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.mybatis.generator.api.MyBatisGenerator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.generator.config.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.generator.config.xml.ConfigurationParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.generator.exception.InvalidConfigurationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.generator.exception.XMLParserException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.generator.internal.DefaultShellCallback</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.ParseException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-20
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MybatisGenerator</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ParseException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">XMLParserException</span><span class="o">,</span> <span class="n">InvalidConfigurationException</span><span class="o">,</span> <span class="n">SQLException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">today</span> <span class="o">=</span> <span class="s">&#34;2020-05-20&#34;</span><span class="o">;</span>

        <span class="n">SimpleDateFormat</span> <span class="n">simpleDateFormat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyy-MM-dd&#34;</span><span class="o">);</span>
        <span class="n">Date</span> <span class="n">now</span> <span class="o">=</span> <span class="n">simpleDateFormat</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">today</span><span class="o">);</span>
        <span class="n">Date</span> <span class="n">d</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">d</span><span class="o">.</span><span class="na">getTime</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">now</span><span class="o">.</span><span class="na">getTime</span><span class="o">()</span> <span class="o">+</span> <span class="n">1000</span> <span class="o">*</span> <span class="n">60</span> <span class="o">*</span> <span class="n">60</span> <span class="o">*</span> <span class="n">24</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;————未成功运行————&#34;</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;————未成功运行————&#34;</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;本程序具有破坏作用，只能运行一次，如果必须运行，需要修改today变量为今天，如：&#34;</span>
                    <span class="o">+</span> <span class="n">simpleDateFormat</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">()));</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="kc">false</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">warnings</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">boolean</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

        <span class="kd">final</span> <span class="n">ClassLoader</span> <span class="n">classLoader</span> <span class="o">=</span> <span class="n">MybatisGenerator</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">();</span>
        <span class="kd">final</span> <span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">classLoader</span><span class="o">.</span><span class="na">getResource</span><span class="o">(</span><span class="s">&#34;generatorConfig.xml&#34;</span><span class="o">).</span><span class="na">openStream</span><span class="o">();</span>
        <span class="kd">final</span> <span class="n">ConfigurationParser</span> <span class="n">configurationParser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConfigurationParser</span><span class="o">(</span><span class="n">warnings</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">Configuration</span> <span class="n">configuration</span> <span class="o">=</span> <span class="n">configurationParser</span><span class="o">.</span><span class="na">parseConfiguration</span><span class="o">(</span><span class="n">inputStream</span><span class="o">);</span>
        <span class="n">inputStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

        <span class="kd">final</span> <span class="n">DefaultShellCallback</span> <span class="n">defaultShellCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultShellCallback</span><span class="o">(</span><span class="n">overwrite</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">MyBatisGenerator</span> <span class="n">myBatisGenerator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyBatisGenerator</span><span class="o">(</span><span class="n">configuration</span><span class="o">,</span> <span class="n">defaultShellCallback</span><span class="o">,</span> <span class="n">warnings</span><span class="o">);</span>
        <span class="n">myBatisGenerator</span><span class="o">.</span><span class="na">generate</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;生成代码成功，只执行一次，以后执行会覆盖掉mapper，pojo，xml等文件上做的修改&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="23-编写源代码">2.3 编写源代码</h2>
<p>逆向工程中，已经自动生成对应的pojo，mapper和mapper.xml文件，接下来需要编写service和controller</p>
<h3 id="231-逆向工程生成的代码">2.3.1 逆向工程生成的代码</h3>
<p><strong>pojo.Category</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Category</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">name</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>pojo.CategoryExample</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CategoryExample</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="n">String</span> <span class="n">orderByClause</span><span class="o">;</span>
 
    <span class="kd">protected</span> <span class="kt">boolean</span> <span class="n">distinct</span><span class="o">;</span>
 
    <span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Criteria</span><span class="o">&gt;</span> <span class="n">oredCriteria</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="nf">CategoryExample</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">oredCriteria</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Criteria</span><span class="o">&gt;();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrderByClause</span><span class="o">(</span><span class="n">String</span> <span class="n">orderByClause</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">orderByClause</span> <span class="o">=</span> <span class="n">orderByClause</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getOrderByClause</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderByClause</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDistinct</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">distinct</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">distinct</span> <span class="o">=</span> <span class="n">distinct</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isDistinct</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">distinct</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Criteria</span><span class="o">&gt;</span> <span class="nf">getOredCriteria</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">oredCriteria</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">or</span><span class="o">(</span><span class="n">Criteria</span> <span class="n">criteria</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">oredCriteria</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">criteria</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">or</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Criteria</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">createCriteriaInternal</span><span class="o">();</span>
        <span class="n">oredCriteria</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">criteria</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">criteria</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">createCriteria</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Criteria</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">createCriteriaInternal</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">oredCriteria</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">oredCriteria</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">criteria</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">criteria</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">protected</span> <span class="n">Criteria</span> <span class="nf">createCriteriaInternal</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Criteria</span> <span class="n">criteria</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Criteria</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">criteria</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">oredCriteria</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="n">orderByClause</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">distinct</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">GeneratedCriteria</span> <span class="o">{</span>
        <span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Criterion</span><span class="o">&gt;</span> <span class="n">criteria</span><span class="o">;</span>
 
        <span class="kd">protected</span> <span class="nf">GeneratedCriteria</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">();</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Criterion</span><span class="o">&gt;();</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">criteria</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Criterion</span><span class="o">&gt;</span> <span class="nf">getAllCriteria</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">criteria</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Criterion</span><span class="o">&gt;</span> <span class="nf">getCriteria</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">criteria</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">addCriterion</span><span class="o">(</span><span class="n">String</span> <span class="n">condition</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">condition</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&#34;Value for condition cannot be null&#34;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">criteria</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Criterion</span><span class="o">(</span><span class="n">condition</span><span class="o">));</span>
        <span class="o">}</span>
 
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">addCriterion</span><span class="o">(</span><span class="n">String</span> <span class="n">condition</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">,</span> <span class="n">String</span> <span class="n">property</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&#34;Value for &#34;</span> <span class="o">+</span> <span class="n">property</span> <span class="o">+</span> <span class="s">&#34; cannot be null&#34;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">criteria</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Criterion</span><span class="o">(</span><span class="n">condition</span><span class="o">,</span> <span class="n">value</span><span class="o">));</span>
        <span class="o">}</span>
 
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">addCriterion</span><span class="o">(</span><span class="n">String</span> <span class="n">condition</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value1</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value2</span><span class="o">,</span> <span class="n">String</span> <span class="n">property</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">value1</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">value2</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&#34;Between values for &#34;</span> <span class="o">+</span> <span class="n">property</span> <span class="o">+</span> <span class="s">&#34; cannot be null&#34;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">criteria</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Criterion</span><span class="o">(</span><span class="n">condition</span><span class="o">,</span> <span class="n">value1</span><span class="o">,</span> <span class="n">value2</span><span class="o">));</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andIdIsNull</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;id is null&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andIdIsNotNull</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;id is not null&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andIdEqualTo</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;id =&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andIdNotEqualTo</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;id &lt;&gt;&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andIdGreaterThan</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;id &gt;&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andIdGreaterThanOrEqualTo</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;id &gt;=&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andIdLessThan</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;id &lt;&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andIdLessThanOrEqualTo</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;id &lt;=&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andIdIn</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;id in&#34;</span><span class="o">,</span> <span class="n">values</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andIdNotIn</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;id not in&#34;</span><span class="o">,</span> <span class="n">values</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andIdBetween</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value1</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">value2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;id between&#34;</span><span class="o">,</span> <span class="n">value1</span><span class="o">,</span> <span class="n">value2</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andIdNotBetween</span><span class="o">(</span><span class="n">Integer</span> <span class="n">value1</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">value2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;id not between&#34;</span><span class="o">,</span> <span class="n">value1</span><span class="o">,</span> <span class="n">value2</span><span class="o">,</span> <span class="s">&#34;id&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameIsNull</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name is null&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameIsNotNull</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name is not null&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameEqualTo</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name =&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameNotEqualTo</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name &lt;&gt;&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameGreaterThan</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name &gt;&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameGreaterThanOrEqualTo</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name &gt;=&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameLessThan</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name &lt;&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameLessThanOrEqualTo</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name &lt;=&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameLike</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name like&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameNotLike</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name not like&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameIn</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name in&#34;</span><span class="o">,</span> <span class="n">values</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameNotIn</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name not in&#34;</span><span class="o">,</span> <span class="n">values</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameBetween</span><span class="o">(</span><span class="n">String</span> <span class="n">value1</span><span class="o">,</span> <span class="n">String</span> <span class="n">value2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name between&#34;</span><span class="o">,</span> <span class="n">value1</span><span class="o">,</span> <span class="n">value2</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Criteria</span> <span class="nf">andNameNotBetween</span><span class="o">(</span><span class="n">String</span> <span class="n">value1</span><span class="o">,</span> <span class="n">String</span> <span class="n">value2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addCriterion</span><span class="o">(</span><span class="s">&#34;name not between&#34;</span><span class="o">,</span> <span class="n">value1</span><span class="o">,</span> <span class="n">value2</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">Criteria</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Criteria</span> <span class="kd">extends</span> <span class="n">GeneratedCriteria</span> <span class="o">{</span>
 
        <span class="kd">protected</span> <span class="nf">Criteria</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Criterion</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">condition</span><span class="o">;</span>
 
        <span class="kd">private</span> <span class="n">Object</span> <span class="n">value</span><span class="o">;</span>
 
        <span class="kd">private</span> <span class="n">Object</span> <span class="n">secondValue</span><span class="o">;</span>
 
        <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">noValue</span><span class="o">;</span>
 
        <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">singleValue</span><span class="o">;</span>
 
        <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">betweenValue</span><span class="o">;</span>
 
        <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">listValue</span><span class="o">;</span>
 
        <span class="kd">private</span> <span class="n">String</span> <span class="n">typeHandler</span><span class="o">;</span>
 
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCondition</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">condition</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getSecondValue</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">secondValue</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isNoValue</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">noValue</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSingleValue</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">singleValue</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isBetweenValue</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">betweenValue</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isListValue</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">listValue</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTypeHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">typeHandler</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">protected</span> <span class="nf">Criterion</span><span class="o">(</span><span class="n">String</span> <span class="n">condition</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">();</span>
            <span class="k">this</span><span class="o">.</span><span class="na">condition</span> <span class="o">=</span> <span class="n">condition</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">typeHandler</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">noValue</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">protected</span> <span class="nf">Criterion</span><span class="o">(</span><span class="n">String</span> <span class="n">condition</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">,</span> <span class="n">String</span> <span class="n">typeHandler</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">();</span>
            <span class="k">this</span><span class="o">.</span><span class="na">condition</span> <span class="o">=</span> <span class="n">condition</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">typeHandler</span> <span class="o">=</span> <span class="n">typeHandler</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">List</span><span class="o">&lt;?&gt;)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">listValue</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">singleValue</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="kd">protected</span> <span class="nf">Criterion</span><span class="o">(</span><span class="n">String</span> <span class="n">condition</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">(</span><span class="n">condition</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="kd">protected</span> <span class="nf">Criterion</span><span class="o">(</span><span class="n">String</span> <span class="n">condition</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">,</span> <span class="n">Object</span> <span class="n">secondValue</span><span class="o">,</span> <span class="n">String</span> <span class="n">typeHandler</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">();</span>
            <span class="k">this</span><span class="o">.</span><span class="na">condition</span> <span class="o">=</span> <span class="n">condition</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">secondValue</span> <span class="o">=</span> <span class="n">secondValue</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">typeHandler</span> <span class="o">=</span> <span class="n">typeHandler</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">betweenValue</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="kd">protected</span> <span class="nf">Criterion</span><span class="o">(</span><span class="n">String</span> <span class="n">condition</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">,</span> <span class="n">Object</span> <span class="n">secondValue</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">(</span><span class="n">condition</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">secondValue</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>mapper.CategoryMapper</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.mapper</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.CategoryExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CategoryMapper</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="nf">deleteByPrimaryKey</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">);</span>
 
    <span class="kt">int</span> <span class="nf">insert</span><span class="o">(</span><span class="n">Category</span> <span class="n">record</span><span class="o">);</span>
 
    <span class="kt">int</span> <span class="nf">insertSelective</span><span class="o">(</span><span class="n">Category</span> <span class="n">record</span><span class="o">);</span>
 
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="nf">selectByExample</span><span class="o">(</span><span class="n">CategoryExample</span> <span class="n">example</span><span class="o">);</span>
 
    <span class="n">Category</span> <span class="nf">selectByPrimaryKey</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">);</span>
 
    <span class="kt">int</span> <span class="nf">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">Category</span> <span class="n">record</span><span class="o">);</span>
 
    <span class="kt">int</span> <span class="nf">updateByPrimaryKey</span><span class="o">(</span><span class="n">Category</span> <span class="n">record</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>resources目录下的mapper/CategoryMapper.xml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&#34;com.qqlin.tmall.mapper.CategoryMapper&#34;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;BaseResultMap&#34;</span> <span class="na">type=</span><span class="s">&#34;com.qqlin.tmall.pojo.Category&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span> <span class="na">jdbcType=</span><span class="s">&#34;INTEGER&#34;</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">&#34;name&#34;</span> <span class="na">jdbcType=</span><span class="s">&#34;VARCHAR&#34;</span> <span class="na">property=</span><span class="s">&#34;name&#34;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/resultMap&gt;</span>
  <span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">&#34;Example_Where_Clause&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;where&gt;</span>
      <span class="nt">&lt;foreach</span> <span class="na">collection=</span><span class="s">&#34;oredCriteria&#34;</span> <span class="na">item=</span><span class="s">&#34;criteria&#34;</span> <span class="na">separator=</span><span class="s">&#34;or&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;criteria.valid&#34;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;trim</span> <span class="na">prefix=</span><span class="s">&#34;(&#34;</span> <span class="na">prefixOverrides=</span><span class="s">&#34;and&#34;</span> <span class="na">suffix=</span><span class="s">&#34;)&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;foreach</span> <span class="na">collection=</span><span class="s">&#34;criteria.criteria&#34;</span> <span class="na">item=</span><span class="s">&#34;criterion&#34;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;choose&gt;</span>
                <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&#34;criterion.noValue&#34;</span><span class="nt">&gt;</span>
                  and ${criterion.condition}
                <span class="nt">&lt;/when&gt;</span>
                <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&#34;criterion.singleValue&#34;</span><span class="nt">&gt;</span>
                  and ${criterion.condition} #{criterion.value}
                <span class="nt">&lt;/when&gt;</span>
                <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&#34;criterion.betweenValue&#34;</span><span class="nt">&gt;</span>
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                <span class="nt">&lt;/when&gt;</span>
                <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&#34;criterion.listValue&#34;</span><span class="nt">&gt;</span>
                  and ${criterion.condition}
                  <span class="nt">&lt;foreach</span> <span class="na">close=</span><span class="s">&#34;)&#34;</span> <span class="na">collection=</span><span class="s">&#34;criterion.value&#34;</span> <span class="na">item=</span><span class="s">&#34;listItem&#34;</span> <span class="na">open=</span><span class="s">&#34;(&#34;</span> <span class="na">separator=</span><span class="s">&#34;,&#34;</span><span class="nt">&gt;</span>
                    #{listItem}
                  <span class="nt">&lt;/foreach&gt;</span>
                <span class="nt">&lt;/when&gt;</span>
              <span class="nt">&lt;/choose&gt;</span>
            <span class="nt">&lt;/foreach&gt;</span>
          <span class="nt">&lt;/trim&gt;</span>
        <span class="nt">&lt;/if&gt;</span>
      <span class="nt">&lt;/foreach&gt;</span>
    <span class="nt">&lt;/where&gt;</span>
  <span class="nt">&lt;/sql&gt;</span>
  <span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">&#34;Base_Column_List&#34;</span><span class="nt">&gt;</span>
    id, name
  <span class="nt">&lt;/sql&gt;</span>
  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectByExample&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;com.qqlin.tmall.pojo.CategoryExample&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;BaseResultMap&#34;</span><span class="nt">&gt;</span>
    select
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;distinct&#34;</span><span class="nt">&gt;</span>
      distinct
    <span class="nt">&lt;/if&gt;</span>
    &#39;false&#39; as QUERYID,
    <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&#34;Base_Column_List&#34;</span> <span class="nt">/&gt;</span>
    from category
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;_parameter != null&#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&#34;Example_Where_Clause&#34;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;orderByClause != null&#34;</span><span class="nt">&gt;</span>
      order by ${orderByClause}
    <span class="nt">&lt;/if&gt;</span>
  <span class="nt">&lt;/select&gt;</span>
  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectByPrimaryKey&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;java.lang.Integer&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;BaseResultMap&#34;</span><span class="nt">&gt;</span>
    select
    <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&#34;Base_Column_List&#34;</span> <span class="nt">/&gt;</span>
    from category
    where id = #{id,jdbcType=INTEGER}
  <span class="nt">&lt;/select&gt;</span>
  <span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">&#34;deleteByPrimaryKey&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;java.lang.Integer&#34;</span><span class="nt">&gt;</span>
    delete from category
    where id = #{id,jdbcType=INTEGER}
  <span class="nt">&lt;/delete&gt;</span>
  <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&#34;insert&#34;</span> <span class="na">keyColumn=</span><span class="s">&#34;id&#34;</span> <span class="na">keyProperty=</span><span class="s">&#34;id&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;com.qqlin.tmall.pojo.Category&#34;</span> <span class="na">useGeneratedKeys=</span><span class="s">&#34;true&#34;</span><span class="nt">&gt;</span>
    insert into category (name)
    values (#{name,jdbcType=VARCHAR})
  <span class="nt">&lt;/insert&gt;</span>
  <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&#34;insertSelective&#34;</span> <span class="na">keyColumn=</span><span class="s">&#34;id&#34;</span> <span class="na">keyProperty=</span><span class="s">&#34;id&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;com.qqlin.tmall.pojo.Category&#34;</span> <span class="na">useGeneratedKeys=</span><span class="s">&#34;true&#34;</span><span class="nt">&gt;</span>
    insert into category
    <span class="nt">&lt;trim</span> <span class="na">prefix=</span><span class="s">&#34;(&#34;</span> <span class="na">suffix=</span><span class="s">&#34;)&#34;</span> <span class="na">suffixOverrides=</span><span class="s">&#34;,&#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;name != null&#34;</span><span class="nt">&gt;</span>
        name,
      <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/trim&gt;</span>
    <span class="nt">&lt;trim</span> <span class="na">prefix=</span><span class="s">&#34;values (&#34;</span> <span class="na">suffix=</span><span class="s">&#34;)&#34;</span> <span class="na">suffixOverrides=</span><span class="s">&#34;,&#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;name != null&#34;</span><span class="nt">&gt;</span>
        #{name,jdbcType=VARCHAR},
      <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/trim&gt;</span>
  <span class="nt">&lt;/insert&gt;</span>
  <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&#34;updateByPrimaryKeySelective&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;com.qqlin.tmall.pojo.Category&#34;</span><span class="nt">&gt;</span>
    update category
    <span class="nt">&lt;set&gt;</span>
      <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;name != null&#34;</span><span class="nt">&gt;</span>
        name = #{name,jdbcType=VARCHAR},
      <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/set&gt;</span>
    where id = #{id,jdbcType=INTEGER}
  <span class="nt">&lt;/update&gt;</span>
  <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&#34;updateByPrimaryKey&#34;</span> <span class="na">parameterType=</span><span class="s">&#34;com.qqlin.tmall.pojo.Category&#34;</span><span class="nt">&gt;</span>
    update category
    set name = #{name,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  <span class="nt">&lt;/update&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="232-分页查询">2.3.2 分页查询</h3>
<p>新增工具类Page</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.util</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-18
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>

    <span class="c1">//开始页数
</span><span class="c1"></span>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">start</span><span class="o">;</span> 
    <span class="c1">//每页显示个数
</span><span class="c1"></span>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span><span class="o">;</span> 
    <span class="c1">//总个数
</span><span class="c1"></span>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">total</span><span class="o">;</span> 
    <span class="c1">//参数
</span><span class="c1"></span>    <span class="kd">private</span> <span class="n">String</span> <span class="n">param</span><span class="o">;</span> 

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">defaultCount</span> <span class="o">=</span> <span class="n">5</span><span class="o">;</span> <span class="c1">//默认每页显示5条
</span><span class="c1"></span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getStart</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">start</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStart</span><span class="o">(</span><span class="kt">int</span> <span class="n">start</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">start</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">count</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCount</span><span class="o">(</span><span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">count</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">Page</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">defaultCount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">Page</span><span class="o">(</span><span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">start</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">count</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isHasPreviouse</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">start</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isHasNext</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">start</span> <span class="o">==</span> <span class="n">getLast</span><span class="o">())</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getTotalPage</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">totalPage</span><span class="o">;</span>
        <span class="c1">// 假设总数是50，是能够被5整除的，那么就有10页
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">0</span> <span class="o">==</span> <span class="n">total</span> <span class="o">%</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">totalPage</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="n">count</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// 假设总数是51，不能够被5整除的，那么就有11页
</span><span class="c1"></span>        <span class="k">else</span> <span class="o">{</span>
            <span class="n">totalPage</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="n">count</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">0</span> <span class="o">==</span> <span class="n">totalPage</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">totalPage</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">totalPage</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getLast</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">last</span><span class="o">;</span>
        <span class="c1">// 假设总数是50，是能够被5整除的，那么最后一页的开始就是45
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">0</span> <span class="o">==</span> <span class="n">total</span> <span class="o">%</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">count</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// 假设总数是51，不能够被5整除的，那么最后一页的开始就是50
</span><span class="c1"></span>        <span class="k">else</span> <span class="o">{</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">total</span> <span class="o">%</span> <span class="n">count</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">last</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="n">last</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">last</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;Page [start=&#34;</span> <span class="o">+</span> <span class="n">start</span> <span class="o">+</span> <span class="s">&#34;, count=&#34;</span> <span class="o">+</span> <span class="n">count</span> <span class="o">+</span> <span class="s">&#34;, total=&#34;</span> <span class="o">+</span> <span class="n">total</span> <span class="o">+</span> <span class="s">&#34;, getStart()=&#34;</span> <span class="o">+</span> <span class="n">getStart</span><span class="o">()</span>
                <span class="o">+</span> <span class="s">&#34;, getCount()=&#34;</span> <span class="o">+</span> <span class="n">getCount</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;, isHasPreviouse()=&#34;</span> <span class="o">+</span> <span class="n">isHasPreviouse</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;, isHasNext()=&#34;</span>
                <span class="o">+</span> <span class="n">isHasNext</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;, getTotalPage()=&#34;</span> <span class="o">+</span> <span class="n">getTotalPage</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;, getLast()=&#34;</span> <span class="o">+</span> <span class="n">getLast</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getTotal</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">total</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTotal</span><span class="o">(</span><span class="kt">int</span> <span class="n">total</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">total</span> <span class="o">=</span> <span class="n">total</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getParam</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">param</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setParam</span><span class="o">(</span><span class="n">String</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">param</span> <span class="o">=</span> <span class="n">param</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>在Mybatis中使用PageHelper插件</p>
<p>applicationContext.xml</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--Mybatis的SessionFactory配置--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;sqlSession&#34;</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.spring.SqlSessionFactoryBean&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;typeAliasesPackage&#34;</span> <span class="na">value=</span><span class="s">&#34;com.qqlin.tmall.pojo&#34;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;mapperLocations&#34;</span> <span class="na">value=</span><span class="s">&#34;classpath:mapper/*.xml&#34;</span><span class="nt">/&gt;</span>
 
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;plugins&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;array&gt;</span>
                <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.github.pagehelper.PageInterceptor&#34;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;properties&#34;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;value&gt;</span>
                        <span class="nt">&lt;/value&gt;</span>
                    <span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;/bean&gt;</span>
            <span class="nt">&lt;/array&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="233-图片上传">2.3.3 图片上传</h3>
<p>新增工具类UploadedImageFile ，其中有一个MultipartFile 类型的属性，用于接受上传文件的注入。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-18
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UploadedImageFile</span> <span class="o">{</span>
    <span class="n">MultipartFile</span> <span class="n">image</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">MultipartFile</span> <span class="nf">getImage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">image</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setImage</span><span class="o">(</span><span class="n">MultipartFile</span> <span class="n">image</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>新增工具类ImageUtil :</p>
<blockquote>
<ol>
<li>change2jpg
确保图片文件的二进制格式是jpg。<br>
仅仅通过ImageIO.write(img, &ldquo;jpg&rdquo;, file);不足以保证转换出来的jpg文件显示正常。这段转换代码，可以确保转换后jpg的图片显示正常，而不会出现暗红色</li>
<li>后两种resizeImage用于改变图片大小</li>
</ol>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.imageio.ImageIO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.image.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-18
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImageUtil</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">BufferedImage</span> <span class="nf">change2jpg</span><span class="o">(</span><span class="n">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Image</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="o">.</span><span class="na">getDefaultToolkit</span><span class="o">().</span><span class="na">createImage</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
            <span class="n">PixelGrabber</span> <span class="n">pg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PixelGrabber</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="o">-</span><span class="n">1</span><span class="o">,</span> <span class="o">-</span><span class="n">1</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
            <span class="n">pg</span><span class="o">.</span><span class="na">grabPixels</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">height</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="na">getHeight</span><span class="o">();</span>
            <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">RGB_MASKS</span> <span class="o">=</span> <span class="o">{</span><span class="n">0xFF0000</span><span class="o">,</span> <span class="n">0xFF00</span><span class="o">,</span> <span class="n">0xFF</span><span class="o">};</span>
            <span class="kd">final</span> <span class="n">ColorModel</span> <span class="n">RGB_OPAQUE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DirectColorModel</span><span class="o">(</span><span class="n">32</span><span class="o">,</span> <span class="n">RGB_MASKS</span><span class="o">[</span><span class="n">0</span><span class="o">],</span> <span class="n">RGB_MASKS</span><span class="o">[</span><span class="n">1</span><span class="o">],</span> <span class="n">RGB_MASKS</span><span class="o">[</span><span class="n">2</span><span class="o">]);</span>
            <span class="n">DataBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataBufferInt</span><span class="o">((</span><span class="kt">int</span><span class="o">[])</span> <span class="n">pg</span><span class="o">.</span><span class="na">getPixels</span><span class="o">(),</span> <span class="n">pg</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">*</span> <span class="n">pg</span><span class="o">.</span><span class="na">getHeight</span><span class="o">());</span>
            <span class="n">WritableRaster</span> <span class="n">raster</span> <span class="o">=</span> <span class="n">Raster</span><span class="o">.</span><span class="na">createPackedRaster</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="n">RGB_MASKS</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="n">BufferedImage</span> <span class="n">img</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedImage</span><span class="o">(</span><span class="n">RGB_OPAQUE</span><span class="o">,</span> <span class="n">raster</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">img</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">resizeImage</span><span class="o">(</span><span class="n">File</span> <span class="n">srcFile</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">,</span> <span class="n">File</span> <span class="n">destFile</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">destFile</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">exists</span><span class="o">())</span>
                <span class="n">destFile</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">mkdirs</span><span class="o">();</span>
            <span class="n">Image</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ImageIO</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">srcFile</span><span class="o">);</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">resizeImage</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">);</span>
            <span class="n">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">((</span><span class="n">RenderedImage</span><span class="o">)</span> <span class="n">i</span><span class="o">,</span> <span class="s">&#34;jpg&#34;</span><span class="o">,</span> <span class="n">destFile</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// TODO Auto-generated catch block
</span><span class="c1"></span>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Image</span> <span class="nf">resizeImage</span><span class="o">(</span><span class="n">Image</span> <span class="n">srcImage</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>

            <span class="n">BufferedImage</span> <span class="n">buffImg</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="n">buffImg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedImage</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">,</span> <span class="n">BufferedImage</span><span class="o">.</span><span class="na">TYPE_INT_RGB</span><span class="o">);</span>
            <span class="n">buffImg</span><span class="o">.</span><span class="na">getGraphics</span><span class="o">().</span><span class="na">drawImage</span><span class="o">(</span><span class="n">srcImage</span><span class="o">.</span><span class="na">getScaledInstance</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">,</span> <span class="n">Image</span><span class="o">.</span><span class="na">SCALE_SMOOTH</span><span class="o">),</span> <span class="n">0</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

            <span class="k">return</span> <span class="n">buffImg</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// TODO Auto-generated catch block
</span><span class="c1"></span>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="234-分类管理">2.3.4 分类管理</h3>
<h4 id="category的service层">Category的service层</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-18
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CategoryService</span> <span class="o">{</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">();</span>

    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="n">Category</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>接口实现类CategoryServiceImpl</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.CategoryMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.CategoryExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-18
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CategoryServiceImpl</span> <span class="kd">implements</span> <span class="n">CategoryService</span> <span class="o">{</span>

    <span class="kd">final</span>
    <span class="n">CategoryMapper</span> <span class="n">categoryMapper</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CategoryServiceImpl</span><span class="o">(</span><span class="n">CategoryMapper</span> <span class="n">categoryMapper</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">categoryMapper</span> <span class="o">=</span> <span class="n">categoryMapper</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">CategoryExample</span> <span class="n">example</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CategoryExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">categoryMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">categoryMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">categoryMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Category</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">categoryMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">categoryMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="category的controller">Category的Controller</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.ImageUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.UploadedImageFile</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.imageio.ImageIO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.image.BufferedImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-18
</span><span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CategoryController</span> <span class="o">{</span>
    
    <span class="cm">/**
</span><span class="cm">     * 这里没有用@Autowired注入
</span><span class="cm">     * 而使用了构造方法注入
</span><span class="cm">     */</span>
    <span class="kd">final</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CategoryController</span><span class="o">(</span><span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">categoryService</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_category_list&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">Page</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getStart</span><span class="o">(),</span> <span class="n">page</span><span class="o">.</span><span class="na">getCount</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="k">new</span> <span class="n">PageInfo</span><span class="o">&lt;&gt;(</span><span class="n">categories</span><span class="o">).</span><span class="na">getTotal</span><span class="o">();</span>
        <span class="n">page</span><span class="o">.</span><span class="na">setTotal</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">categories</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;page&#34;</span><span class="o">,</span> <span class="n">page</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;admin/listCategory&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_category_add&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">add</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="n">UploadedImageFile</span> <span class="n">uploadedImageFile</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">categoryService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
        <span class="n">File</span> <span class="n">imageFolder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/category&#34;</span><span class="o">));</span>
        <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder</span><span class="o">,</span> <span class="n">category</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;.jpg&#34;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">file</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">mkdirs</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">uploadedImageFile</span><span class="o">.</span><span class="na">getImage</span><span class="o">().</span><span class="na">transferTo</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
        <span class="n">BufferedImage</span> <span class="n">img</span> <span class="o">=</span> <span class="n">ImageUtil</span><span class="o">.</span><span class="na">change2jpg</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
        <span class="n">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">img</span><span class="o">,</span> <span class="s">&#34;jpg&#34;</span><span class="o">,</span> <span class="n">file</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:/admin_category_list&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_category_delete&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">categoryService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>

        <span class="n">File</span> <span class="n">imageFolder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/category&#34;</span><span class="o">));</span>
        <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder</span><span class="o">,</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;.jpg&#34;</span><span class="o">);</span>
        <span class="n">file</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>

        <span class="k">return</span> <span class="s">&#34;redirect:/admin_category_list&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_category_edit&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">edit</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">category</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">category</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;admin/editCategory&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_category_update&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">update</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="n">UploadedImageFile</span> <span class="n">uploadedImageFile</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">categoryService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
        <span class="n">MultipartFile</span> <span class="n">image</span> <span class="o">=</span> <span class="n">uploadedImageFile</span><span class="o">.</span><span class="na">getImage</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">image</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">image</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">File</span> <span class="n">imageFolder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/category&#34;</span><span class="o">));</span>
            <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder</span><span class="o">,</span> <span class="n">category</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;.jpg&#34;</span><span class="o">);</span>
            <span class="n">image</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
            <span class="n">BufferedImage</span> <span class="n">img</span> <span class="o">=</span> <span class="n">ImageUtil</span><span class="o">.</span><span class="na">change2jpg</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
            <span class="n">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">img</span><span class="o">,</span> <span class="s">&#34;jpg&#34;</span><span class="o">,</span> <span class="n">file</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:/admin_category_list&#34;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="category视图listcatrogyjsp">Category视图listCatrogy.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
         pageEncoding=&#34;UTF-8&#34; %&gt;

<span class="err">&lt;</span>%@ taglib uri=&#34;http://java.sun.com/jsp/jstl/core&#34; prefix=&#34;c&#34; %&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/admin/adminHeader.jsp&#34; %&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/admin/adminNavigator.jsp&#34; %&gt;

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#addForm&#34;</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;分类名称&#34;</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="s2">&#34;categoryPic&#34;</span><span class="p">,</span> <span class="s2">&#34;分类图片&#34;</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">});</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>分类管理<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;label label-info&#34;</span><span class="p">&gt;</span>分类管理<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;listDataTableDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;table table-striped table-bordered table-hover  table-condensed&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;success&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>图片<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>分类名称<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>属性管理<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>产品管理<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>编辑<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>删除<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${categories}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;category&#34;</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${category.id}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;40px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/category/${category.id}.jpg&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${category.name}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_property_list?cid=${category.id}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span>
                            <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-th-list&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_product_list?cid=${category.id}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span>
                            <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-shopping-cart&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_category_edit?id=${category.id}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span>
                            <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-edit&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">deleteLink</span><span class="o">=</span><span class="s">&#34;true&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_category_delete?id=${category.id}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span>
                            <span class="na">class</span><span class="o">=</span><span class="s">&#34;   glyphicon glyphicon-trash&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>

                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pageDiv&#34;</span><span class="p">&gt;</span>
        <span class="err">&lt;</span>%@include file=&#34;../include/admin/adminPage.jsp&#34; %&gt;
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-warning addDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>新增分类<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;addForm&#34;</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;admin_category_add&#34;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&#34;multipart/form-data&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addTable&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>分类名称<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>分类圖片<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;categoryPic&#34;</span> <span class="na">accept</span><span class="o">=</span><span class="s">&#34;image/*&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;image&#34;</span><span class="p">/&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitTR&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-success&#34;</span><span class="p">&gt;</span>提 交<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="err">&lt;</span>%@include file=&#34;../include/admin/adminFooter.jsp&#34; %&gt;
</code></pre></td></tr></table>
</div>
</div><h3 id="235-属性管理">2.3.5 属性管理</h3>
<h4 id="property实体类">Property实体类</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Property</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">cid</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
 
    <span class="cm">/*非数据库字段*/</span>
    <span class="kd">private</span> <span class="n">Category</span>  <span class="n">category</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="n">Category</span> <span class="nf">getCategory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">category</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">category</span> <span class="o">=</span> <span class="n">category</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getCid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">cid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">cid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">cid</span> <span class="o">=</span> <span class="n">cid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">name</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="propertyservice">PropertyService</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Property</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-20
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PropertyService</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Property</span> <span class="n">property</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Property</span> <span class="n">property</span><span class="o">);</span>

    <span class="n">Property</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="propertyserviceimpl">PropertyServiceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.PropertyMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Property</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.PropertyExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.PropertyService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-20
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropertyServiceImpl</span> <span class="kd">implements</span> <span class="n">PropertyService</span> <span class="o">{</span>

    <span class="kd">final</span>
    <span class="n">PropertyMapper</span> <span class="n">propertyMapper</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">PropertyServiceImpl</span><span class="o">(</span><span class="n">PropertyMapper</span> <span class="n">propertyMapper</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">propertyMapper</span> <span class="o">=</span> <span class="n">propertyMapper</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Property</span> <span class="n">property</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">property</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Property</span> <span class="n">property</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">property</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Property</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">propertyMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">PropertyExample</span> <span class="n">example</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PropertyExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andCidEqualTo</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">propertyMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="propertycontroller">PropertyController</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Property</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.PropertyService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-20
</span><span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropertyController</span> <span class="o">{</span>

    <span class="kd">final</span>
    <span class="n">PropertyService</span> <span class="n">propertyService</span><span class="o">;</span>

    <span class="kd">final</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">PropertyController</span><span class="o">(</span><span class="n">PropertyService</span> <span class="n">propertyService</span><span class="o">,</span> <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">propertyService</span> <span class="o">=</span> <span class="n">propertyService</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">categoryService</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_property_add&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">add</span><span class="o">(</span><span class="n">Property</span> <span class="n">property</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">property</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:admin_property_list?cid=&#34;</span> <span class="o">+</span> <span class="n">property</span><span class="o">.</span><span class="na">getCid</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_property_delete&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Property</span> <span class="n">property</span> <span class="o">=</span> <span class="n">propertyService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">propertyService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:admin_property_list?cid=&#34;</span> <span class="o">+</span> <span class="n">property</span><span class="o">.</span><span class="na">getCid</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_property_edit&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">edit</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Property</span> <span class="n">property</span> <span class="o">=</span> <span class="n">propertyService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">Category</span> <span class="n">category</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">property</span><span class="o">.</span><span class="na">getCid</span><span class="o">());</span>
        <span class="n">property</span><span class="o">.</span><span class="na">setCategory</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;property&#34;</span><span class="o">,</span> <span class="n">property</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;admin/editProperty&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_property_update&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">update</span><span class="o">(</span><span class="n">Property</span> <span class="n">property</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">property</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:admin_property_list?cid=&#34;</span> <span class="o">+</span> <span class="n">property</span><span class="o">.</span><span class="na">getCid</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_property_list&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">Page</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">category</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>

        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getStart</span><span class="o">(),</span> <span class="n">page</span><span class="o">.</span><span class="na">getCount</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">propertyService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="k">new</span> <span class="n">PageInfo</span><span class="o">&lt;&gt;(</span><span class="n">properties</span><span class="o">).</span><span class="na">getTotal</span><span class="o">();</span>
        <span class="n">page</span><span class="o">.</span><span class="na">setTotal</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
        <span class="n">page</span><span class="o">.</span><span class="na">setParam</span><span class="o">(</span><span class="s">&#34;&amp;cid=&#34;</span> <span class="o">+</span> <span class="n">category</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>

        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;properties&#34;</span><span class="o">,</span> <span class="n">properties</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;category&#34;</span><span class="o">,</span> <span class="n">category</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;page&#34;</span><span class="o">,</span> <span class="n">page</span><span class="o">);</span>

        <span class="k">return</span> <span class="s">&#34;admin/listProperty&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="property视图listpropertyjsp">Property视图listProperty.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
         pageEncoding=&#34;UTF-8&#34; %&gt;

<span class="err">&lt;</span>%@ taglib uri=&#34;http://java.sun.com/jsp/jstl/core&#34; prefix=&#34;c&#34; %&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/admin/adminHeader.jsp&#34; %&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/admin/adminNavigator.jsp&#34; %&gt;

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#addForm&#34;</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">checkEmpty</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;属性名称&#34;</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>属性管理<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;workingArea&#34;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">ol</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;breadcrumb&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_category_list&#34;</span><span class="p">&gt;</span>所有分类<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_property_list?cid=${category.id}&#34;</span><span class="p">&gt;</span>${category.name}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;</span>属性管理<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;listDataTableDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&#34;table table-striped table-bordered table-hover  table-condensed&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;success&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>属性名称<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>编辑<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>删除<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${properties}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;property&#34;</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${property.id}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${property.name}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_property_edit?id=${property.id}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span>
                            <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-edit&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">deleteLink</span><span class="o">=</span><span class="s">&#34;true&#34;</span>
                           <span class="na">href</span><span class="o">=</span><span class="s">&#34;admin_property_delete?id=${property.id}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span>
                            <span class="na">class</span><span class="o">=</span><span class="s">&#34;     glyphicon glyphicon-trash&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>

                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pageDiv&#34;</span><span class="p">&gt;</span>
        <span class="err">&lt;</span>%@include file=&#34;../include/admin/adminPage.jsp&#34; %&gt;
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel panel-warning addDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-heading&#34;</span><span class="p">&gt;</span>新增属性<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;panel-body&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;addForm&#34;</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;admin_property_add&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addTable&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>属性名称<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
                                   <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitTR&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;hidden&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;cid&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${category.id}&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-success&#34;</span><span class="p">&gt;</span>提 交<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="err">&lt;</span>%@include file=&#34;../include/admin/adminFooter.jsp&#34; %&gt;
</code></pre></td></tr></table>
</div>
</div><h3 id="236-产品管理">2.3.6 产品管理</h3>
<h4 id="product实体类">Product实体类</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">subTitle</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Float</span> <span class="n">originalPrice</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Float</span> <span class="n">promotePrice</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">stock</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">cid</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createDate</span><span class="o">;</span>
 
    <span class="cm">/*非数据库字段*/</span>
    <span class="kd">private</span> <span class="n">Category</span>  <span class="n">category</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">ProductImage</span> <span class="n">firstProductImage</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="n">ProductImage</span> <span class="nf">getFirstProductImage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">firstProductImage</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">ProductImage</span> <span class="n">firstProductImage</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">firstProductImage</span> <span class="o">=</span> <span class="n">firstProductImage</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Category</span> <span class="nf">getCategory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">category</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">category</span> <span class="o">=</span> <span class="n">category</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">name</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getSubTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">subTitle</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSubTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">subTitle</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">subTitle</span> <span class="o">=</span> <span class="n">subTitle</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">subTitle</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Float</span> <span class="nf">getOriginalPrice</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">originalPrice</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOriginalPrice</span><span class="o">(</span><span class="n">Float</span> <span class="n">originalPrice</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">originalPrice</span> <span class="o">=</span> <span class="n">originalPrice</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Float</span> <span class="nf">getPromotePrice</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">promotePrice</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPromotePrice</span><span class="o">(</span><span class="n">Float</span> <span class="n">promotePrice</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">promotePrice</span> <span class="o">=</span> <span class="n">promotePrice</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getStock</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">stock</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStock</span><span class="o">(</span><span class="n">Integer</span> <span class="n">stock</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getCid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">cid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">cid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">cid</span> <span class="o">=</span> <span class="n">cid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreateDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreateDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">createDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">createDate</span> <span class="o">=</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productservice">ProductService</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductService</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>
    <span class="n">Product</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productserviceimpl">ProductServiceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.ProductMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.ProductExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-20
</span><span class="cm"> */</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductServiceImpl</span> <span class="kd">implements</span> <span class="n">ProductService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductMapper</span> <span class="n">productMapper</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
 
   <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="n">setCategory</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">){</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">p</span> <span class="o">:</span> <span class="n">ps</span><span class="o">)</span>
            <span class="n">setCategory</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">cid</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">getCid</span><span class="o">();</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setCategory</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ProductExample</span> <span class="n">example</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProductExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andCidEqualTo</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="n">List</span> <span class="n">result</span> <span class="o">=</span> <span class="n">productMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="n">setCategory</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">pis</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">pis</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">ProductImage</span> <span class="n">pi</span> <span class="o">=</span> <span class="n">pis</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
            <span class="n">p</span><span class="o">.</span><span class="na">setFirstProductImage</span><span class="o">(</span><span class="n">pi</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">p</span> <span class="o">:</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productcontroller">ProductController</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page</span><span class="o">;</span>
 
<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-20
</span><span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_product_add&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">add</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:admin_product_list?cid=&#34;</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="na">getCid</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_product_delete&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:admin_product_list?cid=&#34;</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="na">getCid</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_product_edit&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">edit</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getCid</span><span class="o">());</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setCategory</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;admin/editProduct&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_product_update&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">update</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:admin_product_list?cid=&#34;</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="na">getCid</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_product_list&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">Page</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getStart</span><span class="o">(),</span><span class="n">page</span><span class="o">.</span><span class="na">getCount</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
 
        <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="k">new</span> <span class="n">PageInfo</span><span class="o">&lt;&gt;(</span><span class="n">ps</span><span class="o">).</span><span class="na">getTotal</span><span class="o">();</span>
        <span class="n">page</span><span class="o">.</span><span class="na">setTotal</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
        <span class="n">page</span><span class="o">.</span><span class="na">setParam</span><span class="o">(</span><span class="s">&#34;&amp;cid=&#34;</span><span class="o">+</span><span class="n">c</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span> <span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;page&#34;</span><span class="o">,</span> <span class="n">page</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;admin/listProduct&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="237-产品图片管理">2.3.7 产品图片管理</h3>
<h4 id="productimage实体类">ProductImage实体类</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductImage</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">pid</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">type</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getPid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">pid</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">pid</span> <span class="o">=</span> <span class="n">pid</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">type</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setType</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">type</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productimageservice">ProductImageService</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.ProductImage</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-20
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductImageService</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * 提供了两个常量，分别表示单个图片和详情图片
</span><span class="cm">     */</span>
    <span class="n">String</span> <span class="n">type_single</span> <span class="o">=</span> <span class="s">&#34;type_single&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">type_detail</span> <span class="o">=</span> <span class="s">&#34;type_detail&#34;</span><span class="o">;</span>

    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">ProductImage</span> <span class="n">pi</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">ProductImage</span> <span class="n">pi</span><span class="o">);</span>

    <span class="n">ProductImage</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * 根据产品id和图片类型查询的list方法
</span><span class="cm">     * @param pid
</span><span class="cm">     * @param type
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">String</span> <span class="n">type</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productimageserviceimpl">ProductImageServiceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.ProductImageMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.ProductImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.ProductImageExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductImageService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-20
</span><span class="cm"> */</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductImageServiceImpl</span> <span class="kd">implements</span> <span class="n">ProductImageService</span> <span class="o">{</span>

    <span class="kd">final</span>
    <span class="n">ProductImageMapper</span> <span class="n">productImageMapper</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ProductImageServiceImpl</span><span class="o">(</span><span class="n">ProductImageMapper</span> <span class="n">productImageMapper</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">productImageMapper</span> <span class="o">=</span> <span class="n">productImageMapper</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">ProductImage</span> <span class="n">productImage</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productImageMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">productImage</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productImageMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">ProductImage</span> <span class="n">productImage</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productImageMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">productImage</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">ProductImage</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productImageMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ProductImageExample</span> <span class="n">example</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProductImageExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">()</span>
                <span class="o">.</span><span class="na">andPidEqualTo</span><span class="o">(</span><span class="n">pid</span><span class="o">)</span>
                <span class="o">.</span><span class="na">andTypeEqualTo</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">productImageMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productimagecontroller">ProductImageController</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.ProductImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductImageService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.ImageUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.UploadedImageFile</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.imageio.ImageIO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.image.BufferedImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-20
</span><span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductImageController</span> <span class="o">{</span>
    <span class="kd">final</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>

    <span class="kd">final</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ProductImageController</span><span class="o">(</span><span class="n">ProductService</span> <span class="n">productService</span><span class="o">,</span> <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">productService</span> <span class="o">=</span> <span class="n">productService</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">productImageService</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_productImage_add&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">add</span><span class="o">(</span><span class="n">ProductImage</span> <span class="n">productImage</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="n">UploadedImageFile</span> <span class="n">uploadedImageFile</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productImageService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">productImage</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">productImage</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;.jpg&#34;</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">imageFolder</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">imageFolderSmall</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">imageFolderMiddle</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">productImage</span><span class="o">.</span><span class="na">getType</span><span class="o">()))</span> <span class="o">{</span>
            <span class="n">imageFolder</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/productSingle&#34;</span><span class="o">);</span>
            <span class="n">imageFolderSmall</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/productSingle_small&#34;</span><span class="o">);</span>
            <span class="n">imageFolderMiddle</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/productSingle_middle&#34;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">imageFolder</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/productDetail&#34;</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
        <span class="n">file</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">mkdirs</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">uploadedImageFile</span><span class="o">.</span><span class="na">getImage</span><span class="o">().</span><span class="na">transferTo</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
            <span class="n">BufferedImage</span> <span class="n">img</span> <span class="o">=</span> <span class="n">ImageUtil</span><span class="o">.</span><span class="na">change2jpg</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
            <span class="n">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">img</span><span class="o">,</span> <span class="s">&#34;jpg&#34;</span><span class="o">,</span> <span class="n">file</span><span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">productImage</span><span class="o">.</span><span class="na">getType</span><span class="o">()))</span> <span class="o">{</span>
                <span class="n">File</span> <span class="n">fileSmall</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolderSmall</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
                <span class="n">File</span> <span class="n">fileMiddle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolderMiddle</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>

                <span class="n">ImageUtil</span><span class="o">.</span><span class="na">resizeImage</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">56</span><span class="o">,</span> <span class="n">56</span><span class="o">,</span> <span class="n">fileSmall</span><span class="o">);</span>
                <span class="n">ImageUtil</span><span class="o">.</span><span class="na">resizeImage</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">217</span><span class="o">,</span> <span class="n">190</span><span class="o">,</span> <span class="n">fileMiddle</span><span class="o">);</span>
            <span class="o">}</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:admin_productImage_list?pid=&#34;</span> <span class="o">+</span> <span class="n">productImage</span><span class="o">.</span><span class="na">getPid</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_productImage_delete&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">ProductImage</span> <span class="n">productImage</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">productImage</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;.jpg&#34;</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">imageFolder</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">imageFolderSmall</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">imageFolderMiddle</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">productImage</span><span class="o">.</span><span class="na">getType</span><span class="o">()))</span> <span class="o">{</span>
            <span class="n">imageFolder</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/productSingle&#34;</span><span class="o">);</span>
            <span class="n">imageFolderSmall</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/productSingle_small&#34;</span><span class="o">);</span>
            <span class="n">imageFolderMiddle</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/productSingle_middle&#34;</span><span class="o">);</span>
            <span class="n">File</span> <span class="n">imageFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
            <span class="n">File</span> <span class="n">fileSmall</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolderSmall</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
            <span class="n">File</span> <span class="n">fileMiddle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolderMiddle</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>

            <span class="n">imageFile</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
            <span class="n">fileSmall</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
            <span class="n">fileMiddle</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>

        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">imageFolder</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;img/productDetail&#34;</span><span class="o">);</span>
            <span class="n">File</span> <span class="n">imageFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">imageFolder</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
            <span class="n">imageFile</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="n">productImageService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>

        <span class="k">return</span> <span class="s">&#34;redirect:admin_productImage_list?pid=&#34;</span> <span class="o">+</span> <span class="n">productImage</span><span class="o">.</span><span class="na">getPid</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_productImage_list&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">pisSingle</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">pid</span><span class="o">,</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">pisDetail</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">pid</span><span class="o">,</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>

        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">product</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pisSingle&#34;</span><span class="o">,</span> <span class="n">pisSingle</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pisDetail&#34;</span><span class="o">,</span> <span class="n">pisDetail</span><span class="o">);</span>

        <span class="k">return</span> <span class="s">&#34;admin/listProductImage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="238-产品属性值设置">2.3.8 产品属性值设置</h3>
<h4 id="propertyvalue实体类">PropertyValue实体类</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropertyValue</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">pid</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">ptid</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>
 
    <span class="cm">/*非数据库字段*/</span>
    <span class="kd">private</span> <span class="n">Property</span> <span class="n">property</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="n">Property</span> <span class="nf">getProperty</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">property</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">Property</span> <span class="n">property</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">property</span> <span class="o">=</span> <span class="n">property</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getPid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">pid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">pid</span> <span class="o">=</span> <span class="n">pid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getPtid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ptid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPtid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">ptid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">ptid</span> <span class="o">=</span> <span class="n">ptid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="propertyvalueservice">PropertyValueService</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.PropertyValue</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PropertyValueService</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">PropertyValue</span> <span class="n">pv</span><span class="o">);</span>
 
    <span class="n">PropertyValue</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">ptid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="propertyvalueserviceimpl">PropertyValueServiceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.PropertyValueMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Property</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.PropertyValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.PropertyValueExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.PropertyService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.PropertyValueService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropertyValueServiceImpl</span> <span class="kd">implements</span> <span class="n">PropertyValueService</span> <span class="o">{</span>
 
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueMapper</span> <span class="n">propertyValueMapper</span><span class="o">;</span>
 
    <span class="nd">@Autowired</span>
    <span class="n">PropertyService</span> <span class="n">propertyService</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="n">pts</span> <span class="o">=</span> <span class="n">propertyService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getCid</span><span class="o">());</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">Property</span> <span class="n">pt</span><span class="o">:</span> <span class="n">pts</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">PropertyValue</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="n">pt</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">pv</span><span class="o">){</span>
                <span class="n">pv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PropertyValue</span><span class="o">();</span>
                <span class="n">pv</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
                <span class="n">pv</span><span class="o">.</span><span class="na">setPtid</span><span class="o">(</span><span class="n">pt</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
                <span class="n">propertyValueMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">pv</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">PropertyValue</span> <span class="n">pv</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyValueMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">pv</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">PropertyValue</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">ptid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">PropertyValueExample</span> <span class="n">example</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PropertyValueExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andPtidEqualTo</span><span class="o">(</span><span class="n">ptid</span><span class="o">).</span><span class="na">andPidEqualTo</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span><span class="o">=</span> <span class="n">propertyValueMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">pvs</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">pvs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">PropertyValueExample</span> <span class="n">example</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PropertyValueExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andPidEqualTo</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">propertyValueMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">PropertyValue</span> <span class="n">pv</span> <span class="o">:</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Property</span> <span class="n">property</span> <span class="o">=</span> <span class="n">propertyService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pv</span><span class="o">.</span><span class="na">getPtid</span><span class="o">());</span>
            <span class="n">pv</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">property</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="propertyvaluecontroller">PropertyValueController</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.PropertyValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.PropertyValueService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PropertyValueController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_propertyValue_edit&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">edit</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">propertyValueService</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;admin/editPropertyValue&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_propertyValue_update&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">update</span><span class="o">(</span><span class="n">PropertyValue</span> <span class="n">pv</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">propertyValueService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">pv</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="239-用户管理">2.3.9 用户管理</h3>
<h4 id="user实体类">User实体类</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">name</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">password</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAnonymousName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">&#34;*&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="n">2</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34;*&#34;</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kt">char</span><span class="o">[]</span> <span class="n">chars</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">chars</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">chars</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="sc">&#39;*&#39;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">chars</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="userservice">UserService</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">User</span> <span class="n">c</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">c</span><span class="o">);</span>
    <span class="n">User</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="userserviceimpl">UserServiceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.UserMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.UserExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.UserService</span><span class="o">;</span>
 
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceImpl</span> <span class="kd">implements</span> <span class="n">UserService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserMapper</span> <span class="n">userMapper</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">User</span> <span class="n">u</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">u</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">u</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">u</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(){</span>
        <span class="n">UserExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">UserExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
 
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="usercontroller">UserController</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.UserService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
  
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_user_list&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">Page</span> <span class="n">page</span><span class="o">){</span>
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getStart</span><span class="o">(),</span><span class="n">page</span><span class="o">.</span><span class="na">getCount</span><span class="o">());</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">us</span><span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
 
        <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="k">new</span> <span class="n">PageInfo</span><span class="o">&lt;&gt;(</span><span class="n">us</span><span class="o">).</span><span class="na">getTotal</span><span class="o">();</span>
        <span class="n">page</span><span class="o">.</span><span class="na">setTotal</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;us&#34;</span><span class="o">,</span> <span class="n">us</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;page&#34;</span><span class="o">,</span> <span class="n">page</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;admin/listUser&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="2310-订单管理">2.3.10 订单管理</h3>
<h4 id="orderitem实体类">OrderItem实体类</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderItem</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">pid</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">oid</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">uid</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">number</span><span class="o">;</span>
 
    <span class="cm">/*非数据库字段*/</span>
    <span class="kd">private</span> <span class="n">Product</span> <span class="n">product</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getPid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">pid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">pid</span> <span class="o">=</span> <span class="n">pid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getOid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">oid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">oid</span> <span class="o">=</span> <span class="n">oid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getUid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">uid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">uid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">uid</span> <span class="o">=</span> <span class="n">uid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getNumber</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">number</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNumber</span><span class="o">(</span><span class="n">Integer</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProduct</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">product</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProduct</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">product</span> <span class="o">=</span> <span class="n">product</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="order实体类">Order实体类</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderService</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Order</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">orderCode</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">address</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">post</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">receiver</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">mobile</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">userMessage</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createDate</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">payDate</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">deliveryDate</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">confirmDate</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">uid</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">status</span><span class="o">;</span>
 
    <span class="cm">/*如下是非数据库字段*/</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">total</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">totalNumber</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getOrderCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderCode</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrderCode</span><span class="o">(</span><span class="n">String</span> <span class="n">orderCode</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">orderCode</span> <span class="o">=</span> <span class="n">orderCode</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">orderCode</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAddress</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">address</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAddress</span><span class="o">(</span><span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">address</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">address</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPost</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">post</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPost</span><span class="o">(</span><span class="n">String</span> <span class="n">post</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">post</span> <span class="o">=</span> <span class="n">post</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">post</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getReceiver</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">receiver</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setReceiver</span><span class="o">(</span><span class="n">String</span> <span class="n">receiver</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">receiver</span> <span class="o">=</span> <span class="n">receiver</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">receiver</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMobile</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mobile</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMobile</span><span class="o">(</span><span class="n">String</span> <span class="n">mobile</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">mobile</span> <span class="o">=</span> <span class="n">mobile</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">mobile</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUserMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userMessage</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">userMessage</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userMessage</span> <span class="o">=</span> <span class="n">userMessage</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">userMessage</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreateDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreateDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">createDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">createDate</span> <span class="o">=</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getPayDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">payDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPayDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">payDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">payDate</span> <span class="o">=</span> <span class="n">payDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getDeliveryDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">deliveryDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDeliveryDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">deliveryDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">deliveryDate</span> <span class="o">=</span> <span class="n">deliveryDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getConfirmDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">confirmDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setConfirmDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">confirmDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">confirmDate</span> <span class="o">=</span> <span class="n">confirmDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getUid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">uid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">uid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">uid</span> <span class="o">=</span> <span class="n">uid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getStatus</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">status</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStatus</span><span class="o">(</span><span class="n">String</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">status</span> <span class="o">=</span> <span class="n">status</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">status</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">getOrderItems</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderItems</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrderItems</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">orderItems</span> <span class="o">=</span> <span class="n">orderItems</span><span class="o">;</span>
    <span class="o">}</span>
     
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]){</span>
        <span class="n">Order</span> <span class="n">o</span>  <span class="o">=</span> <span class="k">new</span> <span class="n">Order</span><span class="o">();</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">delete</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">getStatusDesc</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getStatusDesc</span><span class="o">(){</span>
        <span class="n">String</span> <span class="n">desc</span> <span class="o">=</span><span class="s">&#34;未知&#34;</span><span class="o">;</span>
        <span class="k">switch</span><span class="o">(</span><span class="n">status</span><span class="o">){</span>
            <span class="k">case</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">waitPay</span><span class="o">:</span>
                <span class="n">desc</span><span class="o">=</span><span class="s">&#34;待付款&#34;</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">waitDelivery</span><span class="o">:</span>
                <span class="n">desc</span><span class="o">=</span><span class="s">&#34;待发货&#34;</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">waitConfirm</span><span class="o">:</span>
                <span class="n">desc</span><span class="o">=</span><span class="s">&#34;待收货&#34;</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">waitReview</span><span class="o">:</span>
                <span class="n">desc</span><span class="o">=</span><span class="s">&#34;等评价&#34;</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">finish</span><span class="o">:</span>
                <span class="n">desc</span><span class="o">=</span><span class="s">&#34;完成&#34;</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">OrderService</span><span class="o">.</span><span class="na">delete</span><span class="o">:</span>
                <span class="n">desc</span><span class="o">=</span><span class="s">&#34;刪除&#34;</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="n">desc</span><span class="o">=</span><span class="s">&#34;未知&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">desc</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">getTotal</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">total</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTotal</span><span class="o">(</span><span class="kt">float</span> <span class="n">total</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">total</span> <span class="o">=</span> <span class="n">total</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getTotalNumber</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">totalNumber</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTotalNumber</span><span class="o">(</span><span class="kt">int</span> <span class="n">totalNumber</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">totalNumber</span> <span class="o">=</span> <span class="n">totalNumber</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="orderitemservice">OrderItemService</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItem</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderItemService</span> <span class="o">{</span>
      
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">c</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">c</span><span class="o">);</span>
    <span class="n">OrderItem</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">();</span>
 
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Order</span> <span class="n">o</span><span class="o">);</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="orderitemserviceimpl">OrderItemServiceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.OrderItemMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItemExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
 
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderItemServiceImpl</span> <span class="kd">implements</span> <span class="n">OrderItemService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemMapper</span> <span class="n">orderItemMapper</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">OrderItem</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OrderItem</span> <span class="n">result</span> <span class="o">=</span> <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">setProduct</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(){</span>
        <span class="n">OrderItemExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderItemExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
 
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Order</span> <span class="n">o</span> <span class="o">:</span> <span class="n">os</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">fill</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Order</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OrderItemExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderItemExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andOidEqualTo</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span><span class="n">orderItemMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="n">setProduct</span><span class="o">(</span><span class="n">ois</span><span class="o">);</span>
 
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">totalNumber</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">total</span><span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">();</span>
            <span class="n">totalNumber</span><span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setTotal</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setTotalNumber</span><span class="o">(</span><span class="n">totalNumber</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setOrderItems</span><span class="o">(</span><span class="n">ois</span><span class="o">);</span>
 
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProduct</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">){</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span><span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setProduct</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setProduct</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getPid</span><span class="o">());</span>
        <span class="n">oi</span><span class="o">.</span><span class="na">setProduct</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="orderservice">OrderService</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderService</span> <span class="o">{</span>
 
    <span class="n">String</span> <span class="n">waitPay</span> <span class="o">=</span> <span class="s">&#34;waitPay&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">waitDelivery</span> <span class="o">=</span> <span class="s">&#34;waitDelivery&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">waitConfirm</span> <span class="o">=</span> <span class="s">&#34;waitConfirm&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">waitReview</span> <span class="o">=</span> <span class="s">&#34;waitReview&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">finish</span> <span class="o">=</span> <span class="s">&#34;finish&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">delete</span> <span class="o">=</span> <span class="s">&#34;delete&#34;</span><span class="o">;</span>
 
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">);</span>
    <span class="n">Order</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="orderserviceimpl">OrderServiceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.OrderMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.UserService</span><span class="o">;</span>
 
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderServiceImpl</span> <span class="kd">implements</span> <span class="n">OrderService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderMapper</span> <span class="n">orderMapper</span><span class="o">;</span>
 
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Order</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(){</span>
        <span class="n">OrderExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span><span class="n">orderMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="n">setUser</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">){</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Order</span> <span class="n">o</span> <span class="o">:</span> <span class="n">os</span><span class="o">)</span>
            <span class="n">setUser</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">Order</span> <span class="n">o</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">uid</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="na">getUid</span><span class="o">();</span>
        <span class="n">User</span> <span class="n">u</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">uid</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="n">u</span><span class="o">);</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="ordercontroller">OrderController</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.util.Page</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_order_list&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">Page</span> <span class="n">page</span><span class="o">){</span>
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getStart</span><span class="o">(),</span><span class="n">page</span><span class="o">.</span><span class="na">getCount</span><span class="o">());</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
 
        <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="k">new</span> <span class="n">PageInfo</span><span class="o">&lt;&gt;(</span><span class="n">os</span><span class="o">).</span><span class="na">getTotal</span><span class="o">();</span>
        <span class="n">page</span><span class="o">.</span><span class="na">setTotal</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
 
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;os&#34;</span><span class="o">,</span> <span class="n">os</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;page&#34;</span><span class="o">,</span> <span class="n">page</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;admin/listOrder&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;admin_order_delivery&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">delivery</span><span class="o">(</span><span class="n">Order</span> <span class="n">o</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setDeliveryDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitConfirm</span><span class="o">);</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:admin_order_list&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="三前台管理">三、前台管理</h1>
<h2 id="31-首页-分类管理">3.1 首页-分类管理</h2>
<blockquote>
<p>那么首页需要什么数据呢？ 从 首页展示需求分析上来看：</p>
<ol>
<li>在横向导航栏上提供4个分类连接</li>
<li>在纵向导航栏上提供全部17个分类连接</li>
<li>当鼠标移动到某一个纵向分类连接的时候，显示这个分类下的推荐产品列表</li>
<li>按照每种分类显示5个商品的方式，显示所有17种分类</li>
</ol>
</blockquote>
<h3 id="category实体类">Category实体类</h3>
<blockquote>
<p>新增两个瞬时字段products和productsByRow。</p>
<p>List<!-- raw HTML omitted --> products;
List&lt;List<!-- raw HTML omitted -->&gt; productsByRow;</p>
<p>productsByRow这个属性的类型是List&lt;List<!-- raw HTML omitted -->&gt; productsByRow。
即一个分类又对应多个 List<!-- raw HTML omitted -->，提供这个属性，是为了在首页竖状导航的分类名称右边显示推荐产品列表。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Category</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
 
    <span class="cm">/*如下是非数据库字段*/</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span> <span class="n">productsByRow</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">name</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">getProducts</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">products</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProducts</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">products</span> <span class="o">=</span> <span class="n">products</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span> <span class="nf">getProductsByRow</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productsByRow</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProductsByRow</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span> <span class="n">productsByRow</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">productsByRow</span> <span class="o">=</span> <span class="n">productsByRow</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="productservice-1">ProductService</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductService</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">);</span>
    <span class="n">Product</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Category</span> <span class="n">c</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">fillByRow</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="productserviceimpl-1">ProductServiceImpl</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.ProductMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.ProductExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.ProductImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductImageService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductServiceImpl</span> <span class="kd">implements</span> <span class="n">ProductService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductMapper</span> <span class="n">productMapper</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="n">setCategory</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">){</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">p</span> <span class="o">:</span> <span class="n">ps</span><span class="o">)</span>
            <span class="n">setCategory</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">cid</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">getCid</span><span class="o">();</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setCategory</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ProductExample</span> <span class="n">example</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProductExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andCidEqualTo</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="n">List</span> <span class="n">result</span> <span class="o">=</span> <span class="n">productMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="n">setCategory</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">pis</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">pis</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">ProductImage</span> <span class="n">pi</span> <span class="o">=</span> <span class="n">pis</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
            <span class="n">p</span><span class="o">.</span><span class="na">setFirstProductImage</span><span class="o">(</span><span class="n">pi</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Category</span> <span class="n">c</span> <span class="o">:</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Category</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">list</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">c</span><span class="o">.</span><span class="na">setProducts</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fillByRow</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">productNumberEachRow</span> <span class="o">=</span> <span class="n">8</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Category</span> <span class="n">c</span> <span class="o">:</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span>  <span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span> <span class="n">productsByRow</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">products</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">+=</span><span class="n">productNumberEachRow</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">productNumberEachRow</span><span class="o">;</span>
                <span class="n">size</span><span class="o">=</span> <span class="n">size</span><span class="o">&gt;</span><span class="n">products</span><span class="o">.</span><span class="na">size</span><span class="o">()?</span><span class="n">products</span><span class="o">.</span><span class="na">size</span><span class="o">():</span><span class="n">size</span><span class="o">;</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">productsOfEachRow</span> <span class="o">=</span><span class="n">products</span><span class="o">.</span><span class="na">subList</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
                <span class="n">productsByRow</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">productsOfEachRow</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">c</span><span class="o">.</span><span class="na">setProductsByRow</span><span class="o">(</span><span class="n">productsByRow</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">p</span> <span class="o">:</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="forecontrollerhome">ForeController.home()</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="视图homejsp">视图home.jsp</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/search.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/home/homePage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><p>header.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@ taglib uri=&#34;http://java.sun.com/jsp/jstl/core&#34; prefix=&#34;c&#34;%&gt;
<span class="err">&lt;</span>%@ taglib uri=&#34;http://java.sun.com/jsp/jstl/fmt&#34; prefix=&#39;fmt&#39; %&gt;
<span class="err">&lt;</span>%@ taglib prefix=&#34;fn&#34; uri=&#34;http://java.sun.com/jsp/jstl/functions&#34; %&gt;
 
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;js/jquery/2.0.0/jquery.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;css/bootstrap/3.3.6/bootstrap.min.css&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;js/bootstrap/3.3.6/bootstrap.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;css/fore/style.css&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kd">function</span> <span class="nx">formatMoney</span><span class="p">(</span><span class="nx">num</span><span class="p">){</span>
    <span class="nx">num</span> <span class="o">=</span> <span class="nx">num</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\$|\,/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span> 
    <span class="k">if</span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">num</span><span class="p">))</span> 
        <span class="nx">num</span> <span class="o">=</span> <span class="s2">&#34;0&#34;</span><span class="p">;</span> 
    <span class="nx">sign</span> <span class="o">=</span> <span class="p">(</span><span class="nx">num</span> <span class="o">==</span> <span class="p">(</span><span class="nx">num</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">num</span><span class="p">)));</span> 
    <span class="nx">num</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">num</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mf">0.50000000001</span><span class="p">);</span> 
    <span class="nx">cents</span> <span class="o">=</span> <span class="nx">num</span><span class="o">%</span><span class="mi">100</span><span class="p">;</span> 
    <span class="nx">num</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">num</span><span class="o">/</span><span class="mi">100</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span> 
    <span class="k">if</span><span class="p">(</span><span class="nx">cents</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">)</span> 
    <span class="nx">cents</span> <span class="o">=</span> <span class="s2">&#34;0&#34;</span> <span class="o">+</span> <span class="nx">cents</span><span class="p">;</span> 
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">num</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nx">i</span><span class="p">))</span><span class="o">/</span><span class="mi">3</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> 
    <span class="nx">num</span> <span class="o">=</span> <span class="nx">num</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">num</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="nx">i</span><span class="o">+</span><span class="mi">3</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span> 
    <span class="nx">num</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">num</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="nx">i</span><span class="o">+</span><span class="mi">3</span><span class="p">));</span> 
    <span class="k">return</span> <span class="p">(((</span><span class="nx">sign</span><span class="p">)</span><span class="o">?</span><span class="s1">&#39;&#39;</span><span class="o">:</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">num</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">cents</span><span class="p">);</span> 
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">checkEmpty</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#&#34;</span><span class="o">+</span><span class="nx">id</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
         
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#&#34;</span><span class="o">+</span><span class="nx">id</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">focus</span><span class="p">();</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
 
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;a.productDetailTopReviewLink&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productReviewDiv&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productDetailDiv&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;a.productReviewTopPartSelectedLink&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productReviewDiv&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productDetailDiv&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>      
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.leaveMessageTextareaSpan&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.leaveMessageImg&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
         
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.leaveMessageTextareaSpan&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.orderItemSumDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;height&#34;</span><span class="p">,</span><span class="s2">&#34;100px&#34;</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div#footer a[href$=#nowhere]&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;模仿天猫的连接，并没有跳转到实际的页面&#34;</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;a.wangwanglink&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;模仿旺旺的图标，并不会打开旺旺&#34;</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;a.notImplementLink&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;这个功能没做，蛤蛤~&#34;</span><span class="p">);</span>
    <span class="p">});</span>
     
<span class="p">});</span>
 
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>top.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
         pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;top &#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;${contextPath}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;color:#C40000;margin:0px&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34; glyphicon glyphicon-home redColor&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        天猫首页
    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>喵，欢迎来天猫<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${!empty user}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;loginPage&#34;</span><span class="p">&gt;</span>${user.name}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forelogout&#34;</span><span class="p">&gt;</span>退出<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${empty user}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;loginPage&#34;</span><span class="p">&gt;</span>请登录<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;registerPage&#34;</span><span class="p">&gt;</span>免费注册<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forebought&#34;</span><span class="p">&gt;</span>我的订单<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forecart&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;color:#C40000;margin:0px&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34; glyphicon glyphicon-shopping-cart redColor&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            购物车<span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>${cartTotalItemNumber}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>件<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
 
<span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>search.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;${contextPath}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;logo&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/logo.gif&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;logo&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;foresearch&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;keyword&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;时尚男鞋  太阳镜 &#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span>  <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchButton&#34;</span><span class="p">&gt;</span>搜索<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchBelow&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${cs}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;c&#34;</span> <span class="na">varStatus</span><span class="o">=</span><span class="s">&#34;st&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count&gt;=5 and st.count&lt;=8}&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forecategory?cid=${c.id}&#34;</span><span class="p">&gt;</span>
                                ${c.name}
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count!=8}&#34;</span><span class="p">&gt;</span>             
                                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>             
                            <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>          
                    <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>     
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>  
</code></pre></td></tr></table>
</div>
</div><p>homePage.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>模仿天猫官网<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;homepageDiv&#34;</span><span class="p">&gt;</span>
    <span class="err">&lt;</span>%@include file=&#34;categoryAndcarousel.jsp&#34;%&gt;
    <span class="err">&lt;</span>%@include file=&#34;homepageCategoryProducts.jsp&#34;%&gt; 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>foorer.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
         pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;modal.jsp&#34; %&gt;
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;footer&#34;</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;footer&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;display: block;&#34;</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;footer_ensure&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;footer_ensure&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/ensure.png&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;horizontal_line&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;footer_desc&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;footer_desc&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumn&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumnTitle&#34;</span><span class="p">&gt;</span>购物指南<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>免费注册<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>开通支付宝<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>支付宝充值<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumn&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumnTitle&#34;</span><span class="p">&gt;</span>天猫保障<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>发票保障<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>售后规则<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>缺货赔付<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumn&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumnTitle&#34;</span><span class="p">&gt;</span>支付方式<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>快捷支付<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>信用卡<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>蚂蚁花呗<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>货到付款<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumn&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumnTitle&#34;</span><span class="p">&gt;</span>商家服务<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>商家入驻<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>商家中心<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>天猫智库<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>天猫规则<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>物流服务<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>喵言喵语<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>运营服务<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumn&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;descColumnTitle&#34;</span><span class="p">&gt;</span>手机天猫<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/ma.png&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;</span>
 
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;copyright&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;copyright&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;coptyrightMiddle&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;cateye&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cateye&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/cateye.png&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;white_link&#34;</span> <span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;padding-left:0px&#34;</span> <span class="p">&gt;</span>关于天猫<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span> 帮助中心<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>开放平台<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  诚聘英才<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>联系我们<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>网站合作<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>法律声明<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>知识产权<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  廉正举报    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;white_link&#34;</span> <span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span>  <span class="na">style</span><span class="o">=</span><span class="s">&#34;padding-left:0px&#34;</span> <span class="p">&gt;</span> 阿里巴巴集团<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span> 淘宝网<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>天猫 <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  聚划算<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>全球速卖通<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>阿里巴巴国际交易市场<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>1688<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>阿里妈妈<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  阿里旅行·去啊 <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  阿里云计算   <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  阿里通信    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  YunOS   <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  阿里旅行·去啊 <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>   万网 <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  高德  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span> 优视   <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  友盟  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  虾米  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  天天动听    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  来往  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  钉钉  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;slash&#34;</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="p">&gt;</span>  支付宝         <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;license&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>增值电信业务经营许可证： 浙B2-20110446<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>网络文化经营许可证：浙网文[2015]0295-065号<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>互联网医疗保健信息服务 审核同意书 浙卫网审【2014】6号 <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>互联网药品信息服务资质证书编号：浙-（经营性）-2012-0005<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;copyRightYear&#34;</span><span class="p">&gt;</span>© 2003-2016 TMALL.COM 版权所有<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/copyRight1.jpg&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/copyRight2.jpg&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>modal.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal &#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;loginModal&#34;</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">&#34;-1&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;dialog&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-dialog loginDivInProductPageModalDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-content&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginDivInProductPage&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginErrorMessageDiv&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;alert alert-danger&#34;</span> <span class="p">&gt;</span>
                              <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;close&#34;</span> <span class="na">data-dismiss</span><span class="o">=</span><span class="s">&#34;alert&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Close&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;errorMessage&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                             
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;login_acount_text&#34;</span><span class="p">&gt;</span>账户登录<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInput &#34;</span> <span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInputIcon &#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34; glyphicon glyphicon-user&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;手机/会员名/邮箱&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">&gt;</span>        
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                         
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInput &#34;</span> <span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInputIcon &#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34; glyphicon glyphicon-lock&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;password&#34;</span>  <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;密码&#34;</span><span class="p">&gt;</span>          
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;text-danger&#34;</span><span class="p">&gt;</span>不要输入真实的天猫账号密码<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>忘记登录密码<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;register.jsp&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span><span class="p">&gt;</span>免费注册<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-top:20px&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-block redButton loginSubmitButton&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>登录<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>   
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;deleteConfirmModal&#34;</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">&#34;-1&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;dialog&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-dialog deleteConfirmModalDiv&#34;</span><span class="p">&gt;</span>
       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-content&#34;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-header&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">data-dismiss</span><span class="o">=</span><span class="s">&#34;modal&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;close&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span>×<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;sr-only&#34;</span><span class="p">&gt;</span>Close<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h4</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-title&#34;</span><span class="p">&gt;</span>确认删除？<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-footer&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">data-dismiss</span><span class="o">=</span><span class="s">&#34;modal&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-default&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span><span class="p">&gt;</span>关闭<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-primary deleteConfirmButton&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span><span class="p">&gt;</span>确认<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="视图homepagejsp">视图homePage.jsp</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>模仿天猫官网<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;homepageDiv&#34;</span><span class="p">&gt;</span>
    <span class="err">&lt;</span>%@include file=&#34;categoryAndcarousel.jsp&#34;%&gt;
    <span class="err">&lt;</span>%@include file=&#34;homepageCategoryProducts.jsp&#34;%&gt; 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>categoryAndcarousel.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kd">function</span> <span class="nx">showProductsAsideCategorys</span><span class="p">(</span><span class="nx">cid</span><span class="p">){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.eachCategory[cid=&#34;</span><span class="o">+</span><span class="nx">cid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;white&#34;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.eachCategory[cid=&#34;</span><span class="o">+</span><span class="nx">cid</span><span class="o">+</span><span class="s2">&#34;] a&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;color&#34;</span><span class="p">,</span><span class="s2">&#34;#87CEFA&#34;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productsAsideCategorys[cid=&#34;</span><span class="o">+</span><span class="nx">cid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
<span class="p">}</span>
 
<span class="kd">function</span> <span class="nx">hideProductsAsideCategorys</span><span class="p">(</span><span class="nx">cid</span><span class="p">){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.eachCategory[cid=&#34;</span><span class="o">+</span><span class="nx">cid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#e2e2e3&#34;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.eachCategory[cid=&#34;</span><span class="o">+</span><span class="nx">cid</span><span class="o">+</span><span class="s2">&#34;] a&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;color&#34;</span><span class="p">,</span><span class="s2">&#34;#000&#34;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productsAsideCategorys[cid=&#34;</span><span class="o">+</span><span class="nx">cid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
<span class="p">}</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.eachCategory&#34;</span><span class="p">).</span><span class="nx">mouseenter</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">cid</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;cid&#34;</span><span class="p">);</span>
        <span class="nx">showProductsAsideCategorys</span><span class="p">(</span><span class="nx">cid</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.eachCategory&#34;</span><span class="p">).</span><span class="nx">mouseleave</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">cid</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;cid&#34;</span><span class="p">);</span>
        <span class="nx">hideProductsAsideCategorys</span><span class="p">(</span><span class="nx">cid</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productsAsideCategorys&#34;</span><span class="p">).</span><span class="nx">mouseenter</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">cid</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;cid&#34;</span><span class="p">);</span>
        <span class="nx">showProductsAsideCategorys</span><span class="p">(</span><span class="nx">cid</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productsAsideCategorys&#34;</span><span class="p">).</span><span class="nx">mouseleave</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">cid</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;cid&#34;</span><span class="p">);</span>
        <span class="nx">hideProductsAsideCategorys</span><span class="p">(</span><span class="nx">cid</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.rightMenu span&#34;</span><span class="p">).</span><span class="nx">mouseenter</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">position</span><span class="p">().</span><span class="nx">left</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">top</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">position</span><span class="p">().</span><span class="nx">top</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;width&#34;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">destLeft</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">left</span><span class="p">)</span> <span class="o">+</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">width</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img#catear&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;left&#34;</span><span class="p">,</span><span class="nx">destLeft</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img#catear&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;top&#34;</span><span class="p">,</span><span class="nx">top</span><span class="o">-</span><span class="mi">20</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img#catear&#34;</span><span class="p">).</span><span class="nx">fadeIn</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
                 
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.rightMenu span&#34;</span><span class="p">).</span><span class="nx">mouseleave</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img#catear&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">});</span>
     
    <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div#carousel-of-product&#34;</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">left</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.categoryMenu&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;left&#34;</span><span class="p">,</span><span class="nx">left</span><span class="o">-</span><span class="mi">20</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.categoryWithCarousel div.head&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;margin-left&#34;</span><span class="p">,</span><span class="nx">left</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productsAsideCategorys&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;left&#34;</span><span class="p">,</span><span class="nx">left</span><span class="o">-</span><span class="mi">20</span><span class="p">);</span>
     
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/catear.png&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;catear&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;catear&#34;</span><span class="p">/&gt;</span>
     
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categoryWithCarousel&#34;</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;headbar show1&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;head &#34;</span><span class="p">&gt;</span>
     
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-left:10px&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-th-list&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-left:10px&#34;</span> <span class="p">&gt;</span>商品分类<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
         
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;rightMenu&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/chaoshi.png&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/guoji.png&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
 
        <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${cs}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;c&#34;</span> <span class="na">varStatus</span><span class="o">=</span><span class="s">&#34;st&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count&lt;=4}&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forecategory?cid=${c.id}&#34;</span><span class="p">&gt;</span>
                    ${c.name}
                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>        
            <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;position: relative&#34;</span><span class="p">&gt;</span>
    <span class="err">&lt;</span>%@include file=&#34;categoryMenu.jsp&#34; %&gt;
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;position: relative;left: 0;top: 0;&#34;</span><span class="p">&gt;</span>
    <span class="err">&lt;</span>%@include file=&#34;productsAsideCategorys.jsp&#34; %&gt;
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
<span class="err">&lt;</span>%@include file=&#34;carousel.jsp&#34; %&gt;
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;carouselBackgroundDiv&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>categoryMenu.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
     
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categoryMenu&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${cs}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;c&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">cid</span><span class="o">=</span><span class="s">&#34;${c.id}&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;eachCategory&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-link&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forecategory?cid=${c.id}&#34;</span><span class="p">&gt;</span>
                    ${c.name}
                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span> 
</code></pre></td></tr></table>
</div>
</div><p>productsAsideCategory.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productsAsideCategorys div.row a&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span><span class="mi">6</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">v</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;color&#34;</span><span class="p">,</span><span class="s2">&#34;#87CEFA&#34;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
 
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${cs}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;c&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">cid</span><span class="o">=</span><span class="s">&#34;${c.id}&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productsAsideCategorys&#34;</span><span class="p">&gt;</span>
      
        <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${c.productsByRow}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;ps&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row show1&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${ps}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;p&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${!empty p.subTitle}&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;foreproduct?pid=${p.id}&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${fn:split(p.subTitle, &#39; &#39;)}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;title&#34;</span> <span class="na">varStatus</span><span class="o">=</span><span class="s">&#34;st&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.index==0}&#34;</span><span class="p">&gt;</span>
                                    ${title}
                                <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;seperator&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>       
        <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>           
<span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>carousel.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
     
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;carousel-of-product&#34;</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;carousel-of-product carousel slide1&#34;</span> <span class="na">data-ride</span><span class="o">=</span><span class="s">&#34;carousel&#34;</span><span class="p">&gt;</span>
  <span class="c">&lt;!-- Indicators --&gt;</span>
  <span class="p">&lt;</span><span class="nt">ol</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;carousel-indicators&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">data-target</span><span class="o">=</span><span class="s">&#34;#carousel-of-product&#34;</span> <span class="na">data-slide-to</span><span class="o">=</span><span class="s">&#34;0&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;active&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">data-target</span><span class="o">=</span><span class="s">&#34;#carousel-of-product&#34;</span> <span class="na">data-slide-to</span><span class="o">=</span><span class="s">&#34;1&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">data-target</span><span class="o">=</span><span class="s">&#34;#carousel-of-product&#34;</span> <span class="na">data-slide-to</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">data-target</span><span class="o">=</span><span class="s">&#34;#carousel-of-product&#34;</span> <span class="na">data-slide-to</span><span class="o">=</span><span class="s">&#34;3&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>
 
  <span class="c">&lt;!-- Wrapper for slides --&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;carousel-inner&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;listbox&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item active&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;carousel carouselImage&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/lunbo/1.jpg&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">img</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;carouselImage&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/lunbo/2.jpg&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;carouselImage&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/lunbo/3.jpg&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;carouselImage&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/lunbo/4.jpg&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
  <span class="c">&lt;!-- Controls --&gt;</span>
<span class="c">&lt;!--   &lt;a class=&#34;left carousel-control&#34; href=&#34;#carousel-of-product&#34; role=&#34;button&#34; data-slide=&#34;prev&#34;&gt; --&gt;</span>
<span class="c">&lt;!--     &lt;span class=&#34;glyphicon glyphicon-chevron-left&#34; aria-hidden=&#34;true&#34;&gt;&lt;/span&gt; --&gt;</span>
 
<span class="c">&lt;!--   &lt;/a&gt; --&gt;</span>
<span class="c">&lt;!--   &lt;a class=&#34;right carousel-control&#34; href=&#34;#carousel-of-product&#34; role=&#34;button&#34; data-slide=&#34;next&#34;&gt; --&gt;</span>
<span class="c">&lt;!--     &lt;span class=&#34;glyphicon glyphicon-chevron-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/span&gt; --&gt;</span>
 
<span class="c">&lt;!--   &lt;/a&gt; --&gt;</span>
 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>   
</code></pre></td></tr></table>
</div>
</div><p>homepageCategoryProducts.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${empty param.categorycount}&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">c:set</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;categorycount&#34;</span> <span class="na">scope</span><span class="o">=</span><span class="s">&#34;page&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;100&#34;</span><span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${!empty param.categorycount}&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">c:set</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;categorycount&#34;</span> <span class="na">scope</span><span class="o">=</span><span class="s">&#34;page&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${param.categorycount}&#34;</span><span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;homepageCategoryProducts&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${cs}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;c&#34;</span> <span class="na">varStatus</span><span class="o">=</span><span class="s">&#34;stc&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${stc.count&lt;=categorycount}&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;eachHomepageCategoryProducts&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;left-mark&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categoryTitle&#34;</span><span class="p">&gt;</span>${c.name}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${c.products}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;p&#34;</span> <span class="na">varStatus</span><span class="o">=</span><span class="s">&#34;st&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count&lt;=5}&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productItem&#34;</span> <span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;foreproduct?pid=${p.id}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;100px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/productSingle_middle/${p.firstProductImage.id}.jpg&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productItemDescLink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;foreproduct?pid=${p.id}&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productItemDesc&#34;</span><span class="p">&gt;</span>[热销]
                                ${fn:substring(p.name, 0, 20)}
                                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productPrice&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${p.promotePrice}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>              
                <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;endpng&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;endpng&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/end.png&#34;</span><span class="p">&gt;</span>
 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="32-前台-无需登录">3.2 前台-无需登录</h2>
<blockquote>
<p>根据模仿天猫的前台功能特点，我们把前台功能分为两部分</p>
<ol>
<li>无需登录
有一些功能，无需登录也可以使用的，比如登录，注册本身，分类页面，查询，产品页面等</li>
<li>需要登录
有一些功能，必须建立在已经登录的基础之上，比如购买，加入购物车，查看购物车，结算页面，订单页面等等。</li>
</ol>
</blockquote>
<h3 id="321-注册">3.2.1 注册</h3>
<h4 id="registerjsp">register.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
     
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/simpleSearch.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/registerPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="pagecontroller">PageController</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PageController</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;registerPage&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">registerPage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;registerSuccessPage&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">registerSuccessPage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/registerSuccess&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;loginPage&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginPage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forealipay&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">alipay</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">&#34;fore/alipay&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="simplesearchjsp">simpleSearch.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;${contextPath}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;simpleLogo&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;simpleLogo&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/simpleLogo.png&#34;</span><span class="p">&gt;</span>   
    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;foresearch&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;simpleSearchDiv pull-right&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;平衡车 原汁机&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;keyword&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchButton&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>搜天猫<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchBelow&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${cs}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;c&#34;</span> <span class="na">varStatus</span><span class="o">=</span><span class="s">&#34;st&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count&gt;=8 and st.count&lt;=11}&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forecategory?cid=${c.id}&#34;</span><span class="p">&gt;</span>
                            ${c.name}
                        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count!=11}&#34;</span><span class="p">&gt;</span>            
                            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>             
                        <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>          
                <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>         
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>registerPage.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
     
    <span class="o">&lt;</span><span class="nx">c</span><span class="o">:</span><span class="k">if</span> <span class="nx">test</span><span class="o">=</span><span class="s2">&#34;${!empty msg}&#34;</span><span class="o">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;${msg}&#34;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.registerErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>      
    <span class="o">&lt;</span><span class="err">/c:if&gt;</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.registerForm&#34;</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#name&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;请输入用户名&#34;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.registerErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>          
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>      
        <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#password&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;请输入密码&#34;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.registerErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>          
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>      
        <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#repeatpassword&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;请输入重复密码&#34;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.registerErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>          
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>      
        <span class="k">if</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#password&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">!=</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#repeatpassword&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">()){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;重复密码不一致&#34;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.registerErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;visibility&#34;</span><span class="p">,</span><span class="s2">&#34;visible&#34;</span><span class="p">);</span>          
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>      
 
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">})</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;foreregister&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerForm&#34;</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerDiv&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerErrorMessageDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;alert alert-danger&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;alert&#34;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;close&#34;</span> <span class="na">data-dismiss</span><span class="o">=</span><span class="s">&#34;alert&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Close&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;errorMessage&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>       
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTable&#34;</span> <span class="na">align</span><span class="o">=</span><span class="s">&#34;center&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTip registerTableLeftTD&#34;</span><span class="p">&gt;</span>设置会员名<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableLeftTD&#34;</span><span class="p">&gt;</span>登陆名<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableRightTD&#34;</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;会员名一旦设置成功，无法修改&#34;</span> <span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTip registerTableLeftTD&#34;</span><span class="p">&gt;</span>设置登陆密码<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableRightTD&#34;</span><span class="p">&gt;</span>登陆时验证，保护账号信息<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>    
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableLeftTD&#34;</span><span class="p">&gt;</span>登陆密码<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableRightTD&#34;</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span>  <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;设置你的登陆密码&#34;</span> <span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableLeftTD&#34;</span><span class="p">&gt;</span>密码确认<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerTableRightTD&#34;</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;repeatpassword&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span>   <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;请再次输入你的密码&#34;</span> <span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                 
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerButtonTD&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;registerSuccess.jsp&#34;</span><span class="p">&gt;&lt;</span><span class="nt">button</span><span class="p">&gt;</span>提   交<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>            
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="userservice-1">UserService</h4>
<p>新增isExist（String name）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">User</span> <span class="n">c</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">c</span><span class="o">);</span>
    <span class="n">User</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">();</span>
    <span class="kt">boolean</span> <span class="nf">isExist</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="userserviceimpl-1">UserServiceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.UserMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.UserExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.UserService</span><span class="o">;</span>
 
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceImpl</span> <span class="kd">implements</span> <span class="n">UserService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserMapper</span> <span class="n">userMapper</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">User</span> <span class="n">u</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">u</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">u</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">u</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(){</span>
        <span class="n">UserExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">UserExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
 
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isExist</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">UserExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">UserExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andNameEqualTo</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">=</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">result</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
 
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerregister">ForeController.register()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>registerSuccess.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/simpleSearch.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/registerSuccessPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><p>registerSuccessPage.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;registerSuccessDiv&#34;</span><span class="p">&gt;</span>
     
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/registerSuccess.png&#34;</span><span class="p">&gt;</span>
            恭喜注册成功
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="322-登录">3.2.2 登录</h3>
<h4 id="loginjsp">login.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/loginPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="userservice-2">UserService</h4>
<p>增加get（String name, String password)方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">User</span> <span class="n">c</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">c</span><span class="o">);</span>
    <span class="n">User</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">();</span>
    <span class="kt">boolean</span> <span class="nf">isExist</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
 
    <span class="n">User</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="userserviceimpl-2">UserServiceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.UserMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.UserExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.UserService</span><span class="o">;</span>
 
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceImpl</span> <span class="kd">implements</span> <span class="n">UserService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserMapper</span> <span class="n">userMapper</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">User</span> <span class="n">u</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">u</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">u</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">u</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(){</span>
        <span class="n">UserExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">UserExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
 
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isExist</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">UserExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">UserExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andNameEqualTo</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">=</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">result</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
 
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">UserExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">UserExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andNameEqualTo</span><span class="o">(</span><span class="n">name</span><span class="o">).</span><span class="na">andPasswordEqualTo</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">=</span> <span class="n">userMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="loginpagejsp">loginPage.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
         pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
 
        <span class="o">&lt;</span><span class="nx">c</span><span class="o">:</span><span class="k">if</span> <span class="nx">test</span><span class="o">=</span><span class="s2">&#34;${!empty msg}&#34;</span><span class="o">&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;${msg}&#34;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="o">&lt;</span><span class="err">/c:if&gt;</span>
 
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;form.loginForm&#34;</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#name&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span><span class="o">||</span><span class="mi">0</span><span class="o">==</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#password&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span><span class="p">){</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;请输入账号密码&#34;</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">});</span>
 
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;form.loginForm input&#34;</span><span class="p">).</span><span class="nx">keyup</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="p">});</span>
 
        <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">162</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginSmallDiv&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;left&#34;</span><span class="p">,</span><span class="nx">left</span><span class="p">);</span>
    <span class="p">})</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;loginDiv&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;position: relative&#34;</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;simpleLogo&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;${contextPath}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/simpleLogo.png&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;loginBackgroundImg&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginBackgroundImg&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/loginBackground.png&#34;</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginForm&#34;</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;forelogin&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;loginSmallDiv&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginSmallDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginErrorMessageDiv&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;alert alert-danger&#34;</span> <span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;button&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;close&#34;</span> <span class="na">data-dismiss</span><span class="o">=</span><span class="s">&#34;alert&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Close&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;errorMessage&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;login_acount_text&#34;</span><span class="p">&gt;</span>账户登录<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInput &#34;</span> <span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInputIcon &#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34; glyphicon glyphicon-user&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;手机/会员名/邮箱&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInput &#34;</span> <span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;loginInputIcon &#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34; glyphicon glyphicon-lock&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;密码&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;text-danger&#34;</span><span class="p">&gt;</span>不要输入真实的天猫账号密码<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
 
            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;notImplementLink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>忘记登录密码<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;registerPage&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span><span class="p">&gt;</span>免费注册<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-top:20px&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-block redButton&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>登录<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>   
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerlogin">ForeController.login()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="323-退出">3.2.3 退出</h3>
<h4 id="forecontrollerlogout">ForeController.logout()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="324-产品页">3.2.4 产品页</h3>
<h4 id="product实体类-1">Product实体类</h4>
<blockquote>
<p>修改Product，增加如下属性</p>
<ol>
<li>
<p>单个产品图片集合</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">pricate</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>详情产品图片集合</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>销量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"> <span class="kd">private</span> <span class="kt">int</span> <span class="n">saleCount</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>累计评价</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">int</span> <span class="n">reviewCount</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">subTitle</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Float</span> <span class="n">originalPrice</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Float</span> <span class="n">promotePrice</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">stock</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">cid</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createDate</span><span class="o">;</span>
 
    <span class="cm">/*非数据库字段*/</span>
    <span class="kd">private</span> <span class="n">Category</span>  <span class="n">category</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">ProductImage</span> <span class="n">firstProductImage</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">saleCount</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">reviewCount</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="n">Category</span> <span class="nf">getCategory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">category</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">category</span> <span class="o">=</span> <span class="n">category</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">name</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getSubTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">subTitle</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSubTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">subTitle</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">subTitle</span> <span class="o">=</span> <span class="n">subTitle</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">subTitle</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Float</span> <span class="nf">getOriginalPrice</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">originalPrice</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOriginalPrice</span><span class="o">(</span><span class="n">Float</span> <span class="n">originalPrice</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">originalPrice</span> <span class="o">=</span> <span class="n">originalPrice</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Float</span> <span class="nf">getPromotePrice</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">promotePrice</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPromotePrice</span><span class="o">(</span><span class="n">Float</span> <span class="n">promotePrice</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">promotePrice</span> <span class="o">=</span> <span class="n">promotePrice</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getStock</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">stock</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStock</span><span class="o">(</span><span class="n">Integer</span> <span class="n">stock</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getCid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">cid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">cid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">cid</span> <span class="o">=</span> <span class="n">cid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreateDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreateDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">createDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">createDate</span> <span class="o">=</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">ProductImage</span> <span class="nf">getFirstProductImage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">firstProductImage</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">ProductImage</span> <span class="n">firstProductImage</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">firstProductImage</span> <span class="o">=</span> <span class="n">firstProductImage</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="nf">getProductSingleImages</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productSingleImages</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProductSingleImages</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">productSingleImages</span> <span class="o">=</span> <span class="n">productSingleImages</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="nf">getProductDetailImages</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">productDetailImages</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProductDetailImages</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">productDetailImages</span> <span class="o">=</span> <span class="n">productDetailImages</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSaleCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">saleCount</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSaleCount</span><span class="o">(</span><span class="kt">int</span> <span class="n">saleCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">saleCount</span> <span class="o">=</span> <span class="n">saleCount</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getReviewCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">reviewCount</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setReviewCount</span><span class="o">(</span><span class="kt">int</span> <span class="n">reviewCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">reviewCount</span> <span class="o">=</span> <span class="n">reviewCount</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="review实体类">Review实体类</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Review</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">uid</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">pid</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="cm">/*非数据库字段*/</span>
    <span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">content</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getUid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">uid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">uid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">uid</span> <span class="o">=</span> <span class="n">uid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getPid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">pid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">pid</span> <span class="o">=</span> <span class="n">pid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getCreateDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreateDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">createDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">createDate</span> <span class="o">=</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="user实体类-1">User实体类</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.pojo</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">name</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">password</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAnonymousName</span><span class="o">(){</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">name</span><span class="o">)</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
 
        <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">length</span><span class="o">()&lt;=</span><span class="n">1</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;*&#34;</span><span class="o">;</span>
 
        <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">length</span><span class="o">()==</span><span class="n">2</span><span class="o">)</span>
            <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">1</span><span class="o">)</span> <span class="o">+</span><span class="s">&#34;*&#34;</span><span class="o">;</span>
 
        <span class="kt">char</span><span class="o">[]</span> <span class="n">cs</span> <span class="o">=</span><span class="n">name</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cs</span><span class="o">.</span><span class="na">length</span><span class="o">-</span><span class="n">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">cs</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="sc">&#39;*&#39;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
 
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="reviewservice">ReviewService</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Review</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ReviewService</span> <span class="o">{</span>
      
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Review</span> <span class="n">c</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Review</span> <span class="n">c</span><span class="o">);</span>
    <span class="n">Review</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">);</span>
 
    <span class="kt">int</span> <span class="nf">getCount</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="reviewserviceimpl">ReviewServiceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.ReviewMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Review</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.ReviewExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ReviewService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.UserService</span><span class="o">;</span>
  
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReviewServiceImpl</span> <span class="kd">implements</span> <span class="n">ReviewService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewMapper</span> <span class="n">reviewMapper</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
  
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Review</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">reviewMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
  
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">reviewMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
  
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Review</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">reviewMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
  
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Review</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">reviewMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
  
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">){</span>
        <span class="n">ReviewExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">ReviewExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andPidEqualTo</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
  
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span><span class="n">reviewMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="n">setUser</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
  
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span><span class="o">){</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Review</span> <span class="n">review</span> <span class="o">:</span> <span class="n">reviews</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setUser</span><span class="o">(</span><span class="n">review</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
  
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">Review</span> <span class="n">review</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">uid</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="na">getUid</span><span class="o">();</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span><span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">uid</span><span class="o">);</span>
        <span class="n">review</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>
  
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">(</span><span class="n">pid</span><span class="o">).</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="orderitemservice-1">OrderItemService</h4>
<p>增加根据产品获取销售量的方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItem</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderItemService</span> <span class="o">{</span>
 
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">c</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">c</span><span class="o">);</span>
    <span class="n">OrderItem</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">();</span>
 
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Order</span> <span class="n">o</span><span class="o">);</span>
 
    <span class="kt">int</span> <span class="nf">getSaleCount</span><span class="o">(</span><span class="kt">int</span>  <span class="n">pid</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="orderitemserciceimpl">OrderItemSerciceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.OrderItemMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItemExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
 
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderItemServiceImpl</span> <span class="kd">implements</span> <span class="n">OrderItemService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemMapper</span> <span class="n">orderItemMapper</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">OrderItem</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OrderItem</span> <span class="n">result</span> <span class="o">=</span> <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">setProduct</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(){</span>
        <span class="n">OrderItemExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderItemExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
 
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Order</span> <span class="n">o</span> <span class="o">:</span> <span class="n">os</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">fill</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Order</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OrderItemExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderItemExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andOidEqualTo</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span><span class="n">orderItemMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="n">setProduct</span><span class="o">(</span><span class="n">ois</span><span class="o">);</span>
 
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">totalNumber</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">total</span><span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">();</span>
            <span class="n">totalNumber</span><span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setTotal</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setTotalNumber</span><span class="o">(</span><span class="n">totalNumber</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setOrderItems</span><span class="o">(</span><span class="n">ois</span><span class="o">);</span>
 
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProduct</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">){</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span><span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setProduct</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setProduct</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getPid</span><span class="o">());</span>
        <span class="n">oi</span><span class="o">.</span><span class="na">setProduct</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSaleCount</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OrderItemExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderItemExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andPidEqualTo</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span><span class="n">orderItemMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span><span class="n">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productservice-2">ProductService</h4>
<p>增加产品设置销量和评价数量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductService</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">);</span>
    <span class="n">Product</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Category</span> <span class="n">c</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">fillByRow</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ProductServiceImpl</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.ProductMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.ProductExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.ProductImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductImageService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ReviewService</span><span class="o">;</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductServiceImpl</span> <span class="kd">implements</span> <span class="n">ProductService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductMapper</span> <span class="n">productMapper</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="n">setCategory</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">){</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">p</span> <span class="o">:</span> <span class="n">ps</span><span class="o">)</span>
            <span class="n">setCategory</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">cid</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">getCid</span><span class="o">();</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setCategory</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ProductExample</span> <span class="n">example</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProductExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andCidEqualTo</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="n">List</span> <span class="n">result</span> <span class="o">=</span> <span class="n">productMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="n">setCategory</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">pis</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">pis</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">ProductImage</span> <span class="n">pi</span> <span class="o">=</span> <span class="n">pis</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
            <span class="n">p</span><span class="o">.</span><span class="na">setFirstProductImage</span><span class="o">(</span><span class="n">pi</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Category</span> <span class="n">c</span> <span class="o">:</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fillByRow</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">productNumberEachRow</span> <span class="o">=</span> <span class="n">8</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Category</span> <span class="n">c</span> <span class="o">:</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span>  <span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span> <span class="n">productsByRow</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">products</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">+=</span><span class="n">productNumberEachRow</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">productNumberEachRow</span><span class="o">;</span>
                <span class="n">size</span><span class="o">=</span> <span class="n">size</span><span class="o">&gt;</span><span class="n">products</span><span class="o">.</span><span class="na">size</span><span class="o">()?</span><span class="n">products</span><span class="o">.</span><span class="na">size</span><span class="o">():</span><span class="n">size</span><span class="o">;</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">productsOfEachRow</span> <span class="o">=</span><span class="n">products</span><span class="o">.</span><span class="na">subList</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
                <span class="n">productsByRow</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">productsOfEachRow</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">c</span><span class="o">.</span><span class="na">setProductsByRow</span><span class="o">(</span><span class="n">productsByRow</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">saleCount</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">getSaleCount</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setSaleCount</span><span class="o">(</span><span class="n">saleCount</span><span class="o">);</span>
 
        <span class="kt">int</span> <span class="n">reviewCount</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">getCount</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setReviewCount</span><span class="o">(</span><span class="n">reviewCount</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">p</span> <span class="o">:</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Category</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">list</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">c</span><span class="o">.</span><span class="na">setProducts</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">p</span> <span class="o">:</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerproduct">ForeController.product()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productjsp">Product.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/simpleSearch.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/product/productPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="productpagejsp">productPage.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>模仿天猫官网 ${p.name}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categoryPictureInProductPageDiv&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categoryPictureInProductPage&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/category/${p.category.id}.jpg&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productPageDiv&#34;</span><span class="p">&gt;</span>
 
    <span class="err">&lt;</span>%@include file=&#34;imgAndInfo.jsp&#34; %&gt;
     
    <span class="err">&lt;</span>%@include file=&#34;productReview.jsp&#34; %&gt;
     
    <span class="err">&lt;</span>%@include file=&#34;productDetail.jsp&#34; %&gt;
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="imgandinfojsp">imgAndInfo.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
 
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">stock</span> <span class="o">=</span> <span class="nx">$</span><span class="p">{</span><span class="nx">p</span><span class="p">.</span><span class="nx">stock</span><span class="p">};</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">keyup</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="nx">num</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">num</span><span class="p">))</span>
            <span class="nx">num</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&gt;</span><span class="nx">stock</span><span class="p">)</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="nx">stock</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.increaseNumber&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="nx">num</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&gt;</span><span class="nx">stock</span><span class="p">)</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="nx">stock</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.decreaseNumber&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="o">--</span><span class="nx">num</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>
            <span class="nx">num</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartLink&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="s2">&#34;forecheckLogin&#34;</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span>
                <span class="nx">page</span><span class="p">,</span>
                <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
                    <span class="k">if</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="o">==</span><span class="nx">result</span><span class="p">){</span>
                        <span class="kd">var</span> <span class="nx">pid</span> <span class="o">=</span> <span class="nx">$</span><span class="p">{</span><span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">};</span>
                        <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
                        <span class="kd">var</span> <span class="nx">addCartpage</span> <span class="o">=</span> <span class="s2">&#34;foreaddCart&#34;</span><span class="p">;</span>
                        <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span>
                                <span class="nx">addCartpage</span><span class="p">,</span>
                                <span class="p">{</span><span class="s2">&#34;pid&#34;</span><span class="o">:</span><span class="nx">pid</span><span class="p">,</span><span class="s2">&#34;num&#34;</span><span class="o">:</span><span class="nx">num</span><span class="p">},</span>
                                <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
                                    <span class="k">if</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="o">==</span><span class="nx">result</span><span class="p">){</span>
                                        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartButton&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;已加入购物车&#34;</span><span class="p">);</span>
                                        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartButton&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;disabled&#34;</span><span class="p">,</span><span class="s2">&#34;disabled&#34;</span><span class="p">);</span>
                                        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartButton&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;lightgray&#34;</span><span class="p">)</span>
                                        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartButton&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;border-color&#34;</span><span class="p">,</span><span class="s2">&#34;lightgray&#34;</span><span class="p">)</span>
                                        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.addCartButton&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;color&#34;</span><span class="p">,</span><span class="s2">&#34;black&#34;</span><span class="p">)</span>
                                         
                                    <span class="p">}</span>
                                    <span class="k">else</span><span class="p">{</span>
                                         
                                    <span class="p">}</span>
                                <span class="p">}</span>
                        <span class="p">);</span>                         
                    <span class="p">}</span>
                    <span class="k">else</span><span class="p">{</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#loginModal&#34;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">);</span>                    
                    <span class="p">}</span>
                <span class="p">}</span>
        <span class="p">);</span>     
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.buyLink&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="s2">&#34;forecheckLogin&#34;</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span>
                <span class="nx">page</span><span class="p">,</span>
                <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
                    <span class="k">if</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="o">==</span><span class="nx">result</span><span class="p">){</span>
                        <span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.productNumberSetting&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
                        <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.buyLink&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;href&#34;</span><span class="p">)</span><span class="o">+</span><span class="s2">&#34;&amp;num=&#34;</span><span class="o">+</span><span class="nx">num</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">else</span><span class="p">{</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#loginModal&#34;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">);</span>                    
                    <span class="p">}</span>
                <span class="p">}</span>
        <span class="p">);</span>     
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.loginSubmitButton&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#name&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#password&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
         
        <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="o">||</span><span class="mi">0</span><span class="o">==</span><span class="nx">password</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;请输入账号密码&#34;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>          
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
         
        <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="s2">&#34;foreloginAjax&#34;</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span>
                <span class="nx">page</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="o">:</span><span class="nx">name</span><span class="p">,</span><span class="s2">&#34;password&#34;</span><span class="o">:</span><span class="nx">password</span><span class="p">},</span>
                <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
                    <span class="k">if</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="o">==</span><span class="nx">result</span><span class="p">){</span>
                        <span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
                    <span class="p">}</span>
                    <span class="k">else</span><span class="p">{</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.errorMessage&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;账号密码错误&#34;</span><span class="p">);</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.loginErrorMessageDiv&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>                      
                    <span class="p">}</span>
                <span class="p">}</span>
        <span class="p">);</span>         
         
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.smallImage&#34;</span><span class="p">).</span><span class="nx">mouseenter</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">bigImageURL</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;bigImageURL&#34;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.bigImg&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="nx">bigImageURL</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.bigImg&#34;</span><span class="p">).</span><span class="nx">load</span><span class="p">(</span>
        <span class="kd">function</span><span class="p">(){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.smallImage&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                <span class="kd">var</span> <span class="nx">bigImageURL</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;bigImageURL&#34;</span><span class="p">);</span>
                <span class="nx">img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
                <span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">bigImageURL</span><span class="p">;</span>
                 
                <span class="nx">img</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">bigImageURL</span><span class="p">);</span>  
                    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.img4load&#34;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">img</span><span class="p">));</span>
                <span class="p">};</span>
            <span class="p">});</span>    
        <span class="p">}</span>
    <span class="p">);</span>
<span class="p">});</span>
 
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;imgAndInfo&#34;</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;imgInimgAndInfo&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/productSingle/${p.firstProductImage.id}.jpg&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;bigImg&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;smallImageDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${p.productSingleImages}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;pi&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/productSingle_small/${pi.id}.jpg&#34;</span> <span class="na">bigImageURL</span><span class="o">=</span><span class="s">&#34;img/productSingle/${pi.id}.jpg&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;smallImage&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;img4load hidden&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;infoInimgAndInfo&#34;</span><span class="p">&gt;</span>
         
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productTitle&#34;</span><span class="p">&gt;</span>
            ${p.name}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productSubTitle&#34;</span><span class="p">&gt;</span>
            ${p.subTitle}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
         
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productPrice&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;juhuasuan&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;juhuasuanBig&#34;</span> <span class="p">&gt;</span>聚划算<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>此商品即将参加聚划算，<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;juhuasuanTime&#34;</span><span class="p">&gt;</span>1天19小时<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>后开始，<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productPriceDiv&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;gouwujuanDiv&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;16px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/gouwujuan.png&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span> 全天猫实物商品通用<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                 
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;originalDiv&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;originalPriceDesc&#34;</span><span class="p">&gt;</span>价格<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;originalPriceYuan&#34;</span><span class="p">&gt;</span>¥<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;originalPrice&#34;</span><span class="p">&gt;</span>
                     
                        <span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${p.originalPrice}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;</span>                   
                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;promotionDiv&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;promotionPriceDesc&#34;</span><span class="p">&gt;</span>促销价 <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;promotionPriceYuan&#34;</span><span class="p">&gt;</span>¥<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;promotionPrice&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${p.promotePrice}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>              
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productSaleAndReviewNumber&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>销量 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;redColor boldWord&#34;</span><span class="p">&gt;</span> ${p.saleCount }<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>累计评价 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;redColor boldWord&#34;</span><span class="p">&gt;</span> ${p.reviewCount}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>   
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productNumber&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>数量<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productNumberSettingSpan&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productNumberSetting&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;1&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;arrow&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;increaseNumber&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;updown&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/increase.png&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                     
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;updownMiddle&#34;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;decreaseNumber&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;updown&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/decrease.png&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                     
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                     
            件<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>库存${p.stock}件<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;serviceCommitment&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;serviceCommitmentDesc&#34;</span><span class="p">&gt;</span>服务承诺<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;serviceCommitmentLink&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>正品保证<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>极速退款<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>赠运费险<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>七天无理由退换<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>   
         
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;buyDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;buyLink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forebuyone?pid=${p.id}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;buyButton&#34;</span><span class="p">&gt;</span>立即购买<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addCartLink&#34;</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addCartButton&#34;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-shopping-cart&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>加入购物车<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productreviewjsp">productReview.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewDiv&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewTopPart&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span>  <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewTopPartSelectedLink&#34;</span><span class="p">&gt;</span>商品详情<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span>  <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;selected&#34;</span><span class="p">&gt;</span>累计评价 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewTopReviewLinkNumber&#34;</span><span class="p">&gt;</span>${p.reviewCount}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewContentPart&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${reviews}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;r&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewItem&#34;</span><span class="p">&gt;</span>
         
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewItemDesc&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewItemContent&#34;</span><span class="p">&gt;</span>
                    ${r.content }
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewItemDate&#34;</span><span class="p">&gt;&lt;</span><span class="nt">fmt:formatDate</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${r.createDate}&#34;</span> <span class="na">pattern</span><span class="o">=</span><span class="s">&#34;yyyy-MM-dd&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewItemUserInfo&#34;</span><span class="p">&gt;</span>
             
                ${r.user.anonymousName}<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;userInfoGrayPart&#34;</span><span class="p">&gt;</span>（匿名）<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
             
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
         
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productdetailjsp">productDetail.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDetailDiv&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDetailTopPart&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDetailTopPartSelectedLink selected&#34;</span><span class="p">&gt;</span>商品详情<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDetailTopReviewLink&#34;</span><span class="p">&gt;</span>累计评价 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDetailTopReviewLinkNumber&#34;</span><span class="p">&gt;</span>${p.reviewCount}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productParamterPart&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productParamter&#34;</span><span class="p">&gt;</span>产品参数：<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
         
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productParamterList&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${pvs}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;pv&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>${pv.property.name}:  ${fn:substring(pv.value, 0, 10)} <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDetailImagesPart&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${p.productDetailImages}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;pi&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/productDetail/${pi.id}.jpg&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="325-模态登录">3.2.5 模态登录</h3>
<h4 id="forecontrollerchecklogin">ForeController.checkLogin()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerloginajax">ForeController.loginAjax()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="326-分类页">3.2.6 分类页</h3>
<h4 id="comparator">Comparator</h4>
<p>分类页面有排序功能，所有在使用ForeController之前，需要导入5个Comparator比较器</p>
<p>ProductAllComparator</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">tmall</span><span class="p">.</span><span class="nx">comparator</span><span class="p">;</span>
 
<span class="kn">import</span> <span class="nx">java</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">Comparator</span><span class="p">;</span>
 
<span class="kn">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">qqlin</span><span class="p">.</span><span class="nx">tmall</span><span class="p">.</span><span class="nx">pojo</span><span class="p">.</span><span class="nx">Product</span><span class="p">;</span>
 
<span class="nx">public</span> <span class="nx">class</span> <span class="nx">ProductAllComparator</span> <span class="nx">implements</span> <span class="nx">Comparator</span><span class="p">&lt;</span><span class="nx">Product</span><span class="p">&gt;{</span>
 
    <span class="err">@</span><span class="nx">Override</span>
    <span class="nx">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="p">(</span><span class="nx">Product</span> <span class="nx">p1</span><span class="p">,</span> <span class="nx">Product</span> <span class="nx">p2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">p2</span><span class="p">.</span><span class="nf">getReviewCount</span><span class="p">()</span><span class="o">*</span><span class="nx">p2</span><span class="p">.</span><span class="nf">getSaleCount</span><span class="p">()</span><span class="o">-</span><span class="nx">p1</span><span class="p">.</span><span class="nf">getReviewCount</span><span class="p">()</span><span class="o">*</span><span class="nx">p1</span><span class="p">.</span><span class="nf">getSaleCount</span><span class="p">();</span>
    <span class="p">}</span>
 
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ProductDateComparator</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">tmall.comparator</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductDateComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;{</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Product</span> <span class="n">p1</span><span class="o">,</span> <span class="n">Product</span> <span class="n">p2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">p2</span><span class="o">.</span><span class="na">getCreateDate</span><span class="o">().</span><span class="na">compareTo</span><span class="o">(</span><span class="n">p1</span><span class="o">.</span><span class="na">getCreateDate</span><span class="o">());</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ProductPriceComparator</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">tmall.comparator</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductPriceComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;{</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Product</span> <span class="n">p1</span><span class="o">,</span> <span class="n">Product</span> <span class="n">p2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">p1</span><span class="o">.</span><span class="na">getPromotePrice</span><span class="o">()-</span><span class="n">p2</span><span class="o">.</span><span class="na">getPromotePrice</span><span class="o">());</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ProductReviewComparator</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">tmall.comparator</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductReviewComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;{</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Product</span> <span class="n">p1</span><span class="o">,</span> <span class="n">Product</span> <span class="n">p2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">p2</span><span class="o">.</span><span class="na">getReviewCount</span><span class="o">()-</span><span class="n">p1</span><span class="o">.</span><span class="na">getReviewCount</span><span class="o">();</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ProductSaleCountComparator</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">tmall.comparator</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductSaleCountComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;{</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Product</span> <span class="n">p1</span><span class="o">,</span> <span class="n">Product</span> <span class="n">p2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">p2</span><span class="o">.</span><span class="na">getSaleCount</span><span class="o">()-</span><span class="n">p1</span><span class="o">.</span><span class="na">getSaleCount</span><span class="o">();</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollercategory">ForeController.category()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="categoryjsp">category.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/search.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/category/categoryPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="categorypagejsp">categoryPage.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>模仿天猫官网-${c.name}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;category&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categoryPageDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/category/${c.id}.jpg&#34;</span><span class="p">&gt;</span>
        <span class="err">&lt;</span>%@include file=&#34;sortBar.jsp&#34;%&gt;
        <span class="err">&lt;</span>%@include file=&#34;productsByCategory.jsp&#34;%&gt;
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="sortbarjsp">sortBar.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
<span class="err">&lt;</span>%@ taglib uri=&#34;http://java.sun.com/jsp/jstl/core&#34; prefix=&#34;c&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;input.sortBarPrice&#34;</span><span class="p">).</span><span class="nx">keyup</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productUnit&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
             
        <span class="nx">num</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">num</span><span class="p">))</span>
            <span class="nx">num</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>      
         
        <span class="kd">var</span> <span class="nx">begin</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;input.beginPrice&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">end</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;input.endPrice&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">begin</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">end</span><span class="p">)){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">begin</span><span class="p">);</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">end</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productUnit&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.productUnit&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                <span class="kd">var</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;price&#34;</span><span class="p">);</span>
                <span class="nx">price</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">price</span><span class="p">);</span>
                 
                <span class="k">if</span><span class="p">(</span><span class="nx">price</span><span class="o">&lt;=</span><span class="nx">end</span> <span class="o">&amp;&amp;</span> <span class="nx">price</span><span class="o">&gt;=</span><span class="nx">begin</span><span class="p">)</span>
                    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
            <span class="p">});</span>
        <span class="p">}</span>
         
    <span class="p">});</span>
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categorySortBar&#34;</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categorySortBarTable categorySortTable&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="err">&lt;</span><span class="na">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${&#39;all&#39;==param.sort||empty param.sort}&#34;</span><span class="p">&gt;</span>class=&#34;grayColumn&#34;<span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span> &gt;<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?cid=${c.id}&amp;sort=all&#34;</span><span class="p">&gt;</span>综合<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-arrow-down&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="err">&lt;</span><span class="na">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${&#39;review&#39;==param.sort}&#34;</span><span class="p">&gt;</span>class=&#34;grayColumn&#34;<span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span> &gt;<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?cid=${c.id}&amp;sort=review&#34;</span><span class="p">&gt;</span>人气<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-arrow-down&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="err">&lt;</span><span class="na">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${&#39;date&#39;==param.sort}&#34;</span><span class="p">&gt;</span>class=&#34;grayColumn&#34;<span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>&gt;<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?cid=${c.id}&amp;sort=date&#34;</span><span class="p">&gt;</span>新品<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-arrow-down&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="err">&lt;</span><span class="na">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${&#39;saleCount&#39;==param.sort}&#34;</span><span class="p">&gt;</span>class=&#34;grayColumn&#34;<span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>&gt;<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?cid=${c.id}&amp;sort=saleCount&#34;</span><span class="p">&gt;</span>销量<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-arrow-down&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="err">&lt;</span><span class="na">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${&#39;price&#39;==param.sort}&#34;</span><span class="p">&gt;</span>class=&#34;grayColumn&#34;<span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>&gt;<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;?cid=${c.id}&amp;sort=price&#34;</span><span class="p">&gt;</span>价格<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;glyphicon glyphicon-resize-vertical&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;categorySortBarTable&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;sortBarPrice beginPrice&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;请输入&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;grayColumn priceMiddleColumn&#34;</span><span class="p">&gt;</span>-<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;sortBarPrice endPrice&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;请输入&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productsbycategoryjsp">productsByCategory.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&#34;java&#34;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&#34;text/html; charset=UTF-8&#34;</span>
    <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span> <span class="n">isELIgnored</span><span class="o">=</span><span class="s">&#34;false&#34;</span><span class="o">%&gt;</span>
     
<span class="o">&lt;</span><span class="n">c</span><span class="o">:</span><span class="k">if</span> <span class="n">test</span><span class="o">=</span><span class="s">&#34;${empty param.categorycount}&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">c</span><span class="o">:</span><span class="n">set</span> <span class="n">var</span><span class="o">=</span><span class="s">&#34;categorycount&#34;</span> <span class="n">scope</span><span class="o">=</span><span class="s">&#34;page&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;100&#34;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">c</span><span class="o">:</span><span class="k">if</span><span class="o">&gt;</span>
 
<span class="o">&lt;</span><span class="n">c</span><span class="o">:</span><span class="k">if</span> <span class="n">test</span><span class="o">=</span><span class="s">&#34;${!empty param.categorycount}&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">c</span><span class="o">:</span><span class="n">set</span> <span class="n">var</span><span class="o">=</span><span class="s">&#34;categorycount&#34;</span> <span class="n">scope</span><span class="o">=</span><span class="s">&#34;page&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;${param.categorycount}&#34;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">c</span><span class="o">:</span><span class="k">if</span><span class="o">&gt;</span>
     
<span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;categoryProducts&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">c</span><span class="o">:</span><span class="n">forEach</span> <span class="n">items</span><span class="o">=</span><span class="s">&#34;${c.products}&#34;</span> <span class="n">var</span><span class="o">=</span><span class="s">&#34;p&#34;</span> <span class="n">varStatus</span><span class="o">=</span><span class="s">&#34;stc&#34;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">c</span><span class="o">:</span><span class="k">if</span> <span class="n">test</span><span class="o">=</span><span class="s">&#34;${stc.count&lt;=categorycount}&#34;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;productUnit&#34;</span> <span class="n">price</span><span class="o">=</span><span class="s">&#34;${p.promotePrice}&#34;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;productUnitFrame&#34;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">&#34;foreproduct?pid=${p.id}&#34;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;productImage&#34;</span> <span class="n">src</span><span class="o">=</span><span class="s">&#34;img/productSingle_middle/${p.firstProductImage.id}.jpg&#34;</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;productPrice&#34;</span><span class="o">&gt;</span><span class="err">¥</span><span class="o">&lt;</span><span class="n">fmt</span><span class="o">:</span><span class="n">formatNumber</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;${p.promotePrice}&#34;</span> <span class="n">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="o">/&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;productLink&#34;</span> <span class="n">href</span><span class="o">=</span><span class="s">&#34;foreproduct?pid=${p.id}&#34;</span><span class="o">&gt;</span>
                 <span class="n">$</span><span class="o">{</span><span class="n">fn</span><span class="o">:</span><span class="n">substring</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">50</span><span class="o">)}</span>
                <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                 
                <span class="o">&lt;</span><span class="n">a</span>  <span class="n">class</span><span class="o">=</span><span class="s">&#34;tmallLink&#34;</span> <span class="n">href</span><span class="o">=</span><span class="s">&#34;foreproduct?pid=${p.id}&#34;</span><span class="o">&gt;</span><span class="n">天猫专卖</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
     
                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;show1 productInfo&#34;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;monthDeal &#34;</span><span class="o">&gt;</span><span class="n">月成交</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;productDealNumber&#34;</span><span class="o">&gt;</span><span class="n">$</span><span class="o">{</span><span class="n">p</span><span class="o">.</span><span class="na">saleCount</span><span class="o">}</span><span class="n">笔</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;productReview&#34;</span><span class="o">&gt;</span><span class="n">评价</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;productReviewNumber&#34;</span><span class="o">&gt;</span><span class="n">$</span><span class="o">{</span><span class="n">p</span><span class="o">.</span><span class="na">reviewCount</span><span class="o">}&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;wangwang&#34;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;wangwanglink&#34;</span> <span class="n">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">&#34;img/site/wangwang.png&#34;</span><span class="o">&gt;</span>
                    <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                     
                    <span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">c</span><span class="o">:</span><span class="k">if</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">c</span><span class="o">:</span><span class="n">forEach</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="327-搜索">3.2.7 搜索</h3>
<h4 id="searchjsp">search.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;${contextPath}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;logo&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/logo.gif&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;logo&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;foresearch&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;keyword&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${param.keyword}&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;时尚男鞋  太阳镜 &#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span>  <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchButton&#34;</span><span class="p">&gt;</span>搜索<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchBelow&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${cs}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;c&#34;</span> <span class="na">varStatus</span><span class="o">=</span><span class="s">&#34;st&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count&gt;=5 and st.count&lt;=8}&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forecategory?cid=${c.id}&#34;</span><span class="p">&gt;</span>
                                ${c.name}
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count!=8}&#34;</span><span class="p">&gt;</span>             
                                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>             
                            <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>          
                    <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>     
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>  
</code></pre></td></tr></table>
</div>
</div><h4 id="simplesearchjsp-1">simpleSearch.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="p">&lt;</span><span class="nt">div</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;${contextPath}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;simpleLogo&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;simpleLogo&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/simpleLogo.png&#34;</span><span class="p">&gt;</span>   
    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;foresearch&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;simpleSearchDiv pull-right&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;平衡车 原汁机&#34;</span>  <span class="na">value</span><span class="o">=</span><span class="s">&#34;${param.keyword}&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;keyword&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchButton&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>搜天猫<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchBelow&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${cs}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;c&#34;</span> <span class="na">varStatus</span><span class="o">=</span><span class="s">&#34;st&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count&gt;=8 and st.count&lt;=11}&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forecategory?cid=${c.id}&#34;</span><span class="p">&gt;</span>
                            ${c.name}
                        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count!=11}&#34;</span><span class="p">&gt;</span>            
                            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>             
                        <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>          
                <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>         
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productservice-3">ProductService</h4>
<p>增加了search方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductService</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">);</span>
    <span class="n">Product</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Category</span> <span class="n">c</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">fillByRow</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">);</span>
 
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">search</span><span class="o">(</span><span class="n">String</span> <span class="n">keyword</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productserviceimpl-2">ProductServiceImpl</h4>
<p>使用search方法，通过关键字模糊查询</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.ProductMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.ProductExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.ProductImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductImageService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ReviewService</span><span class="o">;</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductServiceImpl</span> <span class="kd">implements</span> <span class="n">ProductService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductMapper</span> <span class="n">productMapper</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">productMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="n">setCategory</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">){</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">p</span> <span class="o">:</span> <span class="n">ps</span><span class="o">)</span>
            <span class="n">setCategory</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">cid</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">getCid</span><span class="o">();</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setCategory</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ProductExample</span> <span class="n">example</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProductExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andCidEqualTo</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="n">List</span> <span class="n">result</span> <span class="o">=</span> <span class="n">productMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="n">setCategory</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">pis</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">pis</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">ProductImage</span> <span class="n">pi</span> <span class="o">=</span> <span class="n">pis</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
            <span class="n">p</span><span class="o">.</span><span class="na">setFirstProductImage</span><span class="o">(</span><span class="n">pi</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Category</span> <span class="n">c</span> <span class="o">:</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fillByRow</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">productNumberEachRow</span> <span class="o">=</span> <span class="n">8</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Category</span> <span class="n">c</span> <span class="o">:</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span>  <span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;</span> <span class="n">productsByRow</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">products</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">+=</span><span class="n">productNumberEachRow</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">productNumberEachRow</span><span class="o">;</span>
                <span class="n">size</span><span class="o">=</span> <span class="n">size</span><span class="o">&gt;</span><span class="n">products</span><span class="o">.</span><span class="na">size</span><span class="o">()?</span><span class="n">products</span><span class="o">.</span><span class="na">size</span><span class="o">():</span><span class="n">size</span><span class="o">;</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">productsOfEachRow</span> <span class="o">=</span><span class="n">products</span><span class="o">.</span><span class="na">subList</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
                <span class="n">productsByRow</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">productsOfEachRow</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">c</span><span class="o">.</span><span class="na">setProductsByRow</span><span class="o">(</span><span class="n">productsByRow</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">Product</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">saleCount</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">getSaleCount</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setSaleCount</span><span class="o">(</span><span class="n">saleCount</span><span class="o">);</span>
 
        <span class="kt">int</span> <span class="n">reviewCount</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">getCount</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setReviewCount</span><span class="o">(</span><span class="n">reviewCount</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">p</span> <span class="o">:</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">search</span><span class="o">(</span><span class="n">String</span> <span class="n">keyword</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ProductExample</span> <span class="n">example</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProductExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andNameLike</span><span class="o">(</span><span class="s">&#34;%&#34;</span> <span class="o">+</span> <span class="n">keyword</span> <span class="o">+</span> <span class="s">&#34;%&#34;</span><span class="o">);</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="n">List</span> <span class="n">result</span> <span class="o">=</span> <span class="n">productMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="n">setCategory</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Category</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">list</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">c</span><span class="o">.</span><span class="na">setProducts</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstProductImage</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Product</span> <span class="n">p</span> <span class="o">:</span> <span class="n">ps</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setFirstProductImage</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollersearch">ForeController.search()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="searchresultjsp">searchResult.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/search.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/searchResultPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="searchjsp-1">search.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;${contextPath}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;logo&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/logo.gif&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;logo&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;foresearch&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;keyword&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${param.keyword}&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;时尚男鞋  太阳镜 &#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span>  <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchButton&#34;</span><span class="p">&gt;</span>搜索<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchBelow&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${cs}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;c&#34;</span> <span class="na">varStatus</span><span class="o">=</span><span class="s">&#34;st&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count&gt;=5 and st.count&lt;=8}&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forecategory?cid=${c.id}&#34;</span><span class="p">&gt;</span>
                                ${c.name}
                            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count!=8}&#34;</span><span class="p">&gt;</span>             
                                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>|<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>             
                            <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>          
                    <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>     
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>  
</code></pre></td></tr></table>
</div>
</div><h4 id="searchresultpagejsp">searchResultPage.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
     
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;searchResult&#34;</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchResultDiv&#34;</span><span class="p">&gt;</span>
        <span class="err">&lt;</span>%@include file=&#34;productsBySearch.jsp&#34;%&gt;
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="productsbysearchjsp">productsBySearch.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
     
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;searchProducts&#34;</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${ps}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;p&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productUnit&#34;</span> <span class="na">price</span><span class="o">=</span><span class="s">&#34;${p.promotePrice}&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;foreproduct?pid=${p.id}&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productImage&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/productSingle/${p.firstProductImage.id}.jpg&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productPrice&#34;</span><span class="p">&gt;</span>¥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${p.promotePrice}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productLink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;foreproduct?pid=${p.id}&#34;</span><span class="p">&gt;</span>
             ${fn:substring(p.name, 0, 50)}
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
             
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;tmallLink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;foreproduct?pid=${p.id}&#34;</span><span class="p">&gt;</span>天猫专卖<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
 
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productInfo&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;monthDeal &#34;</span><span class="p">&gt;</span>月成交 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productDealNumber&#34;</span><span class="p">&gt;</span>${p.saleCount}笔<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReview&#34;</span><span class="p">&gt;</span>评价<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productReviewNumber&#34;</span><span class="p">&gt;</span>${p.reviewCount}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;wangwang&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/wangwang.png&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
             
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${empty ps}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;noMatch&#34;</span><span class="p">&gt;</span>没有满足条件的产品<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
     
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="32-前台-需要登录">3.2 前台-需要登录</h2>
<h3 id="321-购物流程">3.2.1 购物流程</h3>
<blockquote>
<ol>
<li>登录</li>
<li>访问产品页</li>
<li>立即购买</li>
<li>进入结算页面</li>
<li>加入购物车</li>
<li>查看购物车</li>
<li>选中购物车中的商品</li>
<li>又到了第4步的结算页面</li>
<li>在结算页面生成订单</li>
<li>付款</li>
<li>确认收货</li>
<li>评价</li>
</ol>
</blockquote>
<p>(<img src="https://stepimagewm.how2j.cn/6358.png" alt="购买的业务流程">)</p>
<h3 id="322-购物流程与表关系">3.2.2 购物流程与表关系</h3>
<blockquote>
<p>围绕购物流程最重要的两个表是OrderItem 和 Order表</p>
<p>关于OrderItem的业务行为</p>
<ol>
<li>立即购买——新增OrderItem</li>
<li>加入购物车——新增Orderitem</li>
<li>查看购物车——显示未和Order关联的OrderItem</li>
<li>选择购物车中的商品——选中OrderItem</li>
<li>结算页面——显示选中的OrderItem</li>
</ol>
<p>关于Order的业务行为</p>
<ol>
<li>生成订单——新增Order</li>
<li>付款——修改Order状态</li>
<li>我的订单——显示Order</li>
<li>确认收货——修改Order状态</li>
</ol>
</blockquote>
<p><img src="https://stepimagewm.how2j.cn/6359.png" alt="购物流程环节与表关系"></p>
<h3 id="323-立即购买">3.2.3 立即购买</h3>
<blockquote>
<p>那么点击购买都做了什么事情呢？ 会在OrderItem表里插入一条数据，这条数据会表示:</p>
<ol>
<li>pid =844 购买的商品id</li>
<li>oid = null, 这个订单项还没有生成对应的订单，即还在购物车中</li>
<li>uid= 3，用户的id是3</li>
<li>number=3, 购买了3件产品</li>
</ol>
</blockquote>
<h4 id="orderitemservice-2">OrderItemService</h4>
<p>新增listByUser</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItem</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderItemService</span> <span class="o">{</span>
 
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">c</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">c</span><span class="o">);</span>
    <span class="n">OrderItem</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">();</span>
 
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">);</span>
 
    <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Order</span> <span class="n">o</span><span class="o">);</span>
 
    <span class="kt">int</span> <span class="nf">getSaleCount</span><span class="o">(</span><span class="kt">int</span>  <span class="n">pid</span><span class="o">);</span>
 
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">listByUser</span><span class="o">(</span><span class="kt">int</span> <span class="n">uid</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="orderitemserviceimpl-1">OrderItemServiceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.OrderItemMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItemExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.ProductService</span><span class="o">;</span>
 
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderItemServiceImpl</span> <span class="kd">implements</span> <span class="n">OrderItemService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemMapper</span> <span class="n">orderItemMapper</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">OrderItem</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OrderItem</span> <span class="n">result</span> <span class="o">=</span> <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">setProduct</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(){</span>
        <span class="n">OrderItemExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderItemExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">orderItemMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
 
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Order</span> <span class="n">o</span> <span class="o">:</span> <span class="n">os</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">fill</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSaleCount</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OrderItemExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderItemExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andPidEqualTo</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span><span class="n">orderItemMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span><span class="n">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="nf">listByUser</span><span class="o">(</span><span class="kt">int</span> <span class="n">uid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OrderItemExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderItemExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andUidEqualTo</span><span class="o">(</span><span class="n">uid</span><span class="o">).</span><span class="na">andOidIsNull</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span><span class="n">orderItemMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="n">setProduct</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fill</span><span class="o">(</span><span class="n">Order</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OrderItemExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderItemExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andOidEqualTo</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span><span class="n">orderItemMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
        <span class="n">setProduct</span><span class="o">(</span><span class="n">ois</span><span class="o">);</span>
 
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">totalNumber</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">total</span><span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">();</span>
            <span class="n">totalNumber</span><span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setTotal</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setTotalNumber</span><span class="o">(</span><span class="n">totalNumber</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setOrderItems</span><span class="o">(</span><span class="n">ois</span><span class="o">);</span>
 
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProduct</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">){</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span><span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setProduct</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setProduct</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getPid</span><span class="o">());</span>
        <span class="n">oi</span><span class="o">.</span><span class="na">setProduct</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerbuyone">ForeController.buyone()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="324-结算页面">3.2.4 结算页面</h3>
<h4 id="forecontrollerbuy">ForeController.buy()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="buyjsp">buy.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/cart/buyPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="buypagejsp">buyPage.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;buyPageDiv&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;forecreateOrder&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
   
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;buyFlow&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-left&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/simpleLogo.png&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/buyflow.png&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;address&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addressTip&#34;</span><span class="p">&gt;</span>输入收货地址<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
         
            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;addressTable&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;firstColumn&#34;</span><span class="p">&gt;</span>详细地址<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;redStar&#34;</span><span class="p">&gt;</span>*<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                     
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;address&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;建议您如实填写详细收货地址，例如接到名称，门牌好吗，楼层和房间号等信息&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>邮政编码<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="na">name</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;如果您不清楚邮递区号，请填写000000&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>收货人姓名<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;redStar&#34;</span><span class="p">&gt;</span>*<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span>  <span class="na">name</span><span class="o">=</span><span class="s">&#34;receiver&#34;</span>  <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;长度不超过25个字符&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>手机号码 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;redStar&#34;</span><span class="p">&gt;</span>*<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;mobile&#34;</span>  <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;请输入11位手机号码&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
             
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productList&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productListTip&#34;</span><span class="p">&gt;</span>确认订单信息<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
         
        <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productListTable&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productListTableFirstColumn&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;tmallbuy&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/tmallbuy.png&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;marketLink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>店铺：天猫店铺<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;wangwanglink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;wangwangGif&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>单价<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>数量<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>小计<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>配送方式<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;rowborder&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span>  <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tbody</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;productListTableTbody&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${ois}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;oi&#34;</span> <span class="na">varStatus</span><span class="o">=</span><span class="s">&#34;st&#34;</span> <span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemTR&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemFirstTD&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemImg&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/productSingle_middle/${oi.product.firstProductImage.id}.jpg&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemProductInfo&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span>  <span class="na">href</span><span class="o">=</span><span class="s">&#34;foreproduct?pid=${oi.product.id}&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemProductLink&#34;</span><span class="p">&gt;</span>
                            ${oi.product.name}
                        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                         
                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/creditcard.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;支持信用卡支付&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/7day.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;消费者保障服务,承诺7天退货&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/promise.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;消费者保障服务,承诺如实描述&#34;</span><span class="p">&gt;</span>
                         
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                         
                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemProductPrice&#34;</span><span class="p">&gt;</span>￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${oi.product.promotePrice}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemProductNumber&#34;</span><span class="p">&gt;</span>${oi.number}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemUnitSum&#34;</span><span class="p">&gt;</span>
                        ￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${oi.number*oi.product.promotePrice}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count==1}&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">rowspan</span><span class="o">=</span><span class="s">&#34;5&#34;</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemLastTD&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemDeliveryLabel&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;radio&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="na">checked</span><span class="o">=</span><span class="s">&#34;checked&#34;</span><span class="p">&gt;</span>
                            普通配送
                        <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                         
                        <span class="p">&lt;</span><span class="nt">select</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemDeliverySelect&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">option</span><span class="p">&gt;</span>快递 免邮费<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
 
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                         
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>             
                 
            <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
             
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemSumDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-left&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;leaveMessageText&#34;</span><span class="p">&gt;</span>给卖家留言:<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;leaveMessageImg&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/leaveMessage.png&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;leaveMessageTextareaSpan&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;userMessage&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;leaveMessageTextarea&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>还可以输入200个字符<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
             
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span><span class="p">&gt;</span>店铺合计(含运费): ￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${total}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
         
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemTotalSumDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>实付款：<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemTotalSumSpan&#34;</span><span class="p">&gt;</span>￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${total}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitOrderDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;submitOrderButton&#34;</span><span class="p">&gt;</span>提交订单<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>    
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="325-加入购物车">3.2.5 加入购物车</h3>
<h4 id="forecontrollerandcart">ForeController.andCart()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="326-查看购物车">3.2.6 查看购物车</h3>
<h4 id="forecontrollercart">ForeController.cart()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/cart&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="cartjsp">cart.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/simpleSearch.jsp&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/cart/cartPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="cartpagejsp">cartPage.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
     
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kd">var</span> <span class="nx">deleteOrderItem</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">deleteOrderItemid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
 
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;a.deleteOrderItem&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">deleteOrderItem</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">oiid</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;oiid&#34;</span><span class="p">)</span>
        <span class="nx">deleteOrderItemid</span> <span class="o">=</span> <span class="nx">oiid</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#deleteConfirmModal&#34;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">);</span>   
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.deleteConfirmButton&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">deleteOrderItem</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#deleteConfirmModal&#34;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s1">&#39;hide&#39;</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#deleteConfirmModal&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;hidden.bs.modal&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">deleteOrderItem</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">page</span><span class="o">=</span><span class="s2">&#34;foredeleteOrderItem&#34;</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
                    <span class="nx">page</span><span class="p">,</span>
                    <span class="p">{</span><span class="s2">&#34;oiid&#34;</span><span class="o">:</span><span class="nx">deleteOrderItemid</span><span class="p">},</span>
                    <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
                        <span class="k">if</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="o">==</span><span class="nx">result</span><span class="p">){</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;tr.cartProductItemTR[oiid=&#34;</span><span class="o">+</span><span class="nx">deleteOrderItemid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
                        <span class="p">}</span>
                        <span class="k">else</span><span class="p">{</span>
                            <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">&#34;loginPage&#34;</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">);</span>
             
        <span class="p">}</span>
    <span class="p">})</span> 
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.cartProductItemIfSelected&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">selectit</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="o">==</span><span class="nx">selectit</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">,</span><span class="s2">&#34;false&#34;</span><span class="p">)</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s2">&#34;tr.cartProductItemTR&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#fff&#34;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartSelected.png&#34;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">,</span><span class="s2">&#34;selectit&#34;</span><span class="p">)</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s2">&#34;tr.cartProductItemTR&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#FFF8E1&#34;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">syncSelect</span><span class="p">();</span>
        <span class="nx">syncCreateOrderButton</span><span class="p">();</span>
        <span class="nx">calcCartSumPriceAndNumber</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">selectit</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="o">==</span><span class="nx">selectit</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">,</span><span class="s2">&#34;false&#34;</span><span class="p">)</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemIfSelected&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">,</span><span class="s2">&#34;false&#34;</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s2">&#34;tr.cartProductItemTR&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#fff&#34;</span><span class="p">);</span>
            <span class="p">});</span>        
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartSelected.png&#34;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">,</span><span class="s2">&#34;selectit&#34;</span><span class="p">)</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemIfSelected&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartSelected.png&#34;</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">,</span><span class="s2">&#34;selectit&#34;</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s2">&#34;tr.cartProductItemTR&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#FFF8E1&#34;</span><span class="p">);</span>
            <span class="p">});</span>            
        <span class="p">}</span>
        <span class="nx">syncCreateOrderButton</span><span class="p">();</span>
        <span class="nx">calcCartSumPriceAndNumber</span><span class="p">();</span>
         
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.orderItemNumberSetting&#34;</span><span class="p">).</span><span class="nx">keyup</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">pid</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;pid&#34;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">stock</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.orderItemStock[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">price</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.orderItemPromotePrice[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
         
        <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.orderItemNumberSetting[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="nx">num</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">num</span><span class="p">))</span>
            <span class="nx">num</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&gt;</span><span class="nx">stock</span><span class="p">)</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="nx">stock</span><span class="p">;</span>
         
        <span class="nx">syncPrice</span><span class="p">(</span><span class="nx">pid</span><span class="p">,</span><span class="nx">num</span><span class="p">,</span><span class="nx">price</span><span class="p">);</span>
    <span class="p">});</span>
 
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.numberPlus&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
         
        <span class="kd">var</span> <span class="nx">pid</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;pid&#34;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">stock</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.orderItemStock[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">price</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.orderItemPromotePrice[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.orderItemNumberSetting[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
 
        <span class="nx">num</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&gt;</span><span class="nx">stock</span><span class="p">)</span>
            <span class="nx">num</span> <span class="o">=</span> <span class="nx">stock</span><span class="p">;</span>
        <span class="nx">syncPrice</span><span class="p">(</span><span class="nx">pid</span><span class="p">,</span><span class="nx">num</span><span class="p">,</span><span class="nx">price</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.numberMinus&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">pid</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;pid&#34;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">stock</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.orderItemStock[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">price</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.orderItemPromotePrice[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
         
        <span class="kd">var</span> <span class="nx">num</span><span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.orderItemNumberSetting[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="o">--</span><span class="nx">num</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">num</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>
            <span class="nx">num</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="nx">syncPrice</span><span class="p">(</span><span class="nx">pid</span><span class="p">,</span><span class="nx">num</span><span class="p">,</span><span class="nx">price</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.createOrderButton&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemIfSelected&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="k">if</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="o">==</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">)){</span>
                <span class="kd">var</span> <span class="nx">oiid</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;oiid&#34;</span><span class="p">);</span>
                <span class="nx">params</span> <span class="o">+=</span> <span class="s2">&#34;&amp;oiid=&#34;</span><span class="o">+</span><span class="nx">oiid</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="nx">params</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">&#34;forebuy?&#34;</span><span class="o">+</span><span class="nx">params</span><span class="p">;</span>
    <span class="p">});</span>
     
<span class="p">})</span>
 
<span class="kd">function</span> <span class="nx">syncCreateOrderButton</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">selectAny</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemIfSelected&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="o">==</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">)){</span>
            <span class="nx">selectAny</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>
     
    <span class="k">if</span><span class="p">(</span><span class="nx">selectAny</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.createOrderButton&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#C40000&#34;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.createOrderButton&#34;</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&#34;disabled&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.createOrderButton&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;background-color&#34;</span><span class="p">,</span><span class="s2">&#34;#AAAAAA&#34;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.createOrderButton&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;disabled&#34;</span><span class="p">,</span><span class="s2">&#34;disabled&#34;</span><span class="p">);</span>     
    <span class="p">}</span>
         
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">syncSelect</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">selectAll</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemIfSelected&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">&#34;false&#34;</span><span class="o">==</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;selectit&#34;</span><span class="p">)){</span>
            <span class="nx">selectAll</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>
     
    <span class="k">if</span><span class="p">(</span><span class="nx">selectAll</span><span class="p">)</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartSelected.png&#34;</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.selectAllItem&#34;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span><span class="s2">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">);</span>
     
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">calcCartSumPriceAndNumber</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">totalNumber</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;img.cartProductItemIfSelected[selectit=&#39;selectit&#39;]&#34;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">oiid</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;oiid&#34;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">price</span> <span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemSmallSumPrice[oiid=&#34;</span><span class="o">+</span><span class="nx">oiid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
        <span class="nx">price</span> <span class="o">=</span> <span class="nx">price</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,/g</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">);</span>
        <span class="nx">price</span> <span class="o">=</span> <span class="nx">price</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/￥/g</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">);</span>
        <span class="nx">sum</span> <span class="o">+=</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">price</span><span class="p">);</span>  
         
        <span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.orderItemNumberSetting[oiid=&#34;</span><span class="o">+</span><span class="nx">oiid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="nx">totalNumber</span> <span class="o">+=</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
         
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.cartSumPrice&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;￥&#34;</span><span class="o">+</span><span class="nx">formatMoney</span><span class="p">(</span><span class="nx">sum</span><span class="p">));</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.cartTitlePrice&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;￥&#34;</span><span class="o">+</span><span class="nx">formatMoney</span><span class="p">(</span><span class="nx">sum</span><span class="p">));</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;span.cartSumNumber&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">totalNumber</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">syncPrice</span><span class="p">(</span><span class="nx">pid</span><span class="p">,</span><span class="nx">num</span><span class="p">,</span><span class="nx">price</span><span class="p">){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.orderItemNumberSetting[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">cartProductItemSmallSumPrice</span> <span class="o">=</span> <span class="nx">formatMoney</span><span class="p">(</span><span class="nx">num</span><span class="o">*</span><span class="nx">price</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.cartProductItemSmallSumPrice[pid=&#34;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&#34;￥&#34;</span><span class="o">+</span><span class="nx">cartProductItemSmallSumPrice</span><span class="p">);</span>
    <span class="nx">calcCartSumPriceAndNumber</span><span class="p">();</span>
     
    <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="s2">&#34;forechangeOrderItem&#34;</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
            <span class="nx">page</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&#34;pid&#34;</span><span class="o">:</span><span class="nx">pid</span><span class="p">,</span><span class="s2">&#34;number&#34;</span><span class="o">:</span><span class="nx">num</span><span class="p">},</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="o">!=</span><span class="nx">result</span><span class="p">){</span>
                    <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">&#34;login.jsp&#34;</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">);</span>
 
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
 
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>购物车<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartDiv&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartTitle pull-right&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>已选商品  (不含运费)<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartTitlePrice&#34;</span><span class="p">&gt;</span>￥0.00<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;createOrderButton&#34;</span> <span class="na">disabled</span><span class="o">=</span><span class="s">&#34;disabled&#34;</span><span class="p">&gt;</span>结 算<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductList&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductTable&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;selectAndImage&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">selectit</span><span class="o">=</span><span class="s">&#34;false&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;selectAllItem&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">&gt;</span>              
                    全选
                     
                    <span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>商品信息<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>单价<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>数量<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;120px&#34;</span><span class="p">&gt;</span>金额<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">th</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;operation&#34;</span><span class="p">&gt;</span>操作<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${ois }&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;oi&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">oiid</span><span class="o">=</span><span class="s">&#34;${oi.id}&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductItemTR&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">selectit</span><span class="o">=</span><span class="s">&#34;false&#34;</span> <span class="na">oiid</span><span class="o">=</span><span class="s">&#34;${oi.id}&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductItemIfSelected&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;display:none&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/cartSelected.png&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductImg&#34;</span>  <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/productSingle_middle/${oi.product.firstProductImage.id}.jpg&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductLinkOutDiv&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;foreproduct?pid=${oi.product.id}&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductLink&#34;</span><span class="p">&gt;</span>${oi.product.name}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductLinkInnerDiv&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/creditcard.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;支持信用卡支付&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/7day.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;消费者保障服务,承诺7天退货&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/promise.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;消费者保障服务,承诺如实描述&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                             
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductItemOringalPrice&#34;</span><span class="p">&gt;</span>￥${oi.product.originalPrice}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductItemPromotionPrice&#34;</span><span class="p">&gt;</span>￥${oi.product.promotePrice}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                             
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                         
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductChangeNumberDiv&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;hidden orderItemStock &#34;</span> <span class="na">pid</span><span class="o">=</span><span class="s">&#34;${oi.product.id}&#34;</span><span class="p">&gt;</span>${oi.product.stock}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;hidden orderItemPromotePrice &#34;</span> <span class="na">pid</span><span class="o">=</span><span class="s">&#34;${oi.product.id}&#34;</span><span class="p">&gt;</span>${oi.product.promotePrice}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span>  <span class="na">pid</span><span class="o">=</span><span class="s">&#34;${oi.product.id}&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;numberMinus&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>-<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">pid</span><span class="o">=</span><span class="s">&#34;${oi.product.id}&#34;</span> <span class="na">oiid</span><span class="o">=</span><span class="s">&#34;${oi.id}&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemNumberSetting&#34;</span> <span class="na">autocomplete</span><span class="o">=</span><span class="s">&#34;off&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${oi.number}&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span>  <span class="na">stock</span><span class="o">=</span><span class="s">&#34;${oi.product.stock}&#34;</span> <span class="na">pid</span><span class="o">=</span><span class="s">&#34;${oi.product.id}&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;numberPlus&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>+<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>                   
                         
                         <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span> <span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartProductItemSmallSumPrice&#34;</span> <span class="na">oiid</span><span class="o">=</span><span class="s">&#34;${oi.id}&#34;</span> <span class="na">pid</span><span class="o">=</span><span class="s">&#34;${oi.product.id}&#34;</span> <span class="p">&gt;</span>
                            ￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${oi.product.promotePrice*oi.number}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                         
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;deleteOrderItem&#34;</span> <span class="na">oiid</span><span class="o">=</span><span class="s">&#34;${oi.id}&#34;</span>  <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>删除<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>             
            <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
         
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartFoot&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">selectit</span><span class="o">=</span><span class="s">&#34;false&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;selectAllItem&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/cartNotSelected.png&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>全选<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="c">&lt;!--         &lt;a href=&#34;#&#34;&gt;删除&lt;/a&gt; --&gt;</span>
         
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-right&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>已选商品 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartSumNumber&#34;</span> <span class="p">&gt;</span>0<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> 件<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
             
            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>合计 (不含运费): <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;cartSumPrice&#34;</span> <span class="p">&gt;</span>￥0.00<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;createOrderButton&#34;</span> <span class="na">disabled</span><span class="o">=</span><span class="s">&#34;disabled&#34;</span> <span class="p">&gt;</span>结  算<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
         
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="327-登录拦截器">3.2.7 登录拦截器</h3>
<blockquote>
<p>新建一个过滤器LoginInterceptor ，根据解决思路中
哪些页面需要登录？哪些页面不需要呢？
a. 不需要登录也可以访问的
如：注册，登录，产品，首页，分类，查询等等
b. 需要登录才能够访问的
如：购买行为，加入购物车行为，查看购物车，查看我的订单等等
不需要登录也可以访问的已经确定了，但是需要登录才能够访问，截止目前为止还不能确定，所以这个过滤器就判断如果不是注册，登录，产品这些，就进行登录校验</p>
<ol>
<li>准备字符串数组 noNeedAuthPage，存放哪些不需要登录也能访问的路径</li>
<li>获取uri</li>
<li>去掉前缀/tmall_ssm</li>
<li>如果访问的地址是/fore开头
4.1 取出fore后面的字符串，比如是forecart,那么就取出cart
4.2 判断cart是否是在noNeedAuthPage
4.2 如果不在，那么就需要进行是否登录验证
4.3 从session中取出&quot;user&quot;对象
4.4 如果对象不存在，就客户端跳转到login.jsp
4.5 否则就正常执行</li>
</ol>
</blockquote>
<h4 id="logininterceptor">LoginInterCeptor</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.interceptor</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.StringUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.handler.HandlerInterceptorAdapter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-22
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginInterceptor</span> <span class="kd">extends</span> <span class="n">HandlerInterceptorAdapter</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">LoginInterceptor</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 在业务处理器处理请求之前被调用
</span><span class="cm">     * 如果返回false:
</span><span class="cm">     * --- 从当前的拦截器往回执行所有拦截器的afterCompoletion(),再退出拦截器链
</span><span class="cm">     * 如果返回true:
</span><span class="cm">     * --- 执行下一个拦截器，知道所有拦截器都执行完毕
</span><span class="cm">     * --- 再执行被拦截器的Controller
</span><span class="cm">     * --- 然后进入拦截器链
</span><span class="cm">     * --- 从最后一个拦截器往回执行所有的postHandle()
</span><span class="cm">     * --- 接着再从最后一个拦截器往回执行所有的afterCompletion()
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">contextPath</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getContextPath</span><span class="o">();</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">noNeedAuthPage</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span>
                <span class="s">&#34;home&#34;</span><span class="o">,</span>
                <span class="s">&#34;checkLogin&#34;</span><span class="o">,</span>
                <span class="s">&#34;register&#34;</span><span class="o">,</span>
                <span class="s">&#34;loginAjax&#34;</span><span class="o">,</span>
                <span class="s">&#34;login&#34;</span><span class="o">,</span>
                <span class="s">&#34;product&#34;</span><span class="o">,</span>
                <span class="s">&#34;category&#34;</span><span class="o">,</span>
                <span class="s">&#34;search&#34;</span>
        <span class="o">};</span>

        <span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="n">contextPath</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">&#34;/fore&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">substringAfterLast</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="s">&#34;/fore&#34;</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">noNeedAuthPage</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="n">method</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&#34;loginPage&#34;</span><span class="o">);</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 在业务处理器处理请求执行完成后，生成视图之前执行的动作
</span><span class="cm">     * 可以在modelAndView中加入数据，例如当前时间
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">postHandle</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">,</span> <span class="n">modelAndView</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 在DispatcherServlet完全处理完请求后被调用,可用于清理资源等
</span><span class="cm">     * &lt;p&gt;
</span><span class="cm">     * 当有拦截器抛出异常时,会从当前拦截器往回执行所有的拦截器的afterCompletion()
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">afterCompletion</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterConcurrentHandlingStarted</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">afterConcurrentHandlingStarted</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="springmvcxml">springMVC.xml</h4>
<p>添加拦截器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&#34;/fore*&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.qqlin.tmall.interceptor.LoginInterceptor&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
       <span class="na">xmlns:mvc=</span><span class="s">&#34;http://www.springframework.org/schema/mvc&#34;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
</span><span class="s">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
</span><span class="s">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd&#34;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!--启动注解识别--&gt;</span>
    <span class="nt">&lt;context:annotation-config/&gt;</span>

    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.qqlin.tmall.controller&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;context:include-filter</span> <span class="na">type=</span><span class="s">&#34;annotation&#34;</span>
                                <span class="na">expression=</span><span class="s">&#34;org.springframework.stereotype.Controller&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/context:component-scan&gt;</span>

    <span class="nt">&lt;mvc:annotation-driven/&gt;</span>

    <span class="c">&lt;!--开通静态资源的访问--&gt;</span>
    <span class="nt">&lt;mvc:default-servlet-handler/&gt;</span>

    <span class="c">&lt;!-- 视图定位 --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">name=</span><span class="s">&#34;internalResourceViewResolver&#34;</span>
          <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;viewClass&#34;</span>
                  <span class="na">value=</span><span class="s">&#34;org.springframework.web.servlet.view.JstlView&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/jsp/&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- 对上传文件的解析--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;multipartResolver&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.multipart.commons.CommonsMultipartResolver&#34;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- 添加拦截器--&gt;</span>
    <span class="nt">&lt;mvc:interceptors&gt;</span>
        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&#34;/fore*&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.qqlin.tmall.interceptor.LoginInterceptor&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&#34;/fore*&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.qqlin.tmall.interceptor.OtherInterceptor&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
    <span class="nt">&lt;/mvc:interceptors&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="328-其他拦截器">3.2.8 其他拦截器</h3>
<h4 id="otherinterceptor">OtherInterCeptor</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span><span class="lnt">99
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.interceptor</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.CategoryService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.handler.HandlerInterceptorAdapter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author qqlin
</span><span class="cm"> * @date 2020-5-22
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OtherInterceptor</span> <span class="kd">extends</span> <span class="n">HandlerInterceptorAdapter</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">OtherInterceptor</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 在业务处理器处理请求之前被调用
</span><span class="cm">     * 如果返回false:
</span><span class="cm">     * --- 从当前的拦截器往回执行所有拦截器的afterCompoletion(),再退出拦截器链
</span><span class="cm">     * 如果返回true:
</span><span class="cm">     * --- 执行下一个拦截器，知道所有拦截器都执行完毕
</span><span class="cm">     * --- 再执行被拦截器的Controller
</span><span class="cm">     * --- 然后进入拦截器链
</span><span class="cm">     * --- 从最后一个拦截器往回执行所有的postHandle()
</span><span class="cm">     * --- 接着再从最后一个拦截器往回执行所有的afterCompletion()
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 在业务处理器处理请求执行完成后，生成视图之前执行的动作
</span><span class="cm">     * 可以在modelAndView中加入数据，比如当前时间
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">postHandle</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">,</span> <span class="n">modelAndView</span><span class="o">);</span>

        <span class="cm">/**
</span><span class="cm">         * 这里是获取分类集合信息，用于放在搜索栏下面
</span><span class="cm">         */</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">categories</span><span class="o">);</span>

        <span class="cm">/**
</span><span class="cm">         * 这里是获取当前的contextPath：tmall_ssm,用于放在左上角那个变形金刚，
</span><span class="cm">         * 点击后才能跳转到首页，否则点击之后，也仅仅停留在当前页面
</span><span class="cm">         */</span>
        <span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">contextPath</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getContextPath</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;contextPath&#34;</span><span class="o">,</span> <span class="n">contextPath</span><span class="o">);</span>

        <span class="cm">/**
</span><span class="cm">         * 这里是获取购物车中一共有多少数量
</span><span class="cm">         */</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">cartTotalItemNumber</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">orderItem</span> <span class="o">:</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">cartTotalItemNumber</span> <span class="o">+=</span> <span class="n">orderItem</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;cartTotalItemNumber&#34;</span><span class="o">,</span> <span class="n">cartTotalItemNumber</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 在DispatcherServlet完全处理完请求后被调用,可用于清理资源等
</span><span class="cm">     * &lt;p&gt;
</span><span class="cm">     * 当有拦截器抛出异常时,会从当前拦截器往回执行所有的拦截器的afterCompletion()
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">afterCompletion</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterConcurrentHandlingStarted</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">afterConcurrentHandlingStarted</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="springmvcxml-1">springMVC.xml</h4>
<p>添加拦截器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&#34;/fore*&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.qqlin.tmall.interceptor.OtherInterceptor&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
       <span class="na">xmlns:mvc=</span><span class="s">&#34;http://www.springframework.org/schema/mvc&#34;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
</span><span class="s">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
</span><span class="s">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd&#34;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!--启动注解识别--&gt;</span>
    <span class="nt">&lt;context:annotation-config/&gt;</span>

    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.qqlin.tmall.controller&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;context:include-filter</span> <span class="na">type=</span><span class="s">&#34;annotation&#34;</span>
                                <span class="na">expression=</span><span class="s">&#34;org.springframework.stereotype.Controller&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/context:component-scan&gt;</span>

    <span class="nt">&lt;mvc:annotation-driven/&gt;</span>

    <span class="c">&lt;!--开通静态资源的访问--&gt;</span>
    <span class="nt">&lt;mvc:default-servlet-handler/&gt;</span>

    <span class="c">&lt;!-- 视图定位 --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">name=</span><span class="s">&#34;internalResourceViewResolver&#34;</span>
          <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;viewClass&#34;</span>
                  <span class="na">value=</span><span class="s">&#34;org.springframework.web.servlet.view.JstlView&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/jsp/&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- 对上传文件的解析--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;multipartResolver&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.multipart.commons.CommonsMultipartResolver&#34;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- 添加拦截器--&gt;</span>
    <span class="nt">&lt;mvc:interceptors&gt;</span>
        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&#34;/fore*&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.qqlin.tmall.interceptor.LoginInterceptor&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
        <span class="nt">&lt;mvc:interceptor&gt;</span>
            <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&#34;/fore*&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.qqlin.tmall.interceptor.OtherInterceptor&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/mvc:interceptor&gt;</span>
    <span class="nt">&lt;/mvc:interceptors&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="329-购物车页面">3.2.9 购物车页面</h3>
<blockquote>
<p>购物车页面和服务端的交互主要是三个</p>
<ol>
<li>增加、减少某种产品的数量</li>
<li>删除某种产品</li>
<li>选中产品后，提交到结算页面</li>
</ol>
</blockquote>
<h4 id="forecontrollerchangeorderitem">ForeController.changeOrderItem()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/cart&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forechangeOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">pid</span><span class="o">){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
 
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerdeleteorderitem">ForeController.deleteOrderItem()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/cart&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forechangeOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">pid</span><span class="o">){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
 
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span><span class="kt">int</span> <span class="n">oiid</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">oiid</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="3210-订单状态">3.2.10 订单状态</h3>
<p><img src="https://stepimagewm.how2j.cn/6410.png" alt="订单状态图"></p>
<blockquote>
<p>在开始实现订单相关功能之前，我们把订单的状态捋一捋，这样有助于代码思路更加清晰</p>
<ol>
<li>首先是创建订单，刚创建好之后，订单处于waitPay 待付款状态</li>
<li>接着是付款，付款后，订单处于waitDelivery 待发货状态</li>
<li>前两步都是前台用户操作导致的，接下来需要到后台做发货操作，发货后，订单处于waitConfirm 待确认收货状态</li>
<li>接着又是前台用户进行确认收货操作，操作之后，订单处于waitReview 待评价状态</li>
<li>最后进行评价，评价之后，订单处于finish 完成状态</li>
</ol>
<p>以上状态都是一个接一个的，不能跳状态进行。
比较特殊的是，无论当前订单处于哪个状态，都可以进行删除操作。 像订单这样极其重要的业务数据，实际上是不允许真正从数据库中删除掉的，而是把状态标记为删除，以表示其被删掉了，所以在删除之后，订单处于 delete 已删除状态</p>
</blockquote>
<h3 id="3211-生成订单">3.2.11 生成订单</h3>
<p>需要在订单中增加事务管理</p>
<h4 id="applicationcontextxml">applicationContext.xml</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">    &lt;!--事务管理--&gt;
    &lt;tx:annotation-driven transaction-manager=&#34;transactionManager&#34;/&gt;
    &lt;bean id=&#34;transactionManager&#34; class=&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;&gt;
        &lt;property name=&#34;dataSource&#34; ref=&#34;dataSource&#34; /&gt;
    &lt;/bean&gt;
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       <span class="na">xmlns:tx=</span><span class="s">&#34;http://www.springframework.org/schema/tx&#34;</span>
       <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;
</span><span class="s">     http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
</span><span class="s">     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
</span><span class="s">     http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;context:annotation-config/&gt;</span>
    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.qqlin.tmall.service&#34;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- 导入数据库配置文件 --&gt;</span>
    <span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&#34;classpath:jdbc.properties&#34;</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!-- 配置数据库连接池 --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;com.alibaba.druid.pool.DruidDataSource&#34;</span> <span class="na">init-method=</span><span class="s">&#34;init&#34;</span> <span class="na">destroy-method=</span><span class="s">&#34;close&#34;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- 基本属性 url、user、password --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;url&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.url}&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;username&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.username}&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.password}&#34;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- 配置初始化大小、最小、最大 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;initialSize&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;minIdle&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxActive&#34;</span> <span class="na">value=</span><span class="s">&#34;20&#34;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- 配置获取连接等待超时的时间 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxWait&#34;</span> <span class="na">value=</span><span class="s">&#34;60000&#34;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;timeBetweenEvictionRunsMillis&#34;</span> <span class="na">value=</span><span class="s">&#34;60000&#34;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- 配置一个连接在池中最小生存的时间，单位是毫秒 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;minEvictableIdleTimeMillis&#34;</span> <span class="na">value=</span><span class="s">&#34;300000&#34;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;validationQuery&#34;</span> <span class="na">value=</span><span class="s">&#34;SELECT 1&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;testWhileIdle&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;testOnBorrow&#34;</span> <span class="na">value=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;testOnReturn&#34;</span> <span class="na">value=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- 打开PSCache，并且指定每个连接上PSCache的大小 --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;poolPreparedStatements&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxPoolPreparedStatementPerConnectionSize&#34;</span>
                  <span class="na">value=</span><span class="s">&#34;20&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!--Mybatis的SessionFactory配置--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;sqlSession&#34;</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.spring.SqlSessionFactoryBean&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;typeAliasesPackage&#34;</span> <span class="na">value=</span><span class="s">&#34;com.qqlin.tmall.pojo&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;mapperLocations&#34;</span> <span class="na">value=</span><span class="s">&#34;classpath:mapper/*.xml&#34;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;plugins&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;array&gt;</span>
                <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.github.pagehelper.PageInterceptor&#34;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;properties&#34;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;value&gt;</span>
                        <span class="nt">&lt;/value&gt;</span>
                    <span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;/bean&gt;</span>
            <span class="nt">&lt;/array&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!--Mybatis的Mapper文件识别--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.mybatis.spring.mapper.MapperScannerConfigurer&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;basePackage&#34;</span> <span class="na">value=</span><span class="s">&#34;com.qqlin.tmall.mapper&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!--事务管理--&gt;</span>
    <span class="nt">&lt;tx:annotation-driven</span> <span class="na">transaction-manager=</span><span class="s">&#34;transactionManager&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;transactionManager&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="orderservice-1">OrderService</h4>
<p>新增方法add(Order c, List<!-- raw HTML omitted --> ois)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItem</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderService</span> <span class="o">{</span>
 
    <span class="n">String</span> <span class="n">waitPay</span> <span class="o">=</span> <span class="s">&#34;waitPay&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">waitDelivery</span> <span class="o">=</span> <span class="s">&#34;waitDelivery&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">waitConfirm</span> <span class="o">=</span> <span class="s">&#34;waitConfirm&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">waitReview</span> <span class="o">=</span> <span class="s">&#34;waitReview&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">finish</span> <span class="o">=</span> <span class="s">&#34;finish&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">delete</span> <span class="o">=</span> <span class="s">&#34;delete&#34;</span><span class="o">;</span>
 
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">);</span>
 
    <span class="kt">float</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">,</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">);</span>
    <span class="n">Order</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="orderserviceimpl-1">OrderServiceImpl</h4>
<p>实现add(Order o, List<!-- raw HTML omitted --> ois)方法，该方法通过注解进行事务管理</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.OrderMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.UserService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Propagation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>
 
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderServiceImpl</span> <span class="kd">implements</span> <span class="n">OrderService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderMapper</span> <span class="n">orderMapper</span><span class="o">;</span>
 
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">propagation</span><span class="o">=</span> <span class="n">Propagation</span><span class="o">.</span><span class="na">REQUIRED</span><span class="o">,</span><span class="n">rollbackForClassName</span><span class="o">=</span><span class="s">&#34;Exception&#34;</span><span class="o">)</span>
 
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">o</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="n">add</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
 
        <span class="cm">/**
</span><span class="cm">         * 用来模拟当增加订单后出现异常，观察事务管理是否预期发生。
</span><span class="cm">         * （需要把false修改为true才能观察到）
</span><span class="cm">         */</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">();</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span><span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setOid</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">total</span><span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">total</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Order</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(){</span>
        <span class="n">OrderExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">orderMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
 
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="froecontrollercraeteorder">FroeController.craeteOrder</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.math.RandomUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/cart&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forechangeOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">pid</span><span class="o">){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
 
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span><span class="kt">int</span> <span class="n">oiid</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">oiid</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecreateOrder&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createOrder</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">Order</span> <span class="n">order</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">orderCode</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyyMMddHHmmssSSS&#34;</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">())</span> <span class="o">+</span> <span class="n">RandomUtils</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setOrderCode</span><span class="o">(</span><span class="n">orderCode</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitPay</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">);</span>
 
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span><span class="n">orderService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">order</span><span class="o">,</span><span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forealipay?oid=&#34;</span><span class="o">+</span><span class="n">order</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span><span class="s">&#34;&amp;total=&#34;</span><span class="o">+</span><span class="n">total</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="alipayjsp">alipay.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/cart/alipayPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="alipaypagejsp">alipayPage.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
     
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;aliPayPageDiv&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;aliPayPageLogo&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pull-left&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/simpleLogo.png&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmMoneyText&#34;</span><span class="p">&gt;</span>扫一扫付款（元）<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmMoney&#34;</span><span class="p">&gt;</span>
        ￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${param.total}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
         
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;aliPayImg&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/alipay2wei.png&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forepayed?oid=${param.oid}&amp;total=${param.total}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPay&#34;</span><span class="p">&gt;</span>确认支付<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerpayed">ForeController.payed()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.math.RandomUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/cart&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forechangeOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">pid</span><span class="o">){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
 
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span><span class="kt">int</span> <span class="n">oiid</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">oiid</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecreateOrder&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createOrder</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">Order</span> <span class="n">order</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">orderCode</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyyMMddHHmmssSSS&#34;</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">())</span> <span class="o">+</span> <span class="n">RandomUtils</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setOrderCode</span><span class="o">(</span><span class="n">orderCode</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitPay</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">);</span>
 
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span><span class="n">orderService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">order</span><span class="o">,</span><span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forealipay?oid=&#34;</span><span class="o">+</span><span class="n">order</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span><span class="s">&#34;&amp;total=&#34;</span><span class="o">+</span><span class="n">total</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forepayed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">payed</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">,</span> <span class="kt">float</span> <span class="n">total</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitDelivery</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setPayDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">order</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/payed&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="payedjsp">payed.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/simpleSearch.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/cart/payedPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><p>payedPage.jsp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
     
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;payedDiv&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;payedTextDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/paySuccess.png&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>您已成功付款<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
         
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;payedAddressInfo&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>收货地址：${o.address} ${o.receiver} ${o.mobile }<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>实付款：<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;payedInfoPrice&#34;</span><span class="p">&gt;</span>
            ￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${param.total}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>预计08月08日送达    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
                 
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;paedCheckLinkDiv&#34;</span><span class="p">&gt;</span>
            您可以
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;payedCheckLink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forebought&#34;</span><span class="p">&gt;</span>查看已买到的宝贝<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;payedCheckLink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forebought&#34;</span><span class="p">&gt;</span>查看交易详情 <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
             
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;payedSeperateLine&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;warningDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/warning.png&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>安全提醒：<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>下单后，<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;redColor boldWord&#34;</span><span class="p">&gt;</span>用QQ给您发送链接办理退款的都是骗子！<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>天猫不存在系统升级，订单异常等问题，谨防假冒客服电话诈骗！
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="3212-我的订单页">3.2.12 我的订单页</h3>
<h4 id="orderservice-2">OrderService</h4>
<p>修改OrderService，新增方法 List list(int uid, String excludedStatus);</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItem</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderService</span> <span class="o">{</span>
 
    <span class="n">String</span> <span class="n">waitPay</span> <span class="o">=</span> <span class="s">&#34;waitPay&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">waitDelivery</span> <span class="o">=</span> <span class="s">&#34;waitDelivery&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">waitConfirm</span> <span class="o">=</span> <span class="s">&#34;waitConfirm&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">waitReview</span> <span class="o">=</span> <span class="s">&#34;waitReview&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">finish</span> <span class="o">=</span> <span class="s">&#34;finish&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">delete</span> <span class="o">=</span> <span class="s">&#34;delete&#34;</span><span class="o">;</span>
 
    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">);</span>
    <span class="kt">float</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">,</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">);</span>
    <span class="n">Order</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">();</span>
    <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">uid</span><span class="o">,</span> <span class="n">String</span> <span class="n">excludedStatus</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="orderserviceimpl-2">OrderServiceImpl</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.service.impl</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.mapper.OrderMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.Order</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderExample</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.OrderItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderItemService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.OrderService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.UserService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Propagation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderServiceImpl</span> <span class="kd">implements</span> <span class="n">OrderService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderMapper</span> <span class="n">orderMapper</span><span class="o">;</span>
 
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderMapper</span><span class="o">.</span><span class="na">deleteByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Order</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderMapper</span><span class="o">.</span><span class="na">updateByPrimaryKeySelective</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Order</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">orderMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(){</span>
        <span class="n">OrderExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">orderMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
 
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">list</span><span class="o">(</span><span class="kt">int</span> <span class="n">uid</span><span class="o">,</span> <span class="n">String</span> <span class="n">excludedStatus</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">OrderExample</span> <span class="n">example</span> <span class="o">=</span><span class="k">new</span> <span class="n">OrderExample</span><span class="o">();</span>
        <span class="n">example</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">().</span><span class="na">andUidEqualTo</span><span class="o">(</span><span class="n">uid</span><span class="o">).</span><span class="na">andStatusNotEqualTo</span><span class="o">(</span><span class="n">excludedStatus</span><span class="o">);</span>
        <span class="n">example</span><span class="o">.</span><span class="na">setOrderByClause</span><span class="o">(</span><span class="s">&#34;id desc&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">orderMapper</span><span class="o">.</span><span class="na">selectByExample</span><span class="o">(</span><span class="n">example</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="o">;</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">){</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Order</span> <span class="n">o</span> <span class="o">:</span> <span class="n">os</span><span class="o">)</span>
            <span class="n">setUser</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">Order</span> <span class="n">o</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">uid</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="na">getUid</span><span class="o">();</span>
        <span class="n">User</span> <span class="n">u</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">uid</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="n">u</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">propagation</span><span class="o">=</span> <span class="n">Propagation</span><span class="o">.</span><span class="na">REQUIRED</span><span class="o">,</span><span class="n">rollbackForClassName</span><span class="o">=</span><span class="s">&#34;Exception&#34;</span><span class="o">)</span>
 
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">add</span><span class="o">(</span><span class="n">Order</span> <span class="n">o</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="n">add</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">();</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span><span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setOid</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">total</span><span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">total</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerboutht">ForeController.boutht()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.math.RandomUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/cart&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forechangeOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">pid</span><span class="o">){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
 
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span><span class="kt">int</span> <span class="n">oiid</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">oiid</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecreateOrder&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createOrder</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">Order</span> <span class="n">order</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">orderCode</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyyMMddHHmmssSSS&#34;</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">())</span> <span class="o">+</span> <span class="n">RandomUtils</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setOrderCode</span><span class="o">(</span><span class="n">orderCode</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitPay</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">);</span>
 
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span><span class="n">orderService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">order</span><span class="o">,</span><span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forealipay?oid=&#34;</span><span class="o">+</span><span class="n">order</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span><span class="s">&#34;&amp;total=&#34;</span><span class="o">+</span><span class="n">total</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forepayed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">payed</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">,</span> <span class="kt">float</span> <span class="n">total</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitDelivery</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setPayDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">order</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/payed&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebought&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">bought</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span><span class="n">OrderService</span><span class="o">.</span><span class="na">delete</span><span class="o">);</span>
 
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;os&#34;</span><span class="o">,</span> <span class="n">os</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;fore/bought&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="boughtjsp">bought.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/simpleSearch.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/cart/boughtPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="boughtpagejsp">boughtPage.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
  
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kd">var</span> <span class="nx">deleteOrder</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">deleteOrderid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;a[orderStatus]&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">orderStatus</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;orderStatus&#34;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="o">==</span><span class="nx">orderStatus</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;table[orderStatus]&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;table[orderStatus]&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;table[orderStatus=&#34;</span><span class="o">+</span><span class="nx">orderStatus</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>        
        <span class="p">}</span>
         
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;div.orderType div&#34;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&#34;selectedOrderType&#34;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parent</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&#34;selectedOrderType&#34;</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;a.deleteOrderLink&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">deleteOrderid</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;oid&#34;</span><span class="p">);</span>
        <span class="nx">deleteOrder</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#deleteConfirmModal&#34;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">&#34;show&#34;</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;button.deleteConfirmButton&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">deleteOrder</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#deleteConfirmModal&#34;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s1">&#39;hide&#39;</span><span class="p">);</span>
    <span class="p">});</span>
     
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#deleteConfirmModal&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;hidden.bs.modal&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">deleteOrder</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">page</span><span class="o">=</span><span class="s2">&#34;foredeleteOrder&#34;</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
                    <span class="nx">page</span><span class="p">,</span>
                    <span class="p">{</span><span class="s2">&#34;oid&#34;</span><span class="o">:</span><span class="nx">deleteOrderid</span><span class="p">},</span>
                    <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
                        <span class="k">if</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="o">==</span><span class="nx">result</span><span class="p">){</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;table.orderListItemTable[oid=&#34;</span><span class="o">+</span><span class="nx">deleteOrderid</span><span class="o">+</span><span class="s2">&#34;]&#34;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
                        <span class="p">}</span>
                        <span class="k">else</span><span class="p">{</span>
                            <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">&#34;login.jsp&#34;</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">);</span>
             
        <span class="p">}</span>
    <span class="p">})</span>     
     
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;.ask2delivery&#34;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;link&#34;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">page</span> <span class="o">=</span> <span class="nx">link</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
               <span class="nx">url</span><span class="o">:</span> <span class="nx">page</span><span class="p">,</span>
               <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;卖家已秒发，刷新当前页面，即可进行确认收货&#34;</span><span class="p">)</span>
               <span class="p">}</span>
            <span class="p">});</span>
         
    <span class="p">});</span>
<span class="p">});</span>
 
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
     
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;boughtDiv&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderType&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;selectedOrderType&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">orderStatus</span><span class="o">=</span><span class="s">&#34;all&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>所有订单<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">a</span>  <span class="na">orderStatus</span><span class="o">=</span><span class="s">&#34;waitPay&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>待付款<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">a</span>  <span class="na">orderStatus</span><span class="o">=</span><span class="s">&#34;waitDelivery&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>待发货<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">a</span>  <span class="na">orderStatus</span><span class="o">=</span><span class="s">&#34;waitConfirm&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>待收货<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">a</span>  <span class="na">orderStatus</span><span class="o">=</span><span class="s">&#34;waitReview&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;noRightborder&#34;</span><span class="p">&gt;</span>待评价<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderTypeLastOne&#34;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;noRightborder&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListTitle&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListTitleTable&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>宝贝<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;100px&#34;</span><span class="p">&gt;</span>单价<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;100px&#34;</span><span class="p">&gt;</span>数量<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;120px&#34;</span><span class="p">&gt;</span>实付款<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;100px&#34;</span><span class="p">&gt;</span>交易操作<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
     
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItem&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${os}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;o&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemTable&#34;</span> <span class="na">orderStatus</span><span class="o">=</span><span class="s">&#34;${o.status}&#34;</span> <span class="na">oid</span><span class="o">=</span><span class="s">&#34;${o.id}&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemFirstTR&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;&lt;</span><span class="nt">fmt:formatDate</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${o.createDate}&#34;</span> <span class="na">pattern</span><span class="o">=</span><span class="s">&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>订单号: ${o.orderCode}
                    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span>  <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;13px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/orderItemTmall.png&#34;</span><span class="p">&gt;</span>天猫商场<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;1&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;wangwanglink&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemWangWangGif&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                         
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemDeleteTD&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;deleteOrderLink&#34;</span> <span class="na">oid</span><span class="o">=</span><span class="s">&#34;${o.id}&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">span</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemDelete glyphicon glyphicon-trash&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                         
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${o.orderItems}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;oi&#34;</span> <span class="na">varStatus</span><span class="o">=</span><span class="s">&#34;st&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemProductInfoPartTR&#34;</span> <span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemProductInfoPartTD&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;80&#34;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;80&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/productSingle_middle/${oi.product.firstProductImage.id}.jpg&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemProductInfoPartTD&#34;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemProductLinkOutDiv&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;foreproduct?pid=${oi.product.id}&#34;</span><span class="p">&gt;</span>${oi.product.name}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemProductLinkInnerDiv&#34;</span><span class="p">&gt;</span>
                                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/creditcard.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;支持信用卡支付&#34;</span><span class="p">&gt;</span>
                                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/7day.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;消费者保障服务,承诺7天退货&#34;</span><span class="p">&gt;</span>
                                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/promise.png&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;消费者保障服务,承诺如实描述&#34;</span><span class="p">&gt;</span>                      
                                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderItemProductInfoPartTD&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;100px&#34;</span><span class="p">&gt;</span>
                         
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemProductOriginalPrice&#34;</span><span class="p">&gt;</span>￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${oi.product.originalPrice}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemProductPrice&#34;</span><span class="p">&gt;</span>￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${oi.product.promotePrice}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
         
                        <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${st.count==1}&#34;</span><span class="p">&gt;</span>
                          
                            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">valign</span><span class="o">=</span><span class="s">&#34;top&#34;</span> <span class="na">rowspan</span><span class="o">=</span><span class="s">&#34;${fn:length(o.orderItems)}&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemNumberTD orderItemOrderInfoPartTD&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;100px&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemNumber&#34;</span><span class="p">&gt;</span>${o.totalNumber}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">valign</span><span class="o">=</span><span class="s">&#34;top&#34;</span> <span class="na">rowspan</span><span class="o">=</span><span class="s">&#34;${fn:length(o.orderItems)}&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;120px&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemProductRealPriceTD orderItemOrderInfoPartTD&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemProductRealPrice&#34;</span><span class="p">&gt;</span>￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span>  <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span>  <span class="na">maxFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${o.total}&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemPriceWithTransport&#34;</span><span class="p">&gt;</span>(含运费：￥0.00)<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">valign</span><span class="o">=</span><span class="s">&#34;top&#34;</span> <span class="na">rowspan</span><span class="o">=</span><span class="s">&#34;${fn:length(o.orderItems)}&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemButtonTD orderItemOrderInfoPartTD&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;100px&#34;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${o.status==&#39;waitConfirm&#39; }&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;foreconfirmPay?oid=${o.id}&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemConfirm&#34;</span><span class="p">&gt;</span>确认收货<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${o.status==&#39;waitPay&#39; }&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forealipay?oid=${o.id}&amp;total=${o.total}&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemConfirm&#34;</span><span class="p">&gt;</span>付款<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>                             
                                <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                                 
                                <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${o.status==&#39;waitDelivery&#39; }&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>待发货<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="err">&lt;</span>%--                                     <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-info btn-sm ask2delivery&#34;</span> <span class="na">link</span><span class="o">=</span><span class="s">&#34;admin_order_delivery?id=${o.id}&#34;</span><span class="p">&gt;</span>催卖家发货<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span> --%&gt;
                                     
                                <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
 
                                <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${o.status==&#39;waitReview&#39; }&#34;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;forereview?oid=${o.id}&#34;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">button</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderListItemReview&#34;</span><span class="p">&gt;</span>评价<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>                    
                        <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>     
                 
            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
         
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
     
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="3213-我的订单页面操作">3.2.13 我的订单页面操作</h3>
<p>确认收货/foreconfirmPay</p>
<h4 id="confirmpayjsp">confirmPay.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/simpleSearch.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/cart/confirmPayPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="confirmpaypagejsp">confirmPayPage.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
     
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayPageDiv&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayImageDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/comformPayFlow.png&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayTime1&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">fmt:formatDate</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${o.createDate}&#34;</span> <span class="na">pattern</span><span class="o">=</span><span class="s">&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span>  <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayTime2&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">fmt:formatDate</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${o.payDate}&#34;</span> <span class="na">pattern</span><span class="o">=</span><span class="s">&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayTime3&#34;</span><span class="p">&gt;</span>
            yyyy-MM-dd HH:mm:ss
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
         
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayOrderInfoDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayOrderInfoText&#34;</span><span class="p">&gt;</span>我已收到货，同意支付宝付款<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayOrderItemDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayOrderItemText&#34;</span><span class="p">&gt;</span>订单信息<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayOrderItemTable&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">&gt;</span>宝贝<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>    
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;120px&#34;</span><span class="p">&gt;</span>单价<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>      
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;120px&#34;</span><span class="p">&gt;</span>数量<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>      
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;120px&#34;</span><span class="p">&gt;</span>商品总价 <span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>       
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;120px&#34;</span><span class="p">&gt;</span>运费<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>      
            <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${o.orderItems}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;oi&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;50px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/productSingle_middle/${oi.product.firstProductImage.id}.jpg&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayOrderItemProductLink&#34;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#nowhere&#34;</span><span class="p">&gt;</span>${oi.product.name}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${oi.product.originalPrice}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>1<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;conformPayProductPrice&#34;</span><span class="p">&gt;</span>￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${oi.product.promotePrice}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">span</span><span class="p">&gt;</span>快递 ： 0.00 <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
         
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayOrderItemText pull-right&#34;</span><span class="p">&gt;</span>
            实付款： <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayOrderItemSumPrice&#34;</span><span class="p">&gt;</span>￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${o.total}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
         
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayOrderDetailDiv&#34;</span><span class="p">&gt;</span>
         
        <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayOrderDetailTable&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>订单编号：<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${o.orderCode} <span class="p">&lt;</span><span class="nt">img</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;23px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/confirmOrderTmall.png&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>卖家昵称：<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>天猫商铺 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayOrderDetailWangWangGif&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>收货信息： <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${o.address}，${o.receiver}， ${o.mobile}，${o.post} <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>成交时间：<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">fmt:formatDate</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${o.createDate}&#34;</span> <span class="na">pattern</span><span class="o">=</span><span class="s">&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
         
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayButtonDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayWarning&#34;</span><span class="p">&gt;</span>请收到货后，再确认收货！否则您可能钱货两空！<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;foreorderConfirmed?oid=${o.id}&#34;</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;confirmPayButton&#34;</span><span class="p">&gt;</span>确认支付<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerconfirmpay">ForeController.confirmPay()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.math.RandomUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/cart&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forechangeOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">pid</span><span class="o">){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
 
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span><span class="kt">int</span> <span class="n">oiid</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">oiid</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecreateOrder&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">createOrder</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">Order</span> <span class="n">order</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
    <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">orderCode</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyyMMddHHmmssSSS&#34;</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">())</span> <span class="o">+</span> <span class="n">RandomUtils</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setOrderCode</span><span class="o">(</span><span class="n">orderCode</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitPay</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">);</span>
  
    <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span><span class="n">orderService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">order</span><span class="o">,</span><span class="n">ois</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&#34;redirect:forealipay?oid=&#34;</span><span class="o">+</span><span class="n">order</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span><span class="s">&#34;&amp;total=&#34;</span><span class="o">+</span><span class="n">total</span><span class="o">;</span>
<span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forepayed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">payed</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">,</span> <span class="kt">float</span> <span class="n">total</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitDelivery</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setPayDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">order</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/payed&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebought&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">bought</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span><span class="n">OrderService</span><span class="o">.</span><span class="na">delete</span><span class="o">);</span>
 
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;os&#34;</span><span class="o">,</span> <span class="n">os</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;fore/bought&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreconfirmPay&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">confirmPay</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/confirmPay&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="orderconfirmedjsp">orderConfirmed.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/simpleSearch.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/cart/orderConfirmedPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="orderconfirmedpagejsp">orderConfirmedPage.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
     
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderFinishDiv&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;orderFinishTextDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/orderFinish.png&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>交易已经成功，卖家将收到您的货款。<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerorderconfirmed">ForeController.orderConfirmed()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.math.RandomUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/cart&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forechangeOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">pid</span><span class="o">){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
 
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span><span class="kt">int</span> <span class="n">oiid</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">oiid</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecreateOrder&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">createOrder</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">Order</span> <span class="n">order</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
    <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">orderCode</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyyMMddHHmmssSSS&#34;</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">())</span> <span class="o">+</span> <span class="n">RandomUtils</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setOrderCode</span><span class="o">(</span><span class="n">orderCode</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitPay</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">);</span>
  
    <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span><span class="n">orderService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">order</span><span class="o">,</span><span class="n">ois</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&#34;redirect:forealipay?oid=&#34;</span><span class="o">+</span><span class="n">order</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span><span class="s">&#34;&amp;total=&#34;</span><span class="o">+</span><span class="n">total</span><span class="o">;</span>
<span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forepayed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">payed</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">,</span> <span class="kt">float</span> <span class="n">total</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitDelivery</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setPayDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">order</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/payed&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebought&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">bought</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span><span class="n">OrderService</span><span class="o">.</span><span class="na">delete</span><span class="o">);</span>
 
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;os&#34;</span><span class="o">,</span> <span class="n">os</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;fore/bought&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreconfirmPay&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">confirmPay</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/confirmPay&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreorderConfirmed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">orderConfirmed</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitReview</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setConfirmDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/orderConfirmed&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerdeleteorder">ForeController.deleteOrder()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.math.RandomUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/cart&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forechangeOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">pid</span><span class="o">){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
 
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span><span class="kt">int</span> <span class="n">oiid</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">oiid</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecreateOrder&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">createOrder</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">Order</span> <span class="n">order</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
    <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">orderCode</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyyMMddHHmmssSSS&#34;</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">())</span> <span class="o">+</span> <span class="n">RandomUtils</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setOrderCode</span><span class="o">(</span><span class="n">orderCode</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitPay</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">);</span>
  
    <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span><span class="n">orderService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">order</span><span class="o">,</span><span class="n">ois</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&#34;redirect:forealipay?oid=&#34;</span><span class="o">+</span><span class="n">order</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span><span class="s">&#34;&amp;total=&#34;</span><span class="o">+</span><span class="n">total</span><span class="o">;</span>
<span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forepayed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">payed</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">,</span> <span class="kt">float</span> <span class="n">total</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitDelivery</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setPayDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">order</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/payed&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebought&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">bought</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span><span class="n">OrderService</span><span class="o">.</span><span class="na">delete</span><span class="o">);</span>
 
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;os&#34;</span><span class="o">,</span> <span class="n">os</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;fore/bought&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreconfirmPay&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">confirmPay</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/confirmPay&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreorderConfirmed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">orderConfirmed</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitReview</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setConfirmDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/orderConfirmed&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrder&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteOrder</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">){</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">delete</span><span class="o">);</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="3214-评价">3.2.14 评价</h3>
<h4 id="reviewjsp">review.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
 
<span class="err">&lt;</span>%@include file=&#34;../include/fore/header.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/top.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/simpleSearch.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/cart/reviewPage.jsp&#34;%&gt;
<span class="err">&lt;</span>%@include file=&#34;../include/fore/footer.jsp&#34;%&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="reviewpagejsp">reviewPage.jsp</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="err">&lt;</span>%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34;
    pageEncoding=&#34;UTF-8&#34; isELIgnored=&#34;false&#34;%&gt;
     
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewDiv&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewProductInfoDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewProductInfoImg&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;400px&#34;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;400px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/productSingle/${p.firstProductImage.id}.jpg&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewProductInfoRightDiv&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewProductInfoRightText&#34;</span><span class="p">&gt;</span>
                ${p.name}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewProductInfoTable&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;75px&#34;</span><span class="p">&gt;</span>价格:<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewProductInfoTablePrice&#34;</span><span class="p">&gt;</span>￥<span class="p">&lt;</span><span class="nt">fmt:formatNumber</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${p.originalPrice}&#34;</span> <span class="na">minFractionDigits</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> 元 <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>配送<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>快递:  0.00<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>月销量:<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewProductInfoTableSellNumber&#34;</span><span class="p">&gt;</span>${p.saleCount}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> 件<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
             
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewProductInfoRightBelowDiv&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewProductInfoRightBelowImg&#34;</span><span class="p">&gt;&lt;</span><span class="nt">img1</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;img/site/reviewLight.png&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewProductInfoRightBelowText&#34;</span> <span class="p">&gt;</span>现在查看的是 您所购买商品的信息
于<span class="p">&lt;</span><span class="nt">fmt:formatDate</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${o.createDate}&#34;</span> <span class="na">pattern</span><span class="o">=</span><span class="s">&#34;yyyy年MM月dd&#34;</span><span class="p">/&gt;</span>下单购买了此商品 <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
             
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;clear:both&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewStasticsDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewStasticsLeft&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewStasticsLeftTop&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewStasticsLeftContent&#34;</span><span class="p">&gt;</span>累计评价 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewStasticsNumber&#34;</span><span class="p">&gt;</span> ${p.reviewCount}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewStasticsLeftFoot&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewStasticsRight&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewStasticsRightEmpty&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewStasticsFoot&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>       
     
    <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${param.showonly==true}&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewDivlistReviews&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">c:forEach</span> <span class="na">items</span><span class="o">=</span><span class="s">&#34;${reviews}&#34;</span> <span class="na">var</span><span class="o">=</span><span class="s">&#34;r&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewDivlistReviewsEach&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewDate&#34;</span><span class="p">&gt;&lt;</span><span class="nt">fmt:formatDate</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${r.createDate}&#34;</span> <span class="na">pattern</span><span class="o">=</span><span class="s">&#34;yyyy-MM-dd&#34;</span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewContent&#34;</span><span class="p">&gt;</span>${r.content}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewUserInfo pull-right&#34;</span><span class="p">&gt;</span>${r.user.anonymousName}<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;reviewUserInfoAnonymous&#34;</span><span class="p">&gt;</span>(匿名)<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">c:forEach</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
     
    <span class="p">&lt;</span><span class="nt">c:if</span> <span class="na">test</span><span class="o">=</span><span class="s">&#34;${param.showonly!=true}&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;makeReviewDiv&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;foredoreview&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;makeReviewText&#34;</span><span class="p">&gt;</span>其他买家，需要你的建议哦！<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;makeReviewTable&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;makeReviewTableFirstTD&#34;</span><span class="p">&gt;</span>评价商品<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;makeReviewButtonDiv&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;hidden&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;oid&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${o.id}&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;hidden&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;pid&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;${p.id}&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>提交评价<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>   
    <span class="p">&lt;/</span><span class="nt">c:if</span><span class="p">&gt;</span>
 
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerreview">ForeController.review()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.math.RandomUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/cart&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forechangeOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">pid</span><span class="o">){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
 
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span><span class="kt">int</span> <span class="n">oiid</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">oiid</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecreateOrder&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">createOrder</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">Order</span> <span class="n">order</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
    <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">orderCode</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyyMMddHHmmssSSS&#34;</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">())</span> <span class="o">+</span> <span class="n">RandomUtils</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setOrderCode</span><span class="o">(</span><span class="n">orderCode</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitPay</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">);</span>
  
    <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span><span class="n">orderService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">order</span><span class="o">,</span><span class="n">ois</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&#34;redirect:forealipay?oid=&#34;</span><span class="o">+</span><span class="n">order</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span><span class="s">&#34;&amp;total=&#34;</span><span class="o">+</span><span class="n">total</span><span class="o">;</span>
<span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forepayed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">payed</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">,</span> <span class="kt">float</span> <span class="n">total</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitDelivery</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setPayDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">order</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/payed&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebought&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">bought</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span><span class="n">OrderService</span><span class="o">.</span><span class="na">delete</span><span class="o">);</span>
 
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;os&#34;</span><span class="o">,</span> <span class="n">os</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;fore/bought&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreconfirmPay&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">confirmPay</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/confirmPay&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreorderConfirmed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">orderConfirmed</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitReview</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setConfirmDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/orderConfirmed&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrder&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteOrder</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">){</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">delete</span><span class="o">);</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forereview&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">review</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="na">getOrderItems</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">).</span><span class="na">getProduct</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">o</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/review&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="forecontrollerdoreview">ForeController.doreview()</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.qqlin.tmall.controller</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.github.pagehelper.PageHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.pojo.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.qqlin.tmall.service.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">comparator.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.math.RandomUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.HtmlUtils</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ProductImageService</span> <span class="n">productImageService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">PropertyValueService</span> <span class="n">propertyValueService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderService</span> <span class="n">orderService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">OrderItemService</span> <span class="n">orderItemService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">ReviewService</span> <span class="n">reviewService</span><span class="o">;</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forehome&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">cs</span><span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fillByRow</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;cs&#34;</span><span class="o">,</span> <span class="n">cs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/home&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreregister&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">register</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">exist</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">isExist</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
         
        <span class="k">if</span><span class="o">(</span><span class="n">exist</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span><span class="s">&#34;用户名已经被使用,不能使用&#34;</span><span class="o">;</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
 
            <span class="k">return</span> <span class="s">&#34;fore/register&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:registerSuccessPage&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogin&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&#34;fore/login&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forelogout&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forehome&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreproduct&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">product</span><span class="o">(</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productSingleImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_single</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ProductImage</span><span class="o">&gt;</span> <span class="n">productDetailImages</span> <span class="o">=</span> <span class="n">productImageService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">ProductImageService</span><span class="o">.</span><span class="na">type_detail</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductSingleImages</span><span class="o">(</span><span class="n">productSingleImages</span><span class="o">);</span>
        <span class="n">p</span><span class="o">.</span><span class="na">setProductDetailImages</span><span class="o">(</span><span class="n">productDetailImages</span><span class="o">);</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PropertyValue</span><span class="o">&gt;</span> <span class="n">pvs</span> <span class="o">=</span> <span class="n">propertyValueService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;pvs&#34;</span><span class="o">,</span> <span class="n">pvs</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/product&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecheckLogin&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">checkLogin</span><span class="o">(</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreloginAjax&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginAjax</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">){</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecategory&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">category</span><span class="o">(</span><span class="kt">int</span> <span class="n">cid</span><span class="o">,</span><span class="n">String</span> <span class="n">sort</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Category</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categoryService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cid</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">());</span>
 
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">!=</span><span class="n">sort</span><span class="o">){</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">sort</span><span class="o">){</span>
                <span class="k">case</span> <span class="s">&#34;review&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductReviewComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="s">&#34;date&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductDateComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;saleCount&#34;</span> <span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductSaleCountComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;price&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductPriceComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
 
                <span class="k">case</span> <span class="s">&#34;all&#34;</span><span class="o">:</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getProducts</span><span class="o">(),</span><span class="k">new</span> <span class="n">ProductAllComparator</span><span class="o">());</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/category&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foresearch&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">keyword</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
 
        <span class="n">PageHelper</span><span class="o">.</span><span class="na">offsetPage</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">20</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">ps</span><span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">ps</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ps&#34;</span><span class="o">,</span><span class="n">ps</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/searchResult&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuyone&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buyone</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">oiid</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
            <span class="n">oiid</span> <span class="o">=</span> <span class="n">oi</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;redirect:forebuy?oiid=&#34;</span><span class="o">+</span><span class="n">oiid</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebuy&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">buy</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">String</span><span class="o">[]</span> <span class="n">oiid</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
 
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">strid</span> <span class="o">:</span> <span class="n">oiid</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strid</span><span class="o">);</span>
            <span class="n">OrderItem</span> <span class="n">oi</span><span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">total</span> <span class="o">+=</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getPromotePrice</span><span class="o">()*</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">();</span>
            <span class="n">ois</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;total&#34;</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/buy&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreaddCart&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addCart</span><span class="o">(</span><span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()+</span><span class="n">num</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderItem</span><span class="o">();</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="n">oi</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
            <span class="n">orderItemService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecart&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">cart</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">,</span> <span class="n">ois</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/cart&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forechangeOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span> <span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">orderItemService</span><span class="o">.</span><span class="na">listByUser</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">OrderItem</span> <span class="n">oi</span> <span class="o">:</span> <span class="n">ois</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">oi</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">()==</span><span class="n">pid</span><span class="o">){</span>
                <span class="n">oi</span><span class="o">.</span><span class="na">setNumber</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
                <span class="n">orderItemService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">oi</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
 
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrderItem&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteOrderItem</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span><span class="kt">int</span> <span class="n">oiid</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">user</span><span class="o">)</span>
            <span class="k">return</span> <span class="s">&#34;fail&#34;</span><span class="o">;</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">oiid</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forecreateOrder&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">createOrder</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">Order</span> <span class="n">order</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
    <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">orderCode</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyyMMddHHmmssSSS&#34;</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">())</span> <span class="o">+</span> <span class="n">RandomUtils</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setOrderCode</span><span class="o">(</span><span class="n">orderCode</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitPay</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">ois</span><span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;ois&#34;</span><span class="o">);</span>
  
    <span class="kt">float</span> <span class="n">total</span> <span class="o">=</span><span class="n">orderService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">order</span><span class="o">,</span><span class="n">ois</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&#34;redirect:forealipay?oid=&#34;</span><span class="o">+</span><span class="n">order</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span><span class="s">&#34;&amp;total=&#34;</span><span class="o">+</span><span class="n">total</span><span class="o">;</span>
<span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forepayed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">payed</span><span class="o">(</span><span class="kt">int</span> <span class="n">oid</span><span class="o">,</span> <span class="kt">float</span> <span class="n">total</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitDelivery</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">setPayDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">order</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/payed&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forebought&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">bought</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">os</span><span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span><span class="n">OrderService</span><span class="o">.</span><span class="na">delete</span><span class="o">);</span>
 
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">os</span><span class="o">);</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;os&#34;</span><span class="o">,</span> <span class="n">os</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;fore/bought&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreconfirmPay&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">confirmPay</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/confirmPay&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foreorderConfirmed&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">orderConfirmed</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">waitReview</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setConfirmDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/orderConfirmed&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredeleteOrder&#34;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteOrder</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">){</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">delete</span><span class="o">);</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;forereview&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">review</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="kt">int</span> <span class="n">oid</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">orderItemService</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="na">getOrderItems</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">).</span><span class="na">getProduct</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Review</span><span class="o">&gt;</span> <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviewService</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">productService</span><span class="o">.</span><span class="na">setSaleAndReviewNumber</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;o&#34;</span><span class="o">,</span> <span class="n">o</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;reviews&#34;</span><span class="o">,</span> <span class="n">reviews</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;fore/review&#34;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;foredoreview&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">doreview</span><span class="o">(</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;oid&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">oid</span><span class="o">,</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;pid&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">pid</span><span class="o">,</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Order</span> <span class="n">o</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oid</span><span class="o">);</span>
        <span class="n">o</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">OrderService</span><span class="o">.</span><span class="na">finish</span><span class="o">);</span>
        <span class="n">orderService</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
 
        <span class="n">Product</span> <span class="n">p</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">HtmlUtils</span><span class="o">.</span><span class="na">htmlEscape</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
 
        <span class="n">User</span> <span class="n">user</span> <span class="o">=(</span><span class="n">User</span><span class="o">)</span>  <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
        <span class="n">Review</span> <span class="n">review</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Review</span><span class="o">();</span>
        <span class="n">review</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
        <span class="n">review</span><span class="o">.</span><span class="na">setPid</span><span class="o">(</span><span class="n">pid</span><span class="o">);</span>
        <span class="n">review</span><span class="o">.</span><span class="na">setCreateDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="n">review</span><span class="o">.</span><span class="na">setUid</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="n">reviewService</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">review</span><span class="o">);</span>
 
        <span class="k">return</span> <span class="s">&#34;redirect:forereview?oid=&#34;</span><span class="o">+</span><span class="n">oid</span><span class="o">+</span><span class="s">&#34;&amp;showonly=true&#34;</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="四项目总结">四、项目总结</h1>
<h2 id="41-项目结构">4.1 项目结构</h2>
<ol>
<li>
<p>项目名称 tmall_ssm</p>
</li>
<li>
<p>java源代码包结构</p>
<blockquote>
<p>pojo 实体类
mapper Mapper类
interceptor 拦截器
controller 控制层
service Service层
test 测试类
util 工具类
comparator 比较类</p>
</blockquote>
</li>
<li>
<p>web目录</p>
<blockquote>
<p>css  css文件
img 图片资源
js js文件
admin 后台管理用到的jsp文件
fore 前台展示用到的jsp文件
include 被包含的jsp文件</p>
</blockquote>
</li>
</ol>
<h2 id="42-运用的场景">4.2 运用的场景</h2>
<ol>
<li>
<p>购物车</p>
<blockquote>
<p>立即购买 加入购物车 查看购物车页面 购物车页面操作</p>
</blockquote>
</li>
<li>
<p>订单状态流转</p>
<blockquote>
<p>生成订单 确认支付 后台发货 确认收货 评价</p>
</blockquote>
</li>
<li>
<p>CRUD</p>
</li>
<li>
<p>分页</p>
</li>
<li>
<p>一类产品多个属性配置</p>
</li>
<li>
<p>一款产品多个图片维护</p>
<blockquote>
<p>图片文件转码</p>
</blockquote>
</li>
<li>
<p>产品展示</p>
<blockquote>
<p>前台首页 前台产品页</p>
</blockquote>
</li>
<li>
<p>搜索查询</p>
<blockquote>
<p>模糊查询 搜索结果排序（比较器）</p>
</blockquote>
</li>
<li>
<p>登录、注册</p>
<blockquote>
<p>注册 登录 退出</p>
</blockquote>
</li>
<li>
<p>登录验证</p>
<blockquote>
<p>登录状态拦截器</p>
</blockquote>
</li>
<li>
<p>事务管理</p>
<blockquote>
<p>订单的创建</p>
</blockquote>
</li>
</ol>
<h2 id="43-设计模式">4.3 设计模式</h2>
<blockquote>
<ol>
<li>
<p>MVC
MVC设计模式贯穿于整个后台与前台功能开发始末</p>
</li>
<li>
<p>重构
通过发现问题，分析问题，解决问题的三部曲，进行了各种角度的重构。经历这样一个重构过程提高开发效率，降低维护成本
分页方式 ，分类逆向工程 ，所有逆向工程</p>
</li>
<li>
<p>统一的分页查询简化开发
所有的后台都使用同一个分页机制，仅仅需要一份简化的adminPage.jsp即满足了各种分页功能的需求，简化了开发，提升了开发速度。</p>
</li>
<li>
<p>模块化JSP设计
从大的JSP文件中，通过JSP包含关系抽象出多个公共文件，并把业务JSP按照功能，设计为多个小的JSP文件，便于维护和理解</p>
</li>
</ol>
</blockquote>
<h2 id="44-需要改进">4.4 需要改进</h2>
<ol>
<li>后台管理员登陆模块</li>
<li>产品图片排序</li>
<li>用户的信息展示与编辑</li>
<li>收货地址的管理</li>
<li>订单的物流信息</li>
<li>订单的售后功能</li>
<li>前台分类下显示产品，提供分页功能</li>
<li>缓存问题</li>
<li>多线程与并发</li>
</ol>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/spring-framework/">Spring Framework</a>
          <a href="/tags/springmvc/">SpringMVC</a>
          <a href="/tags/mybatis/">Mybatis</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/14.springboot%E9%A1%B9%E7%9B%AE/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">基于springboot框架的电商系统</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/12.spring%E4%B8%ADautowired%E7%9A%84%E9%97%AE%E9%A2%98/">
            <span class="next-text nav-default">IntelliJ IDEA：Field injection is not recommended</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:492332435@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/daniel1n" class="iconfont icon-github" title="github"></a>
  <a href="https://daniel1n.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Daniel1n</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>








</body>
</html>
